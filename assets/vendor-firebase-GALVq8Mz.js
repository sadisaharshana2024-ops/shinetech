const of=()=>{};var Iu={};const tl=function(r){const t=[];let e=0;for(let n=0;n<r.length;n++){let s=r.charCodeAt(n);s<128?t[e++]=s:s<2048?(t[e++]=s>>6|192,t[e++]=s&63|128):(s&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(s=65536+((s&1023)<<10)+(r.charCodeAt(++n)&1023),t[e++]=s>>18|240,t[e++]=s>>12&63|128,t[e++]=s>>6&63|128,t[e++]=s&63|128):(t[e++]=s>>12|224,t[e++]=s>>6&63|128,t[e++]=s&63|128)}return t},af=function(r){const t=[];let e=0,n=0;for(;e<r.length;){const s=r[e++];if(s<128)t[n++]=String.fromCharCode(s);else if(s>191&&s<224){const i=r[e++];t[n++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=r[e++],a=r[e++],u=r[e++],l=((s&7)<<18|(i&63)<<12|(a&63)<<6|u&63)-65536;t[n++]=String.fromCharCode(55296+(l>>10)),t[n++]=String.fromCharCode(56320+(l&1023))}else{const i=r[e++],a=r[e++];t[n++]=String.fromCharCode((s&15)<<12|(i&63)<<6|a&63)}}return t.join("")},el={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,t){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let s=0;s<r.length;s+=3){const i=r[s],a=s+1<r.length,u=a?r[s+1]:0,l=s+2<r.length,d=l?r[s+2]:0,m=i>>2,p=(i&3)<<4|u>>4;let I=(u&15)<<2|d>>6,S=d&63;l||(S=64,a||(I=64)),n.push(e[m],e[p],e[I],e[S])}return n.join("")},encodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(r):this.encodeByteArray(tl(r),t)},decodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(r):af(this.decodeStringToByteArray(r,t))},decodeStringToByteArray(r,t){this.init_();const e=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let s=0;s<r.length;){const i=e[r.charAt(s++)],u=s<r.length?e[r.charAt(s)]:0;++s;const d=s<r.length?e[r.charAt(s)]:64;++s;const p=s<r.length?e[r.charAt(s)]:64;if(++s,i==null||u==null||d==null||p==null)throw new uf;const I=i<<2|u>>4;if(n.push(I),d!==64){const S=u<<4&240|d>>2;if(n.push(S),p!==64){const C=d<<6&192|p;n.push(C)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}};class uf extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const cf=function(r){const t=tl(r);return el.encodeByteArray(t,!0)},bs=function(r){return cf(r).replace(/\./g,"")},lf=function(r){try{return el.decodeString(r,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function nl(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const hf=()=>nl().__FIREBASE_DEFAULTS__,df=()=>{if(typeof process>"u"||typeof Iu>"u")return;const r=Iu.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},ff=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=r&&lf(r[1]);return t&&JSON.parse(t)},Ro=()=>{try{return of()||hf()||df()||ff()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},mf=r=>Ro()?.emulatorHosts?.[r],pf=r=>{const t=mf(r);if(!t)return;const e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const n=parseInt(t.substring(e+1),10);return t[0]==="["?[t.substring(1,e-1),n]:[t.substring(0,e),n]},rl=()=>Ro()?.config;class gf{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,n))}}}function So(r){try{return(r.startsWith("http://")||r.startsWith("https://")?new URL(r).hostname:r).endsWith(".cloudworkstations.dev")}catch{return!1}}async function _f(r){return(await fetch(r,{credentials:"include"})).ok}function yf(r,t){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const e={alg:"none",type:"JWT"},n=t||"demo-project",s=r.iat||0,i=r.sub||r.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${n}`,aud:n,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...r};return[bs(JSON.stringify(e)),bs(JSON.stringify(a)),""].join(".")}const lr={};function If(){const r={prod:[],emulator:[]};for(const t of Object.keys(lr))lr[t]?r.emulator.push(t):r.prod.push(t);return r}function Ef(r){let t=document.getElementById(r),e=!1;return t||(t=document.createElement("div"),t.setAttribute("id",r),e=!0),{created:e,element:t}}let Eu=!1;function Tf(r,t){if(typeof window>"u"||typeof document>"u"||!So(window.location.host)||lr[r]===t||lr[r]||Eu)return;lr[r]=t;function e(I){return`__firebase__banner__${I}`}const n="__firebase__banner",i=If().prod.length>0;function a(){const I=document.getElementById(n);I&&I.remove()}function u(I){I.style.display="flex",I.style.background="#7faaf0",I.style.position="fixed",I.style.bottom="5px",I.style.left="5px",I.style.padding=".5em",I.style.borderRadius="5px",I.style.alignItems="center"}function l(I,S){I.setAttribute("width","24"),I.setAttribute("id",S),I.setAttribute("height","24"),I.setAttribute("viewBox","0 0 24 24"),I.setAttribute("fill","none"),I.style.marginLeft="-6px"}function d(){const I=document.createElement("span");return I.style.cursor="pointer",I.style.marginLeft="16px",I.style.fontSize="24px",I.innerHTML=" &times;",I.onclick=()=>{Eu=!0,a()},I}function m(I,S){I.setAttribute("id",S),I.innerText="Learn more",I.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",I.setAttribute("target","__blank"),I.style.paddingLeft="5px",I.style.textDecoration="underline"}function p(){const I=Ef(n),S=e("text"),C=document.getElementById(S)||document.createElement("span"),k=e("learnmore"),M=document.getElementById(k)||document.createElement("a"),G=e("preprendIcon"),U=document.getElementById(G)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(I.created){const B=I.element;u(B),m(M,k);const J=d();l(U,G),B.append(U,C,M,J),document.body.appendChild(B)}i?(C.innerText="Preview backend disconnected.",U.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(U.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,C.innerText="Preview backend running in this workspace."),C.setAttribute("id",S)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",p):p()}function Rs(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function sl(){const r=Ro()?.forceEnvironment;if(r==="node")return!0;if(r==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function il(){return!sl()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function ol(){return!sl()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function al(){try{return typeof indexedDB=="object"}catch{return!1}}function wf(){return new Promise((r,t)=>{try{let e=!0;const n="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(n);s.onsuccess=()=>{s.result.close(),e||self.indexedDB.deleteDatabase(n),r(!0)},s.onupgradeneeded=()=>{e=!1},s.onerror=()=>{t(s.error?.message||"")}}catch(e){t(e)}})}const vf="FirebaseError";class xn extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name=vf,Object.setPrototypeOf(this,xn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ul.prototype.create)}}class ul{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},s=`${this.service}/${t}`,i=this.errors[t],a=i?Af(i,n):"Error",u=`${this.serviceName}: ${a} (${s}).`;return new xn(s,u,n)}}function Af(r,t){return r.replace(bf,(e,n)=>{const s=t[n];return s!=null?String(s):`<${n}?>`})}const bf=/\{\$([^}]+)}/g;function Ss(r,t){if(r===t)return!0;const e=Object.keys(r),n=Object.keys(t);for(const s of e){if(!n.includes(s))return!1;const i=r[s],a=t[s];if(Tu(i)&&Tu(a)){if(!Ss(i,a))return!1}else if(i!==a)return!1}for(const s of n)if(!e.includes(s))return!1;return!0}function Tu(r){return r!==null&&typeof r=="object"}function Kt(r){return r&&r._delegate?r._delegate:r}class Ir{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const xe="[DEFAULT]";class Rf{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const n=new gf;if(this.instancesDeferred.set(e,n),this.isInitialized(e)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:e});s&&n.resolve(s)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){const e=this.normalizeInstanceIdentifier(t?.identifier),n=t?.optional??!1;if(this.isInitialized(e)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:e})}catch(s){if(n)return null;throw s}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(Pf(t))try{this.getOrInitializeService({instanceIdentifier:xe})}catch{}for(const[e,n]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(e);try{const i=this.getOrInitializeService({instanceIdentifier:s});n.resolve(i)}catch{}}}}clearInstance(t=xe){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=xe){return this.instances.has(t)}getOptions(t=xe){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[i,a]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(i);n===u&&a.resolve(s)}return s}onInit(t,e){const n=this.normalizeInstanceIdentifier(e),s=this.onInitCallbacks.get(n)??new Set;s.add(t),this.onInitCallbacks.set(n,s);const i=this.instances.get(n);return i&&t(i,n),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const s of n)try{s(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:Sf(t),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch{}return n||null}normalizeInstanceIdentifier(t=xe){return this.component?this.component.multipleInstances?t:xe:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Sf(r){return r===xe?void 0:r}function Pf(r){return r.instantiationMode==="EAGER"}class Vf{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new Rf(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}var W;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(W||(W={}));const Cf={debug:W.DEBUG,verbose:W.VERBOSE,info:W.INFO,warn:W.WARN,error:W.ERROR,silent:W.SILENT},Df=W.INFO,xf={[W.DEBUG]:"log",[W.VERBOSE]:"log",[W.INFO]:"info",[W.WARN]:"warn",[W.ERROR]:"error"},Nf=(r,t,...e)=>{if(t<r.logLevel)return;const n=new Date().toISOString(),s=xf[t];if(s)console[s](`[${n}]  ${r.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class cl{constructor(t){this.name=t,this._logLevel=Df,this._logHandler=Nf,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in W))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?Cf[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,W.DEBUG,...t),this._logHandler(this,W.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,W.VERBOSE,...t),this._logHandler(this,W.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,W.INFO,...t),this._logHandler(this,W.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,W.WARN,...t),this._logHandler(this,W.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,W.ERROR,...t),this._logHandler(this,W.ERROR,...t)}}const kf=(r,t)=>t.some(e=>r instanceof e);let wu,vu;function Mf(){return wu||(wu=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Of(){return vu||(vu=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const ll=new WeakMap,Qi=new WeakMap,hl=new WeakMap,Li=new WeakMap,Po=new WeakMap;function Ff(r){const t=new Promise((e,n)=>{const s=()=>{r.removeEventListener("success",i),r.removeEventListener("error",a)},i=()=>{e(de(r.result)),s()},a=()=>{n(r.error),s()};r.addEventListener("success",i),r.addEventListener("error",a)});return t.then(e=>{e instanceof IDBCursor&&ll.set(e,r)}).catch(()=>{}),Po.set(t,r),t}function Lf(r){if(Qi.has(r))return;const t=new Promise((e,n)=>{const s=()=>{r.removeEventListener("complete",i),r.removeEventListener("error",a),r.removeEventListener("abort",a)},i=()=>{e(),s()},a=()=>{n(r.error||new DOMException("AbortError","AbortError")),s()};r.addEventListener("complete",i),r.addEventListener("error",a),r.addEventListener("abort",a)});Qi.set(r,t)}let Yi={get(r,t,e){if(r instanceof IDBTransaction){if(t==="done")return Qi.get(r);if(t==="objectStoreNames")return r.objectStoreNames||hl.get(r);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return de(r[t])},set(r,t,e){return r[t]=e,!0},has(r,t){return r instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in r}};function Bf(r){Yi=r(Yi)}function Uf(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){const n=r.call(Bi(this),t,...e);return hl.set(n,t.sort?t.sort():[t]),de(n)}:Of().includes(r)?function(...t){return r.apply(Bi(this),t),de(ll.get(this))}:function(...t){return de(r.apply(Bi(this),t))}}function qf(r){return typeof r=="function"?Uf(r):(r instanceof IDBTransaction&&Lf(r),kf(r,Mf())?new Proxy(r,Yi):r)}function de(r){if(r instanceof IDBRequest)return Ff(r);if(Li.has(r))return Li.get(r);const t=qf(r);return t!==r&&(Li.set(r,t),Po.set(t,r)),t}const Bi=r=>Po.get(r);function jf(r,t,{blocked:e,upgrade:n,blocking:s,terminated:i}={}){const a=indexedDB.open(r,t),u=de(a);return n&&a.addEventListener("upgradeneeded",l=>{n(de(a.result),l.oldVersion,l.newVersion,de(a.transaction),l)}),e&&a.addEventListener("blocked",l=>e(l.oldVersion,l.newVersion,l)),u.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),u}const zf=["get","getKey","getAll","getAllKeys","count"],$f=["put","add","delete","clear"],Ui=new Map;function Au(r,t){if(!(r instanceof IDBDatabase&&!(t in r)&&typeof t=="string"))return;if(Ui.get(t))return Ui.get(t);const e=t.replace(/FromIndex$/,""),n=t!==e,s=$f.includes(e);if(!(e in(n?IDBIndex:IDBObjectStore).prototype)||!(s||zf.includes(e)))return;const i=async function(a,...u){const l=this.transaction(a,s?"readwrite":"readonly");let d=l.store;return n&&(d=d.index(u.shift())),(await Promise.all([d[e](...u),s&&l.done]))[0]};return Ui.set(t,i),i}Bf(r=>({...r,get:(t,e,n)=>Au(t,e)||r.get(t,e,n),has:(t,e)=>!!Au(t,e)||r.has(t,e)}));class Gf{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(Kf(e)){const n=e.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(e=>e).join(" ")}}function Kf(r){return r.getComponent()?.type==="VERSION"}const Ji="@firebase/app",bu="0.14.8";const Yt=new cl("@firebase/app"),Hf="@firebase/app-compat",Wf="@firebase/analytics-compat",Qf="@firebase/analytics",Yf="@firebase/app-check-compat",Jf="@firebase/app-check",Xf="@firebase/auth",Zf="@firebase/auth-compat",tm="@firebase/database",em="@firebase/data-connect",nm="@firebase/database-compat",rm="@firebase/functions",sm="@firebase/functions-compat",im="@firebase/installations",om="@firebase/installations-compat",am="@firebase/messaging",um="@firebase/messaging-compat",cm="@firebase/performance",lm="@firebase/performance-compat",hm="@firebase/remote-config",dm="@firebase/remote-config-compat",fm="@firebase/storage",mm="@firebase/storage-compat",pm="@firebase/firestore",gm="@firebase/ai",_m="@firebase/firestore-compat",ym="firebase",Im="12.9.0";const Xi="[DEFAULT]",Em={[Ji]:"fire-core",[Hf]:"fire-core-compat",[Qf]:"fire-analytics",[Wf]:"fire-analytics-compat",[Jf]:"fire-app-check",[Yf]:"fire-app-check-compat",[Xf]:"fire-auth",[Zf]:"fire-auth-compat",[tm]:"fire-rtdb",[em]:"fire-data-connect",[nm]:"fire-rtdb-compat",[rm]:"fire-fn",[sm]:"fire-fn-compat",[im]:"fire-iid",[om]:"fire-iid-compat",[am]:"fire-fcm",[um]:"fire-fcm-compat",[cm]:"fire-perf",[lm]:"fire-perf-compat",[hm]:"fire-rc",[dm]:"fire-rc-compat",[fm]:"fire-gcs",[mm]:"fire-gcs-compat",[pm]:"fire-fst",[_m]:"fire-fst-compat",[gm]:"fire-vertex","fire-js":"fire-js",[ym]:"fire-js-all"};const Ps=new Map,Tm=new Map,Zi=new Map;function Ru(r,t){try{r.container.addComponent(t)}catch(e){Yt.debug(`Component ${t.name} failed to register with FirebaseApp ${r.name}`,e)}}function Vs(r){const t=r.name;if(Zi.has(t))return Yt.debug(`There were multiple attempts to register component ${t}.`),!1;Zi.set(t,r);for(const e of Ps.values())Ru(e,r);for(const e of Tm.values())Ru(e,r);return!0}function wm(r,t){const e=r.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),r.container.getProvider(t)}function vm(r){return r==null?!1:r.settings!==void 0}const Am={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},fe=new ul("app","Firebase",Am);class bm{constructor(t,e,n){this._isDeleted=!1,this._options={...t},this._config={...e},this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Ir("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw fe.create("app-deleted",{appName:this._name})}}const Rm=Im;function Sm(r,t={}){let e=r;typeof t!="object"&&(t={name:t});const n={name:Xi,automaticDataCollectionEnabled:!0,...t},s=n.name;if(typeof s!="string"||!s)throw fe.create("bad-app-name",{appName:String(s)});if(e||(e=rl()),!e)throw fe.create("no-options");const i=Ps.get(s);if(i){if(Ss(e,i.options)&&Ss(n,i.config))return i;throw fe.create("duplicate-app",{appName:s})}const a=new Vf(s);for(const l of Zi.values())a.addComponent(l);const u=new bm(e,n,a);return Ps.set(s,u),u}function Pm(r=Xi){const t=Ps.get(r);if(!t&&r===Xi&&rl())return Sm();if(!t)throw fe.create("no-app",{appName:r});return t}function pn(r,t,e){let n=Em[r]??r;e&&(n+=`-${e}`);const s=n.match(/\s|\//),i=t.match(/\s|\//);if(s||i){const a=[`Unable to register library "${n}" with version "${t}":`];s&&a.push(`library name "${n}" contains illegal characters (whitespace or "/")`),s&&i&&a.push("and"),i&&a.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Yt.warn(a.join(" "));return}Vs(new Ir(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}const Vm="firebase-heartbeat-database",Cm=1,Er="firebase-heartbeat-store";let qi=null;function dl(){return qi||(qi=jf(Vm,Cm,{upgrade:(r,t)=>{switch(t){case 0:try{r.createObjectStore(Er)}catch(e){console.warn(e)}}}}).catch(r=>{throw fe.create("idb-open",{originalErrorMessage:r.message})})),qi}async function Dm(r){try{const e=(await dl()).transaction(Er),n=await e.objectStore(Er).get(fl(r));return await e.done,n}catch(t){if(t instanceof xn)Yt.warn(t.message);else{const e=fe.create("idb-get",{originalErrorMessage:t?.message});Yt.warn(e.message)}}}async function Su(r,t){try{const n=(await dl()).transaction(Er,"readwrite");await n.objectStore(Er).put(t,fl(r)),await n.done}catch(e){if(e instanceof xn)Yt.warn(e.message);else{const n=fe.create("idb-set",{originalErrorMessage:e?.message});Yt.warn(n.message)}}}function fl(r){return`${r.name}!${r.options.appId}`}const xm=1024,Nm=30;class km{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new Om(e),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){try{const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=Pu();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(s=>s.date===n))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:e}),this._heartbeatsCache.heartbeats.length>Nm){const s=Fm(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(t){Yt.warn(t)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Pu(),{heartbeatsToSend:e,unsentEntries:n}=Mm(this._heartbeatsCache.heartbeats),s=bs(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return Yt.warn(t),""}}}function Pu(){return new Date().toISOString().substring(0,10)}function Mm(r,t=xm){const e=[];let n=r.slice();for(const s of r){const i=e.find(a=>a.agent===s.agent);if(i){if(i.dates.push(s.date),Vu(e)>t){i.dates.pop();break}}else if(e.push({agent:s.agent,dates:[s.date]}),Vu(e)>t){e.pop();break}n=n.slice(1)}return{heartbeatsToSend:e,unsentEntries:n}}class Om{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return al()?wf().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const e=await Dm(this.app);return e?.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){if(await this._canUseIndexedDBPromise){const n=await this.read();return Su(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){if(await this._canUseIndexedDBPromise){const n=await this.read();return Su(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}else return}}function Vu(r){return bs(JSON.stringify({version:2,heartbeats:r})).length}function Fm(r){if(r.length===0)return-1;let t=0,e=r[0].date;for(let n=1;n<r.length;n++)r[n].date<e&&(e=r[n].date,t=n);return t}function Lm(r){Vs(new Ir("platform-logger",t=>new Gf(t),"PRIVATE")),Vs(new Ir("heartbeat",t=>new km(t),"PRIVATE")),pn(Ji,bu,r),pn(Ji,bu,"esm2020"),pn("fire-js","")}Lm("");var Bm="firebase",Um="12.9.0";pn(Bm,Um,"app");var Cu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var me,ml;(function(){var r;function t(E,g){function y(){}y.prototype=g.prototype,E.F=g.prototype,E.prototype=new y,E.prototype.constructor=E,E.D=function(w,T,b){for(var _=Array(arguments.length-2),Vt=2;Vt<arguments.length;Vt++)_[Vt-2]=arguments[Vt];return g.prototype[T].apply(w,_)}}function e(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}t(n,e),n.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(E,g,y){y||(y=0);const w=Array(16);if(typeof g=="string")for(var T=0;T<16;++T)w[T]=g.charCodeAt(y++)|g.charCodeAt(y++)<<8|g.charCodeAt(y++)<<16|g.charCodeAt(y++)<<24;else for(T=0;T<16;++T)w[T]=g[y++]|g[y++]<<8|g[y++]<<16|g[y++]<<24;g=E.g[0],y=E.g[1],T=E.g[2];let b=E.g[3],_;_=g+(b^y&(T^b))+w[0]+3614090360&4294967295,g=y+(_<<7&4294967295|_>>>25),_=b+(T^g&(y^T))+w[1]+3905402710&4294967295,b=g+(_<<12&4294967295|_>>>20),_=T+(y^b&(g^y))+w[2]+606105819&4294967295,T=b+(_<<17&4294967295|_>>>15),_=y+(g^T&(b^g))+w[3]+3250441966&4294967295,y=T+(_<<22&4294967295|_>>>10),_=g+(b^y&(T^b))+w[4]+4118548399&4294967295,g=y+(_<<7&4294967295|_>>>25),_=b+(T^g&(y^T))+w[5]+1200080426&4294967295,b=g+(_<<12&4294967295|_>>>20),_=T+(y^b&(g^y))+w[6]+2821735955&4294967295,T=b+(_<<17&4294967295|_>>>15),_=y+(g^T&(b^g))+w[7]+4249261313&4294967295,y=T+(_<<22&4294967295|_>>>10),_=g+(b^y&(T^b))+w[8]+1770035416&4294967295,g=y+(_<<7&4294967295|_>>>25),_=b+(T^g&(y^T))+w[9]+2336552879&4294967295,b=g+(_<<12&4294967295|_>>>20),_=T+(y^b&(g^y))+w[10]+4294925233&4294967295,T=b+(_<<17&4294967295|_>>>15),_=y+(g^T&(b^g))+w[11]+2304563134&4294967295,y=T+(_<<22&4294967295|_>>>10),_=g+(b^y&(T^b))+w[12]+1804603682&4294967295,g=y+(_<<7&4294967295|_>>>25),_=b+(T^g&(y^T))+w[13]+4254626195&4294967295,b=g+(_<<12&4294967295|_>>>20),_=T+(y^b&(g^y))+w[14]+2792965006&4294967295,T=b+(_<<17&4294967295|_>>>15),_=y+(g^T&(b^g))+w[15]+1236535329&4294967295,y=T+(_<<22&4294967295|_>>>10),_=g+(T^b&(y^T))+w[1]+4129170786&4294967295,g=y+(_<<5&4294967295|_>>>27),_=b+(y^T&(g^y))+w[6]+3225465664&4294967295,b=g+(_<<9&4294967295|_>>>23),_=T+(g^y&(b^g))+w[11]+643717713&4294967295,T=b+(_<<14&4294967295|_>>>18),_=y+(b^g&(T^b))+w[0]+3921069994&4294967295,y=T+(_<<20&4294967295|_>>>12),_=g+(T^b&(y^T))+w[5]+3593408605&4294967295,g=y+(_<<5&4294967295|_>>>27),_=b+(y^T&(g^y))+w[10]+38016083&4294967295,b=g+(_<<9&4294967295|_>>>23),_=T+(g^y&(b^g))+w[15]+3634488961&4294967295,T=b+(_<<14&4294967295|_>>>18),_=y+(b^g&(T^b))+w[4]+3889429448&4294967295,y=T+(_<<20&4294967295|_>>>12),_=g+(T^b&(y^T))+w[9]+568446438&4294967295,g=y+(_<<5&4294967295|_>>>27),_=b+(y^T&(g^y))+w[14]+3275163606&4294967295,b=g+(_<<9&4294967295|_>>>23),_=T+(g^y&(b^g))+w[3]+4107603335&4294967295,T=b+(_<<14&4294967295|_>>>18),_=y+(b^g&(T^b))+w[8]+1163531501&4294967295,y=T+(_<<20&4294967295|_>>>12),_=g+(T^b&(y^T))+w[13]+2850285829&4294967295,g=y+(_<<5&4294967295|_>>>27),_=b+(y^T&(g^y))+w[2]+4243563512&4294967295,b=g+(_<<9&4294967295|_>>>23),_=T+(g^y&(b^g))+w[7]+1735328473&4294967295,T=b+(_<<14&4294967295|_>>>18),_=y+(b^g&(T^b))+w[12]+2368359562&4294967295,y=T+(_<<20&4294967295|_>>>12),_=g+(y^T^b)+w[5]+4294588738&4294967295,g=y+(_<<4&4294967295|_>>>28),_=b+(g^y^T)+w[8]+2272392833&4294967295,b=g+(_<<11&4294967295|_>>>21),_=T+(b^g^y)+w[11]+1839030562&4294967295,T=b+(_<<16&4294967295|_>>>16),_=y+(T^b^g)+w[14]+4259657740&4294967295,y=T+(_<<23&4294967295|_>>>9),_=g+(y^T^b)+w[1]+2763975236&4294967295,g=y+(_<<4&4294967295|_>>>28),_=b+(g^y^T)+w[4]+1272893353&4294967295,b=g+(_<<11&4294967295|_>>>21),_=T+(b^g^y)+w[7]+4139469664&4294967295,T=b+(_<<16&4294967295|_>>>16),_=y+(T^b^g)+w[10]+3200236656&4294967295,y=T+(_<<23&4294967295|_>>>9),_=g+(y^T^b)+w[13]+681279174&4294967295,g=y+(_<<4&4294967295|_>>>28),_=b+(g^y^T)+w[0]+3936430074&4294967295,b=g+(_<<11&4294967295|_>>>21),_=T+(b^g^y)+w[3]+3572445317&4294967295,T=b+(_<<16&4294967295|_>>>16),_=y+(T^b^g)+w[6]+76029189&4294967295,y=T+(_<<23&4294967295|_>>>9),_=g+(y^T^b)+w[9]+3654602809&4294967295,g=y+(_<<4&4294967295|_>>>28),_=b+(g^y^T)+w[12]+3873151461&4294967295,b=g+(_<<11&4294967295|_>>>21),_=T+(b^g^y)+w[15]+530742520&4294967295,T=b+(_<<16&4294967295|_>>>16),_=y+(T^b^g)+w[2]+3299628645&4294967295,y=T+(_<<23&4294967295|_>>>9),_=g+(T^(y|~b))+w[0]+4096336452&4294967295,g=y+(_<<6&4294967295|_>>>26),_=b+(y^(g|~T))+w[7]+1126891415&4294967295,b=g+(_<<10&4294967295|_>>>22),_=T+(g^(b|~y))+w[14]+2878612391&4294967295,T=b+(_<<15&4294967295|_>>>17),_=y+(b^(T|~g))+w[5]+4237533241&4294967295,y=T+(_<<21&4294967295|_>>>11),_=g+(T^(y|~b))+w[12]+1700485571&4294967295,g=y+(_<<6&4294967295|_>>>26),_=b+(y^(g|~T))+w[3]+2399980690&4294967295,b=g+(_<<10&4294967295|_>>>22),_=T+(g^(b|~y))+w[10]+4293915773&4294967295,T=b+(_<<15&4294967295|_>>>17),_=y+(b^(T|~g))+w[1]+2240044497&4294967295,y=T+(_<<21&4294967295|_>>>11),_=g+(T^(y|~b))+w[8]+1873313359&4294967295,g=y+(_<<6&4294967295|_>>>26),_=b+(y^(g|~T))+w[15]+4264355552&4294967295,b=g+(_<<10&4294967295|_>>>22),_=T+(g^(b|~y))+w[6]+2734768916&4294967295,T=b+(_<<15&4294967295|_>>>17),_=y+(b^(T|~g))+w[13]+1309151649&4294967295,y=T+(_<<21&4294967295|_>>>11),_=g+(T^(y|~b))+w[4]+4149444226&4294967295,g=y+(_<<6&4294967295|_>>>26),_=b+(y^(g|~T))+w[11]+3174756917&4294967295,b=g+(_<<10&4294967295|_>>>22),_=T+(g^(b|~y))+w[2]+718787259&4294967295,T=b+(_<<15&4294967295|_>>>17),_=y+(b^(T|~g))+w[9]+3951481745&4294967295,E.g[0]=E.g[0]+g&4294967295,E.g[1]=E.g[1]+(T+(_<<21&4294967295|_>>>11))&4294967295,E.g[2]=E.g[2]+T&4294967295,E.g[3]=E.g[3]+b&4294967295}n.prototype.v=function(E,g){g===void 0&&(g=E.length);const y=g-this.blockSize,w=this.C;let T=this.h,b=0;for(;b<g;){if(T==0)for(;b<=y;)s(this,E,b),b+=this.blockSize;if(typeof E=="string"){for(;b<g;)if(w[T++]=E.charCodeAt(b++),T==this.blockSize){s(this,w),T=0;break}}else for(;b<g;)if(w[T++]=E[b++],T==this.blockSize){s(this,w),T=0;break}}this.h=T,this.o+=g},n.prototype.A=function(){var E=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);E[0]=128;for(var g=1;g<E.length-8;++g)E[g]=0;g=this.o*8;for(var y=E.length-8;y<E.length;++y)E[y]=g&255,g/=256;for(this.v(E),E=Array(16),g=0,y=0;y<4;++y)for(let w=0;w<32;w+=8)E[g++]=this.g[y]>>>w&255;return E};function i(E,g){var y=u;return Object.prototype.hasOwnProperty.call(y,E)?y[E]:y[E]=g(E)}function a(E,g){this.h=g;const y=[];let w=!0;for(let T=E.length-1;T>=0;T--){const b=E[T]|0;w&&b==g||(y[T]=b,w=!1)}this.g=y}var u={};function l(E){return-128<=E&&E<128?i(E,function(g){return new a([g|0],g<0?-1:0)}):new a([E|0],E<0?-1:0)}function d(E){if(isNaN(E)||!isFinite(E))return p;if(E<0)return M(d(-E));const g=[];let y=1;for(let w=0;E>=y;w++)g[w]=E/y|0,y*=4294967296;return new a(g,0)}function m(E,g){if(E.length==0)throw Error("number format error: empty string");if(g=g||10,g<2||36<g)throw Error("radix out of range: "+g);if(E.charAt(0)=="-")return M(m(E.substring(1),g));if(E.indexOf("-")>=0)throw Error('number format error: interior "-" character');const y=d(Math.pow(g,8));let w=p;for(let b=0;b<E.length;b+=8){var T=Math.min(8,E.length-b);const _=parseInt(E.substring(b,b+T),g);T<8?(T=d(Math.pow(g,T)),w=w.j(T).add(d(_))):(w=w.j(y),w=w.add(d(_)))}return w}var p=l(0),I=l(1),S=l(16777216);r=a.prototype,r.m=function(){if(k(this))return-M(this).m();let E=0,g=1;for(let y=0;y<this.g.length;y++){const w=this.i(y);E+=(w>=0?w:4294967296+w)*g,g*=4294967296}return E},r.toString=function(E){if(E=E||10,E<2||36<E)throw Error("radix out of range: "+E);if(C(this))return"0";if(k(this))return"-"+M(this).toString(E);const g=d(Math.pow(E,6));var y=this;let w="";for(;;){const T=J(y,g).g;y=G(y,T.j(g));let b=((y.g.length>0?y.g[0]:y.h)>>>0).toString(E);if(y=T,C(y))return b+w;for(;b.length<6;)b="0"+b;w=b+w}},r.i=function(E){return E<0?0:E<this.g.length?this.g[E]:this.h};function C(E){if(E.h!=0)return!1;for(let g=0;g<E.g.length;g++)if(E.g[g]!=0)return!1;return!0}function k(E){return E.h==-1}r.l=function(E){return E=G(this,E),k(E)?-1:C(E)?0:1};function M(E){const g=E.g.length,y=[];for(let w=0;w<g;w++)y[w]=~E.g[w];return new a(y,~E.h).add(I)}r.abs=function(){return k(this)?M(this):this},r.add=function(E){const g=Math.max(this.g.length,E.g.length),y=[];let w=0;for(let T=0;T<=g;T++){let b=w+(this.i(T)&65535)+(E.i(T)&65535),_=(b>>>16)+(this.i(T)>>>16)+(E.i(T)>>>16);w=_>>>16,b&=65535,_&=65535,y[T]=_<<16|b}return new a(y,y[y.length-1]&-2147483648?-1:0)};function G(E,g){return E.add(M(g))}r.j=function(E){if(C(this)||C(E))return p;if(k(this))return k(E)?M(this).j(M(E)):M(M(this).j(E));if(k(E))return M(this.j(M(E)));if(this.l(S)<0&&E.l(S)<0)return d(this.m()*E.m());const g=this.g.length+E.g.length,y=[];for(var w=0;w<2*g;w++)y[w]=0;for(w=0;w<this.g.length;w++)for(let T=0;T<E.g.length;T++){const b=this.i(w)>>>16,_=this.i(w)&65535,Vt=E.i(T)>>>16,be=E.i(T)&65535;y[2*w+2*T]+=_*be,U(y,2*w+2*T),y[2*w+2*T+1]+=b*be,U(y,2*w+2*T+1),y[2*w+2*T+1]+=_*Vt,U(y,2*w+2*T+1),y[2*w+2*T+2]+=b*Vt,U(y,2*w+2*T+2)}for(E=0;E<g;E++)y[E]=y[2*E+1]<<16|y[2*E];for(E=g;E<2*g;E++)y[E]=0;return new a(y,0)};function U(E,g){for(;(E[g]&65535)!=E[g];)E[g+1]+=E[g]>>>16,E[g]&=65535,g++}function B(E,g){this.g=E,this.h=g}function J(E,g){if(C(g))throw Error("division by zero");if(C(E))return new B(p,p);if(k(E))return g=J(M(E),g),new B(M(g.g),M(g.h));if(k(g))return g=J(E,M(g)),new B(M(g.g),g.h);if(E.g.length>30){if(k(E)||k(g))throw Error("slowDivide_ only works with positive integers.");for(var y=I,w=g;w.l(E)<=0;)y=et(y),w=et(w);var T=Q(y,1),b=Q(w,1);for(w=Q(w,2),y=Q(y,2);!C(w);){var _=b.add(w);_.l(E)<=0&&(T=T.add(y),b=_),w=Q(w,1),y=Q(y,1)}return g=G(E,T.j(g)),new B(T,g)}for(T=p;E.l(g)>=0;){for(y=Math.max(1,Math.floor(E.m()/g.m())),w=Math.ceil(Math.log(y)/Math.LN2),w=w<=48?1:Math.pow(2,w-48),b=d(y),_=b.j(g);k(_)||_.l(E)>0;)y-=w,b=d(y),_=b.j(g);C(b)&&(b=I),T=T.add(b),E=G(E,_)}return new B(T,E)}r.B=function(E){return J(this,E).h},r.and=function(E){const g=Math.max(this.g.length,E.g.length),y=[];for(let w=0;w<g;w++)y[w]=this.i(w)&E.i(w);return new a(y,this.h&E.h)},r.or=function(E){const g=Math.max(this.g.length,E.g.length),y=[];for(let w=0;w<g;w++)y[w]=this.i(w)|E.i(w);return new a(y,this.h|E.h)},r.xor=function(E){const g=Math.max(this.g.length,E.g.length),y=[];for(let w=0;w<g;w++)y[w]=this.i(w)^E.i(w);return new a(y,this.h^E.h)};function et(E){const g=E.g.length+1,y=[];for(let w=0;w<g;w++)y[w]=E.i(w)<<1|E.i(w-1)>>>31;return new a(y,E.h)}function Q(E,g){const y=g>>5;g%=32;const w=E.g.length-y,T=[];for(let b=0;b<w;b++)T[b]=g>0?E.i(b+y)>>>g|E.i(b+y+1)<<32-g:E.i(b+y);return new a(T,E.h)}n.prototype.digest=n.prototype.A,n.prototype.reset=n.prototype.u,n.prototype.update=n.prototype.v,ml=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=m,me=a}).apply(typeof Cu<"u"?Cu:typeof self<"u"?self:typeof window<"u"?window:{});var os=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var pl,ir,gl,fs,to,_l,yl,Il;(function(){var r,t=Object.defineProperty;function e(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof os=="object"&&os];for(var c=0;c<o.length;++c){var h=o[c];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var n=e(this);function s(o,c){if(c)t:{var h=n;o=o.split(".");for(var f=0;f<o.length-1;f++){var A=o[f];if(!(A in h))break t;h=h[A]}o=o[o.length-1],f=h[o],c=c(f),c!=f&&c!=null&&t(h,o,{configurable:!0,writable:!0,value:c})}}s("Symbol.dispose",function(o){return o||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(o){return o||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(o){return o||function(c){var h=[],f;for(f in c)Object.prototype.hasOwnProperty.call(c,f)&&h.push([f,c[f]]);return h}});var i=i||{},a=this||self;function u(o){var c=typeof o;return c=="object"&&o!=null||c=="function"}function l(o,c,h){return o.call.apply(o.bind,arguments)}function d(o,c,h){return d=l,d.apply(null,arguments)}function m(o,c){var h=Array.prototype.slice.call(arguments,1);return function(){var f=h.slice();return f.push.apply(f,arguments),o.apply(this,f)}}function p(o,c){function h(){}h.prototype=c.prototype,o.Z=c.prototype,o.prototype=new h,o.prototype.constructor=o,o.Ob=function(f,A,R){for(var D=Array(arguments.length-2),z=2;z<arguments.length;z++)D[z-2]=arguments[z];return c.prototype[A].apply(f,D)}}var I=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?o=>o&&AsyncContext.Snapshot.wrap(o):o=>o;function S(o){const c=o.length;if(c>0){const h=Array(c);for(let f=0;f<c;f++)h[f]=o[f];return h}return[]}function C(o,c){for(let f=1;f<arguments.length;f++){const A=arguments[f];var h=typeof A;if(h=h!="object"?h:A?Array.isArray(A)?"array":h:"null",h=="array"||h=="object"&&typeof A.length=="number"){h=o.length||0;const R=A.length||0;o.length=h+R;for(let D=0;D<R;D++)o[h+D]=A[D]}else o.push(A)}}class k{constructor(c,h){this.i=c,this.j=h,this.h=0,this.g=null}get(){let c;return this.h>0?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function M(o){a.setTimeout(()=>{throw o},0)}function G(){var o=E;let c=null;return o.g&&(c=o.g,o.g=o.g.next,o.g||(o.h=null),c.next=null),c}class U{constructor(){this.h=this.g=null}add(c,h){const f=B.get();f.set(c,h),this.h?this.h.next=f:this.g=f,this.h=f}}var B=new k(()=>new J,o=>o.reset());class J{constructor(){this.next=this.g=this.h=null}set(c,h){this.h=c,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let et,Q=!1,E=new U,g=()=>{const o=Promise.resolve(void 0);et=()=>{o.then(y)}};function y(){for(var o;o=G();){try{o.h.call(o.g)}catch(h){M(h)}var c=B;c.j(o),c.h<100&&(c.h++,o.next=c.g,c.g=o)}Q=!1}function w(){this.u=this.u,this.C=this.C}w.prototype.u=!1,w.prototype.dispose=function(){this.u||(this.u=!0,this.N())},w.prototype[Symbol.dispose]=function(){this.dispose()},w.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function T(o,c){this.type=o,this.g=this.target=c,this.defaultPrevented=!1}T.prototype.h=function(){this.defaultPrevented=!0};var b=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var o=!1,c=Object.defineProperty({},"passive",{get:function(){o=!0}});try{const h=()=>{};a.addEventListener("test",h,c),a.removeEventListener("test",h,c)}catch{}return o})();function _(o){return/^[\s\xa0]*$/.test(o)}function Vt(o,c){T.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o&&this.init(o,c)}p(Vt,T),Vt.prototype.init=function(o,c){const h=this.type=o.type,f=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;this.target=o.target||o.srcElement,this.g=c,c=o.relatedTarget,c||(h=="mouseover"?c=o.fromElement:h=="mouseout"&&(c=o.toElement)),this.relatedTarget=c,f?(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=o.pointerType,this.state=o.state,this.i=o,o.defaultPrevented&&Vt.Z.h.call(this)},Vt.prototype.h=function(){Vt.Z.h.call(this);const o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var be="closure_listenable_"+(Math.random()*1e6|0),Sd=0;function Pd(o,c,h,f,A){this.listener=o,this.proxy=null,this.src=c,this.type=h,this.capture=!!f,this.ha=A,this.key=++Sd,this.da=this.fa=!1}function Gr(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function Kr(o,c,h){for(const f in o)c.call(h,o[f],f,o)}function Vd(o,c){for(const h in o)c.call(void 0,o[h],h,o)}function ya(o){const c={};for(const h in o)c[h]=o[h];return c}const Ia="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ea(o,c){let h,f;for(let A=1;A<arguments.length;A++){f=arguments[A];for(h in f)o[h]=f[h];for(let R=0;R<Ia.length;R++)h=Ia[R],Object.prototype.hasOwnProperty.call(f,h)&&(o[h]=f[h])}}function Hr(o){this.src=o,this.g={},this.h=0}Hr.prototype.add=function(o,c,h,f,A){const R=o.toString();o=this.g[R],o||(o=this.g[R]=[],this.h++);const D=pi(o,c,f,A);return D>-1?(c=o[D],h||(c.fa=!1)):(c=new Pd(c,this.src,R,!!f,A),c.fa=h,o.push(c)),c};function mi(o,c){const h=c.type;if(h in o.g){var f=o.g[h],A=Array.prototype.indexOf.call(f,c,void 0),R;(R=A>=0)&&Array.prototype.splice.call(f,A,1),R&&(Gr(c),o.g[h].length==0&&(delete o.g[h],o.h--))}}function pi(o,c,h,f){for(let A=0;A<o.length;++A){const R=o[A];if(!R.da&&R.listener==c&&R.capture==!!h&&R.ha==f)return A}return-1}var gi="closure_lm_"+(Math.random()*1e6|0),_i={};function Ta(o,c,h,f,A){if(Array.isArray(c)){for(let R=0;R<c.length;R++)Ta(o,c[R],h,f,A);return null}return h=Aa(h),o&&o[be]?o.J(c,h,u(f)?!!f.capture:!1,A):Cd(o,c,h,!1,f,A)}function Cd(o,c,h,f,A,R){if(!c)throw Error("Invalid event type");const D=u(A)?!!A.capture:!!A;let z=Ii(o);if(z||(o[gi]=z=new Hr(o)),h=z.add(c,h,f,D,R),h.proxy)return h;if(f=Dd(),h.proxy=f,f.src=o,f.listener=h,o.addEventListener)b||(A=D),A===void 0&&(A=!1),o.addEventListener(c.toString(),f,A);else if(o.attachEvent)o.attachEvent(va(c.toString()),f);else if(o.addListener&&o.removeListener)o.addListener(f);else throw Error("addEventListener and attachEvent are unavailable.");return h}function Dd(){function o(h){return c.call(o.src,o.listener,h)}const c=xd;return o}function wa(o,c,h,f,A){if(Array.isArray(c))for(var R=0;R<c.length;R++)wa(o,c[R],h,f,A);else f=u(f)?!!f.capture:!!f,h=Aa(h),o&&o[be]?(o=o.i,R=String(c).toString(),R in o.g&&(c=o.g[R],h=pi(c,h,f,A),h>-1&&(Gr(c[h]),Array.prototype.splice.call(c,h,1),c.length==0&&(delete o.g[R],o.h--)))):o&&(o=Ii(o))&&(c=o.g[c.toString()],o=-1,c&&(o=pi(c,h,f,A)),(h=o>-1?c[o]:null)&&yi(h))}function yi(o){if(typeof o!="number"&&o&&!o.da){var c=o.src;if(c&&c[be])mi(c.i,o);else{var h=o.type,f=o.proxy;c.removeEventListener?c.removeEventListener(h,f,o.capture):c.detachEvent?c.detachEvent(va(h),f):c.addListener&&c.removeListener&&c.removeListener(f),(h=Ii(c))?(mi(h,o),h.h==0&&(h.src=null,c[gi]=null)):Gr(o)}}}function va(o){return o in _i?_i[o]:_i[o]="on"+o}function xd(o,c){if(o.da)o=!0;else{c=new Vt(c,this);const h=o.listener,f=o.ha||o.src;o.fa&&yi(o),o=h.call(f,c)}return o}function Ii(o){return o=o[gi],o instanceof Hr?o:null}var Ei="__closure_events_fn_"+(Math.random()*1e9>>>0);function Aa(o){return typeof o=="function"?o:(o[Ei]||(o[Ei]=function(c){return o.handleEvent(c)}),o[Ei])}function It(){w.call(this),this.i=new Hr(this),this.M=this,this.G=null}p(It,w),It.prototype[be]=!0,It.prototype.removeEventListener=function(o,c,h,f){wa(this,o,c,h,f)};function At(o,c){var h,f=o.G;if(f)for(h=[];f;f=f.G)h.push(f);if(o=o.M,f=c.type||c,typeof c=="string")c=new T(c,o);else if(c instanceof T)c.target=c.target||o;else{var A=c;c=new T(f,o),Ea(c,A)}A=!0;let R,D;if(h)for(D=h.length-1;D>=0;D--)R=c.g=h[D],A=Wr(R,f,!0,c)&&A;if(R=c.g=o,A=Wr(R,f,!0,c)&&A,A=Wr(R,f,!1,c)&&A,h)for(D=0;D<h.length;D++)R=c.g=h[D],A=Wr(R,f,!1,c)&&A}It.prototype.N=function(){if(It.Z.N.call(this),this.i){var o=this.i;for(const c in o.g){const h=o.g[c];for(let f=0;f<h.length;f++)Gr(h[f]);delete o.g[c],o.h--}}this.G=null},It.prototype.J=function(o,c,h,f){return this.i.add(String(o),c,!1,h,f)},It.prototype.K=function(o,c,h,f){return this.i.add(String(o),c,!0,h,f)};function Wr(o,c,h,f){if(c=o.i.g[String(c)],!c)return!0;c=c.concat();let A=!0;for(let R=0;R<c.length;++R){const D=c[R];if(D&&!D.da&&D.capture==h){const z=D.listener,ft=D.ha||D.src;D.fa&&mi(o.i,D),A=z.call(ft,f)!==!1&&A}}return A&&!f.defaultPrevented}function Nd(o,c){if(typeof o!="function")if(o&&typeof o.handleEvent=="function")o=d(o.handleEvent,o);else throw Error("Invalid listener argument");return Number(c)>2147483647?-1:a.setTimeout(o,c||0)}function ba(o){o.g=Nd(()=>{o.g=null,o.i&&(o.i=!1,ba(o))},o.l);const c=o.h;o.h=null,o.m.apply(null,c)}class kd extends w{constructor(c,h){super(),this.m=c,this.l=h,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:ba(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Fn(o){w.call(this),this.h=o,this.g={}}p(Fn,w);var Ra=[];function Sa(o){Kr(o.g,function(c,h){this.g.hasOwnProperty(h)&&yi(c)},o),o.g={}}Fn.prototype.N=function(){Fn.Z.N.call(this),Sa(this)},Fn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ti=a.JSON.stringify,Md=a.JSON.parse,Od=class{stringify(o){return a.JSON.stringify(o,void 0)}parse(o){return a.JSON.parse(o,void 0)}};function Pa(){}function Va(){}var Ln={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function wi(){T.call(this,"d")}p(wi,T);function vi(){T.call(this,"c")}p(vi,T);var Re={},Ca=null;function Qr(){return Ca=Ca||new It}Re.Ia="serverreachability";function Da(o){T.call(this,Re.Ia,o)}p(Da,T);function Bn(o){const c=Qr();At(c,new Da(c))}Re.STAT_EVENT="statevent";function xa(o,c){T.call(this,Re.STAT_EVENT,o),this.stat=c}p(xa,T);function bt(o){const c=Qr();At(c,new xa(c,o))}Re.Ja="timingevent";function Na(o,c){T.call(this,Re.Ja,o),this.size=c}p(Na,T);function Un(o,c){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){o()},c)}function qn(){this.g=!0}qn.prototype.ua=function(){this.g=!1};function Fd(o,c,h,f,A,R){o.info(function(){if(o.g)if(R){var D="",z=R.split("&");for(let nt=0;nt<z.length;nt++){var ft=z[nt].split("=");if(ft.length>1){const pt=ft[0];ft=ft[1];const qt=pt.split("_");D=qt.length>=2&&qt[1]=="type"?D+(pt+"="+ft+"&"):D+(pt+"=redacted&")}}}else D=null;else D=R;return"XMLHTTP REQ ("+f+") [attempt "+A+"]: "+c+`
`+h+`
`+D})}function Ld(o,c,h,f,A,R,D){o.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+A+"]: "+c+`
`+h+`
`+R+" "+D})}function tn(o,c,h,f){o.info(function(){return"XMLHTTP TEXT ("+c+"): "+Ud(o,h)+(f?" "+f:"")})}function Bd(o,c){o.info(function(){return"TIMEOUT: "+c})}qn.prototype.info=function(){};function Ud(o,c){if(!o.g)return c;if(!c)return null;try{const R=JSON.parse(c);if(R){for(o=0;o<R.length;o++)if(Array.isArray(R[o])){var h=R[o];if(!(h.length<2)){var f=h[1];if(Array.isArray(f)&&!(f.length<1)){var A=f[0];if(A!="noop"&&A!="stop"&&A!="close")for(let D=1;D<f.length;D++)f[D]=""}}}}return Ti(R)}catch{return c}}var Yr={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},ka={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Ma;function Ai(){}p(Ai,Pa),Ai.prototype.g=function(){return new XMLHttpRequest},Ma=new Ai;function jn(o){return encodeURIComponent(String(o))}function qd(o){var c=1;o=o.split(":");const h=[];for(;c>0&&o.length;)h.push(o.shift()),c--;return o.length&&h.push(o.join(":")),h}function ee(o,c,h,f){this.j=o,this.i=c,this.l=h,this.S=f||1,this.V=new Fn(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Oa}function Oa(){this.i=null,this.g="",this.h=!1}var Fa={},bi={};function Ri(o,c,h){o.M=1,o.A=Xr(Ut(c)),o.u=h,o.R=!0,La(o,null)}function La(o,c){o.F=Date.now(),Jr(o),o.B=Ut(o.A);var h=o.B,f=o.S;Array.isArray(f)||(f=[String(f)]),Ja(h.i,"t",f),o.C=0,h=o.j.L,o.h=new Oa,o.g=pu(o.j,h?c:null,!o.u),o.P>0&&(o.O=new kd(d(o.Y,o,o.g),o.P)),c=o.V,h=o.g,f=o.ba;var A="readystatechange";Array.isArray(A)||(A&&(Ra[0]=A.toString()),A=Ra);for(let R=0;R<A.length;R++){const D=Ta(h,A[R],f||c.handleEvent,!1,c.h||c);if(!D)break;c.g[D.key]=D}c=o.J?ya(o.J):{},o.u?(o.v||(o.v="POST"),c["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.B,o.v,o.u,c)):(o.v="GET",o.g.ea(o.B,o.v,null,c)),Bn(),Fd(o.i,o.v,o.B,o.l,o.S,o.u)}ee.prototype.ba=function(o){o=o.target;const c=this.O;c&&se(o)==3?c.j():this.Y(o)},ee.prototype.Y=function(o){try{if(o==this.g)t:{const z=se(this.g),ft=this.g.ya(),nt=this.g.ca();if(!(z<3)&&(z!=3||this.g&&(this.h.h||this.g.la()||su(this.g)))){this.K||z!=4||ft==7||(ft==8||nt<=0?Bn(3):Bn(2)),Si(this);var c=this.g.ca();this.X=c;var h=jd(this);if(this.o=c==200,Ld(this.i,this.v,this.B,this.l,this.S,z,c),this.o){if(this.U&&!this.L){e:{if(this.g){var f,A=this.g;if((f=A.g?A.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!_(f)){var R=f;break e}}R=null}if(o=R)tn(this.i,this.l,o,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Pi(this,o);else{this.o=!1,this.m=3,bt(12),Se(this),zn(this);break t}}if(this.R){o=!0;let pt;for(;!this.K&&this.C<h.length;)if(pt=zd(this,h),pt==bi){z==4&&(this.m=4,bt(14),o=!1),tn(this.i,this.l,null,"[Incomplete Response]");break}else if(pt==Fa){this.m=4,bt(15),tn(this.i,this.l,h,"[Invalid Chunk]"),o=!1;break}else tn(this.i,this.l,pt,null),Pi(this,pt);if(Ba(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),z!=4||h.length!=0||this.h.h||(this.m=1,bt(16),o=!1),this.o=this.o&&o,!o)tn(this.i,this.l,h,"[Invalid Chunked Response]"),Se(this),zn(this);else if(h.length>0&&!this.W){this.W=!0;var D=this.j;D.g==this&&D.aa&&!D.P&&(D.j.info("Great, no buffering proxy detected. Bytes received: "+h.length),Oi(D),D.P=!0,bt(11))}}else tn(this.i,this.l,h,null),Pi(this,h);z==4&&Se(this),this.o&&!this.K&&(z==4?hu(this.j,this):(this.o=!1,Jr(this)))}else rf(this.g),c==400&&h.indexOf("Unknown SID")>0?(this.m=3,bt(12)):(this.m=0,bt(13)),Se(this),zn(this)}}}catch{}};function jd(o){if(!Ba(o))return o.g.la();const c=su(o.g);if(c==="")return"";let h="";const f=c.length,A=se(o.g)==4;if(!o.h.i){if(typeof TextDecoder>"u")return Se(o),zn(o),"";o.h.i=new a.TextDecoder}for(let R=0;R<f;R++)o.h.h=!0,h+=o.h.i.decode(c[R],{stream:!(A&&R==f-1)});return c.length=0,o.h.g+=h,o.C=0,o.h.g}function Ba(o){return o.g?o.v=="GET"&&o.M!=2&&o.j.Aa:!1}function zd(o,c){var h=o.C,f=c.indexOf(`
`,h);return f==-1?bi:(h=Number(c.substring(h,f)),isNaN(h)?Fa:(f+=1,f+h>c.length?bi:(c=c.slice(f,f+h),o.C=f+h,c)))}ee.prototype.cancel=function(){this.K=!0,Se(this)};function Jr(o){o.T=Date.now()+o.H,Ua(o,o.H)}function Ua(o,c){if(o.D!=null)throw Error("WatchDog timer not null");o.D=Un(d(o.aa,o),c)}function Si(o){o.D&&(a.clearTimeout(o.D),o.D=null)}ee.prototype.aa=function(){this.D=null;const o=Date.now();o-this.T>=0?(Bd(this.i,this.B),this.M!=2&&(Bn(),bt(17)),Se(this),this.m=2,zn(this)):Ua(this,this.T-o)};function zn(o){o.j.I==0||o.K||hu(o.j,o)}function Se(o){Si(o);var c=o.O;c&&typeof c.dispose=="function"&&c.dispose(),o.O=null,Sa(o.V),o.g&&(c=o.g,o.g=null,c.abort(),c.dispose())}function Pi(o,c){try{var h=o.j;if(h.I!=0&&(h.g==o||Vi(h.h,o))){if(!o.L&&Vi(h.h,o)&&h.I==3){try{var f=h.Ba.g.parse(c)}catch{f=null}if(Array.isArray(f)&&f.length==3){var A=f;if(A[0]==0){t:if(!h.v){if(h.g)if(h.g.F+3e3<o.F)rs(h),es(h);else break t;Mi(h),bt(18)}}else h.xa=A[1],0<h.xa-h.K&&A[2]<37500&&h.F&&h.A==0&&!h.C&&(h.C=Un(d(h.Va,h),6e3));za(h.h)<=1&&h.ta&&(h.ta=void 0)}else Ve(h,11)}else if((o.L||h.g==o)&&rs(h),!_(c))for(A=h.Ba.g.parse(c),c=0;c<A.length;c++){let nt=A[c];const pt=nt[0];if(!(pt<=h.K))if(h.K=pt,nt=nt[1],h.I==2)if(nt[0]=="c"){h.M=nt[1],h.ba=nt[2];const qt=nt[3];qt!=null&&(h.ka=qt,h.j.info("VER="+h.ka));const Ce=nt[4];Ce!=null&&(h.za=Ce,h.j.info("SVER="+h.za));const ie=nt[5];ie!=null&&typeof ie=="number"&&ie>0&&(f=1.5*ie,h.O=f,h.j.info("backChannelRequestTimeoutMs_="+f)),f=h;const oe=o.g;if(oe){const is=oe.g?oe.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(is){var R=f.h;R.g||is.indexOf("spdy")==-1&&is.indexOf("quic")==-1&&is.indexOf("h2")==-1||(R.j=R.l,R.g=new Set,R.h&&(Ci(R,R.h),R.h=null))}if(f.G){const Fi=oe.g?oe.g.getResponseHeader("X-HTTP-Session-Id"):null;Fi&&(f.wa=Fi,rt(f.J,f.G,Fi))}}h.I=3,h.l&&h.l.ra(),h.aa&&(h.T=Date.now()-o.F,h.j.info("Handshake RTT: "+h.T+"ms")),f=h;var D=o;if(f.na=mu(f,f.L?f.ba:null,f.W),D.L){$a(f.h,D);var z=D,ft=f.O;ft&&(z.H=ft),z.D&&(Si(z),Jr(z)),f.g=D}else cu(f);h.i.length>0&&ns(h)}else nt[0]!="stop"&&nt[0]!="close"||Ve(h,7);else h.I==3&&(nt[0]=="stop"||nt[0]=="close"?nt[0]=="stop"?Ve(h,7):ki(h):nt[0]!="noop"&&h.l&&h.l.qa(nt),h.A=0)}}Bn(4)}catch{}}var $d=class{constructor(o,c){this.g=o,this.map=c}};function qa(o){this.l=o||10,a.PerformanceNavigationTiming?(o=a.performance.getEntriesByType("navigation"),o=o.length>0&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function ja(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function za(o){return o.h?1:o.g?o.g.size:0}function Vi(o,c){return o.h?o.h==c:o.g?o.g.has(c):!1}function Ci(o,c){o.g?o.g.add(c):o.h=c}function $a(o,c){o.h&&o.h==c?o.h=null:o.g&&o.g.has(c)&&o.g.delete(c)}qa.prototype.cancel=function(){if(this.i=Ga(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const o of this.g.values())o.cancel();this.g.clear()}};function Ga(o){if(o.h!=null)return o.i.concat(o.h.G);if(o.g!=null&&o.g.size!==0){let c=o.i;for(const h of o.g.values())c=c.concat(h.G);return c}return S(o.i)}var Ka=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Gd(o,c){if(o){o=o.split("&");for(let h=0;h<o.length;h++){const f=o[h].indexOf("=");let A,R=null;f>=0?(A=o[h].substring(0,f),R=o[h].substring(f+1)):A=o[h],c(A,R?decodeURIComponent(R.replace(/\+/g," ")):"")}}}function ne(o){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let c;o instanceof ne?(this.l=o.l,$n(this,o.j),this.o=o.o,this.g=o.g,Gn(this,o.u),this.h=o.h,Di(this,Xa(o.i)),this.m=o.m):o&&(c=String(o).match(Ka))?(this.l=!1,$n(this,c[1]||"",!0),this.o=Kn(c[2]||""),this.g=Kn(c[3]||"",!0),Gn(this,c[4]),this.h=Kn(c[5]||"",!0),Di(this,c[6]||"",!0),this.m=Kn(c[7]||"")):(this.l=!1,this.i=new Wn(null,this.l))}ne.prototype.toString=function(){const o=[];var c=this.j;c&&o.push(Hn(c,Ha,!0),":");var h=this.g;return(h||c=="file")&&(o.push("//"),(c=this.o)&&o.push(Hn(c,Ha,!0),"@"),o.push(jn(h).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.u,h!=null&&o.push(":",String(h))),(h=this.h)&&(this.g&&h.charAt(0)!="/"&&o.push("/"),o.push(Hn(h,h.charAt(0)=="/"?Wd:Hd,!0))),(h=this.i.toString())&&o.push("?",h),(h=this.m)&&o.push("#",Hn(h,Yd)),o.join("")},ne.prototype.resolve=function(o){const c=Ut(this);let h=!!o.j;h?$n(c,o.j):h=!!o.o,h?c.o=o.o:h=!!o.g,h?c.g=o.g:h=o.u!=null;var f=o.h;if(h)Gn(c,o.u);else if(h=!!o.h){if(f.charAt(0)!="/")if(this.g&&!this.h)f="/"+f;else{var A=c.h.lastIndexOf("/");A!=-1&&(f=c.h.slice(0,A+1)+f)}if(A=f,A==".."||A==".")f="";else if(A.indexOf("./")!=-1||A.indexOf("/.")!=-1){f=A.lastIndexOf("/",0)==0,A=A.split("/");const R=[];for(let D=0;D<A.length;){const z=A[D++];z=="."?f&&D==A.length&&R.push(""):z==".."?((R.length>1||R.length==1&&R[0]!="")&&R.pop(),f&&D==A.length&&R.push("")):(R.push(z),f=!0)}f=R.join("/")}else f=A}return h?c.h=f:h=o.i.toString()!=="",h?Di(c,Xa(o.i)):h=!!o.m,h&&(c.m=o.m),c};function Ut(o){return new ne(o)}function $n(o,c,h){o.j=h?Kn(c,!0):c,o.j&&(o.j=o.j.replace(/:$/,""))}function Gn(o,c){if(c){if(c=Number(c),isNaN(c)||c<0)throw Error("Bad port number "+c);o.u=c}else o.u=null}function Di(o,c,h){c instanceof Wn?(o.i=c,Jd(o.i,o.l)):(h||(c=Hn(c,Qd)),o.i=new Wn(c,o.l))}function rt(o,c,h){o.i.set(c,h)}function Xr(o){return rt(o,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),o}function Kn(o,c){return o?c?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function Hn(o,c,h){return typeof o=="string"?(o=encodeURI(o).replace(c,Kd),h&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function Kd(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var Ha=/[#\/\?@]/g,Hd=/[#\?:]/g,Wd=/[#\?]/g,Qd=/[#\?@]/g,Yd=/#/g;function Wn(o,c){this.h=this.g=null,this.i=o||null,this.j=!!c}function Pe(o){o.g||(o.g=new Map,o.h=0,o.i&&Gd(o.i,function(c,h){o.add(decodeURIComponent(c.replace(/\+/g," ")),h)}))}r=Wn.prototype,r.add=function(o,c){Pe(this),this.i=null,o=en(this,o);let h=this.g.get(o);return h||this.g.set(o,h=[]),h.push(c),this.h+=1,this};function Wa(o,c){Pe(o),c=en(o,c),o.g.has(c)&&(o.i=null,o.h-=o.g.get(c).length,o.g.delete(c))}function Qa(o,c){return Pe(o),c=en(o,c),o.g.has(c)}r.forEach=function(o,c){Pe(this),this.g.forEach(function(h,f){h.forEach(function(A){o.call(c,A,f,this)},this)},this)};function Ya(o,c){Pe(o);let h=[];if(typeof c=="string")Qa(o,c)&&(h=h.concat(o.g.get(en(o,c))));else for(o=Array.from(o.g.values()),c=0;c<o.length;c++)h=h.concat(o[c]);return h}r.set=function(o,c){return Pe(this),this.i=null,o=en(this,o),Qa(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[c]),this.h+=1,this},r.get=function(o,c){return o?(o=Ya(this,o),o.length>0?String(o[0]):c):c};function Ja(o,c,h){Wa(o,c),h.length>0&&(o.i=null,o.g.set(en(o,c),S(h)),o.h+=h.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const o=[],c=Array.from(this.g.keys());for(let f=0;f<c.length;f++){var h=c[f];const A=jn(h);h=Ya(this,h);for(let R=0;R<h.length;R++){let D=A;h[R]!==""&&(D+="="+jn(h[R])),o.push(D)}}return this.i=o.join("&")};function Xa(o){const c=new Wn;return c.i=o.i,o.g&&(c.g=new Map(o.g),c.h=o.h),c}function en(o,c){return c=String(c),o.j&&(c=c.toLowerCase()),c}function Jd(o,c){c&&!o.j&&(Pe(o),o.i=null,o.g.forEach(function(h,f){const A=f.toLowerCase();f!=A&&(Wa(this,f),Ja(this,A,h))},o)),o.j=c}function Xd(o,c){const h=new qn;if(a.Image){const f=new Image;f.onload=m(re,h,"TestLoadImage: loaded",!0,c,f),f.onerror=m(re,h,"TestLoadImage: error",!1,c,f),f.onabort=m(re,h,"TestLoadImage: abort",!1,c,f),f.ontimeout=m(re,h,"TestLoadImage: timeout",!1,c,f),a.setTimeout(function(){f.ontimeout&&f.ontimeout()},1e4),f.src=o}else c(!1)}function Zd(o,c){const h=new qn,f=new AbortController,A=setTimeout(()=>{f.abort(),re(h,"TestPingServer: timeout",!1,c)},1e4);fetch(o,{signal:f.signal}).then(R=>{clearTimeout(A),R.ok?re(h,"TestPingServer: ok",!0,c):re(h,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(A),re(h,"TestPingServer: error",!1,c)})}function re(o,c,h,f,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),f(h)}catch{}}function tf(){this.g=new Od}function xi(o){this.i=o.Sb||null,this.h=o.ab||!1}p(xi,Pa),xi.prototype.g=function(){return new Zr(this.i,this.h)};function Zr(o,c){It.call(this),this.H=o,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}p(Zr,It),r=Zr.prototype,r.open=function(o,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=o,this.D=c,this.readyState=1,Yn(this)},r.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const c={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};o&&(c.body=o),(this.H||a).fetch(new Request(this.D,c)).then(this.Pa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Qn(this)),this.readyState=0},r.Pa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,Yn(this)),this.g&&(this.readyState=3,Yn(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Za(this)}else o.text().then(this.Oa.bind(this),this.ga.bind(this))};function Za(o){o.j.read().then(o.Ma.bind(o)).catch(o.ga.bind(o))}r.Ma=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var c=o.value?o.value:new Uint8Array(0);(c=this.B.decode(c,{stream:!o.done}))&&(this.response=this.responseText+=c)}o.done?Qn(this):Yn(this),this.readyState==3&&Za(this)}},r.Oa=function(o){this.g&&(this.response=this.responseText=o,Qn(this))},r.Na=function(o){this.g&&(this.response=o,Qn(this))},r.ga=function(){this.g&&Qn(this)};function Qn(o){o.readyState=4,o.l=null,o.j=null,o.B=null,Yn(o)}r.setRequestHeader=function(o,c){this.A.append(o,c)},r.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const o=[],c=this.h.entries();for(var h=c.next();!h.done;)h=h.value,o.push(h[0]+": "+h[1]),h=c.next();return o.join(`\r
`)};function Yn(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(Zr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function tu(o){let c="";return Kr(o,function(h,f){c+=f,c+=":",c+=h,c+=`\r
`}),c}function Ni(o,c,h){t:{for(f in h){var f=!1;break t}f=!0}f||(h=tu(h),typeof o=="string"?h!=null&&jn(h):rt(o,c,h))}function at(o){It.call(this),this.headers=new Map,this.L=o||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}p(at,It);var ef=/^https?$/i,nf=["POST","PUT"];r=at.prototype,r.Fa=function(o){this.H=o},r.ea=function(o,c,h,f){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);c=c?c.toUpperCase():"GET",this.D=o,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Ma.g(),this.g.onreadystatechange=I(d(this.Ca,this));try{this.B=!0,this.g.open(c,String(o),!0),this.B=!1}catch(R){eu(this,R);return}if(o=h||"",h=new Map(this.headers),f)if(Object.getPrototypeOf(f)===Object.prototype)for(var A in f)h.set(A,f[A]);else if(typeof f.keys=="function"&&typeof f.get=="function")for(const R of f.keys())h.set(R,f.get(R));else throw Error("Unknown input type for opt_headers: "+String(f));f=Array.from(h.keys()).find(R=>R.toLowerCase()=="content-type"),A=a.FormData&&o instanceof a.FormData,!(Array.prototype.indexOf.call(nf,c,void 0)>=0)||f||A||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[R,D]of h)this.g.setRequestHeader(R,D);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(o),this.v=!1}catch(R){eu(this,R)}};function eu(o,c){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=c,o.o=5,nu(o),ts(o)}function nu(o){o.A||(o.A=!0,At(o,"complete"),At(o,"error"))}r.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=o||7,At(this,"complete"),At(this,"abort"),ts(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ts(this,!0)),at.Z.N.call(this)},r.Ca=function(){this.u||(this.B||this.v||this.j?ru(this):this.Xa())},r.Xa=function(){ru(this)};function ru(o){if(o.h&&typeof i<"u"){if(o.v&&se(o)==4)setTimeout(o.Ca.bind(o),0);else if(At(o,"readystatechange"),se(o)==4){o.h=!1;try{const R=o.ca();t:switch(R){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break t;default:c=!1}var h;if(!(h=c)){var f;if(f=R===0){let D=String(o.D).match(Ka)[1]||null;!D&&a.self&&a.self.location&&(D=a.self.location.protocol.slice(0,-1)),f=!ef.test(D?D.toLowerCase():"")}h=f}if(h)At(o,"complete"),At(o,"success");else{o.o=6;try{var A=se(o)>2?o.g.statusText:""}catch{A=""}o.l=A+" ["+o.ca()+"]",nu(o)}}finally{ts(o)}}}}function ts(o,c){if(o.g){o.m&&(clearTimeout(o.m),o.m=null);const h=o.g;o.g=null,c||At(o,"ready");try{h.onreadystatechange=null}catch{}}}r.isActive=function(){return!!this.g};function se(o){return o.g?o.g.readyState:0}r.ca=function(){try{return se(this)>2?this.g.status:-1}catch{return-1}},r.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.La=function(o){if(this.g){var c=this.g.responseText;return o&&c.indexOf(o)==0&&(c=c.substring(o.length)),Md(c)}};function su(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.F){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function rf(o){const c={};o=(o.g&&se(o)>=2&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let f=0;f<o.length;f++){if(_(o[f]))continue;var h=qd(o[f]);const A=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();const R=c[A]||[];c[A]=R,R.push(h)}Vd(c,function(f){return f.join(", ")})}r.ya=function(){return this.o},r.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Jn(o,c,h){return h&&h.internalChannelParams&&h.internalChannelParams[o]||c}function iu(o){this.za=0,this.i=[],this.j=new qn,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Jn("failFast",!1,o),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Jn("baseRetryDelayMs",5e3,o),this.Za=Jn("retryDelaySeedMs",1e4,o),this.Ta=Jn("forwardChannelMaxRetries",2,o),this.va=Jn("forwardChannelRequestTimeoutMs",2e4,o),this.ma=o&&o.xmlHttpFactory||void 0,this.Ua=o&&o.Rb||void 0,this.Aa=o&&o.useFetchStreams||!1,this.O=void 0,this.L=o&&o.supportsCrossDomainXhr||!1,this.M="",this.h=new qa(o&&o.concurrentRequestLimit),this.Ba=new tf,this.S=o&&o.fastHandshake||!1,this.R=o&&o.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=o&&o.Pb||!1,o&&o.ua&&this.j.ua(),o&&o.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&o&&o.detectBufferingProxy||!1,this.ia=void 0,o&&o.longPollingTimeout&&o.longPollingTimeout>0&&(this.ia=o.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}r=iu.prototype,r.ka=8,r.I=1,r.connect=function(o,c,h,f){bt(0),this.W=o,this.H=c||{},h&&f!==void 0&&(this.H.OSID=h,this.H.OAID=f),this.F=this.X,this.J=mu(this,null,this.W),ns(this)};function ki(o){if(ou(o),o.I==3){var c=o.V++,h=Ut(o.J);if(rt(h,"SID",o.M),rt(h,"RID",c),rt(h,"TYPE","terminate"),Xn(o,h),c=new ee(o,o.j,c),c.M=2,c.A=Xr(Ut(h)),h=!1,a.navigator&&a.navigator.sendBeacon)try{h=a.navigator.sendBeacon(c.A.toString(),"")}catch{}!h&&a.Image&&(new Image().src=c.A,h=!0),h||(c.g=pu(c.j,null),c.g.ea(c.A)),c.F=Date.now(),Jr(c)}fu(o)}function es(o){o.g&&(Oi(o),o.g.cancel(),o.g=null)}function ou(o){es(o),o.v&&(a.clearTimeout(o.v),o.v=null),rs(o),o.h.cancel(),o.m&&(typeof o.m=="number"&&a.clearTimeout(o.m),o.m=null)}function ns(o){if(!ja(o.h)&&!o.m){o.m=!0;var c=o.Ea;et||g(),Q||(et(),Q=!0),E.add(c,o),o.D=0}}function sf(o,c){return za(o.h)>=o.h.j-(o.m?1:0)?!1:o.m?(o.i=c.G.concat(o.i),!0):o.I==1||o.I==2||o.D>=(o.Sa?0:o.Ta)?!1:(o.m=Un(d(o.Ea,o,c),du(o,o.D)),o.D++,!0)}r.Ea=function(o){if(this.m)if(this.m=null,this.I==1){if(!o){this.V=Math.floor(Math.random()*1e5),o=this.V++;const A=new ee(this,this.j,o);let R=this.o;if(this.U&&(R?(R=ya(R),Ea(R,this.U)):R=this.U),this.u!==null||this.R||(A.J=R,R=null),this.S)t:{for(var c=0,h=0;h<this.i.length;h++){e:{var f=this.i[h];if("__data__"in f.map&&(f=f.map.__data__,typeof f=="string")){f=f.length;break e}f=void 0}if(f===void 0)break;if(c+=f,c>4096){c=h;break t}if(c===4096||h===this.i.length-1){c=h+1;break t}}c=1e3}else c=1e3;c=uu(this,A,c),h=Ut(this.J),rt(h,"RID",o),rt(h,"CVER",22),this.G&&rt(h,"X-HTTP-Session-Id",this.G),Xn(this,h),R&&(this.R?c="headers="+jn(tu(R))+"&"+c:this.u&&Ni(h,this.u,R)),Ci(this.h,A),this.Ra&&rt(h,"TYPE","init"),this.S?(rt(h,"$req",c),rt(h,"SID","null"),A.U=!0,Ri(A,h,null)):Ri(A,h,c),this.I=2}}else this.I==3&&(o?au(this,o):this.i.length==0||ja(this.h)||au(this))};function au(o,c){var h;c?h=c.l:h=o.V++;const f=Ut(o.J);rt(f,"SID",o.M),rt(f,"RID",h),rt(f,"AID",o.K),Xn(o,f),o.u&&o.o&&Ni(f,o.u,o.o),h=new ee(o,o.j,h,o.D+1),o.u===null&&(h.J=o.o),c&&(o.i=c.G.concat(o.i)),c=uu(o,h,1e3),h.H=Math.round(o.va*.5)+Math.round(o.va*.5*Math.random()),Ci(o.h,h),Ri(h,f,c)}function Xn(o,c){o.H&&Kr(o.H,function(h,f){rt(c,f,h)}),o.l&&Kr({},function(h,f){rt(c,f,h)})}function uu(o,c,h){h=Math.min(o.i.length,h);const f=o.l?d(o.l.Ka,o.l,o):null;t:{var A=o.i;let z=-1;for(;;){const ft=["count="+h];z==-1?h>0?(z=A[0].g,ft.push("ofs="+z)):z=0:ft.push("ofs="+z);let nt=!0;for(let pt=0;pt<h;pt++){var R=A[pt].g;const qt=A[pt].map;if(R-=z,R<0)z=Math.max(0,A[pt].g-100),nt=!1;else try{R="req"+R+"_"||"";try{var D=qt instanceof Map?qt:Object.entries(qt);for(const[Ce,ie]of D){let oe=ie;u(ie)&&(oe=Ti(ie)),ft.push(R+Ce+"="+encodeURIComponent(oe))}}catch(Ce){throw ft.push(R+"type="+encodeURIComponent("_badmap")),Ce}}catch{f&&f(qt)}}if(nt){D=ft.join("&");break t}}D=void 0}return o=o.i.splice(0,h),c.G=o,D}function cu(o){if(!o.g&&!o.v){o.Y=1;var c=o.Da;et||g(),Q||(et(),Q=!0),E.add(c,o),o.A=0}}function Mi(o){return o.g||o.v||o.A>=3?!1:(o.Y++,o.v=Un(d(o.Da,o),du(o,o.A)),o.A++,!0)}r.Da=function(){if(this.v=null,lu(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var o=4*this.T;this.j.info("BP detection timer enabled: "+o),this.B=Un(d(this.Wa,this),o)}},r.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,bt(10),es(this),lu(this))};function Oi(o){o.B!=null&&(a.clearTimeout(o.B),o.B=null)}function lu(o){o.g=new ee(o,o.j,"rpc",o.Y),o.u===null&&(o.g.J=o.o),o.g.P=0;var c=Ut(o.na);rt(c,"RID","rpc"),rt(c,"SID",o.M),rt(c,"AID",o.K),rt(c,"CI",o.F?"0":"1"),!o.F&&o.ia&&rt(c,"TO",o.ia),rt(c,"TYPE","xmlhttp"),Xn(o,c),o.u&&o.o&&Ni(c,o.u,o.o),o.O&&(o.g.H=o.O);var h=o.g;o=o.ba,h.M=1,h.A=Xr(Ut(c)),h.u=null,h.R=!0,La(h,o)}r.Va=function(){this.C!=null&&(this.C=null,es(this),Mi(this),bt(19))};function rs(o){o.C!=null&&(a.clearTimeout(o.C),o.C=null)}function hu(o,c){var h=null;if(o.g==c){rs(o),Oi(o),o.g=null;var f=2}else if(Vi(o.h,c))h=c.G,$a(o.h,c),f=1;else return;if(o.I!=0){if(c.o)if(f==1){h=c.u?c.u.length:0,c=Date.now()-c.F;var A=o.D;f=Qr(),At(f,new Na(f,h)),ns(o)}else cu(o);else if(A=c.m,A==3||A==0&&c.X>0||!(f==1&&sf(o,c)||f==2&&Mi(o)))switch(h&&h.length>0&&(c=o.h,c.i=c.i.concat(h)),A){case 1:Ve(o,5);break;case 4:Ve(o,10);break;case 3:Ve(o,6);break;default:Ve(o,2)}}}function du(o,c){let h=o.Qa+Math.floor(Math.random()*o.Za);return o.isActive()||(h*=2),h*c}function Ve(o,c){if(o.j.info("Error code "+c),c==2){var h=d(o.bb,o),f=o.Ua;const A=!f;f=new ne(f||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||$n(f,"https"),Xr(f),A?Xd(f.toString(),h):Zd(f.toString(),h)}else bt(2);o.I=0,o.l&&o.l.pa(c),fu(o),ou(o)}r.bb=function(o){o?(this.j.info("Successfully pinged google.com"),bt(2)):(this.j.info("Failed to ping google.com"),bt(1))};function fu(o){if(o.I=0,o.ja=[],o.l){const c=Ga(o.h);(c.length!=0||o.i.length!=0)&&(C(o.ja,c),C(o.ja,o.i),o.h.i.length=0,S(o.i),o.i.length=0),o.l.oa()}}function mu(o,c,h){var f=h instanceof ne?Ut(h):new ne(h);if(f.g!="")c&&(f.g=c+"."+f.g),Gn(f,f.u);else{var A=a.location;f=A.protocol,c=c?c+"."+A.hostname:A.hostname,A=+A.port;const R=new ne(null);f&&$n(R,f),c&&(R.g=c),A&&Gn(R,A),h&&(R.h=h),f=R}return h=o.G,c=o.wa,h&&c&&rt(f,h,c),rt(f,"VER",o.ka),Xn(o,f),f}function pu(o,c,h){if(c&&!o.L)throw Error("Can't create secondary domain capable XhrIo object.");return c=o.Aa&&!o.ma?new at(new xi({ab:h})):new at(o.ma),c.Fa(o.L),c}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function gu(){}r=gu.prototype,r.ra=function(){},r.qa=function(){},r.pa=function(){},r.oa=function(){},r.isActive=function(){return!0},r.Ka=function(){};function ss(){}ss.prototype.g=function(o,c){return new Dt(o,c)};function Dt(o,c){It.call(this),this.g=new iu(c),this.l=o,this.h=c&&c.messageUrlParams||null,o=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(o?o["X-WebChannel-Content-Type"]=c.messageContentType:o={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.sa&&(o?o["X-WebChannel-Client-Profile"]=c.sa:o={"X-WebChannel-Client-Profile":c.sa}),this.g.U=o,(o=c&&c.Qb)&&!_(o)&&(this.g.u=o),this.A=c&&c.supportsCrossDomainXhr||!1,this.v=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!_(c)&&(this.g.G=c,o=this.h,o!==null&&c in o&&(o=this.h,c in o&&delete o[c])),this.j=new nn(this)}p(Dt,It),Dt.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Dt.prototype.close=function(){ki(this.g)},Dt.prototype.o=function(o){var c=this.g;if(typeof o=="string"){var h={};h.__data__=o,o=h}else this.v&&(h={},h.__data__=Ti(o),o=h);c.i.push(new $d(c.Ya++,o)),c.I==3&&ns(c)},Dt.prototype.N=function(){this.g.l=null,delete this.j,ki(this.g),delete this.g,Dt.Z.N.call(this)};function _u(o){wi.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var c=o.__sm__;if(c){t:{for(const h in c){o=h;break t}o=void 0}(this.i=o)&&(o=this.i,c=c!==null&&o in c?c[o]:void 0),this.data=c}else this.data=o}p(_u,wi);function yu(){vi.call(this),this.status=1}p(yu,vi);function nn(o){this.g=o}p(nn,gu),nn.prototype.ra=function(){At(this.g,"a")},nn.prototype.qa=function(o){At(this.g,new _u(o))},nn.prototype.pa=function(o){At(this.g,new yu)},nn.prototype.oa=function(){At(this.g,"b")},ss.prototype.createWebChannel=ss.prototype.g,Dt.prototype.send=Dt.prototype.o,Dt.prototype.open=Dt.prototype.m,Dt.prototype.close=Dt.prototype.close,Il=function(){return new ss},yl=function(){return Qr()},_l=Re,to={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Yr.NO_ERROR=0,Yr.TIMEOUT=8,Yr.HTTP_ERROR=6,fs=Yr,ka.COMPLETE="complete",gl=ka,Va.EventType=Ln,Ln.OPEN="a",Ln.CLOSE="b",Ln.ERROR="c",Ln.MESSAGE="d",It.prototype.listen=It.prototype.J,ir=Va,at.prototype.listenOnce=at.prototype.K,at.prototype.getLastError=at.prototype.Ha,at.prototype.getLastErrorCode=at.prototype.ya,at.prototype.getStatus=at.prototype.ca,at.prototype.getResponseJson=at.prototype.La,at.prototype.getResponseText=at.prototype.la,at.prototype.send=at.prototype.ea,at.prototype.setWithCredentials=at.prototype.Fa,pl=at}).apply(typeof os<"u"?os:typeof self<"u"?self:typeof window<"u"?window:{});class _t{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}_t.UNAUTHENTICATED=new _t(null),_t.GOOGLE_CREDENTIALS=new _t("google-credentials-uid"),_t.FIRST_PARTY=new _t("first-party-uid"),_t.MOCK_USER=new _t("mock-user");let Nn="12.9.0";function qm(r){Nn=r}const $e=new cl("@firebase/firestore");function ln(){return $e.logLevel}function V(r,...t){if($e.logLevel<=W.DEBUG){const e=t.map(Vo);$e.debug(`Firestore (${Nn}): ${r}`,...e)}}function Rt(r,...t){if($e.logLevel<=W.ERROR){const e=t.map(Vo);$e.error(`Firestore (${Nn}): ${r}`,...e)}}function ye(r,...t){if($e.logLevel<=W.WARN){const e=t.map(Vo);$e.warn(`Firestore (${Nn}): ${r}`,...e)}}function Vo(r){if(typeof r=="string")return r;try{return(function(e){return JSON.stringify(e)})(r)}catch{return r}}function O(r,t,e){let n="Unexpected state";typeof t=="string"?n=t:e=t,El(r,n,e)}function El(r,t,e){let n=`FIRESTORE (${Nn}) INTERNAL ASSERTION FAILED: ${t} (ID: ${r.toString(16)})`;if(e!==void 0)try{n+=" CONTEXT: "+JSON.stringify(e)}catch{n+=" CONTEXT: "+e}throw Rt(n),new Error(n)}function F(r,t,e,n){let s="Unexpected state";typeof e=="string"?s=e:n=e,r||El(t,s,n)}function j(r,t){return r}const P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class x extends xn{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class pe{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class Tl{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class jm{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(_t.UNAUTHENTICATED)))}shutdown(){}}class zm{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class $m{constructor(t){this.t=t,this.currentUser=_t.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){F(this.o===void 0,42304);let n=this.i;const s=l=>this.i!==n?(n=this.i,e(l)):Promise.resolve();let i=new pe;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new pe,t.enqueueRetryable((()=>s(this.currentUser)))};const a=()=>{const l=i;t.enqueueRetryable((async()=>{await l.promise,await s(this.currentUser)}))},u=l=>{V("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((l=>u(l))),setTimeout((()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?u(l):(V("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new pe)}}),0),a()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((n=>this.i!==t?(V("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(F(typeof n.accessToken=="string",31837,{l:n}),new Tl(n.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return F(t===null||typeof t=="string",2055,{h:t}),new _t(t)}}class Gm{constructor(t,e,n){this.P=t,this.T=e,this.I=n,this.type="FirstParty",this.user=_t.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);const t=this.A();return t&&this.R.set("Authorization",t),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class Km{constructor(t,e,n){this.P=t,this.T=e,this.I=n}getToken(){return Promise.resolve(new Gm(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable((()=>e(_t.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Du{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Hm{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,vm(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){F(this.o===void 0,3512);const n=i=>{i.error!=null&&V("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const a=i.token!==this.m;return this.m=i.token,V("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?e(i.token):Promise.resolve()};this.o=i=>{t.enqueueRetryable((()=>n(i)))};const s=i=>{V("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((i=>s(i))),setTimeout((()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):V("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Du(this.p));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((e=>e?(F(typeof e.token=="string",44558,{tokenResult:e}),this.m=e.token,new Du(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Wm(r){const t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(r);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let n=0;n<r;n++)e[n]=Math.floor(256*Math.random());return e}class Co{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(4.129032258064516);let n="";for(;n.length<20;){const s=Wm(40);for(let i=0;i<s.length;++i)n.length<20&&s[i]<e&&(n+=t.charAt(s[i]%62))}return n}}function q(r,t){return r<t?-1:r>t?1:0}function eo(r,t){const e=Math.min(r.length,t.length);for(let n=0;n<e;n++){const s=r.charAt(n),i=t.charAt(n);if(s!==i)return ji(s)===ji(i)?q(s,i):ji(s)?1:-1}return q(r.length,t.length)}const Qm=55296,Ym=57343;function ji(r){const t=r.charCodeAt(0);return t>=Qm&&t<=Ym}function In(r,t,e){return r.length===t.length&&r.every(((n,s)=>e(n,t[s])))}function wl(r){return r+"\0"}const xu="__name__";class jt{constructor(t,e,n){e===void 0?e=0:e>t.length&&O(637,{offset:e,range:t.length}),n===void 0?n=t.length-e:n>t.length-e&&O(1746,{length:n,range:t.length-e}),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return jt.comparator(this,t)===0}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof jt?t.forEach((n=>{e.push(n)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let s=0;s<n;s++){const i=jt.compareSegments(t.get(s),e.get(s));if(i!==0)return i}return q(t.length,e.length)}static compareSegments(t,e){const n=jt.isNumericId(t),s=jt.isNumericId(e);return n&&!s?-1:!n&&s?1:n&&s?jt.extractNumericId(t).compare(jt.extractNumericId(e)):eo(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return me.fromString(t.substring(4,t.length-2))}}class Y extends jt{construct(t,e,n){return new Y(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new x(P.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((s=>s.length>0)))}return new Y(e)}static emptyPath(){return new Y([])}}const Jm=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ot extends jt{construct(t,e,n){return new ot(t,e,n)}static isValidIdentifier(t){return Jm.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ot.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===xu}static keyField(){return new ot([xu])}static fromServerFormat(t){const e=[];let n="",s=0;const i=()=>{if(n.length===0)throw new x(P.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let a=!1;for(;s<t.length;){const u=t[s];if(u==="\\"){if(s+1===t.length)throw new x(P.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const l=t[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new x(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=l,s+=2}else u==="`"?(a=!a,s++):u!=="."||a?(n+=u,s++):(i(),s++)}if(i(),a)throw new x(P.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new ot(e)}static emptyPath(){return new ot([])}}class N{constructor(t){this.path=t}static fromPath(t){return new N(Y.fromString(t))}static fromName(t){return new N(Y.fromString(t).popFirst(5))}static empty(){return new N(Y.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&Y.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return Y.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new N(new Y(t.slice()))}}function vl(r,t,e){if(!e)throw new x(P.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${t}.`)}function Xm(r,t,e,n){if(t===!0&&n===!0)throw new x(P.INVALID_ARGUMENT,`${r} and ${e} cannot be used together.`)}function Nu(r){if(!N.isDocumentKey(r))throw new x(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function ku(r){if(N.isDocumentKey(r))throw new x(P.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function Al(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}function Hs(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{const t=(function(n){return n.constructor?n.constructor.name:null})(r);return t?`a custom ${t} object`:"an object"}}return typeof r=="function"?"a function":O(12329,{type:typeof r})}function Qt(r,t){if("_delegate"in r&&(r=r._delegate),!(r instanceof t)){if(t.name===r.constructor.name)throw new x(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const e=Hs(r);throw new x(P.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return r}function lt(r,t){const e={typeString:r};return t&&(e.value=t),e}function Mr(r,t){if(!Al(r))throw new x(P.INVALID_ARGUMENT,"JSON must be an object");let e;for(const n in t)if(t[n]){const s=t[n].typeString,i="value"in t[n]?{value:t[n].value}:void 0;if(!(n in r)){e=`JSON missing required field: '${n}'`;break}const a=r[n];if(s&&typeof a!==s){e=`JSON field '${n}' must be a ${s}.`;break}if(i!==void 0&&a!==i.value){e=`Expected '${n}' field to equal '${i.value}'`;break}}if(e)throw new x(P.INVALID_ARGUMENT,e);return!0}const Mu=-62135596800,Ou=1e6;class X{static now(){return X.fromMillis(Date.now())}static fromDate(t){return X.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor((t-1e3*e)*Ou);return new X(e,n)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new x(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new x(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<Mu)throw new x(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new x(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Ou}_compareTo(t){return this.seconds===t.seconds?q(this.nanoseconds,t.nanoseconds):q(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:X._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(Mr(t,X._jsonSchema))return new X(t.seconds,t.nanoseconds)}valueOf(){const t=this.seconds-Mu;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}X._jsonSchemaVersion="firestore/timestamp/1.0",X._jsonSchema={type:lt("string",X._jsonSchemaVersion),seconds:lt("number"),nanoseconds:lt("number")};class L{static fromTimestamp(t){return new L(t)}static min(){return new L(new X(0,0))}static max(){return new L(new X(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Tr=-1;class Cs{constructor(t,e,n,s){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=s}}function no(r){return r.fields.find((t=>t.kind===2))}function Ne(r){return r.fields.filter((t=>t.kind!==2))}Cs.UNKNOWN_ID=-1;class ms{constructor(t,e){this.fieldPath=t,this.kind=e}}class wr{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new wr(0,kt.min())}}function Zm(r,t){const e=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,s=L.fromTimestamp(n===1e9?new X(e+1,0):new X(e,n));return new kt(s,N.empty(),t)}function bl(r){return new kt(r.readTime,r.key,Tr)}class kt{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new kt(L.min(),N.empty(),Tr)}static max(){return new kt(L.max(),N.empty(),Tr)}}function Do(r,t){let e=r.readTime.compareTo(t.readTime);return e!==0?e:(e=N.comparator(r.documentKey,t.documentKey),e!==0?e:q(r.largestBatchId,t.largestBatchId))}const Rl="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Sl{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function Xe(r){if(r.code!==P.FAILED_PRECONDITION||r.message!==Rl)throw r;V("LocalStore","Unexpectedly lost primary lease")}class v{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&O(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new v(((n,s)=>{this.nextCallback=i=>{this.wrapSuccess(t,i).next(n,s)},this.catchCallback=i=>{this.wrapFailure(e,i).next(n,s)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof v?e:v.resolve(e)}catch(e){return v.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):v.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):v.reject(e)}static resolve(t){return new v(((e,n)=>{e(t)}))}static reject(t){return new v(((e,n)=>{n(t)}))}static waitFor(t){return new v(((e,n)=>{let s=0,i=0,a=!1;t.forEach((u=>{++s,u.next((()=>{++i,a&&i===s&&e()}),(l=>n(l)))})),a=!0,i===s&&e()}))}static or(t){let e=v.resolve(!1);for(const n of t)e=e.next((s=>s?v.resolve(s):n()));return e}static forEach(t,e){const n=[];return t.forEach(((s,i)=>{n.push(e.call(this,s,i))})),this.waitFor(n)}static mapArray(t,e){return new v(((n,s)=>{const i=t.length,a=new Array(i);let u=0;for(let l=0;l<i;l++){const d=l;e(t[d]).next((m=>{a[d]=m,++u,u===i&&n(a)}),(m=>s(m)))}}))}static doWhile(t,e){return new v(((n,s)=>{const i=()=>{t()===!0?e().next((()=>{i()}),s):n()};i()}))}}const xt="SimpleDb";class Ws{static open(t,e,n,s){try{return new Ws(e,t.transaction(s,n))}catch(i){throw new hr(e,i)}}constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.S=new pe,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{e.error?this.S.reject(new hr(t,e.error)):this.S.resolve()},this.transaction.onerror=n=>{const s=xo(n.target.error);this.S.reject(new hr(t,s))}}get D(){return this.S.promise}abort(t){t&&this.S.reject(t),this.aborted||(V(xt,"Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const t=this.transaction;this.aborted||typeof t.commit!="function"||t.commit()}store(t){const e=this.transaction.objectStore(t);return new ep(e)}}class ge{static delete(t){return V(xt,"Removing database:",t),Me(nl().indexedDB.deleteDatabase(t)).toPromise()}static v(){if(!al())return!1;if(ge.F())return!0;const t=Rs(),e=ge.M(t),n=0<e&&e<10,s=Pl(t),i=0<s&&s<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||i)}static F(){return typeof process<"u"&&process.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE==="YES"}static O(t,e){return t.store(e)}static M(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}constructor(t,e,n){this.name=t,this.version=e,this.N=n,this.B=null,ge.M(Rs())===12.2&&Rt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(t){return this.db||(V(xt,"Opening database:",this.name),this.db=await new Promise(((e,n)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const a=i.target.result;e(a)},s.onblocked=()=>{n(new hr(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const a=i.target.error;a.name==="VersionError"?n(new x(P.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?n(new x(P.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):n(new hr(t,a))},s.onupgradeneeded=i=>{V(xt,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const a=i.target.result;this.N.k(a,s.transaction,i.oldVersion,this.version).next((()=>{V(xt,"Database upgrade to version "+this.version+" complete")}))}}))),this.K&&(this.db.onversionchange=e=>this.K(e)),this.db}q(t){this.K=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(t,e,n,s){const i=e==="readonly";let a=0;for(;;){++a;try{this.db=await this.L(t);const u=Ws.open(this.db,t,i?"readonly":"readwrite",n),l=s(u).next((d=>(u.C(),d))).catch((d=>(u.abort(d),v.reject(d)))).toPromise();return l.catch((()=>{})),await u.D,l}catch(u){const l=u,d=l.name!=="FirebaseError"&&a<3;if(V(xt,"Transaction failed with error:",l.message,"Retrying:",d),this.close(),!d)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function Pl(r){const t=r.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}class tp{constructor(t){this.U=t,this.$=!1,this.W=null}get isDone(){return this.$}get G(){return this.W}set cursor(t){this.U=t}done(){this.$=!0}j(t){this.W=t}delete(){return Me(this.U.delete())}}class hr extends x{constructor(t,e){super(P.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function ve(r){return r.name==="IndexedDbTransactionError"}class ep{constructor(t){this.store=t}put(t,e){let n;return e!==void 0?(V(xt,"PUT",this.store.name,t,e),n=this.store.put(e,t)):(V(xt,"PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Me(n)}add(t){return V(xt,"ADD",this.store.name,t,t),Me(this.store.add(t))}get(t){return Me(this.store.get(t)).next((e=>(e===void 0&&(e=null),V(xt,"GET",this.store.name,t,e),e)))}delete(t){return V(xt,"DELETE",this.store.name,t),Me(this.store.delete(t))}count(){return V(xt,"COUNT",this.store.name),Me(this.store.count())}H(t,e){const n=this.options(t,e),s=n.index?this.store.index(n.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(n.range);return new v(((a,u)=>{i.onerror=l=>{u(l.target.error)},i.onsuccess=l=>{a(l.target.result)}}))}{const i=this.cursor(n),a=[];return this.J(i,((u,l)=>{a.push(l)})).next((()=>a))}}Z(t,e){const n=this.store.getAll(t,e===null?void 0:e);return new v(((s,i)=>{n.onerror=a=>{i(a.target.error)},n.onsuccess=a=>{s(a.target.result)}}))}X(t,e){V(xt,"DELETE ALL",this.store.name);const n=this.options(t,e);n.Y=!1;const s=this.cursor(n);return this.J(s,((i,a,u)=>u.delete()))}ee(t,e){let n;e?n=t:(n={},e=t);const s=this.cursor(n);return this.J(s,e)}te(t){const e=this.cursor({});return new v(((n,s)=>{e.onerror=i=>{const a=xo(i.target.error);s(a)},e.onsuccess=i=>{const a=i.target.result;a?t(a.primaryKey,a.value).next((u=>{u?a.continue():n()})):n()}}))}J(t,e){const n=[];return new v(((s,i)=>{t.onerror=a=>{i(a.target.error)},t.onsuccess=a=>{const u=a.target.result;if(!u)return void s();const l=new tp(u),d=e(u.primaryKey,u.value,l);if(d instanceof v){const m=d.catch((p=>(l.done(),v.reject(p))));n.push(m)}l.isDone?s():l.G===null?u.continue():u.continue(l.G)}})).next((()=>v.waitFor(n)))}options(t,e){let n;return t!==void 0&&(typeof t=="string"?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.Y?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function Me(r){return new v(((t,e)=>{r.onsuccess=n=>{const s=n.target.result;t(s)},r.onerror=n=>{const s=xo(n.target.error);e(s)}}))}let Fu=!1;function xo(r){const t=ge.M(Rs());if(t>=12.2&&t<13){const e="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(e)>=0){const n=new x("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Fu||(Fu=!0,setTimeout((()=>{throw n}),0)),n}}return r}const dr="IndexBackfiller";class np{constructor(t,e){this.asyncQueue=t,this.ne=e,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(t){V(dr,`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,(async()=>{this.task=null;try{const e=await this.ne.ie();V(dr,`Documents written: ${e}`)}catch(e){ve(e)?V(dr,"Ignoring IndexedDB error during index backfill: ",e):await Xe(e)}await this.re(6e4)}))}}class rp{constructor(t,e){this.localStore=t,this.persistence=e}async ie(t=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(e=>this.se(e,t)))}se(t,e){const n=new Set;let s=e,i=!0;return v.doWhile((()=>i===!0&&s>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next((a=>{if(a!==null&&!n.has(a))return V(dr,`Processing collection: ${a}`),this.oe(t,a,s).next((u=>{s-=u,n.add(a)}));i=!1})))).next((()=>e-s))}oe(t,e,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next((s=>this.localStore.localDocuments.getNextDocuments(t,e,s,n).next((i=>{const a=i.changes;return this.localStore.indexManager.updateIndexEntries(t,a).next((()=>this._e(s,i))).next((u=>(V(dr,`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(t,e,u)))).next((()=>a.size))}))))}_e(t,e){let n=t;return e.changes.forEach(((s,i)=>{const a=bl(i);Do(a,n)>0&&(n=a)})),new kt(n.readTime,n.documentKey,Math.max(e.batchId,t.largestBatchId))}}class Ot{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=n=>this.ae(n),this.ue=n=>e.writeSequenceNumber(n))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ue&&this.ue(t),t}}Ot.ce=-1;const Ue=-1;function Qs(r){return r==null}function vr(r){return r===0&&1/r==-1/0}function sp(r){return typeof r=="number"&&Number.isInteger(r)&&!vr(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}const Ds="";function vt(r){let t="";for(let e=0;e<r.length;e++)t.length>0&&(t=Lu(t)),t=ip(r.get(e),t);return Lu(t)}function ip(r,t){let e=t;const n=r.length;for(let s=0;s<n;s++){const i=r.charAt(s);switch(i){case"\0":e+="";break;case Ds:e+="";break;default:e+=i}}return e}function Lu(r){return r+Ds+""}function zt(r){const t=r.length;if(F(t>=2,64408,{path:r}),t===2)return F(r.charAt(0)===Ds&&r.charAt(1)==="",56145,{path:r}),Y.emptyPath();const e=t-2,n=[];let s="";for(let i=0;i<t;){const a=r.indexOf(Ds,i);switch((a<0||a>e)&&O(50515,{path:r}),r.charAt(a+1)){case"":const u=r.substring(i,a);let l;s.length===0?l=u:(s+=u,l=s,s=""),n.push(l);break;case"":s+=r.substring(i,a),s+="\0";break;case"":s+=r.substring(i,a+1);break;default:O(61167,{path:r})}i=a+2}return new Y(n)}const ke="remoteDocuments",Or="owner",rn="owner",Ar="mutationQueues",op="userId",Lt="mutations",Bu="batchId",Be="userMutationsIndex",Uu=["userId","batchId"];function ps(r,t){return[r,vt(t)]}function Vl(r,t,e){return[r,vt(t),e]}const ap={},En="documentMutations",xs="remoteDocumentsV14",up=["prefixPath","collectionGroup","readTime","documentId"],gs="documentKeyIndex",cp=["prefixPath","collectionGroup","documentId"],Cl="collectionGroupIndex",lp=["collectionGroup","readTime","prefixPath","documentId"],br="remoteDocumentGlobal",ro="remoteDocumentGlobalKey",Tn="targets",Dl="queryTargetsIndex",hp=["canonicalId","targetId"],wn="targetDocuments",dp=["targetId","path"],No="documentTargetsIndex",fp=["path","targetId"],Ns="targetGlobalKey",qe="targetGlobal",Rr="collectionParents",mp=["collectionId","parent"],vn="clientMetadata",pp="clientId",Ys="bundles",gp="bundleId",Js="namedQueries",_p="name",ko="indexConfiguration",yp="indexId",so="collectionGroupIndex",Ip="collectionGroup",fr="indexState",Ep=["indexId","uid"],xl="sequenceNumberIndex",Tp=["uid","sequenceNumber"],mr="indexEntries",wp=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Nl="documentKeyIndex",vp=["indexId","uid","orderedDocumentKey"],Xs="documentOverlays",Ap=["userId","collectionPath","documentId"],io="collectionPathOverlayIndex",bp=["userId","collectionPath","largestBatchId"],kl="collectionGroupOverlayIndex",Rp=["userId","collectionGroup","largestBatchId"],Mo="globals",Sp="name",Ml=[Ar,Lt,En,ke,Tn,Or,qe,wn,vn,br,Rr,Ys,Js],Pp=[...Ml,Xs],Ol=[Ar,Lt,En,xs,Tn,Or,qe,wn,vn,br,Rr,Ys,Js,Xs],Fl=Ol,Oo=[...Fl,ko,fr,mr],Vp=Oo,Ll=[...Oo,Mo],Cp=Ll;class oo extends Sl{constructor(t,e){super(),this.le=t,this.currentSequenceNumber=e}}function mt(r,t){const e=j(r);return ge.O(e.le,t)}function qu(r){let t=0;for(const e in r)Object.prototype.hasOwnProperty.call(r,e)&&t++;return t}function Ae(r,t){for(const e in r)Object.prototype.hasOwnProperty.call(r,e)&&t(e,r[e])}function Bl(r){for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}class it{constructor(t,e){this.comparator=t,this.root=e||yt.EMPTY}insert(t,e){return new it(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,yt.BLACK,null,null))}remove(t){return new it(this.comparator,this.root.remove(t,this.comparator).copy(null,null,yt.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(n===0)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(t,n.key);if(s===0)return e+n.left.size;s<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new as(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new as(this.root,t,this.comparator,!1)}getReverseIterator(){return new as(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new as(this.root,t,this.comparator,!0)}}class as{constructor(t,e,n,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,e&&s&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(i===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class yt{constructor(t,e,n,s,i){this.key=t,this.value=e,this.color=n??yt.RED,this.left=s??yt.EMPTY,this.right=i??yt.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,s,i){return new yt(t??this.key,e??this.value,n??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let s=this;const i=n(t,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(t,e,n),null):i===0?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return yt.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),e(t,s.key)===0){if(s.right.isEmpty())return yt.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,yt.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,yt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw O(43730,{key:this.key,value:this.value});if(this.right.isRed())throw O(14113,{key:this.key,value:this.value});const t=this.left.check();if(t!==this.right.check())throw O(27949);return t+(this.isRed()?0:1)}}yt.EMPTY=null,yt.RED=!0,yt.BLACK=!1;yt.EMPTY=new class{constructor(){this.size=0}get key(){throw O(57766)}get value(){throw O(16141)}get color(){throw O(16727)}get left(){throw O(29726)}get right(){throw O(36894)}copy(t,e,n,s,i){return this}insert(t,e,n){return new yt(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class tt{constructor(t){this.comparator=t,this.data=new it(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let n;for(n=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new ju(this.data.getIterator())}getIteratorFrom(t){return new ju(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((n=>{e=e.add(n)})),e}isEqual(t){if(!(t instanceof tt)||this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const s=e.getNext().key,i=n.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new tt(this.comparator);return e.data=t,e}}class ju{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function sn(r){return r.hasNext()?r.getNext():void 0}class Ct{constructor(t){this.fields=t,t.sort(ot.comparator)}static empty(){return new Ct([])}unionWith(t){let e=new tt(ot.comparator);for(const n of this.fields)e=e.add(n);for(const n of t)e=e.add(n);return new Ct(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return In(this.fields,t.fields,((e,n)=>e.isEqual(n)))}}class Ul extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class dt{constructor(t){this.binaryString=t}static fromBase64String(t){const e=(function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new Ul("Invalid base64 string: "+i):i}})(t);return new dt(e)}static fromUint8Array(t){const e=(function(s){let i="";for(let a=0;a<s.length;++a)i+=String.fromCharCode(s[a]);return i})(t);return new dt(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(e){return btoa(e)})(this.binaryString)}toUint8Array(){return(function(e){const n=new Uint8Array(e.length);for(let s=0;s<e.length;s++)n[s]=e.charCodeAt(s);return n})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return q(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}dt.EMPTY_BYTE_STRING=new dt("");const Dp=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Jt(r){if(F(!!r,39018),typeof r=="string"){let t=0;const e=Dp.exec(r);if(F(!!e,46558,{timestamp:r}),e[1]){let s=e[1];s=(s+"000000000").substr(0,9),t=Number(s)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:t}}return{seconds:st(r.seconds),nanos:st(r.nanos)}}function st(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function Xt(r){return typeof r=="string"?dt.fromBase64String(r):dt.fromUint8Array(r)}const ql="server_timestamp",jl="__type__",zl="__previous_value__",$l="__local_write_time__";function Fo(r){return(r?.mapValue?.fields||{})[jl]?.stringValue===ql}function Zs(r){const t=r.mapValue.fields[zl];return Fo(t)?Zs(t):t}function Sr(r){const t=Jt(r.mapValue.fields[$l].timestampValue);return new X(t.seconds,t.nanos)}class xp{constructor(t,e,n,s,i,a,u,l,d,m,p){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=s,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=l,this.useFetchStreams=d,this.isUsingEmulator=m,this.apiKey=p}}const ks="(default)";class Ge{constructor(t,e){this.projectId=t,this.database=e||ks}static empty(){return new Ge("","")}get isDefaultDatabase(){return this.database===ks}isEqual(t){return t instanceof Ge&&t.projectId===this.projectId&&t.database===this.database}}function Np(r,t){if(!Object.prototype.hasOwnProperty.apply(r.options,["projectId"]))throw new x(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ge(r.options.projectId,t)}const Lo="__type__",Gl="__max__",he={mapValue:{fields:{__type__:{stringValue:Gl}}}},Bo="__vector__",An="value",_s={nullValue:"NULL_VALUE"};function Ie(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?Fo(r)?4:Kl(r)?9007199254740991:ti(r)?10:11:O(28295,{value:r})}function Ht(r,t){if(r===t)return!0;const e=Ie(r);if(e!==Ie(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===t.booleanValue;case 4:return Sr(r).isEqual(Sr(t));case 3:return(function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const a=Jt(s.timestampValue),u=Jt(i.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos})(r,t);case 5:return r.stringValue===t.stringValue;case 6:return(function(s,i){return Xt(s.bytesValue).isEqual(Xt(i.bytesValue))})(r,t);case 7:return r.referenceValue===t.referenceValue;case 8:return(function(s,i){return st(s.geoPointValue.latitude)===st(i.geoPointValue.latitude)&&st(s.geoPointValue.longitude)===st(i.geoPointValue.longitude)})(r,t);case 2:return(function(s,i){if("integerValue"in s&&"integerValue"in i)return st(s.integerValue)===st(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const a=st(s.doubleValue),u=st(i.doubleValue);return a===u?vr(a)===vr(u):isNaN(a)&&isNaN(u)}return!1})(r,t);case 9:return In(r.arrayValue.values||[],t.arrayValue.values||[],Ht);case 10:case 11:return(function(s,i){const a=s.mapValue.fields||{},u=i.mapValue.fields||{};if(qu(a)!==qu(u))return!1;for(const l in a)if(a.hasOwnProperty(l)&&(u[l]===void 0||!Ht(a[l],u[l])))return!1;return!0})(r,t);default:return O(52216,{left:r})}}function Pr(r,t){return(r.values||[]).find((e=>Ht(e,t)))!==void 0}function Ee(r,t){if(r===t)return 0;const e=Ie(r),n=Ie(t);if(e!==n)return q(e,n);switch(e){case 0:case 9007199254740991:return 0;case 1:return q(r.booleanValue,t.booleanValue);case 2:return(function(i,a){const u=st(i.integerValue||i.doubleValue),l=st(a.integerValue||a.doubleValue);return u<l?-1:u>l?1:u===l?0:isNaN(u)?isNaN(l)?0:-1:1})(r,t);case 3:return zu(r.timestampValue,t.timestampValue);case 4:return zu(Sr(r),Sr(t));case 5:return eo(r.stringValue,t.stringValue);case 6:return(function(i,a){const u=Xt(i),l=Xt(a);return u.compareTo(l)})(r.bytesValue,t.bytesValue);case 7:return(function(i,a){const u=i.split("/"),l=a.split("/");for(let d=0;d<u.length&&d<l.length;d++){const m=q(u[d],l[d]);if(m!==0)return m}return q(u.length,l.length)})(r.referenceValue,t.referenceValue);case 8:return(function(i,a){const u=q(st(i.latitude),st(a.latitude));return u!==0?u:q(st(i.longitude),st(a.longitude))})(r.geoPointValue,t.geoPointValue);case 9:return $u(r.arrayValue,t.arrayValue);case 10:return(function(i,a){const u=i.fields||{},l=a.fields||{},d=u[An]?.arrayValue,m=l[An]?.arrayValue,p=q(d?.values?.length||0,m?.values?.length||0);return p!==0?p:$u(d,m)})(r.mapValue,t.mapValue);case 11:return(function(i,a){if(i===he.mapValue&&a===he.mapValue)return 0;if(i===he.mapValue)return 1;if(a===he.mapValue)return-1;const u=i.fields||{},l=Object.keys(u),d=a.fields||{},m=Object.keys(d);l.sort(),m.sort();for(let p=0;p<l.length&&p<m.length;++p){const I=eo(l[p],m[p]);if(I!==0)return I;const S=Ee(u[l[p]],d[m[p]]);if(S!==0)return S}return q(l.length,m.length)})(r.mapValue,t.mapValue);default:throw O(23264,{he:e})}}function zu(r,t){if(typeof r=="string"&&typeof t=="string"&&r.length===t.length)return q(r,t);const e=Jt(r),n=Jt(t),s=q(e.seconds,n.seconds);return s!==0?s:q(e.nanos,n.nanos)}function $u(r,t){const e=r.values||[],n=t.values||[];for(let s=0;s<e.length&&s<n.length;++s){const i=Ee(e[s],n[s]);if(i)return i}return q(e.length,n.length)}function bn(r){return ao(r)}function ao(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?(function(e){const n=Jt(e);return`time(${n.seconds},${n.nanos})`})(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?(function(e){return Xt(e).toBase64()})(r.bytesValue):"referenceValue"in r?(function(e){return N.fromName(e).toString()})(r.referenceValue):"geoPointValue"in r?(function(e){return`geo(${e.latitude},${e.longitude})`})(r.geoPointValue):"arrayValue"in r?(function(e){let n="[",s=!0;for(const i of e.values||[])s?s=!1:n+=",",n+=ao(i);return n+"]"})(r.arrayValue):"mapValue"in r?(function(e){const n=Object.keys(e.fields||{}).sort();let s="{",i=!0;for(const a of n)i?i=!1:s+=",",s+=`${a}:${ao(e.fields[a])}`;return s+"}"})(r.mapValue):O(61005,{value:r})}function ys(r){switch(Ie(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=Zs(r);return t?16+ys(t):16;case 5:return 2*r.stringValue.length;case 6:return Xt(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return(function(n){return(n.values||[]).reduce(((s,i)=>s+ys(i)),0)})(r.arrayValue);case 10:case 11:return(function(n){let s=0;return Ae(n.fields,((i,a)=>{s+=i.length+ys(a)})),s})(r.mapValue);default:throw O(13486,{value:r})}}function Vr(r,t){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${t.path.canonicalString()}`}}function uo(r){return!!r&&"integerValue"in r}function Cr(r){return!!r&&"arrayValue"in r}function Gu(r){return!!r&&"nullValue"in r}function Ku(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function Is(r){return!!r&&"mapValue"in r}function ti(r){return(r?.mapValue?.fields||{})[Lo]?.stringValue===Bo}function pr(r){if(r.geoPointValue)return{geoPointValue:{...r.geoPointValue}};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:{...r.timestampValue}};if(r.mapValue){const t={mapValue:{fields:{}}};return Ae(r.mapValue.fields,((e,n)=>t.mapValue.fields[e]=pr(n))),t}if(r.arrayValue){const t={arrayValue:{values:[]}};for(let e=0;e<(r.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=pr(r.arrayValue.values[e]);return t}return{...r}}function Kl(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue===Gl}const Hl={mapValue:{fields:{[Lo]:{stringValue:Bo},[An]:{arrayValue:{}}}}};function kp(r){return"nullValue"in r?_s:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?Vr(Ge.empty(),N.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?ti(r)?Hl:{mapValue:{}}:O(35942,{value:r})}function Mp(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?Vr(Ge.empty(),N.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?Hl:"mapValue"in r?ti(r)?{mapValue:{}}:he:O(61959,{value:r})}function Hu(r,t){const e=Ee(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?-1:!r.inclusive&&t.inclusive?1:0}function Wu(r,t){const e=Ee(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?1:!r.inclusive&&t.inclusive?-1:0}class wt{constructor(t){this.value=t}static empty(){return new wt({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Is(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=pr(e)}setAll(t){let e=ot.emptyPath(),n={},s=[];t.forEach(((a,u)=>{if(!e.isImmediateParentOf(u)){const l=this.getFieldsMap(e);this.applyChanges(l,n,s),n={},s=[],e=u.popLast()}a?n[u.lastSegment()]=pr(a):s.push(u.lastSegment())}));const i=this.getFieldsMap(e);this.applyChanges(i,n,s)}delete(t){const e=this.field(t.popLast());Is(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Ht(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let s=e.mapValue.fields[t.get(n)];Is(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,n){Ae(e,((s,i)=>t[s]=i));for(const s of n)delete t[s]}clone(){return new wt(pr(this.value))}}function Wl(r){const t=[];return Ae(r.fields,((e,n)=>{const s=new ot([e]);if(Is(n)){const i=Wl(n.mapValue).fields;if(i.length===0)t.push(s);else for(const a of i)t.push(s.child(a))}else t.push(s)})),new Ct(t)}class ut{constructor(t,e,n,s,i,a,u){this.key=t,this.documentType=e,this.version=n,this.readTime=s,this.createTime=i,this.data=a,this.documentState=u}static newInvalidDocument(t){return new ut(t,0,L.min(),L.min(),L.min(),wt.empty(),0)}static newFoundDocument(t,e,n,s){return new ut(t,1,e,L.min(),n,s,0)}static newNoDocument(t,e){return new ut(t,2,e,L.min(),L.min(),wt.empty(),0)}static newUnknownDocument(t,e){return new ut(t,3,e,L.min(),L.min(),wt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(L.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=wt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=wt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=L.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof ut&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new ut(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Rn{constructor(t,e){this.position=t,this.inclusive=e}}function Qu(r,t,e){let n=0;for(let s=0;s<r.position.length;s++){const i=t[s],a=r.position[s];if(i.field.isKeyField()?n=N.comparator(N.fromName(a.referenceValue),e.key):n=Ee(a,e.data.field(i.field)),i.dir==="desc"&&(n*=-1),n!==0)break}return n}function Yu(r,t){if(r===null)return t===null;if(t===null||r.inclusive!==t.inclusive||r.position.length!==t.position.length)return!1;for(let e=0;e<r.position.length;e++)if(!Ht(r.position[e],t.position[e]))return!1;return!0}class Ms{constructor(t,e="asc"){this.field=t,this.dir=e}}function Op(r,t){return r.dir===t.dir&&r.field.isEqual(t.field)}class Ql{}class K extends Ql{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,n):new Fp(t,e,n):e==="array-contains"?new Up(t,n):e==="in"?new eh(t,n):e==="not-in"?new qp(t,n):e==="array-contains-any"?new jp(t,n):new K(t,e,n)}static createKeyFieldInFilter(t,e,n){return e==="in"?new Lp(t,n):new Bp(t,n)}matches(t){const e=t.data.field(this.field);return this.op==="!="?e!==null&&e.nullValue===void 0&&this.matchesComparison(Ee(e,this.value)):e!==null&&Ie(this.value)===Ie(e)&&this.matchesComparison(Ee(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return O(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Z extends Ql{constructor(t,e){super(),this.filters=t,this.op=e,this.Pe=null}static create(t,e){return new Z(t,e)}matches(t){return Sn(this)?this.filters.find((e=>!e.matches(t)))===void 0:this.filters.find((e=>e.matches(t)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Sn(r){return r.op==="and"}function co(r){return r.op==="or"}function Uo(r){return Yl(r)&&Sn(r)}function Yl(r){for(const t of r.filters)if(t instanceof Z)return!1;return!0}function lo(r){if(r instanceof K)return r.field.canonicalString()+r.op.toString()+bn(r.value);if(Uo(r))return r.filters.map((t=>lo(t))).join(",");{const t=r.filters.map((e=>lo(e))).join(",");return`${r.op}(${t})`}}function Jl(r,t){return r instanceof K?(function(n,s){return s instanceof K&&n.op===s.op&&n.field.isEqual(s.field)&&Ht(n.value,s.value)})(r,t):r instanceof Z?(function(n,s){return s instanceof Z&&n.op===s.op&&n.filters.length===s.filters.length?n.filters.reduce(((i,a,u)=>i&&Jl(a,s.filters[u])),!0):!1})(r,t):void O(19439)}function Xl(r,t){const e=r.filters.concat(t);return Z.create(e,r.op)}function Zl(r){return r instanceof K?(function(e){return`${e.field.canonicalString()} ${e.op} ${bn(e.value)}`})(r):r instanceof Z?(function(e){return e.op.toString()+" {"+e.getFilters().map(Zl).join(" ,")+"}"})(r):"Filter"}class Fp extends K{constructor(t,e,n){super(t,e,n),this.key=N.fromName(n.referenceValue)}matches(t){const e=N.comparator(t.key,this.key);return this.matchesComparison(e)}}class Lp extends K{constructor(t,e){super(t,"in",e),this.keys=th("in",e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class Bp extends K{constructor(t,e){super(t,"not-in",e),this.keys=th("not-in",e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function th(r,t){return(t.arrayValue?.values||[]).map((e=>N.fromName(e.referenceValue)))}class Up extends K{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Cr(e)&&Pr(e.arrayValue,this.value)}}class eh extends K{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return e!==null&&Pr(this.value.arrayValue,e)}}class qp extends K{constructor(t,e){super(t,"not-in",e)}matches(t){if(Pr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return e!==null&&e.nullValue===void 0&&!Pr(this.value.arrayValue,e)}}class jp extends K{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Cr(e)||!e.arrayValue.values)&&e.arrayValue.values.some((n=>Pr(this.value.arrayValue,n)))}}class zp{constructor(t,e=null,n=[],s=[],i=null,a=null,u=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=a,this.endAt=u,this.Te=null}}function ho(r,t=null,e=[],n=[],s=null,i=null,a=null){return new zp(r,t,e,n,s,i,a)}function Ke(r){const t=j(r);if(t.Te===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((n=>lo(n))).join(","),e+="|ob:",e+=t.orderBy.map((n=>(function(i){return i.field.canonicalString()+i.dir})(n))).join(","),Qs(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((n=>bn(n))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((n=>bn(n))).join(",")),t.Te=e}return t.Te}function Fr(r,t){if(r.limit!==t.limit||r.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<r.orderBy.length;e++)if(!Op(r.orderBy[e],t.orderBy[e]))return!1;if(r.filters.length!==t.filters.length)return!1;for(let e=0;e<r.filters.length;e++)if(!Jl(r.filters[e],t.filters[e]))return!1;return r.collectionGroup===t.collectionGroup&&!!r.path.isEqual(t.path)&&!!Yu(r.startAt,t.startAt)&&Yu(r.endAt,t.endAt)}function Os(r){return N.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function Fs(r,t){return r.filters.filter((e=>e instanceof K&&e.field.isEqual(t)))}function Ju(r,t,e){let n=_s,s=!0;for(const i of Fs(r,t)){let a=_s,u=!0;switch(i.op){case"<":case"<=":a=kp(i.value);break;case"==":case"in":case">=":a=i.value;break;case">":a=i.value,u=!1;break;case"!=":case"not-in":a=_s}Hu({value:n,inclusive:s},{value:a,inclusive:u})<0&&(n=a,s=u)}if(e!==null){for(let i=0;i<r.orderBy.length;++i)if(r.orderBy[i].field.isEqual(t)){const a=e.position[i];Hu({value:n,inclusive:s},{value:a,inclusive:e.inclusive})<0&&(n=a,s=e.inclusive);break}}return{value:n,inclusive:s}}function Xu(r,t,e){let n=he,s=!0;for(const i of Fs(r,t)){let a=he,u=!0;switch(i.op){case">=":case">":a=Mp(i.value),u=!1;break;case"==":case"in":case"<=":a=i.value;break;case"<":a=i.value,u=!1;break;case"!=":case"not-in":a=he}Wu({value:n,inclusive:s},{value:a,inclusive:u})>0&&(n=a,s=u)}if(e!==null){for(let i=0;i<r.orderBy.length;++i)if(r.orderBy[i].field.isEqual(t)){const a=e.position[i];Wu({value:n,inclusive:s},{value:a,inclusive:e.inclusive})>0&&(n=a,s=e.inclusive);break}}return{value:n,inclusive:s}}class Lr{constructor(t,e=null,n=[],s=[],i=null,a="F",u=null,l=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=s,this.limit=i,this.limitType=a,this.startAt=u,this.endAt=l,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function $p(r,t,e,n,s,i,a,u){return new Lr(r,t,e,n,s,i,a,u)}function ei(r){return new Lr(r)}function Zu(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function Gp(r){return N.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function nh(r){return r.collectionGroup!==null}function gr(r){const t=j(r);if(t.Ie===null){t.Ie=[];const e=new Set;for(const i of t.explicitOrderBy)t.Ie.push(i),e.add(i.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new tt(ot.comparator);return a.filters.forEach((l=>{l.getFlattenedFilters().forEach((d=>{d.isInequality()&&(u=u.add(d.field))}))})),u})(t).forEach((i=>{e.has(i.canonicalString())||i.isKeyField()||t.Ie.push(new Ms(i,n))})),e.has(ot.keyField().canonicalString())||t.Ie.push(new Ms(ot.keyField(),n))}return t.Ie}function Ft(r){const t=j(r);return t.Ee||(t.Ee=Kp(t,gr(r))),t.Ee}function Kp(r,t){if(r.limitType==="F")return ho(r.path,r.collectionGroup,t,r.filters,r.limit,r.startAt,r.endAt);{t=t.map((s=>{const i=s.dir==="desc"?"asc":"desc";return new Ms(s.field,i)}));const e=r.endAt?new Rn(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new Rn(r.startAt.position,r.startAt.inclusive):null;return ho(r.path,r.collectionGroup,t,r.filters,r.limit,e,n)}}function fo(r,t){const e=r.filters.concat([t]);return new Lr(r.path,r.collectionGroup,r.explicitOrderBy.slice(),e,r.limit,r.limitType,r.startAt,r.endAt)}function mo(r,t,e){return new Lr(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),t,e,r.startAt,r.endAt)}function ni(r,t){return Fr(Ft(r),Ft(t))&&r.limitType===t.limitType}function rh(r){return`${Ke(Ft(r))}|lt:${r.limitType}`}function hn(r){return`Query(target=${(function(e){let n=e.path.canonicalString();return e.collectionGroup!==null&&(n+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(n+=`, filters: [${e.filters.map((s=>Zl(s))).join(", ")}]`),Qs(e.limit)||(n+=", limit: "+e.limit),e.orderBy.length>0&&(n+=`, orderBy: [${e.orderBy.map((s=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(s))).join(", ")}]`),e.startAt&&(n+=", startAt: ",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map((s=>bn(s))).join(",")),e.endAt&&(n+=", endAt: ",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map((s=>bn(s))).join(",")),`Target(${n})`})(Ft(r))}; limitType=${r.limitType})`}function Br(r,t){return t.isFoundDocument()&&(function(n,s){const i=s.key.path;return n.collectionGroup!==null?s.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):N.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i)})(r,t)&&(function(n,s){for(const i of gr(n))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0})(r,t)&&(function(n,s){for(const i of n.filters)if(!i.matches(s))return!1;return!0})(r,t)&&(function(n,s){return!(n.startAt&&!(function(a,u,l){const d=Qu(a,u,l);return a.inclusive?d<=0:d<0})(n.startAt,gr(n),s)||n.endAt&&!(function(a,u,l){const d=Qu(a,u,l);return a.inclusive?d>=0:d>0})(n.endAt,gr(n),s))})(r,t)}function Hp(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function sh(r){return(t,e)=>{let n=!1;for(const s of gr(r)){const i=Wp(s,t,e);if(i!==0)return i;n=n||s.field.isKeyField()}return 0}}function Wp(r,t,e){const n=r.field.isKeyField()?N.comparator(t.key,e.key):(function(i,a,u){const l=a.data.field(i),d=u.data.field(i);return l!==null&&d!==null?Ee(l,d):O(42886)})(r.field,t,e);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return O(19790,{direction:r.dir})}}class Zt{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(n!==void 0){for(const[s,i]of n)if(this.equalsFn(s,t))return i}}has(t){return this.get(t)!==void 0}set(t,e){const n=this.mapKeyFn(t),s=this.inner[n];if(s===void 0)return this.inner[n]=[[t,e]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],t))return void(s[i]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(n===void 0)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],t))return n.length===1?delete this.inner[e]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(t){Ae(this.inner,((e,n)=>{for(const[s,i]of n)t(s,i)}))}isEmpty(){return Bl(this.inner)}size(){return this.innerSize}}const Qp=new it(N.comparator);function Nt(){return Qp}const ih=new it(N.comparator);function or(...r){let t=ih;for(const e of r)t=t.insert(e.key,e);return t}function oh(r){let t=ih;return r.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function $t(){return _r()}function ah(){return _r()}function _r(){return new Zt((r=>r.toString()),((r,t)=>r.isEqual(t)))}const Yp=new it(N.comparator),Jp=new tt(N.comparator);function $(...r){let t=Jp;for(const e of r)t=t.add(e);return t}const Xp=new tt(q);function Zp(){return Xp}function qo(r,t){if(r.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:vr(t)?"-0":t}}function uh(r){return{integerValue:""+r}}function tg(r,t){return sp(t)?uh(t):qo(r,t)}class ri{constructor(){this._=void 0}}function eg(r,t,e){return r instanceof Dr?(function(s,i){const a={fields:{[jl]:{stringValue:ql},[$l]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&Fo(i)&&(i=Zs(i)),i&&(a.fields[zl]=i),{mapValue:a}})(e,t):r instanceof Pn?lh(r,t):r instanceof Vn?hh(r,t):(function(s,i){const a=ch(s,i),u=tc(a)+tc(s.Ae);return uo(a)&&uo(s.Ae)?uh(u):qo(s.serializer,u)})(r,t)}function ng(r,t,e){return r instanceof Pn?lh(r,t):r instanceof Vn?hh(r,t):e}function ch(r,t){return r instanceof xr?(function(n){return uo(n)||(function(i){return!!i&&"doubleValue"in i})(n)})(t)?t:{integerValue:0}:null}class Dr extends ri{}class Pn extends ri{constructor(t){super(),this.elements=t}}function lh(r,t){const e=dh(t);for(const n of r.elements)e.some((s=>Ht(s,n)))||e.push(n);return{arrayValue:{values:e}}}class Vn extends ri{constructor(t){super(),this.elements=t}}function hh(r,t){let e=dh(t);for(const n of r.elements)e=e.filter((s=>!Ht(s,n)));return{arrayValue:{values:e}}}class xr extends ri{constructor(t,e){super(),this.serializer=t,this.Ae=e}}function tc(r){return st(r.integerValue||r.doubleValue)}function dh(r){return Cr(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}class rg{constructor(t,e){this.field=t,this.transform=e}}function sg(r,t){return r.field.isEqual(t.field)&&(function(n,s){return n instanceof Pn&&s instanceof Pn||n instanceof Vn&&s instanceof Vn?In(n.elements,s.elements,Ht):n instanceof xr&&s instanceof xr?Ht(n.Ae,s.Ae):n instanceof Dr&&s instanceof Dr})(r.transform,t.transform)}class ig{constructor(t,e){this.version=t,this.transformResults=e}}class St{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new St}static exists(t){return new St(void 0,t)}static updateTime(t){return new St(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Es(r,t){return r.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(r.updateTime):r.exists===void 0||r.exists===t.isFoundDocument()}class si{}function fh(r,t){if(!r.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return r.isNoDocument()?new ii(r.key,St.none()):new kn(r.key,r.data,St.none());{const e=r.data,n=wt.empty();let s=new tt(ot.comparator);for(let i of t.fields)if(!s.has(i)){let a=e.field(i);a===null&&i.length>1&&(i=i.popLast(),a=e.field(i)),a===null?n.delete(i):n.set(i,a),s=s.add(i)}return new te(r.key,n,new Ct(s.toArray()),St.none())}}function og(r,t,e){r instanceof kn?(function(s,i,a){const u=s.value.clone(),l=nc(s.fieldTransforms,i,a.transformResults);u.setAll(l),i.convertToFoundDocument(a.version,u).setHasCommittedMutations()})(r,t,e):r instanceof te?(function(s,i,a){if(!Es(s.precondition,i))return void i.convertToUnknownDocument(a.version);const u=nc(s.fieldTransforms,i,a.transformResults),l=i.data;l.setAll(mh(s)),l.setAll(u),i.convertToFoundDocument(a.version,l).setHasCommittedMutations()})(r,t,e):(function(s,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()})(0,t,e)}function yr(r,t,e,n){return r instanceof kn?(function(i,a,u,l){if(!Es(i.precondition,a))return u;const d=i.value.clone(),m=rc(i.fieldTransforms,l,a);return d.setAll(m),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null})(r,t,e,n):r instanceof te?(function(i,a,u,l){if(!Es(i.precondition,a))return u;const d=rc(i.fieldTransforms,l,a),m=a.data;return m.setAll(mh(i)),m.setAll(d),a.convertToFoundDocument(a.version,m).setHasLocalMutations(),u===null?null:u.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map((p=>p.field)))})(r,t,e,n):(function(i,a,u){return Es(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u})(r,t,e)}function ag(r,t){let e=null;for(const n of r.fieldTransforms){const s=t.data.field(n.field),i=ch(n.transform,s||null);i!=null&&(e===null&&(e=wt.empty()),e.set(n.field,i))}return e||null}function ec(r,t){return r.type===t.type&&!!r.key.isEqual(t.key)&&!!r.precondition.isEqual(t.precondition)&&!!(function(n,s){return n===void 0&&s===void 0||!(!n||!s)&&In(n,s,((i,a)=>sg(i,a)))})(r.fieldTransforms,t.fieldTransforms)&&(r.type===0?r.value.isEqual(t.value):r.type!==1||r.data.isEqual(t.data)&&r.fieldMask.isEqual(t.fieldMask))}class kn extends si{constructor(t,e,n,s=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class te extends si{constructor(t,e,n,s,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function mh(r){const t=new Map;return r.fieldMask.fields.forEach((e=>{if(!e.isEmpty()){const n=r.data.field(e);t.set(e,n)}})),t}function nc(r,t,e){const n=new Map;F(r.length===e.length,32656,{Ve:e.length,de:r.length});for(let s=0;s<e.length;s++){const i=r[s],a=i.transform,u=t.data.field(i.field);n.set(i.field,ng(a,u,e[s]))}return n}function rc(r,t,e){const n=new Map;for(const s of r){const i=s.transform,a=e.data.field(s.field);n.set(s.field,eg(i,a,t))}return n}class ii extends si{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ph extends si{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class jo{constructor(t,e,n,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(t.key)&&og(i,t,n[s])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=yr(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=yr(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=ah();return this.mutations.forEach((s=>{const i=t.get(s.key),a=i.overlayedDocument;let u=this.applyToLocalView(a,i.mutatedFields);u=e.has(s.key)?null:u;const l=fh(a,u);l!==null&&n.set(s.key,l),a.isValidDocument()||a.convertToNoDocument(L.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),$())}isEqual(t){return this.batchId===t.batchId&&In(this.mutations,t.mutations,((e,n)=>ec(e,n)))&&In(this.baseMutations,t.baseMutations,((e,n)=>ec(e,n)))}}class zo{constructor(t,e,n,s){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=s}static from(t,e,n){F(t.mutations.length===n.length,58842,{me:t.mutations.length,fe:n.length});let s=(function(){return Yp})();const i=t.mutations;for(let a=0;a<i.length;a++)s=s.insert(i[a].key,n[a].version);return new zo(t,e,n,s)}}class $o{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class ug{constructor(t,e){this.count=t,this.unchangedNames=e}}var ct,H;function cg(r){switch(r){case P.OK:return O(64938);case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0;default:return O(15467,{code:r})}}function gh(r){if(r===void 0)return Rt("GRPC error has no .code"),P.UNKNOWN;switch(r){case ct.OK:return P.OK;case ct.CANCELLED:return P.CANCELLED;case ct.UNKNOWN:return P.UNKNOWN;case ct.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case ct.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case ct.INTERNAL:return P.INTERNAL;case ct.UNAVAILABLE:return P.UNAVAILABLE;case ct.UNAUTHENTICATED:return P.UNAUTHENTICATED;case ct.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case ct.NOT_FOUND:return P.NOT_FOUND;case ct.ALREADY_EXISTS:return P.ALREADY_EXISTS;case ct.PERMISSION_DENIED:return P.PERMISSION_DENIED;case ct.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case ct.ABORTED:return P.ABORTED;case ct.OUT_OF_RANGE:return P.OUT_OF_RANGE;case ct.UNIMPLEMENTED:return P.UNIMPLEMENTED;case ct.DATA_LOSS:return P.DATA_LOSS;default:return O(39323,{code:r})}}(H=ct||(ct={}))[H.OK=0]="OK",H[H.CANCELLED=1]="CANCELLED",H[H.UNKNOWN=2]="UNKNOWN",H[H.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",H[H.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",H[H.NOT_FOUND=5]="NOT_FOUND",H[H.ALREADY_EXISTS=6]="ALREADY_EXISTS",H[H.PERMISSION_DENIED=7]="PERMISSION_DENIED",H[H.UNAUTHENTICATED=16]="UNAUTHENTICATED",H[H.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",H[H.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",H[H.ABORTED=10]="ABORTED",H[H.OUT_OF_RANGE=11]="OUT_OF_RANGE",H[H.UNIMPLEMENTED=12]="UNIMPLEMENTED",H[H.INTERNAL=13]="INTERNAL",H[H.UNAVAILABLE=14]="UNAVAILABLE",H[H.DATA_LOSS=15]="DATA_LOSS";function lg(){return new TextEncoder}const hg=new me([4294967295,4294967295],0);function sc(r){const t=lg().encode(r),e=new ml;return e.update(t),new Uint8Array(e.digest())}function ic(r){const t=new DataView(r.buffer),e=t.getUint32(0,!0),n=t.getUint32(4,!0),s=t.getUint32(8,!0),i=t.getUint32(12,!0);return[new me([e,n],0),new me([s,i],0)]}class Go{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new ar(`Invalid padding: ${e}`);if(n<0)throw new ar(`Invalid hash count: ${n}`);if(t.length>0&&this.hashCount===0)throw new ar(`Invalid hash count: ${n}`);if(t.length===0&&e!==0)throw new ar(`Invalid padding when bitmap length is 0: ${e}`);this.ge=8*t.length-e,this.pe=me.fromNumber(this.ge)}ye(t,e,n){let s=t.add(e.multiply(me.fromNumber(n)));return s.compare(hg)===1&&(s=new me([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.ge===0)return!1;const e=sc(t),[n,s]=ic(e);for(let i=0;i<this.hashCount;i++){const a=this.ye(n,s,i);if(!this.we(a))return!1}return!0}static create(t,e,n){const s=t%8==0?0:8-t%8,i=new Uint8Array(Math.ceil(t/8)),a=new Go(i,s,e);return n.forEach((u=>a.insert(u))),a}insert(t){if(this.ge===0)return;const e=sc(t),[n,s]=ic(e);for(let i=0;i<this.hashCount;i++){const a=this.ye(n,s,i);this.be(a)}}be(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class ar extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class oi{constructor(t,e,n,s,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const s=new Map;return s.set(t,Ur.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new oi(L.min(),s,new it(q),Nt(),$())}}class Ur{constructor(t,e,n,s,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new Ur(n,e,$(),$(),$())}}class Ts{constructor(t,e,n,s){this.Se=t,this.removedTargetIds=e,this.key=n,this.De=s}}class _h{constructor(t,e){this.targetId=t,this.Ce=e}}class yh{constructor(t,e,n=dt.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=s}}class oc{constructor(){this.ve=0,this.Fe=ac(),this.Me=dt.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(t){t.approximateByteSize()>0&&(this.Oe=!0,this.Me=t)}ke(){let t=$(),e=$(),n=$();return this.Fe.forEach(((s,i)=>{switch(i){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:O(38017,{changeType:i})}})),new Ur(this.Me,this.xe,t,e,n)}Ke(){this.Oe=!1,this.Fe=ac()}qe(t,e){this.Oe=!0,this.Fe=this.Fe.insert(t,e)}Ue(t){this.Oe=!0,this.Fe=this.Fe.remove(t)}$e(){this.ve+=1}We(){this.ve-=1,F(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class dg{constructor(t){this.Ge=t,this.ze=new Map,this.je=Nt(),this.He=us(),this.Je=us(),this.Ze=new it(q)}Xe(t){for(const e of t.Se)t.De&&t.De.isFoundDocument()?this.Ye(e,t.De):this.et(e,t.key,t.De);for(const e of t.removedTargetIds)this.et(e,t.key,t.De)}tt(t){this.forEachTarget(t,(e=>{const n=this.nt(e);switch(t.state){case 0:this.rt(e)&&n.Le(t.resumeToken);break;case 1:n.We(),n.Ne||n.Ke(),n.Le(t.resumeToken);break;case 2:n.We(),n.Ne||this.removeTarget(e);break;case 3:this.rt(e)&&(n.Qe(),n.Le(t.resumeToken));break;case 4:this.rt(e)&&(this.it(e),n.Le(t.resumeToken));break;default:O(56790,{state:t.state})}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ze.forEach(((n,s)=>{this.rt(s)&&e(s)}))}st(t){const e=t.targetId,n=t.Ce.count,s=this.ot(e);if(s){const i=s.target;if(Os(i))if(n===0){const a=new N(i.path);this.et(e,a,ut.newNoDocument(a,L.min()))}else F(n===1,20013,{expectedCount:n});else{const a=this._t(e);if(a!==n){const u=this.ut(t),l=u?this.ct(u,t,a):1;if(l!==0){this.it(e);const d=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(e,d)}}}}}ut(t){const e=t.Ce.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:s=0},hashCount:i=0}=e;let a,u;try{a=Xt(n).toUint8Array()}catch(l){if(l instanceof Ul)return ye("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{u=new Go(a,s,i)}catch(l){return ye(l instanceof ar?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return u.ge===0?null:u}ct(t,e,n){return e.Ce.count===n-this.Pt(t,e.targetId)?0:2}Pt(t,e){const n=this.Ge.getRemoteKeysForTarget(e);let s=0;return n.forEach((i=>{const a=this.Ge.ht(),u=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;t.mightContain(u)||(this.et(e,i,null),s++)})),s}Tt(t){const e=new Map;this.ze.forEach(((i,a)=>{const u=this.ot(a);if(u){if(i.current&&Os(u.target)){const l=new N(u.target.path);this.It(l).has(a)||this.Et(a,l)||this.et(a,l,ut.newNoDocument(l,t))}i.Be&&(e.set(a,i.ke()),i.Ke())}}));let n=$();this.Je.forEach(((i,a)=>{let u=!0;a.forEachWhile((l=>{const d=this.ot(l);return!d||d.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)})),u&&(n=n.add(i))})),this.je.forEach(((i,a)=>a.setReadTime(t)));const s=new oi(t,e,this.Ze,this.je,n);return this.je=Nt(),this.He=us(),this.Je=us(),this.Ze=new it(q),s}Ye(t,e){if(!this.rt(t))return;const n=this.Et(t,e.key)?2:0;this.nt(t).qe(e.key,n),this.je=this.je.insert(e.key,e),this.He=this.He.insert(e.key,this.It(e.key).add(t)),this.Je=this.Je.insert(e.key,this.Rt(e.key).add(t))}et(t,e,n){if(!this.rt(t))return;const s=this.nt(t);this.Et(t,e)?s.qe(e,1):s.Ue(e),this.Je=this.Je.insert(e,this.Rt(e).delete(t)),this.Je=this.Je.insert(e,this.Rt(e).add(t)),n&&(this.je=this.je.insert(e,n))}removeTarget(t){this.ze.delete(t)}_t(t){const e=this.nt(t).ke();return this.Ge.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}$e(t){this.nt(t).$e()}nt(t){let e=this.ze.get(t);return e||(e=new oc,this.ze.set(t,e)),e}Rt(t){let e=this.Je.get(t);return e||(e=new tt(q),this.Je=this.Je.insert(t,e)),e}It(t){let e=this.He.get(t);return e||(e=new tt(q),this.He=this.He.insert(t,e)),e}rt(t){const e=this.ot(t)!==null;return e||V("WatchChangeAggregator","Detected inactive target",t),e}ot(t){const e=this.ze.get(t);return e&&e.Ne?null:this.Ge.At(t)}it(t){this.ze.set(t,new oc),this.Ge.getRemoteKeysForTarget(t).forEach((e=>{this.et(t,e,null)}))}Et(t,e){return this.Ge.getRemoteKeysForTarget(t).has(e)}}function us(){return new it(N.comparator)}function ac(){return new it(N.comparator)}const fg={asc:"ASCENDING",desc:"DESCENDING"},mg={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},pg={and:"AND",or:"OR"};class gg{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function po(r,t){return r.useProto3Json||Qs(t)?t:{value:t}}function Cn(r,t){return r.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Ih(r,t){return r.useProto3Json?t.toBase64():t.toUint8Array()}function _g(r,t){return Cn(r,t.toTimestamp())}function Pt(r){return F(!!r,49232),L.fromTimestamp((function(e){const n=Jt(e);return new X(n.seconds,n.nanos)})(r))}function Ko(r,t){return go(r,t).canonicalString()}function go(r,t){const e=(function(s){return new Y(["projects",s.projectId,"databases",s.database])})(r).child("documents");return t===void 0?e:e.child(t)}function Eh(r){const t=Y.fromString(r);return F(Vh(t),10190,{key:t.toString()}),t}function Ls(r,t){return Ko(r.databaseId,t.path)}function je(r,t){const e=Eh(t);if(e.get(1)!==r.databaseId.projectId)throw new x(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+r.databaseId.projectId);if(e.get(3)!==r.databaseId.database)throw new x(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+r.databaseId.database);return new N(vh(e))}function Th(r,t){return Ko(r.databaseId,t)}function wh(r){const t=Eh(r);return t.length===4?Y.emptyPath():vh(t)}function _o(r){return new Y(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function vh(r){return F(r.length>4&&r.get(4)==="documents",29091,{key:r.toString()}),r.popFirst(5)}function uc(r,t,e){return{name:Ls(r,t),fields:e.value.mapValue.fields}}function yg(r,t,e){const n=je(r,t.name),s=Pt(t.updateTime),i=t.createTime?Pt(t.createTime):L.min(),a=new wt({mapValue:{fields:t.fields}}),u=ut.newFoundDocument(n,s,i,a);return e&&u.setHasCommittedMutations(),e?u.setHasCommittedMutations():u}function Ig(r,t){let e;if("targetChange"in t){t.targetChange;const n=(function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:O(39313,{state:d})})(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],i=(function(d,m){return d.useProto3Json?(F(m===void 0||typeof m=="string",58123),dt.fromBase64String(m||"")):(F(m===void 0||m instanceof Buffer||m instanceof Uint8Array,16193),dt.fromUint8Array(m||new Uint8Array))})(r,t.targetChange.resumeToken),a=t.targetChange.cause,u=a&&(function(d){const m=d.code===void 0?P.UNKNOWN:gh(d.code);return new x(m,d.message||"")})(a);e=new yh(n,s,i,u||null)}else if("documentChange"in t){t.documentChange;const n=t.documentChange;n.document,n.document.name,n.document.updateTime;const s=je(r,n.document.name),i=Pt(n.document.updateTime),a=n.document.createTime?Pt(n.document.createTime):L.min(),u=new wt({mapValue:{fields:n.document.fields}}),l=ut.newFoundDocument(s,i,a,u),d=n.targetIds||[],m=n.removedTargetIds||[];e=new Ts(d,m,l.key,l)}else if("documentDelete"in t){t.documentDelete;const n=t.documentDelete;n.document;const s=je(r,n.document),i=n.readTime?Pt(n.readTime):L.min(),a=ut.newNoDocument(s,i),u=n.removedTargetIds||[];e=new Ts([],u,a.key,a)}else if("documentRemove"in t){t.documentRemove;const n=t.documentRemove;n.document;const s=je(r,n.document),i=n.removedTargetIds||[];e=new Ts([],i,s,null)}else{if(!("filter"in t))return O(11601,{Vt:t});{t.filter;const n=t.filter;n.targetId;const{count:s=0,unchangedNames:i}=n,a=new ug(s,i),u=n.targetId;e=new _h(u,a)}}return e}function Bs(r,t){let e;if(t instanceof kn)e={update:uc(r,t.key,t.value)};else if(t instanceof ii)e={delete:Ls(r,t.key)};else if(t instanceof te)e={update:uc(r,t.key,t.data),updateMask:bg(t.fieldMask)};else{if(!(t instanceof ph))return O(16599,{dt:t.type});e={verify:Ls(r,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map((n=>(function(i,a){const u=a.transform;if(u instanceof Dr)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Pn)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Vn)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof xr)return{fieldPath:a.field.canonicalString(),increment:u.Ae};throw O(20930,{transform:a.transform})})(0,n)))),t.precondition.isNone||(e.currentDocument=(function(s,i){return i.updateTime!==void 0?{updateTime:_g(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:O(27497)})(r,t.precondition)),e}function yo(r,t){const e=t.currentDocument?(function(i){return i.updateTime!==void 0?St.updateTime(Pt(i.updateTime)):i.exists!==void 0?St.exists(i.exists):St.none()})(t.currentDocument):St.none(),n=t.updateTransforms?t.updateTransforms.map((s=>(function(a,u){let l=null;if("setToServerValue"in u)F(u.setToServerValue==="REQUEST_TIME",16630,{proto:u}),l=new Dr;else if("appendMissingElements"in u){const m=u.appendMissingElements.values||[];l=new Pn(m)}else if("removeAllFromArray"in u){const m=u.removeAllFromArray.values||[];l=new Vn(m)}else"increment"in u?l=new xr(a,u.increment):O(16584,{proto:u});const d=ot.fromServerFormat(u.fieldPath);return new rg(d,l)})(r,s))):[];if(t.update){t.update.name;const s=je(r,t.update.name),i=new wt({mapValue:{fields:t.update.fields}});if(t.updateMask){const a=(function(l){const d=l.fieldPaths||[];return new Ct(d.map((m=>ot.fromServerFormat(m))))})(t.updateMask);return new te(s,i,a,e,n)}return new kn(s,i,e,n)}if(t.delete){const s=je(r,t.delete);return new ii(s,e)}if(t.verify){const s=je(r,t.verify);return new ph(s,e)}return O(1463,{proto:t})}function Eg(r,t){return r&&r.length>0?(F(t!==void 0,14353),r.map((e=>(function(s,i){let a=s.updateTime?Pt(s.updateTime):Pt(i);return a.isEqual(L.min())&&(a=Pt(i)),new ig(a,s.transformResults||[])})(e,t)))):[]}function Ah(r,t){return{documents:[Th(r,t.path)]}}function bh(r,t){const e={structuredQuery:{}},n=t.path;let s;t.collectionGroup!==null?(s=n,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=n.popLast(),e.structuredQuery.from=[{collectionId:n.lastSegment()}]),e.parent=Th(r,s);const i=(function(d){if(d.length!==0)return Ph(Z.create(d,"and"))})(t.filters);i&&(e.structuredQuery.where=i);const a=(function(d){if(d.length!==0)return d.map((m=>(function(I){return{field:dn(I.field),direction:wg(I.dir)}})(m)))})(t.orderBy);a&&(e.structuredQuery.orderBy=a);const u=po(r,t.limit);return u!==null&&(e.structuredQuery.limit=u),t.startAt&&(e.structuredQuery.startAt=(function(d){return{before:d.inclusive,values:d.position}})(t.startAt)),t.endAt&&(e.structuredQuery.endAt=(function(d){return{before:!d.inclusive,values:d.position}})(t.endAt)),{ft:e,parent:s}}function Rh(r){let t=wh(r.parent);const e=r.structuredQuery,n=e.from?e.from.length:0;let s=null;if(n>0){F(n===1,65062);const m=e.from[0];m.allDescendants?s=m.collectionId:t=t.child(m.collectionId)}let i=[];e.where&&(i=(function(p){const I=Sh(p);return I instanceof Z&&Uo(I)?I.getFilters():[I]})(e.where));let a=[];e.orderBy&&(a=(function(p){return p.map((I=>(function(C){return new Ms(fn(C.field),(function(M){switch(M){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(C.direction))})(I)))})(e.orderBy));let u=null;e.limit&&(u=(function(p){let I;return I=typeof p=="object"?p.value:p,Qs(I)?null:I})(e.limit));let l=null;e.startAt&&(l=(function(p){const I=!!p.before,S=p.values||[];return new Rn(S,I)})(e.startAt));let d=null;return e.endAt&&(d=(function(p){const I=!p.before,S=p.values||[];return new Rn(S,I)})(e.endAt)),$p(t,s,a,i,u,"F",l,d)}function Tg(r,t){const e=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return O(28987,{purpose:s})}})(t.purpose);return e==null?null:{"goog-listen-tags":e}}function Sh(r){return r.unaryFilter!==void 0?(function(e){switch(e.unaryFilter.op){case"IS_NAN":const n=fn(e.unaryFilter.field);return K.create(n,"==",{doubleValue:NaN});case"IS_NULL":const s=fn(e.unaryFilter.field);return K.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=fn(e.unaryFilter.field);return K.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=fn(e.unaryFilter.field);return K.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return O(61313);default:return O(60726)}})(r):r.fieldFilter!==void 0?(function(e){return K.create(fn(e.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return O(58110);default:return O(50506)}})(e.fieldFilter.op),e.fieldFilter.value)})(r):r.compositeFilter!==void 0?(function(e){return Z.create(e.compositeFilter.filters.map((n=>Sh(n))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return O(1026)}})(e.compositeFilter.op))})(r):O(30097,{filter:r})}function wg(r){return fg[r]}function vg(r){return mg[r]}function Ag(r){return pg[r]}function dn(r){return{fieldPath:r.canonicalString()}}function fn(r){return ot.fromServerFormat(r.fieldPath)}function Ph(r){return r instanceof K?(function(e){if(e.op==="=="){if(Ku(e.value))return{unaryFilter:{field:dn(e.field),op:"IS_NAN"}};if(Gu(e.value))return{unaryFilter:{field:dn(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(Ku(e.value))return{unaryFilter:{field:dn(e.field),op:"IS_NOT_NAN"}};if(Gu(e.value))return{unaryFilter:{field:dn(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:dn(e.field),op:vg(e.op),value:e.value}}})(r):r instanceof Z?(function(e){const n=e.getFilters().map((s=>Ph(s)));return n.length===1?n[0]:{compositeFilter:{op:Ag(e.op),filters:n}}})(r):O(54877,{filter:r})}function bg(r){const t=[];return r.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function Vh(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}function Ch(r){return!!r&&typeof r._toProto=="function"&&r._protoValueType==="ProtoValue"}class Wt{constructor(t,e,n,s,i=L.min(),a=L.min(),u=dt.EMPTY_BYTE_STRING,l=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=l}withSequenceNumber(t){return new Wt(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new Wt(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Wt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Wt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class Dh{constructor(t){this.yt=t}}function Rg(r,t){let e;if(t.document)e=yg(r.yt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const n=N.fromSegments(t.noDocument.path),s=We(t.noDocument.readTime);e=ut.newNoDocument(n,s),t.hasCommittedMutations&&e.setHasCommittedMutations()}else{if(!t.unknownDocument)return O(56709);{const n=N.fromSegments(t.unknownDocument.path),s=We(t.unknownDocument.version);e=ut.newUnknownDocument(n,s)}}return t.readTime&&e.setReadTime((function(s){const i=new X(s[0],s[1]);return L.fromTimestamp(i)})(t.readTime)),e}function cc(r,t){const e=t.key,n={prefixPath:e.getCollectionPath().popLast().toArray(),collectionGroup:e.collectionGroup,documentId:e.path.lastSegment(),readTime:Us(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())n.document=(function(i,a){return{name:Ls(i,a.key),fields:a.data.value.mapValue.fields,updateTime:Cn(i,a.version.toTimestamp()),createTime:Cn(i,a.createTime.toTimestamp())}})(r.yt,t);else if(t.isNoDocument())n.noDocument={path:e.path.toArray(),readTime:He(t.version)};else{if(!t.isUnknownDocument())return O(57904,{document:t});n.unknownDocument={path:e.path.toArray(),version:He(t.version)}}return n}function Us(r){const t=r.toTimestamp();return[t.seconds,t.nanoseconds]}function He(r){const t=r.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function We(r){const t=new X(r.seconds,r.nanoseconds);return L.fromTimestamp(t)}function Oe(r,t){const e=(t.baseMutations||[]).map((i=>yo(r.yt,i)));for(let i=0;i<t.mutations.length-1;++i){const a=t.mutations[i];if(i+1<t.mutations.length&&t.mutations[i+1].transform!==void 0){const u=t.mutations[i+1];a.updateTransforms=u.transform.fieldTransforms,t.mutations.splice(i+1,1),++i}}const n=t.mutations.map((i=>yo(r.yt,i))),s=X.fromMillis(t.localWriteTimeMs);return new jo(t.batchId,s,e,n)}function ur(r){const t=We(r.readTime),e=r.lastLimboFreeSnapshotVersion!==void 0?We(r.lastLimboFreeSnapshotVersion):L.min();let n;return n=(function(i){return i.documents!==void 0})(r.query)?(function(i){const a=i.documents.length;return F(a===1,1966,{count:a}),Ft(ei(wh(i.documents[0])))})(r.query):(function(i){return Ft(Rh(i))})(r.query),new Wt(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,t,e,dt.fromBase64String(r.resumeToken))}function xh(r,t){const e=He(t.snapshotVersion),n=He(t.lastLimboFreeSnapshotVersion);let s;s=Os(t.target)?Ah(r.yt,t.target):bh(r.yt,t.target).ft;const i=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:Ke(t.target),readTime:e,resumeToken:i,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:s}}function Nh(r){const t=Rh({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?mo(t,t.limit,"L"):t}function zi(r,t){return new $o(t.largestBatchId,yo(r.yt,t.overlayMutation))}function lc(r,t){const e=t.path.lastSegment();return[r,vt(t.path.popLast()),e]}function hc(r,t,e,n){return{indexId:r,uid:t,sequenceNumber:e,readTime:He(n.readTime),documentKey:vt(n.documentKey.path),largestBatchId:n.largestBatchId}}class Sg{getBundleMetadata(t,e){return dc(t).get(e).next((n=>{if(n)return(function(i){return{id:i.bundleId,createTime:We(i.createTime),version:i.version}})(n)}))}saveBundleMetadata(t,e){return dc(t).put((function(s){return{bundleId:s.id,createTime:He(Pt(s.createTime)),version:s.version}})(e))}getNamedQuery(t,e){return fc(t).get(e).next((n=>{if(n)return(function(i){return{name:i.name,query:Nh(i.bundledQuery),readTime:We(i.readTime)}})(n)}))}saveNamedQuery(t,e){return fc(t).put((function(s){return{name:s.name,readTime:He(Pt(s.readTime)),bundledQuery:s.bundledQuery}})(e))}}function dc(r){return mt(r,Ys)}function fc(r){return mt(r,Js)}class ai{constructor(t,e){this.serializer=t,this.userId=e}static wt(t,e){const n=e.uid||"";return new ai(t,n)}getOverlay(t,e){return Zn(t).get(lc(this.userId,e)).next((n=>n?zi(this.serializer,n):null))}getOverlays(t,e){const n=$t();return v.forEach(e,(s=>this.getOverlay(t,s).next((i=>{i!==null&&n.set(s,i)})))).next((()=>n))}saveOverlays(t,e,n){const s=[];return n.forEach(((i,a)=>{const u=new $o(e,a);s.push(this.bt(t,u))})),v.waitFor(s)}removeOverlaysForBatchId(t,e,n){const s=new Set;e.forEach((a=>s.add(vt(a.getCollectionPath()))));const i=[];return s.forEach((a=>{const u=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,n+1],!1,!0);i.push(Zn(t).X(io,u))})),v.waitFor(i)}getOverlaysForCollection(t,e,n){const s=$t(),i=vt(e),a=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Zn(t).H(io,a).next((u=>{for(const l of u){const d=zi(this.serializer,l);s.set(d.getKey(),d)}return s}))}getOverlaysForCollectionGroup(t,e,n,s){const i=$t();let a;const u=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,Number.POSITIVE_INFINITY],!0);return Zn(t).ee({index:kl,range:u},((l,d,m)=>{const p=zi(this.serializer,d);i.size()<s||p.largestBatchId===a?(i.set(p.getKey(),p),a=p.largestBatchId):m.done()})).next((()=>i))}bt(t,e){return Zn(t).put((function(s,i,a){const[u,l,d]=lc(i,a.mutation.key);return{userId:i,collectionPath:l,documentId:d,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:Bs(s.yt,a.mutation)}})(this.serializer,this.userId,e))}}function Zn(r){return mt(r,Xs)}class Pg{St(t){return mt(t,Mo)}getSessionToken(t){return this.St(t).get("sessionToken").next((e=>{const n=e?.value;return n?dt.fromUint8Array(n):dt.EMPTY_BYTE_STRING}))}setSessionToken(t,e){return this.St(t).put({name:"sessionToken",value:e.toUint8Array()})}}class Fe{constructor(){}Dt(t,e){this.Ct(t,e),e.vt()}Ct(t,e){if("nullValue"in t)this.Ft(e,5);else if("booleanValue"in t)this.Ft(e,10),e.Mt(t.booleanValue?1:0);else if("integerValue"in t)this.Ft(e,15),e.Mt(st(t.integerValue));else if("doubleValue"in t){const n=st(t.doubleValue);isNaN(n)?this.Ft(e,13):(this.Ft(e,15),vr(n)?e.Mt(0):e.Mt(n))}else if("timestampValue"in t){let n=t.timestampValue;this.Ft(e,20),typeof n=="string"&&(n=Jt(n)),e.xt(`${n.seconds||""}`),e.Mt(n.nanos||0)}else if("stringValue"in t)this.Ot(t.stringValue,e),this.Nt(e);else if("bytesValue"in t)this.Ft(e,30),e.Bt(Xt(t.bytesValue)),this.Nt(e);else if("referenceValue"in t)this.Lt(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.Ft(e,45),e.Mt(n.latitude||0),e.Mt(n.longitude||0)}else"mapValue"in t?Kl(t)?this.Ft(e,Number.MAX_SAFE_INTEGER):ti(t)?this.kt(t.mapValue,e):(this.Kt(t.mapValue,e),this.Nt(e)):"arrayValue"in t?(this.qt(t.arrayValue,e),this.Nt(e)):O(19022,{Ut:t})}Ot(t,e){this.Ft(e,25),this.$t(t,e)}$t(t,e){e.xt(t)}Kt(t,e){const n=t.fields||{};this.Ft(e,55);for(const s of Object.keys(n))this.Ot(s,e),this.Ct(n[s],e)}kt(t,e){const n=t.fields||{};this.Ft(e,53);const s=An,i=n[s].arrayValue?.values?.length||0;this.Ft(e,15),e.Mt(st(i)),this.Ot(s,e),this.Ct(n[s],e)}qt(t,e){const n=t.values||[];this.Ft(e,50);for(const s of n)this.Ct(s,e)}Lt(t,e){this.Ft(e,37),N.fromName(t).path.forEach((n=>{this.Ft(e,60),this.$t(n,e)}))}Ft(t,e){t.Mt(e)}Nt(t){t.Mt(2)}}Fe.Wt=new Fe;const on=255;function Vg(r){if(r===0)return 8;let t=0;return r>>4||(t+=4,r<<=4),r>>6||(t+=2,r<<=2),r>>7||(t+=1),t}function mc(r){const t=64-(function(n){let s=0;for(let i=0;i<8;++i){const a=Vg(255&n[i]);if(s+=a,a!==8)break}return s})(r);return Math.ceil(t/8)}class Cg{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Qt(t){const e=t[Symbol.iterator]();let n=e.next();for(;!n.done;)this.Gt(n.value),n=e.next();this.zt()}jt(t){const e=t[Symbol.iterator]();let n=e.next();for(;!n.done;)this.Ht(n.value),n=e.next();this.Jt()}Zt(t){for(const e of t){const n=e.charCodeAt(0);if(n<128)this.Gt(n);else if(n<2048)this.Gt(960|n>>>6),this.Gt(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.Gt(480|n>>>12),this.Gt(128|63&n>>>6),this.Gt(128|63&n);else{const s=e.codePointAt(0);this.Gt(240|s>>>18),this.Gt(128|63&s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s)}}this.zt()}Xt(t){for(const e of t){const n=e.charCodeAt(0);if(n<128)this.Ht(n);else if(n<2048)this.Ht(960|n>>>6),this.Ht(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.Ht(480|n>>>12),this.Ht(128|63&n>>>6),this.Ht(128|63&n);else{const s=e.codePointAt(0);this.Ht(240|s>>>18),this.Ht(128|63&s>>>12),this.Ht(128|63&s>>>6),this.Ht(128|63&s)}}this.Jt()}Yt(t){const e=this.en(t),n=mc(e);this.tn(1+n),this.buffer[this.position++]=255&n;for(let s=e.length-n;s<e.length;++s)this.buffer[this.position++]=255&e[s]}nn(t){const e=this.en(t),n=mc(e);this.tn(1+n),this.buffer[this.position++]=~(255&n);for(let s=e.length-n;s<e.length;++s)this.buffer[this.position++]=~(255&e[s])}rn(){this.sn(on),this.sn(255)}_n(){this.an(on),this.an(255)}reset(){this.position=0}seed(t){this.tn(t.length),this.buffer.set(t,this.position),this.position+=t.length}un(){return this.buffer.slice(0,this.position)}en(t){const e=(function(i){const a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,i,!1),new Uint8Array(a.buffer)})(t),n=!!(128&e[0]);e[0]^=n?255:128;for(let s=1;s<e.length;++s)e[s]^=n?255:0;return e}Gt(t){const e=255&t;e===0?(this.sn(0),this.sn(255)):e===on?(this.sn(on),this.sn(0)):this.sn(e)}Ht(t){const e=255&t;e===0?(this.an(0),this.an(255)):e===on?(this.an(on),this.an(0)):this.an(t)}zt(){this.sn(0),this.sn(1)}Jt(){this.an(0),this.an(1)}sn(t){this.tn(1),this.buffer[this.position++]=t}an(t){this.tn(1),this.buffer[this.position++]=~t}tn(t){const e=t+this.position;if(e<=this.buffer.length)return;let n=2*this.buffer.length;n<e&&(n=e);const s=new Uint8Array(n);s.set(this.buffer),this.buffer=s}}class Dg{constructor(t){this.cn=t}Bt(t){this.cn.Qt(t)}xt(t){this.cn.Zt(t)}Mt(t){this.cn.Yt(t)}vt(){this.cn.rn()}}class xg{constructor(t){this.cn=t}Bt(t){this.cn.jt(t)}xt(t){this.cn.Xt(t)}Mt(t){this.cn.nn(t)}vt(){this.cn._n()}}class tr{constructor(){this.cn=new Cg,this.ascending=new Dg(this.cn),this.descending=new xg(this.cn)}seed(t){this.cn.seed(t)}ln(t){return t===0?this.ascending:this.descending}un(){return this.cn.un()}reset(){this.cn.reset()}}class Le{constructor(t,e,n,s){this.hn=t,this.Pn=e,this.Tn=n,this.In=s}En(){const t=this.In.length,e=t===0||this.In[t-1]===255?t+1:t,n=new Uint8Array(e);return n.set(this.In,0),e!==t?n.set([0],this.In.length):++n[n.length-1],new Le(this.hn,this.Pn,this.Tn,n)}Rn(t,e,n){return{indexId:this.hn,uid:t,arrayValue:ws(this.Tn),directionalValue:ws(this.In),orderedDocumentKey:ws(e),documentKey:n.path.toArray()}}An(t,e,n){const s=this.Rn(t,e,n);return[s.indexId,s.uid,s.arrayValue,s.directionalValue,s.orderedDocumentKey,s.documentKey]}}function ae(r,t){let e=r.hn-t.hn;return e!==0?e:(e=pc(r.Tn,t.Tn),e!==0?e:(e=pc(r.In,t.In),e!==0?e:N.comparator(r.Pn,t.Pn)))}function pc(r,t){for(let e=0;e<r.length&&e<t.length;++e){const n=r[e]-t[e];if(n!==0)return n}return r.length-t.length}function ws(r){return ol()?(function(e){let n="";for(let s=0;s<e.length;s++)n+=String.fromCharCode(e[s]);return n})(r):r}function gc(r){return typeof r!="string"?r:(function(e){const n=new Uint8Array(e.length);for(let s=0;s<e.length;s++)n[s]=e.charCodeAt(s);return n})(r)}class _c{constructor(t){this.Vn=new tt(((e,n)=>ot.comparator(e.field,n.field))),this.collectionId=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment(),this.dn=t.orderBy,this.mn=[];for(const e of t.filters){const n=e;n.isInequality()?this.Vn=this.Vn.add(n):this.mn.push(n)}}get fn(){return this.Vn.size>1}gn(t){if(F(t.collectionGroup===this.collectionId,49279),this.fn)return!1;const e=no(t);if(e!==void 0&&!this.pn(e))return!1;const n=Ne(t);let s=new Set,i=0,a=0;for(;i<n.length&&this.pn(n[i]);++i)s=s.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.Vn.size>0){const u=this.Vn.getIterator().getNext();if(!s.has(u.field.canonicalString())){const l=n[i];if(!this.yn(u,l)||!this.wn(this.dn[a++],l))return!1}++i}for(;i<n.length;++i){const u=n[i];if(a>=this.dn.length||!this.wn(this.dn[a++],u))return!1}return!0}bn(){if(this.fn)return null;let t=new tt(ot.comparator);const e=[];for(const n of this.mn)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")e.push(new ms(n.field,2));else{if(t.has(n.field))continue;t=t.add(n.field),e.push(new ms(n.field,0))}for(const n of this.dn)n.field.isKeyField()||t.has(n.field)||(t=t.add(n.field),e.push(new ms(n.field,n.dir==="asc"?0:1)));return new Cs(Cs.UNKNOWN_ID,this.collectionId,e,wr.empty())}pn(t){for(const e of this.mn)if(this.yn(e,t))return!0;return!1}yn(t,e){if(t===void 0||!t.field.isEqual(e.fieldPath))return!1;const n=t.op==="array-contains"||t.op==="array-contains-any";return e.kind===2===n}wn(t,e){return!!t.field.isEqual(e.fieldPath)&&(e.kind===0&&t.dir==="asc"||e.kind===1&&t.dir==="desc")}}function kh(r){if(F(r instanceof K||r instanceof Z,20012),r instanceof K){if(r instanceof eh){const e=r.value.arrayValue?.values?.map((n=>K.create(r.field,"==",n)))||[];return Z.create(e,"or")}return r}const t=r.filters.map((e=>kh(e)));return Z.create(t,r.op)}function Ng(r){if(r.getFilters().length===0)return[];const t=To(kh(r));return F(Mh(t),7391),Io(t)||Eo(t)?[t]:t.getFilters()}function Io(r){return r instanceof K}function Eo(r){return r instanceof Z&&Uo(r)}function Mh(r){return Io(r)||Eo(r)||(function(e){if(e instanceof Z&&co(e)){for(const n of e.getFilters())if(!Io(n)&&!Eo(n))return!1;return!0}return!1})(r)}function To(r){if(F(r instanceof K||r instanceof Z,34018),r instanceof K)return r;if(r.filters.length===1)return To(r.filters[0]);const t=r.filters.map((n=>To(n)));let e=Z.create(t,r.op);return e=qs(e),Mh(e)?e:(F(e instanceof Z,64498),F(Sn(e),40251),F(e.filters.length>1,57927),e.filters.reduce(((n,s)=>Ho(n,s))))}function Ho(r,t){let e;return F(r instanceof K||r instanceof Z,38388),F(t instanceof K||t instanceof Z,25473),e=r instanceof K?t instanceof K?(function(s,i){return Z.create([s,i],"and")})(r,t):yc(r,t):t instanceof K?yc(t,r):(function(s,i){if(F(s.filters.length>0&&i.filters.length>0,48005),Sn(s)&&Sn(i))return Xl(s,i.getFilters());const a=co(s)?s:i,u=co(s)?i:s,l=a.filters.map((d=>Ho(d,u)));return Z.create(l,"or")})(r,t),qs(e)}function yc(r,t){if(Sn(t))return Xl(t,r.getFilters());{const e=t.filters.map((n=>Ho(r,n)));return Z.create(e,"or")}}function qs(r){if(F(r instanceof K||r instanceof Z,11850),r instanceof K)return r;const t=r.getFilters();if(t.length===1)return qs(t[0]);if(Yl(r))return r;const e=t.map((s=>qs(s))),n=[];return e.forEach((s=>{s instanceof K?n.push(s):s instanceof Z&&(s.op===r.op?n.push(...s.filters):n.push(s))})),n.length===1?n[0]:Z.create(n,r.op)}class kg{constructor(){this.Sn=new Wo}addToCollectionParentIndex(t,e){return this.Sn.add(e),v.resolve()}getCollectionParents(t,e){return v.resolve(this.Sn.getEntries(e))}addFieldIndex(t,e){return v.resolve()}deleteFieldIndex(t,e){return v.resolve()}deleteAllFieldIndexes(t){return v.resolve()}createTargetIndexes(t,e){return v.resolve()}getDocumentsMatchingTarget(t,e){return v.resolve(null)}getIndexType(t,e){return v.resolve(0)}getFieldIndexes(t,e){return v.resolve([])}getNextCollectionGroupToUpdate(t){return v.resolve(null)}getMinOffset(t,e){return v.resolve(kt.min())}getMinOffsetFromCollectionGroup(t,e){return v.resolve(kt.min())}updateCollectionGroup(t,e,n){return v.resolve()}updateIndexEntries(t,e){return v.resolve()}}class Wo{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e]||new tt(Y.comparator),i=!s.has(n);return this.index[e]=s.add(n),i}has(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e];return s&&s.has(n)}getEntries(t){return(this.index[t]||new tt(Y.comparator)).toArray()}}const Ic="IndexedDbIndexManager",cs=new Uint8Array(0);class Mg{constructor(t,e){this.databaseId=e,this.Dn=new Wo,this.Cn=new Zt((n=>Ke(n)),((n,s)=>Fr(n,s))),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this.Dn.has(e)){const n=e.lastSegment(),s=e.popLast();t.addOnCommittedListener((()=>{this.Dn.add(e)}));const i={collectionId:n,parent:vt(s)};return Ec(t).put(i)}return v.resolve()}getCollectionParents(t,e){const n=[],s=IDBKeyRange.bound([e,""],[wl(e),""],!1,!0);return Ec(t).H(s).next((i=>{for(const a of i){if(a.collectionId!==e)break;n.push(zt(a.parent))}return n}))}addFieldIndex(t,e){const n=er(t),s=(function(u){return{indexId:u.indexId,collectionGroup:u.collectionGroup,fields:u.fields.map((l=>[l.fieldPath.canonicalString(),l.kind]))}})(e);delete s.indexId;const i=n.add(s);if(e.indexState){const a=un(t);return i.next((u=>{a.put(hc(u,this.uid,e.indexState.sequenceNumber,e.indexState.offset))}))}return i.next()}deleteFieldIndex(t,e){const n=er(t),s=un(t),i=an(t);return n.delete(e.indexId).next((()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))).next((()=>i.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))))}deleteAllFieldIndexes(t){const e=er(t),n=an(t),s=un(t);return e.X().next((()=>n.X())).next((()=>s.X()))}createTargetIndexes(t,e){return v.forEach(this.vn(e),(n=>this.getIndexType(t,n).next((s=>{if(s===0||s===1){const i=new _c(n).bn();if(i!=null)return this.addFieldIndex(t,i)}}))))}getDocumentsMatchingTarget(t,e){const n=an(t);let s=!0;const i=new Map;return v.forEach(this.vn(e),(a=>this.Fn(t,a).next((u=>{s&&(s=!!u),i.set(a,u)})))).next((()=>{if(s){let a=$();const u=[];return v.forEach(i,((l,d)=>{V(Ic,`Using index ${(function(B){return`id=${B.indexId}|cg=${B.collectionGroup}|f=${B.fields.map((J=>`${J.fieldPath}:${J.kind}`)).join(",")}`})(l)} to execute ${Ke(e)}`);const m=(function(B,J){const et=no(J);if(et===void 0)return null;for(const Q of Fs(B,et.fieldPath))switch(Q.op){case"array-contains-any":return Q.value.arrayValue.values||[];case"array-contains":return[Q.value]}return null})(d,l),p=(function(B,J){const et=new Map;for(const Q of Ne(J))for(const E of Fs(B,Q.fieldPath))switch(E.op){case"==":case"in":et.set(Q.fieldPath.canonicalString(),E.value);break;case"not-in":case"!=":return et.set(Q.fieldPath.canonicalString(),E.value),Array.from(et.values())}return null})(d,l),I=(function(B,J){const et=[];let Q=!0;for(const E of Ne(J)){const g=E.kind===0?Ju(B,E.fieldPath,B.startAt):Xu(B,E.fieldPath,B.startAt);et.push(g.value),Q&&(Q=g.inclusive)}return new Rn(et,Q)})(d,l),S=(function(B,J){const et=[];let Q=!0;for(const E of Ne(J)){const g=E.kind===0?Xu(B,E.fieldPath,B.endAt):Ju(B,E.fieldPath,B.endAt);et.push(g.value),Q&&(Q=g.inclusive)}return new Rn(et,Q)})(d,l),C=this.Mn(l,d,I),k=this.Mn(l,d,S),M=this.xn(l,d,p),G=this.On(l.indexId,m,C,I.inclusive,k,S.inclusive,M);return v.forEach(G,(U=>n.Z(U,e.limit).next((B=>{B.forEach((J=>{const et=N.fromSegments(J.documentKey);a.has(et)||(a=a.add(et),u.push(et))}))}))))})).next((()=>u))}return v.resolve(null)}))}vn(t){let e=this.Cn.get(t);return e||(t.filters.length===0?e=[t]:e=Ng(Z.create(t.filters,"and")).map((n=>ho(t.path,t.collectionGroup,t.orderBy,n.getFilters(),t.limit,t.startAt,t.endAt))),this.Cn.set(t,e),e)}On(t,e,n,s,i,a,u){const l=(e!=null?e.length:1)*Math.max(n.length,i.length),d=l/(e!=null?e.length:1),m=[];for(let p=0;p<l;++p){const I=e?this.Nn(e[p/d]):cs,S=this.Bn(t,I,n[p%d],s),C=this.Ln(t,I,i[p%d],a),k=u.map((M=>this.Bn(t,I,M,!0)));m.push(...this.createRange(S,C,k))}return m}Bn(t,e,n,s){const i=new Le(t,N.empty(),e,n);return s?i:i.En()}Ln(t,e,n,s){const i=new Le(t,N.empty(),e,n);return s?i.En():i}Fn(t,e){const n=new _c(e),s=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,s).next((i=>{let a=null;for(const u of i)n.gn(u)&&(!a||u.fields.length>a.fields.length)&&(a=u);return a}))}getIndexType(t,e){let n=2;const s=this.vn(e);return v.forEach(s,(i=>this.Fn(t,i).next((a=>{a?n!==0&&a.fields.length<(function(l){let d=new tt(ot.comparator),m=!1;for(const p of l.filters)for(const I of p.getFlattenedFilters())I.field.isKeyField()||(I.op==="array-contains"||I.op==="array-contains-any"?m=!0:d=d.add(I.field));for(const p of l.orderBy)p.field.isKeyField()||(d=d.add(p.field));return d.size+(m?1:0)})(i)&&(n=1):n=0})))).next((()=>(function(a){return a.limit!==null})(e)&&s.length>1&&n===2?1:n))}kn(t,e){const n=new tr;for(const s of Ne(t)){const i=e.data.field(s.fieldPath);if(i==null)return null;const a=n.ln(s.kind);Fe.Wt.Dt(i,a)}return n.un()}Nn(t){const e=new tr;return Fe.Wt.Dt(t,e.ln(0)),e.un()}Kn(t,e){const n=new tr;return Fe.Wt.Dt(Vr(this.databaseId,e),n.ln((function(i){const a=Ne(i);return a.length===0?0:a[a.length-1].kind})(t))),n.un()}xn(t,e,n){if(n===null)return[];let s=[];s.push(new tr);let i=0;for(const a of Ne(t)){const u=n[i++];for(const l of s)if(this.qn(e,a.fieldPath)&&Cr(u))s=this.Un(s,a,u);else{const d=l.ln(a.kind);Fe.Wt.Dt(u,d)}}return this.$n(s)}Mn(t,e,n){return this.xn(t,e,n.position)}$n(t){const e=[];for(let n=0;n<t.length;++n)e[n]=t[n].un();return e}Un(t,e,n){const s=[...t],i=[];for(const a of n.arrayValue.values||[])for(const u of s){const l=new tr;l.seed(u.un()),Fe.Wt.Dt(a,l.ln(e.kind)),i.push(l)}return i}qn(t,e){return!!t.filters.find((n=>n instanceof K&&n.field.isEqual(e)&&(n.op==="in"||n.op==="not-in")))}getFieldIndexes(t,e){const n=er(t),s=un(t);return(e?n.H(so,IDBKeyRange.bound(e,e)):n.H()).next((i=>{const a=[];return v.forEach(i,(u=>s.get([u.indexId,this.uid]).next((l=>{a.push((function(m,p){const I=p?new wr(p.sequenceNumber,new kt(We(p.readTime),new N(zt(p.documentKey)),p.largestBatchId)):wr.empty(),S=m.fields.map((([C,k])=>new ms(ot.fromServerFormat(C),k)));return new Cs(m.indexId,m.collectionGroup,S,I)})(u,l))})))).next((()=>a))}))}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next((e=>e.length===0?null:(e.sort(((n,s)=>{const i=n.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:q(n.collectionGroup,s.collectionGroup)})),e[0].collectionGroup)))}updateCollectionGroup(t,e,n){const s=er(t),i=un(t);return this.Wn(t).next((a=>s.H(so,IDBKeyRange.bound(e,e)).next((u=>v.forEach(u,(l=>i.put(hc(l.indexId,this.uid,a,n))))))))}updateIndexEntries(t,e){const n=new Map;return v.forEach(e,((s,i)=>{const a=n.get(s.collectionGroup);return(a?v.resolve(a):this.getFieldIndexes(t,s.collectionGroup)).next((u=>(n.set(s.collectionGroup,u),v.forEach(u,(l=>this.Qn(t,s,l).next((d=>{const m=this.Gn(i,l);return d.isEqual(m)?v.resolve():this.zn(t,i,l,d,m)})))))))}))}jn(t,e,n,s){return an(t).put(s.Rn(this.uid,this.Kn(n,e.key),e.key))}Hn(t,e,n,s){return an(t).delete(s.An(this.uid,this.Kn(n,e.key),e.key))}Qn(t,e,n){const s=an(t);let i=new tt(ae);return s.ee({index:Nl,range:IDBKeyRange.only([n.indexId,this.uid,ws(this.Kn(n,e))])},((a,u)=>{i=i.add(new Le(n.indexId,e,gc(u.arrayValue),gc(u.directionalValue)))})).next((()=>i))}Gn(t,e){let n=new tt(ae);const s=this.kn(e,t);if(s==null)return n;const i=no(e);if(i!=null){const a=t.data.field(i.fieldPath);if(Cr(a))for(const u of a.arrayValue.values||[])n=n.add(new Le(e.indexId,t.key,this.Nn(u),s))}else n=n.add(new Le(e.indexId,t.key,cs,s));return n}zn(t,e,n,s,i){V(Ic,"Updating index entries for document '%s'",e.key);const a=[];return(function(l,d,m,p,I){const S=l.getIterator(),C=d.getIterator();let k=sn(S),M=sn(C);for(;k||M;){let G=!1,U=!1;if(k&&M){const B=m(k,M);B<0?U=!0:B>0&&(G=!0)}else k!=null?U=!0:G=!0;G?(p(M),M=sn(C)):U?(I(k),k=sn(S)):(k=sn(S),M=sn(C))}})(s,i,ae,(u=>{a.push(this.jn(t,e,n,u))}),(u=>{a.push(this.Hn(t,e,n,u))})),v.waitFor(a)}Wn(t){let e=1;return un(t).ee({index:xl,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((n,s,i)=>{i.done(),e=s.sequenceNumber+1})).next((()=>e))}createRange(t,e,n){n=n.sort(((a,u)=>ae(a,u))).filter(((a,u,l)=>!u||ae(a,l[u-1])!==0));const s=[];s.push(t);for(const a of n){const u=ae(a,t),l=ae(a,e);if(u===0)s[0]=t.En();else if(u>0&&l<0)s.push(a),s.push(a.En());else if(l>0)break}s.push(e);const i=[];for(let a=0;a<s.length;a+=2){if(this.Jn(s[a],s[a+1]))return[];const u=s[a].An(this.uid,cs,N.empty()),l=s[a+1].An(this.uid,cs,N.empty());i.push(IDBKeyRange.bound(u,l))}return i}Jn(t,e){return ae(t,e)>0}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next(Tc)}getMinOffset(t,e){return v.mapArray(this.vn(e),(n=>this.Fn(t,n).next((s=>s||O(44426))))).next(Tc)}}function Ec(r){return mt(r,Rr)}function an(r){return mt(r,mr)}function er(r){return mt(r,ko)}function un(r){return mt(r,fr)}function Tc(r){F(r.length!==0,28825);let t=r[0].indexState.offset,e=t.largestBatchId;for(let n=1;n<r.length;n++){const s=r[n].indexState.offset;Do(s,t)<0&&(t=s),e<s.largestBatchId&&(e=s.largestBatchId)}return new kt(t.readTime,t.documentKey,e)}const wc={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Oh=41943040;class Tt{static withCacheSize(t){return new Tt(t,Tt.DEFAULT_COLLECTION_PERCENTILE,Tt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}}function Fh(r,t,e){const n=r.store(Lt),s=r.store(En),i=[],a=IDBKeyRange.only(e.batchId);let u=0;const l=n.ee({range:a},((m,p,I)=>(u++,I.delete())));i.push(l.next((()=>{F(u===1,47070,{batchId:e.batchId})})));const d=[];for(const m of e.mutations){const p=Vl(t,m.key.path,e.batchId);i.push(s.delete(p)),d.push(m.key)}return v.waitFor(i).next((()=>d))}function js(r){if(!r)return 0;let t;if(r.document)t=r.document;else if(r.unknownDocument)t=r.unknownDocument;else{if(!r.noDocument)throw O(14731);t=r.noDocument}return JSON.stringify(t).length}Tt.DEFAULT_COLLECTION_PERCENTILE=10,Tt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Tt.DEFAULT=new Tt(Oh,Tt.DEFAULT_COLLECTION_PERCENTILE,Tt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Tt.DISABLED=new Tt(-1,0,0);class ui{constructor(t,e,n,s){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=s,this.Zn={}}static wt(t,e,n,s){F(t.uid!=="",64387);const i=t.isAuthenticated()?t.uid:"";return new ui(i,e,n,s)}checkEmpty(t){let e=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ue(t).ee({index:Be,range:n},((s,i,a)=>{e=!1,a.done()})).next((()=>e))}addMutationBatch(t,e,n,s){const i=mn(t),a=ue(t);return a.add({}).next((u=>{F(typeof u=="number",49019);const l=new jo(u,e,n,s),d=(function(S,C,k){const M=k.baseMutations.map((U=>Bs(S.yt,U))),G=k.mutations.map((U=>Bs(S.yt,U)));return{userId:C,batchId:k.batchId,localWriteTimeMs:k.localWriteTime.toMillis(),baseMutations:M,mutations:G}})(this.serializer,this.userId,l),m=[];let p=new tt(((I,S)=>q(I.canonicalString(),S.canonicalString())));for(const I of s){const S=Vl(this.userId,I.key.path,u);p=p.add(I.key.path.popLast()),m.push(a.put(d)),m.push(i.put(S,ap))}return p.forEach((I=>{m.push(this.indexManager.addToCollectionParentIndex(t,I))})),t.addOnCommittedListener((()=>{this.Zn[u]=l.keys()})),v.waitFor(m).next((()=>l))}))}lookupMutationBatch(t,e){return ue(t).get(e).next((n=>n?(F(n.userId===this.userId,48,"Unexpected user for mutation batch",{userId:n.userId,batchId:e}),Oe(this.serializer,n)):null))}Xn(t,e){return this.Zn[e]?v.resolve(this.Zn[e]):this.lookupMutationBatch(t,e).next((n=>{if(n){const s=n.keys();return this.Zn[e]=s,s}return null}))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,s=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return ue(t).ee({index:Be,range:s},((a,u,l)=>{u.userId===this.userId&&(F(u.batchId>=n,47524,{Yn:n}),i=Oe(this.serializer,u)),l.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(t){const e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=Ue;return ue(t).ee({index:Be,range:e,reverse:!0},((s,i,a)=>{n=i.batchId,a.done()})).next((()=>n))}getAllMutationBatches(t){const e=IDBKeyRange.bound([this.userId,Ue],[this.userId,Number.POSITIVE_INFINITY]);return ue(t).H(Be,e).next((n=>n.map((s=>Oe(this.serializer,s)))))}getAllMutationBatchesAffectingDocumentKey(t,e){const n=ps(this.userId,e.path),s=IDBKeyRange.lowerBound(n),i=[];return mn(t).ee({range:s},((a,u,l)=>{const[d,m,p]=a,I=zt(m);if(d===this.userId&&e.path.isEqual(I))return ue(t).get(p).next((S=>{if(!S)throw O(61480,{er:a,batchId:p});F(S.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:S.userId,batchId:p}),i.push(Oe(this.serializer,S))}));l.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new tt(q);const s=[];return e.forEach((i=>{const a=ps(this.userId,i.path),u=IDBKeyRange.lowerBound(a),l=mn(t).ee({range:u},((d,m,p)=>{const[I,S,C]=d,k=zt(S);I===this.userId&&i.path.isEqual(k)?n=n.add(C):p.done()}));s.push(l)})),v.waitFor(s).next((()=>this.tr(t,n)))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,s=n.length+1,i=ps(this.userId,n),a=IDBKeyRange.lowerBound(i);let u=new tt(q);return mn(t).ee({range:a},((l,d,m)=>{const[p,I,S]=l,C=zt(I);p===this.userId&&n.isPrefixOf(C)?C.length===s&&(u=u.add(S)):m.done()})).next((()=>this.tr(t,u)))}tr(t,e){const n=[],s=[];return e.forEach((i=>{s.push(ue(t).get(i).next((a=>{if(a===null)throw O(35274,{batchId:i});F(a.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:a.userId,batchId:i}),n.push(Oe(this.serializer,a))})))})),v.waitFor(s).next((()=>n))}removeMutationBatch(t,e){return Fh(t.le,this.userId,e).next((n=>(t.addOnCommittedListener((()=>{this.nr(e.batchId)})),v.forEach(n,(s=>this.referenceDelegate.markPotentiallyOrphaned(t,s))))))}nr(t){delete this.Zn[t]}performConsistencyCheck(t){return this.checkEmpty(t).next((e=>{if(!e)return v.resolve();const n=IDBKeyRange.lowerBound((function(a){return[a]})(this.userId)),s=[];return mn(t).ee({range:n},((i,a,u)=>{if(i[0]===this.userId){const l=zt(i[1]);s.push(l)}else u.done()})).next((()=>{F(s.length===0,56720,{rr:s.map((i=>i.canonicalString()))})}))}))}containsKey(t,e){return Lh(t,this.userId,e)}ir(t){return Bh(t).get(this.userId).next((e=>e||{userId:this.userId,lastAcknowledgedBatchId:Ue,lastStreamToken:""}))}}function Lh(r,t,e){const n=ps(t,e.path),s=n[1],i=IDBKeyRange.lowerBound(n);let a=!1;return mn(r).ee({range:i,Y:!0},((u,l,d)=>{const[m,p,I]=u;m===t&&p===s&&(a=!0),d.done()})).next((()=>a))}function ue(r){return mt(r,Lt)}function mn(r){return mt(r,En)}function Bh(r){return mt(r,Ar)}class Qe{constructor(t){this.sr=t}next(){return this.sr+=2,this.sr}static _r(){return new Qe(0)}static ar(){return new Qe(-1)}}class Og{constructor(t,e){this.referenceDelegate=t,this.serializer=e}allocateTargetId(t){return this.ur(t).next((e=>{const n=new Qe(e.highestTargetId);return e.highestTargetId=n.next(),this.cr(t,e).next((()=>e.highestTargetId))}))}getLastRemoteSnapshotVersion(t){return this.ur(t).next((e=>L.fromTimestamp(new X(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(t){return this.ur(t).next((e=>e.highestListenSequenceNumber))}setTargetsMetadata(t,e,n){return this.ur(t).next((s=>(s.highestListenSequenceNumber=e,n&&(s.lastRemoteSnapshotVersion=n.toTimestamp()),e>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=e),this.cr(t,s))))}addTargetData(t,e){return this.lr(t,e).next((()=>this.ur(t).next((n=>(n.targetCount+=1,this.hr(e,n),this.cr(t,n))))))}updateTargetData(t,e){return this.lr(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next((()=>cn(t).delete(e.targetId))).next((()=>this.ur(t))).next((n=>(F(n.targetCount>0,8065),n.targetCount-=1,this.cr(t,n))))}removeTargets(t,e,n){let s=0;const i=[];return cn(t).ee(((a,u)=>{const l=ur(u);l.sequenceNumber<=e&&n.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(t,l)))})).next((()=>v.waitFor(i))).next((()=>s))}forEachTarget(t,e){return cn(t).ee(((n,s)=>{const i=ur(s);e(i)}))}ur(t){return vc(t).get(Ns).next((e=>(F(e!==null,2888),e)))}cr(t,e){return vc(t).put(Ns,e)}lr(t,e){return cn(t).put(xh(this.serializer,e))}hr(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.ur(t).next((e=>e.targetCount))}getTargetData(t,e){const n=Ke(e),s=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return cn(t).ee({range:s,index:Dl},((a,u,l)=>{const d=ur(u);Fr(e,d.target)&&(i=d,l.done())})).next((()=>i))}addMatchingKeys(t,e,n){const s=[],i=le(t);return e.forEach((a=>{const u=vt(a.path);s.push(i.put({targetId:n,path:u})),s.push(this.referenceDelegate.addReference(t,n,a))})),v.waitFor(s)}removeMatchingKeys(t,e,n){const s=le(t);return v.forEach(e,(i=>{const a=vt(i.path);return v.waitFor([s.delete([n,a]),this.referenceDelegate.removeReference(t,n,i)])}))}removeMatchingKeysForTargetId(t,e){const n=le(t),s=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(s)}getMatchingKeysForTargetId(t,e){const n=IDBKeyRange.bound([e],[e+1],!1,!0),s=le(t);let i=$();return s.ee({range:n,Y:!0},((a,u,l)=>{const d=zt(a[1]),m=new N(d);i=i.add(m)})).next((()=>i))}containsKey(t,e){const n=vt(e.path),s=IDBKeyRange.bound([n],[wl(n)],!1,!0);let i=0;return le(t).ee({index:No,Y:!0,range:s},(([a,u],l,d)=>{a!==0&&(i++,d.done())})).next((()=>i>0))}At(t,e){return cn(t).get(e).next((n=>n?ur(n):null))}}function cn(r){return mt(r,Tn)}function vc(r){return mt(r,qe)}function le(r){return mt(r,wn)}const Ac="LruGarbageCollector",Fg=1048576;function bc([r,t],[e,n]){const s=q(r,e);return s===0?q(t,n):s}class Lg{constructor(t){this.Pr=t,this.buffer=new tt(bc),this.Tr=0}Ir(){return++this.Tr}Er(t){const e=[t,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(e);else{const n=this.buffer.last();bc(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}}get maxValue(){return this.buffer.last()[0]}}class Uh{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Ar(t){V(Ac,`Garbage collection scheduled in ${t}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){ve(e)?V(Ac,"Ignoring IndexedDB error during garbage collection: ",e):await Xe(e)}await this.Ar(3e5)}))}}class Bg{constructor(t,e){this.Vr=t,this.params=e}calculateTargetCount(t,e){return this.Vr.dr(t).next((n=>Math.floor(e/100*n)))}nthSequenceNumber(t,e){if(e===0)return v.resolve(Ot.ce);const n=new Lg(e);return this.Vr.forEachTarget(t,(s=>n.Er(s.sequenceNumber))).next((()=>this.Vr.mr(t,(s=>n.Er(s))))).next((()=>n.maxValue))}removeTargets(t,e,n){return this.Vr.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.Vr.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(V("LruGarbageCollector","Garbage collection skipped; disabled"),v.resolve(wc)):this.getCacheSize(t).next((n=>n<this.params.cacheSizeCollectionThreshold?(V("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),wc):this.gr(t,e)))}getCacheSize(t){return this.Vr.getCacheSize(t)}gr(t,e){let n,s,i,a,u,l,d;const m=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((p=>(p>this.params.maximumSequenceNumbersToCollect?(V("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),s=this.params.maximumSequenceNumbersToCollect):s=p,a=Date.now(),this.nthSequenceNumber(t,s)))).next((p=>(n=p,u=Date.now(),this.removeTargets(t,n,e)))).next((p=>(i=p,l=Date.now(),this.removeOrphanedDocuments(t,n)))).next((p=>(d=Date.now(),ln()<=W.DEBUG&&V("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-m}ms
	Determined least recently used ${s} in `+(u-a)+`ms
	Removed ${i} targets in `+(l-u)+`ms
	Removed ${p} documents in `+(d-l)+`ms
Total Duration: ${d-m}ms`),v.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:p}))))}}function qh(r,t){return new Bg(r,t)}class Ug{constructor(t,e){this.db=t,this.garbageCollector=qh(this,e)}dr(t){const e=this.pr(t);return this.db.getTargetCache().getTargetCount(t).next((n=>e.next((s=>n+s))))}pr(t){let e=0;return this.mr(t,(n=>{e++})).next((()=>e))}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}mr(t,e){return this.yr(t,((n,s)=>e(s)))}addReference(t,e,n){return ls(t,n)}removeReference(t,e,n){return ls(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return ls(t,e)}wr(t,e){return(function(s,i){let a=!1;return Bh(s).te((u=>Lh(s,u,i).next((l=>(l&&(a=!0),v.resolve(!l)))))).next((()=>a))})(t,e)}removeOrphanedDocuments(t,e){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.yr(t,((a,u)=>{if(u<=e){const l=this.wr(t,a).next((d=>{if(!d)return i++,n.getEntry(t,a).next((()=>(n.removeEntry(a,L.min()),le(t).delete((function(p){return[0,vt(p.path)]})(a)))))}));s.push(l)}})).next((()=>v.waitFor(s))).next((()=>n.apply(t))).next((()=>i))}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return ls(t,e)}yr(t,e){const n=le(t);let s,i=Ot.ce;return n.ee({index:No},(([a,u],{path:l,sequenceNumber:d})=>{a===0?(i!==Ot.ce&&e(new N(zt(s)),i),i=d,s=l):i=Ot.ce})).next((()=>{i!==Ot.ce&&e(new N(zt(s)),i)}))}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}}function ls(r,t){return le(r).put((function(n,s){return{targetId:0,path:vt(n.path),sequenceNumber:s}})(t,r.currentSequenceNumber))}class jh{constructor(){this.changes=new Zt((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,ut.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return n!==void 0?v.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class qg{constructor(t){this.serializer=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,n){return De(t).put(n)}removeEntry(t,e,n){return De(t).delete((function(i,a){const u=i.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],Us(a),u[u.length-1]]})(e,n))}updateMetadata(t,e){return this.getMetadata(t).next((n=>(n.byteSize+=e,this.br(t,n))))}getEntry(t,e){let n=ut.newInvalidDocument(e);return De(t).ee({index:gs,range:IDBKeyRange.only(nr(e))},((s,i)=>{n=this.Sr(e,i)})).next((()=>n))}Dr(t,e){let n={size:0,document:ut.newInvalidDocument(e)};return De(t).ee({index:gs,range:IDBKeyRange.only(nr(e))},((s,i)=>{n={document:this.Sr(e,i),size:js(i)}})).next((()=>n))}getEntries(t,e){let n=Nt();return this.Cr(t,e,((s,i)=>{const a=this.Sr(s,i);n=n.insert(s,a)})).next((()=>n))}vr(t,e){let n=Nt(),s=new it(N.comparator);return this.Cr(t,e,((i,a)=>{const u=this.Sr(i,a);n=n.insert(i,u),s=s.insert(i,js(a))})).next((()=>({documents:n,Fr:s})))}Cr(t,e,n){if(e.isEmpty())return v.resolve();let s=new tt(Pc);e.forEach((l=>s=s.add(l)));const i=IDBKeyRange.bound(nr(s.first()),nr(s.last())),a=s.getIterator();let u=a.getNext();return De(t).ee({index:gs,range:i},((l,d,m)=>{const p=N.fromSegments([...d.prefixPath,d.collectionGroup,d.documentId]);for(;u&&Pc(u,p)<0;)n(u,null),u=a.getNext();u&&u.isEqual(p)&&(n(u,d),u=a.hasNext()?a.getNext():null),u?m.j(nr(u)):m.done()})).next((()=>{for(;u;)n(u,null),u=a.hasNext()?a.getNext():null}))}getDocumentsMatchingQuery(t,e,n,s,i){const a=e.path,u=[a.popLast().toArray(),a.lastSegment(),Us(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],l=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return De(t).H(IDBKeyRange.bound(u,l,!0)).next((d=>{i?.incrementDocumentReadCount(d.length);let m=Nt();for(const p of d){const I=this.Sr(N.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);I.isFoundDocument()&&(Br(e,I)||s.has(I.key))&&(m=m.insert(I.key,I))}return m}))}getAllFromCollectionGroup(t,e,n,s){let i=Nt();const a=Sc(e,n),u=Sc(e,kt.max());return De(t).ee({index:Cl,range:IDBKeyRange.bound(a,u,!0)},((l,d,m)=>{const p=this.Sr(N.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);i=i.insert(p.key,p),i.size===s&&m.done()})).next((()=>i))}newChangeBuffer(t){return new jg(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next((e=>e.byteSize))}getMetadata(t){return Rc(t).get(ro).next((e=>(F(!!e,20021),e)))}br(t,e){return Rc(t).put(ro,e)}Sr(t,e){if(e){const n=Rg(this.serializer,e);if(!(n.isNoDocument()&&n.version.isEqual(L.min())))return n}return ut.newInvalidDocument(t)}}function zh(r){return new qg(r)}class jg extends jh{constructor(t,e){super(),this.Mr=t,this.trackRemovals=e,this.Or=new Zt((n=>n.toString()),((n,s)=>n.isEqual(s)))}applyChanges(t){const e=[];let n=0,s=new tt(((i,a)=>q(i.canonicalString(),a.canonicalString())));return this.changes.forEach(((i,a)=>{const u=this.Or.get(i);if(e.push(this.Mr.removeEntry(t,i,u.readTime)),a.isValidDocument()){const l=cc(this.Mr.serializer,a);s=s.add(i.path.popLast());const d=js(l);n+=d-u.size,e.push(this.Mr.addEntry(t,i,l))}else if(n-=u.size,this.trackRemovals){const l=cc(this.Mr.serializer,a.convertToNoDocument(L.min()));e.push(this.Mr.addEntry(t,i,l))}})),s.forEach((i=>{e.push(this.Mr.indexManager.addToCollectionParentIndex(t,i))})),e.push(this.Mr.updateMetadata(t,n)),v.waitFor(e)}getFromCache(t,e){return this.Mr.Dr(t,e).next((n=>(this.Or.set(e,{size:n.size,readTime:n.document.readTime}),n.document)))}getAllFromCache(t,e){return this.Mr.vr(t,e).next((({documents:n,Fr:s})=>(s.forEach(((i,a)=>{this.Or.set(i,{size:a,readTime:n.get(i).readTime})})),n)))}}function Rc(r){return mt(r,br)}function De(r){return mt(r,xs)}function nr(r){const t=r.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Sc(r,t){const e=t.documentKey.path.toArray();return[r,Us(t.readTime),e.slice(0,e.length-2),e.length>0?e[e.length-1]:""]}function Pc(r,t){const e=r.path.toArray(),n=t.path.toArray();let s=0;for(let i=0;i<e.length-2&&i<n.length-2;++i)if(s=q(e[i],n[i]),s)return s;return s=q(e.length,n.length),s||(s=q(e[e.length-2],n[n.length-2]),s||q(e[e.length-1],n[n.length-1]))}class zg{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class $h{constructor(t,e,n,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=s}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((s=>(n=s,this.remoteDocumentCache.getEntry(t,e)))).next((s=>(n!==null&&yr(n.mutation,s,Ct.empty(),X.now()),s)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((n=>this.getLocalViewOfDocuments(t,n,$()).next((()=>n))))}getLocalViewOfDocuments(t,e,n=$()){const s=$t();return this.populateOverlays(t,s,e).next((()=>this.computeViews(t,e,s,n).next((i=>{let a=or();return i.forEach(((u,l)=>{a=a.insert(u,l.overlayedDocument)})),a}))))}getOverlayedDocuments(t,e){const n=$t();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,$())))}populateOverlays(t,e,n){const s=[];return n.forEach((i=>{e.has(i)||s.push(i)})),this.documentOverlayCache.getOverlays(t,s).next((i=>{i.forEach(((a,u)=>{e.set(a,u)}))}))}computeViews(t,e,n,s){let i=Nt();const a=_r(),u=(function(){return _r()})();return e.forEach(((l,d)=>{const m=n.get(d.key);s.has(d.key)&&(m===void 0||m.mutation instanceof te)?i=i.insert(d.key,d):m!==void 0?(a.set(d.key,m.mutation.getFieldMask()),yr(m.mutation,d,m.mutation.getFieldMask(),X.now())):a.set(d.key,Ct.empty())})),this.recalculateAndSaveOverlays(t,i).next((l=>(l.forEach(((d,m)=>a.set(d,m))),e.forEach(((d,m)=>u.set(d,new zg(m,a.get(d)??null)))),u)))}recalculateAndSaveOverlays(t,e){const n=_r();let s=new it(((a,u)=>a-u)),i=$();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((a=>{for(const u of a)u.keys().forEach((l=>{const d=e.get(l);if(d===null)return;let m=n.get(l)||Ct.empty();m=u.applyToLocalView(d,m),n.set(l,m);const p=(s.get(u.batchId)||$()).add(l);s=s.insert(u.batchId,p)}))})).next((()=>{const a=[],u=s.getReverseIterator();for(;u.hasNext();){const l=u.getNext(),d=l.key,m=l.value,p=ah();m.forEach((I=>{if(!i.has(I)){const S=fh(e.get(I),n.get(I));S!==null&&p.set(I,S),i=i.add(I)}})),a.push(this.documentOverlayCache.saveOverlays(t,d,p))}return v.waitFor(a)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((n=>this.recalculateAndSaveOverlays(t,n)))}getDocumentsMatchingQuery(t,e,n,s){return Gp(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):nh(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,s):this.getDocumentsMatchingCollectionQuery(t,e,n,s)}getNextDocuments(t,e,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,s).next((i=>{const a=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,s-i.size):v.resolve($t());let u=Tr,l=i;return a.next((d=>v.forEach(d,((m,p)=>(u<p.largestBatchId&&(u=p.largestBatchId),i.get(m)?v.resolve():this.remoteDocumentCache.getEntry(t,m).next((I=>{l=l.insert(m,I)}))))).next((()=>this.populateOverlays(t,d,i))).next((()=>this.computeViews(t,l,d,$()))).next((m=>({batchId:u,changes:oh(m)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new N(e)).next((n=>{let s=or();return n.isFoundDocument()&&(s=s.insert(n.key,n)),s}))}getDocumentsMatchingCollectionGroupQuery(t,e,n,s){const i=e.collectionGroup;let a=or();return this.indexManager.getCollectionParents(t,i).next((u=>v.forEach(u,(l=>{const d=(function(p,I){return new Lr(I,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)})(e,l.child(i));return this.getDocumentsMatchingCollectionQuery(t,d,n,s).next((m=>{m.forEach(((p,I)=>{a=a.insert(p,I)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(t,e,n,s){let i;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,i,s)))).next((a=>{i.forEach(((l,d)=>{const m=d.getKey();a.get(m)===null&&(a=a.insert(m,ut.newInvalidDocument(m)))}));let u=or();return a.forEach(((l,d)=>{const m=i.get(l);m!==void 0&&yr(m.mutation,d,Ct.empty(),X.now()),Br(e,d)&&(u=u.insert(l,d))})),u}))}}class $g{constructor(t){this.serializer=t,this.Nr=new Map,this.Br=new Map}getBundleMetadata(t,e){return v.resolve(this.Nr.get(e))}saveBundleMetadata(t,e){return this.Nr.set(e.id,(function(s){return{id:s.id,version:s.version,createTime:Pt(s.createTime)}})(e)),v.resolve()}getNamedQuery(t,e){return v.resolve(this.Br.get(e))}saveNamedQuery(t,e){return this.Br.set(e.name,(function(s){return{name:s.name,query:Nh(s.bundledQuery),readTime:Pt(s.readTime)}})(e)),v.resolve()}}class Gg{constructor(){this.overlays=new it(N.comparator),this.Lr=new Map}getOverlay(t,e){return v.resolve(this.overlays.get(e))}getOverlays(t,e){const n=$t();return v.forEach(e,(s=>this.getOverlay(t,s).next((i=>{i!==null&&n.set(s,i)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((s,i)=>{this.bt(t,e,i)})),v.resolve()}removeOverlaysForBatchId(t,e,n){const s=this.Lr.get(n);return s!==void 0&&(s.forEach((i=>this.overlays=this.overlays.remove(i))),this.Lr.delete(n)),v.resolve()}getOverlaysForCollection(t,e,n){const s=$t(),i=e.length+1,a=new N(e.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){const l=u.getNext().value,d=l.getKey();if(!e.isPrefixOf(d.path))break;d.path.length===i&&l.largestBatchId>n&&s.set(l.getKey(),l)}return v.resolve(s)}getOverlaysForCollectionGroup(t,e,n,s){let i=new it(((d,m)=>d-m));const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===e&&d.largestBatchId>n){let m=i.get(d.largestBatchId);m===null&&(m=$t(),i=i.insert(d.largestBatchId,m)),m.set(d.getKey(),d)}}const u=$t(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach(((d,m)=>u.set(d,m))),!(u.size()>=s)););return v.resolve(u)}bt(t,e,n){const s=this.overlays.get(n.key);if(s!==null){const a=this.Lr.get(s.largestBatchId).delete(n.key);this.Lr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new $o(e,n));let i=this.Lr.get(e);i===void 0&&(i=$(),this.Lr.set(e,i)),this.Lr.set(e,i.add(n.key))}}class Kg{constructor(){this.sessionToken=dt.EMPTY_BYTE_STRING}getSessionToken(t){return v.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,v.resolve()}}class Qo{constructor(){this.kr=new tt(gt.Kr),this.qr=new tt(gt.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(t,e){const n=new gt(t,e);this.kr=this.kr.add(n),this.qr=this.qr.add(n)}$r(t,e){t.forEach((n=>this.addReference(n,e)))}removeReference(t,e){this.Wr(new gt(t,e))}Qr(t,e){t.forEach((n=>this.removeReference(n,e)))}Gr(t){const e=new N(new Y([])),n=new gt(e,t),s=new gt(e,t+1),i=[];return this.qr.forEachInRange([n,s],(a=>{this.Wr(a),i.push(a.key)})),i}zr(){this.kr.forEach((t=>this.Wr(t)))}Wr(t){this.kr=this.kr.delete(t),this.qr=this.qr.delete(t)}jr(t){const e=new N(new Y([])),n=new gt(e,t),s=new gt(e,t+1);let i=$();return this.qr.forEachInRange([n,s],(a=>{i=i.add(a.key)})),i}containsKey(t){const e=new gt(t,0),n=this.kr.firstAfterOrEqual(e);return n!==null&&t.isEqual(n.key)}}class gt{constructor(t,e){this.key=t,this.Hr=e}static Kr(t,e){return N.comparator(t.key,e.key)||q(t.Hr,e.Hr)}static Ur(t,e){return q(t.Hr,e.Hr)||N.comparator(t.key,e.key)}}class Hg{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.Yn=1,this.Jr=new tt(gt.Kr)}checkEmpty(t){return v.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,n,s){const i=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new jo(i,e,n,s);this.mutationQueue.push(a);for(const u of s)this.Jr=this.Jr.add(new gt(u.key,i)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast());return v.resolve(a)}lookupMutationBatch(t,e){return v.resolve(this.Zr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,s=this.Xr(n),i=s<0?0:s;return v.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return v.resolve(this.mutationQueue.length===0?Ue:this.Yn-1)}getAllMutationBatches(t){return v.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new gt(e,0),s=new gt(e,Number.POSITIVE_INFINITY),i=[];return this.Jr.forEachInRange([n,s],(a=>{const u=this.Zr(a.Hr);i.push(u)})),v.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new tt(q);return e.forEach((s=>{const i=new gt(s,0),a=new gt(s,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([i,a],(u=>{n=n.add(u.Hr)}))})),v.resolve(this.Yr(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,s=n.length+1;let i=n;N.isDocumentKey(i)||(i=i.child(""));const a=new gt(new N(i),0);let u=new tt(q);return this.Jr.forEachWhile((l=>{const d=l.key.path;return!!n.isPrefixOf(d)&&(d.length===s&&(u=u.add(l.Hr)),!0)}),a),v.resolve(this.Yr(u))}Yr(t){const e=[];return t.forEach((n=>{const s=this.Zr(n);s!==null&&e.push(s)})),e}removeMutationBatch(t,e){F(this.ei(e.batchId,"removed")===0,55003),this.mutationQueue.shift();let n=this.Jr;return v.forEach(e.mutations,(s=>{const i=new gt(s.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)})).next((()=>{this.Jr=n}))}nr(t){}containsKey(t,e){const n=new gt(e,0),s=this.Jr.firstAfterOrEqual(n);return v.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,v.resolve()}ei(t,e){return this.Xr(t)}Xr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Zr(t){const e=this.Xr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class Wg{constructor(t){this.ti=t,this.docs=(function(){return new it(N.comparator)})(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,s=this.docs.get(n),i=s?s.size:0,a=this.ti(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return v.resolve(n?n.document.mutableCopy():ut.newInvalidDocument(e))}getEntries(t,e){let n=Nt();return e.forEach((s=>{const i=this.docs.get(s);n=n.insert(s,i?i.document.mutableCopy():ut.newInvalidDocument(s))})),v.resolve(n)}getDocumentsMatchingQuery(t,e,n,s){let i=Nt();const a=e.path,u=new N(a.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(u);for(;l.hasNext();){const{key:d,value:{document:m}}=l.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||Do(bl(m),n)<=0||(s.has(m.key)||Br(e,m))&&(i=i.insert(m.key,m.mutableCopy()))}return v.resolve(i)}getAllFromCollectionGroup(t,e,n,s){O(9500)}ni(t,e){return v.forEach(this.docs,(n=>e(n)))}newChangeBuffer(t){return new Qg(this)}getSize(t){return v.resolve(this.size)}}class Qg extends jh{constructor(t){super(),this.Mr=t}applyChanges(t){const e=[];return this.changes.forEach(((n,s)=>{s.isValidDocument()?e.push(this.Mr.addEntry(t,s)):this.Mr.removeEntry(n)})),v.waitFor(e)}getFromCache(t,e){return this.Mr.getEntry(t,e)}getAllFromCache(t,e){return this.Mr.getEntries(t,e)}}class Yg{constructor(t){this.persistence=t,this.ri=new Zt((e=>Ke(e)),Fr),this.lastRemoteSnapshotVersion=L.min(),this.highestTargetId=0,this.ii=0,this.si=new Qo,this.targetCount=0,this.oi=Qe._r()}forEachTarget(t,e){return this.ri.forEach(((n,s)=>e(s))),v.resolve()}getLastRemoteSnapshotVersion(t){return v.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return v.resolve(this.ii)}allocateTargetId(t){return this.highestTargetId=this.oi.next(),v.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ii&&(this.ii=e),v.resolve()}lr(t){this.ri.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.oi=new Qe(e),this.highestTargetId=e),t.sequenceNumber>this.ii&&(this.ii=t.sequenceNumber)}addTargetData(t,e){return this.lr(e),this.targetCount+=1,v.resolve()}updateTargetData(t,e){return this.lr(e),v.resolve()}removeTargetData(t,e){return this.ri.delete(e.target),this.si.Gr(e.targetId),this.targetCount-=1,v.resolve()}removeTargets(t,e,n){let s=0;const i=[];return this.ri.forEach(((a,u)=>{u.sequenceNumber<=e&&n.get(u.targetId)===null&&(this.ri.delete(a),i.push(this.removeMatchingKeysForTargetId(t,u.targetId)),s++)})),v.waitFor(i).next((()=>s))}getTargetCount(t){return v.resolve(this.targetCount)}getTargetData(t,e){const n=this.ri.get(e)||null;return v.resolve(n)}addMatchingKeys(t,e,n){return this.si.$r(e,n),v.resolve()}removeMatchingKeys(t,e,n){this.si.Qr(e,n);const s=this.persistence.referenceDelegate,i=[];return s&&e.forEach((a=>{i.push(s.markPotentiallyOrphaned(t,a))})),v.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this.si.Gr(e),v.resolve()}getMatchingKeysForTargetId(t,e){const n=this.si.jr(e);return v.resolve(n)}containsKey(t,e){return v.resolve(this.si.containsKey(e))}}class Yo{constructor(t,e){this._i={},this.overlays={},this.ai=new Ot(0),this.ui=!1,this.ui=!0,this.ci=new Kg,this.referenceDelegate=t(this),this.li=new Yg(this),this.indexManager=new kg,this.remoteDocumentCache=(function(s){return new Wg(s)})((n=>this.referenceDelegate.hi(n))),this.serializer=new Dh(e),this.Pi=new $g(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Gg,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this._i[t.toKey()];return n||(n=new Hg(e,this.referenceDelegate),this._i[t.toKey()]=n),n}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(t,e,n){V("MemoryPersistence","Starting transaction:",t);const s=new Jg(this.ai.next());return this.referenceDelegate.Ti(),n(s).next((i=>this.referenceDelegate.Ii(s).next((()=>i)))).toPromise().then((i=>(s.raiseOnCommittedEvent(),i)))}Ei(t,e){return v.or(Object.values(this._i).map((n=>()=>n.containsKey(t,e))))}}class Jg extends Sl{constructor(t){super(),this.currentSequenceNumber=t}}class ci{constructor(t){this.persistence=t,this.Ri=new Qo,this.Ai=null}static Vi(t){return new ci(t)}get di(){if(this.Ai)return this.Ai;throw O(60996)}addReference(t,e,n){return this.Ri.addReference(n,e),this.di.delete(n.toString()),v.resolve()}removeReference(t,e,n){return this.Ri.removeReference(n,e),this.di.add(n.toString()),v.resolve()}markPotentiallyOrphaned(t,e){return this.di.add(e.toString()),v.resolve()}removeTarget(t,e){this.Ri.Gr(e.targetId).forEach((s=>this.di.add(s.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((s=>{s.forEach((i=>this.di.add(i.toString())))})).next((()=>n.removeTargetData(t,e)))}Ti(){this.Ai=new Set}Ii(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return v.forEach(this.di,(n=>{const s=N.fromPath(n);return this.mi(t,s).next((i=>{i||e.removeEntry(s,L.min())}))})).next((()=>(this.Ai=null,e.apply(t))))}updateLimboDocument(t,e){return this.mi(t,e).next((n=>{n?this.di.delete(e.toString()):this.di.add(e.toString())}))}hi(t){return 0}mi(t,e){return v.or([()=>v.resolve(this.Ri.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ei(t,e)])}}class zs{constructor(t,e){this.persistence=t,this.fi=new Zt((n=>vt(n.path)),((n,s)=>n.isEqual(s))),this.garbageCollector=qh(this,e)}static Vi(t,e){return new zs(t,e)}Ti(){}Ii(t){return v.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}dr(t){const e=this.pr(t);return this.persistence.getTargetCache().getTargetCount(t).next((n=>e.next((s=>n+s))))}pr(t){let e=0;return this.mr(t,(n=>{e++})).next((()=>e))}mr(t,e){return v.forEach(this.fi,((n,s)=>this.wr(t,n,s).next((i=>i?v.resolve():e(s)))))}removeTargets(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)}removeOrphanedDocuments(t,e){let n=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ni(t,(a=>this.wr(t,a,e).next((u=>{u||(n++,i.removeEntry(a,L.min()))})))).next((()=>i.apply(t))).next((()=>n))}markPotentiallyOrphaned(t,e){return this.fi.set(e,t.currentSequenceNumber),v.resolve()}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)}addReference(t,e,n){return this.fi.set(n,t.currentSequenceNumber),v.resolve()}removeReference(t,e,n){return this.fi.set(n,t.currentSequenceNumber),v.resolve()}updateLimboDocument(t,e){return this.fi.set(e,t.currentSequenceNumber),v.resolve()}hi(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=ys(t.data.value)),e}wr(t,e,n){return v.or([()=>this.persistence.Ei(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{const s=this.fi.get(e);return v.resolve(s!==void 0&&s>n)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}class Xg{constructor(t){this.serializer=t}k(t,e,n,s){const i=new Ws("createOrUpgrade",e);n<1&&s>=1&&((function(l){l.createObjectStore(Or)})(t),(function(l){l.createObjectStore(Ar,{keyPath:op}),l.createObjectStore(Lt,{keyPath:Bu,autoIncrement:!0}).createIndex(Be,Uu,{unique:!0}),l.createObjectStore(En)})(t),Vc(t),(function(l){l.createObjectStore(ke)})(t));let a=v.resolve();return n<3&&s>=3&&(n!==0&&((function(l){l.deleteObjectStore(wn),l.deleteObjectStore(Tn),l.deleteObjectStore(qe)})(t),Vc(t)),a=a.next((()=>(function(l){const d=l.store(qe),m={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:L.min().toTimestamp(),targetCount:0};return d.put(Ns,m)})(i)))),n<4&&s>=4&&(n!==0&&(a=a.next((()=>(function(l,d){return d.store(Lt).H().next((p=>{l.deleteObjectStore(Lt),l.createObjectStore(Lt,{keyPath:Bu,autoIncrement:!0}).createIndex(Be,Uu,{unique:!0});const I=d.store(Lt),S=p.map((C=>I.put(C)));return v.waitFor(S)}))})(t,i)))),a=a.next((()=>{(function(l){l.createObjectStore(vn,{keyPath:pp})})(t)}))),n<5&&s>=5&&(a=a.next((()=>this.gi(i)))),n<6&&s>=6&&(a=a.next((()=>((function(l){l.createObjectStore(br)})(t),this.pi(i))))),n<7&&s>=7&&(a=a.next((()=>this.yi(i)))),n<8&&s>=8&&(a=a.next((()=>this.wi(t,i)))),n<9&&s>=9&&(a=a.next((()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(t)}))),n<10&&s>=10&&(a=a.next((()=>this.bi(i)))),n<11&&s>=11&&(a=a.next((()=>{(function(l){l.createObjectStore(Ys,{keyPath:gp})})(t),(function(l){l.createObjectStore(Js,{keyPath:_p})})(t)}))),n<12&&s>=12&&(a=a.next((()=>{(function(l){const d=l.createObjectStore(Xs,{keyPath:Ap});d.createIndex(io,bp,{unique:!1}),d.createIndex(kl,Rp,{unique:!1})})(t)}))),n<13&&s>=13&&(a=a.next((()=>(function(l){const d=l.createObjectStore(xs,{keyPath:up});d.createIndex(gs,cp),d.createIndex(Cl,lp)})(t))).next((()=>this.Si(t,i))).next((()=>t.deleteObjectStore(ke)))),n<14&&s>=14&&(a=a.next((()=>this.Di(t,i)))),n<15&&s>=15&&(a=a.next((()=>(function(l){l.createObjectStore(ko,{keyPath:yp,autoIncrement:!0}).createIndex(so,Ip,{unique:!1}),l.createObjectStore(fr,{keyPath:Ep}).createIndex(xl,Tp,{unique:!1}),l.createObjectStore(mr,{keyPath:wp}).createIndex(Nl,vp,{unique:!1})})(t)))),n<16&&s>=16&&(a=a.next((()=>{e.objectStore(fr).clear()})).next((()=>{e.objectStore(mr).clear()}))),n<17&&s>=17&&(a=a.next((()=>{(function(l){l.createObjectStore(Mo,{keyPath:Sp})})(t)}))),n<18&&s>=18&&ol()&&(a=a.next((()=>{e.objectStore(fr).clear()})).next((()=>{e.objectStore(mr).clear()}))),a}pi(t){let e=0;return t.store(ke).ee(((n,s)=>{e+=js(s)})).next((()=>{const n={byteSize:e};return t.store(br).put(ro,n)}))}gi(t){const e=t.store(Ar),n=t.store(Lt);return e.H().next((s=>v.forEach(s,(i=>{const a=IDBKeyRange.bound([i.userId,Ue],[i.userId,i.lastAcknowledgedBatchId]);return n.H(Be,a).next((u=>v.forEach(u,(l=>{F(l.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:l.batchId});const d=Oe(this.serializer,l);return Fh(t,i.userId,d).next((()=>{}))}))))}))))}yi(t){const e=t.store(wn),n=t.store(ke);return t.store(qe).get(Ns).next((s=>{const i=[];return n.ee(((a,u)=>{const l=new Y(a),d=(function(p){return[0,vt(p)]})(l);i.push(e.get(d).next((m=>m?v.resolve():(p=>e.put({targetId:0,path:vt(p),sequenceNumber:s.highestListenSequenceNumber}))(l))))})).next((()=>v.waitFor(i)))}))}wi(t,e){t.createObjectStore(Rr,{keyPath:mp});const n=e.store(Rr),s=new Wo,i=a=>{if(s.add(a)){const u=a.lastSegment(),l=a.popLast();return n.put({collectionId:u,parent:vt(l)})}};return e.store(ke).ee({Y:!0},((a,u)=>{const l=new Y(a);return i(l.popLast())})).next((()=>e.store(En).ee({Y:!0},(([a,u,l],d)=>{const m=zt(u);return i(m.popLast())}))))}bi(t){const e=t.store(Tn);return e.ee(((n,s)=>{const i=ur(s),a=xh(this.serializer,i);return e.put(a)}))}Si(t,e){const n=e.store(ke),s=[];return n.ee(((i,a)=>{const u=e.store(xs),l=(function(p){return p.document?new N(Y.fromString(p.document.name).popFirst(5)):p.noDocument?N.fromSegments(p.noDocument.path):p.unknownDocument?N.fromSegments(p.unknownDocument.path):O(36783)})(a).path.toArray(),d={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};s.push(u.put(d))})).next((()=>v.waitFor(s)))}Di(t,e){const n=e.store(Lt),s=zh(this.serializer),i=new Yo(ci.Vi,this.serializer.yt);return n.H().next((a=>{const u=new Map;return a.forEach((l=>{let d=u.get(l.userId)??$();Oe(this.serializer,l).keys().forEach((m=>d=d.add(m))),u.set(l.userId,d)})),v.forEach(u,((l,d)=>{const m=new _t(d),p=ai.wt(this.serializer,m),I=i.getIndexManager(m),S=ui.wt(m,this.serializer,I,i.referenceDelegate);return new $h(s,S,p,I).recalculateAndSaveOverlaysForDocumentKeys(new oo(e,Ot.ce),l).next()}))}))}}function Vc(r){r.createObjectStore(wn,{keyPath:dp}).createIndex(No,fp,{unique:!0}),r.createObjectStore(Tn,{keyPath:"targetId"}).createIndex(Dl,hp,{unique:!0}),r.createObjectStore(qe)}const ce="IndexedDbPersistence",$i=18e5,Gi=5e3,Ki="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Zg="main";class Jo{constructor(t,e,n,s,i,a,u,l,d,m,p=18){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Ci=i,this.window=a,this.document=u,this.Fi=d,this.Mi=m,this.xi=p,this.ai=null,this.ui=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Oi=null,this.inForeground=!1,this.Ni=null,this.Bi=null,this.Li=Number.NEGATIVE_INFINITY,this.ki=I=>Promise.resolve(),!Jo.v())throw new x(P.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Ug(this,s),this.Ki=e+Zg,this.serializer=new Dh(l),this.qi=new ge(this.Ki,this.xi,new Xg(this.serializer)),this.ci=new Pg,this.li=new Og(this.referenceDelegate,this.serializer),this.remoteDocumentCache=zh(this.serializer),this.Pi=new Sg,this.window&&this.window.localStorage?this.Ui=this.window.localStorage:(this.Ui=null,m===!1&&Rt(ce,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.$i().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new x(P.FAILED_PRECONDITION,Ki);return this.Wi(),this.Qi(),this.Gi(),this.runTransaction("getHighestListenSequenceNumber","readonly",(t=>this.li.getHighestSequenceNumber(t)))})).then((t=>{this.ai=new Ot(t,this.Fi)})).then((()=>{this.ui=!0})).catch((t=>(this.qi&&this.qi.close(),Promise.reject(t))))}zi(t){return this.ki=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.qi.q((async e=>{e.newVersion===null&&await t()}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.Ci.enqueueAndForget((async()=>{this.started&&await this.$i()})))}$i(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(t=>hs(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.ji(t).next((e=>{e||(this.isPrimary=!1,this.Ci.enqueueRetryable((()=>this.ki(!1))))}))})).next((()=>this.Hi(t))).next((e=>this.isPrimary&&!e?this.Ji(t).next((()=>!1)):!!e&&this.Zi(t).next((()=>!0)))))).catch((t=>{if(ve(t))return V(ce,"Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return V(ce,"Releasing owner lease after error during lease refresh",t),!1})).then((t=>{this.isPrimary!==t&&this.Ci.enqueueRetryable((()=>this.ki(t))),this.isPrimary=t}))}ji(t){return rr(t).get(rn).next((e=>v.resolve(this.Xi(e))))}Yi(t){return hs(t).delete(this.clientId)}async es(){if(this.isPrimary&&!this.ts(this.Li,$i)){this.Li=Date.now();const t=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(e=>{const n=mt(e,vn);return n.H().next((s=>{const i=this.ns(s,$i),a=s.filter((u=>i.indexOf(u)===-1));return v.forEach(a,(u=>n.delete(u.clientId))).next((()=>a))}))})).catch((()=>[]));if(this.Ui)for(const e of t)this.Ui.removeItem(this.rs(e.clientId))}}Gi(){this.Bi=this.Ci.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.$i().then((()=>this.es())).then((()=>this.Gi()))))}Xi(t){return!!t&&t.ownerId===this.clientId}Hi(t){return this.Mi?v.resolve(!0):rr(t).get(rn).next((e=>{if(e!==null&&this.ts(e.leaseTimestampMs,Gi)&&!this.ss(e.ownerId)){if(this.Xi(e)&&this.networkEnabled)return!0;if(!this.Xi(e)){if(!e.allowTabSynchronization)throw new x(P.FAILED_PRECONDITION,Ki);return!1}}return!(!this.networkEnabled||!this.inForeground)||hs(t).H().next((n=>this.ns(n,Gi).find((s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,a=!this.inForeground&&s.inForeground,u=this.networkEnabled===s.networkEnabled;if(i||a&&u)return!0}return!1}))===void 0))})).next((e=>(this.isPrimary!==e&&V(ce,`Client ${e?"is":"is not"} eligible for a primary lease.`),e)))}async shutdown(){this.ui=!1,this._s(),this.Bi&&(this.Bi.cancel(),this.Bi=null),this.us(),this.cs(),await this.qi.runTransaction("shutdown","readwrite",[Or,vn],(t=>{const e=new oo(t,Ot.ce);return this.Ji(e).next((()=>this.Yi(e)))})),this.qi.close(),this.ls()}ns(t,e){return t.filter((n=>this.ts(n.updateTimeMs,e)&&!this.ss(n.clientId)))}hs(){return this.runTransaction("getActiveClients","readonly",(t=>hs(t).H().next((e=>this.ns(e,$i).map((n=>n.clientId))))))}get started(){return this.ui}getGlobalsCache(){return this.ci}getMutationQueue(t,e){return ui.wt(t,this.serializer,e,this.referenceDelegate)}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new Mg(t,this.serializer.yt.databaseId)}getDocumentOverlayCache(t){return ai.wt(this.serializer,t)}getBundleCache(){return this.Pi}runTransaction(t,e,n){V(ce,"Starting transaction:",t);const s=e==="readonly"?"readonly":"readwrite",i=(function(l){return l===18?Cp:l===17?Ll:l===16?Vp:l===15?Oo:l===14?Fl:l===13?Ol:l===12?Pp:l===11?Ml:void O(60245)})(this.xi);let a;return this.qi.runTransaction(t,s,i,(u=>(a=new oo(u,this.ai?this.ai.next():Ot.ce),e==="readwrite-primary"?this.ji(a).next((l=>!!l||this.Hi(a))).next((l=>{if(!l)throw Rt(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Ci.enqueueRetryable((()=>this.ki(!1))),new x(P.FAILED_PRECONDITION,Rl);return n(a)})).next((l=>this.Zi(a).next((()=>l)))):this.Ps(a).next((()=>n(a)))))).then((u=>(a.raiseOnCommittedEvent(),u)))}Ps(t){return rr(t).get(rn).next((e=>{if(e!==null&&this.ts(e.leaseTimestampMs,Gi)&&!this.ss(e.ownerId)&&!this.Xi(e)&&!(this.Mi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new x(P.FAILED_PRECONDITION,Ki)}))}Zi(t){const e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return rr(t).put(rn,e)}static v(){return ge.v()}Ji(t){const e=rr(t);return e.get(rn).next((n=>this.Xi(n)?(V(ce,"Releasing primary lease."),e.delete(rn)):v.resolve()))}ts(t,e){const n=Date.now();return!(t<n-e)&&(!(t>n)||(Rt(`Detected an update time that is in the future: ${t} > ${n}`),!1))}Wi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ni=()=>{this.Ci.enqueueAndForget((()=>(this.inForeground=this.document.visibilityState==="visible",this.$i())))},this.document.addEventListener("visibilitychange",this.Ni),this.inForeground=this.document.visibilityState==="visible")}us(){this.Ni&&(this.document.removeEventListener("visibilitychange",this.Ni),this.Ni=null)}Qi(){typeof this.window?.addEventListener=="function"&&(this.Oi=()=>{this._s();const t=/(?:Version|Mobile)\/1[456]/;il()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.Ci.enterRestrictedMode(!0),this.Ci.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.Oi))}cs(){this.Oi&&(this.window.removeEventListener("pagehide",this.Oi),this.Oi=null)}ss(t){try{const e=this.Ui?.getItem(this.rs(t))!==null;return V(ce,`Client '${t}' ${e?"is":"is not"} zombied in LocalStorage`),e}catch(e){return Rt(ce,"Failed to get zombied client id.",e),!1}}_s(){if(this.Ui)try{this.Ui.setItem(this.rs(this.clientId),String(Date.now()))}catch(t){Rt("Failed to set zombie client id.",t)}}ls(){if(this.Ui)try{this.Ui.removeItem(this.rs(this.clientId))}catch{}}rs(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}function rr(r){return mt(r,Or)}function hs(r){return mt(r,vn)}function t_(r,t){let e=r.projectId;return r.isDefaultDatabase||(e+="."+r.database),"firestore/"+t+"/"+e+"/"}class Xo{constructor(t,e,n,s){this.targetId=t,this.fromCache=e,this.Ts=n,this.Is=s}static Es(t,e){let n=$(),s=$();for(const i of e.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Xo(t,e.fromCache,n,s)}}class e_{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class Gh{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=(function(){return il()?8:Pl(Rs())>0?6:4})()}initialize(t,e){this.fs=t,this.indexManager=e,this.Rs=!0}getDocumentsMatchingQuery(t,e,n,s){const i={result:null};return this.gs(t,e).next((a=>{i.result=a})).next((()=>{if(!i.result)return this.ps(t,e,s,n).next((a=>{i.result=a}))})).next((()=>{if(i.result)return;const a=new e_;return this.ys(t,e,a).next((u=>{if(i.result=u,this.As)return this.ws(t,e,a,u.size)}))})).next((()=>i.result))}ws(t,e,n,s){return n.documentReadCount<this.Vs?(ln()<=W.DEBUG&&V("QueryEngine","SDK will not create cache indexes for query:",hn(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),v.resolve()):(ln()<=W.DEBUG&&V("QueryEngine","Query:",hn(e),"scans",n.documentReadCount,"local documents and returns",s,"documents as results."),n.documentReadCount>this.ds*s?(ln()<=W.DEBUG&&V("QueryEngine","The SDK decides to create cache indexes for query:",hn(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Ft(e))):v.resolve())}gs(t,e){if(Zu(e))return v.resolve(null);let n=Ft(e);return this.indexManager.getIndexType(t,n).next((s=>s===0?null:(e.limit!==null&&s===1&&(e=mo(e,null,"F"),n=Ft(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((i=>{const a=$(...i);return this.fs.getDocuments(t,a).next((u=>this.indexManager.getMinOffset(t,n).next((l=>{const d=this.bs(e,u);return this.Ss(e,d,a,l.readTime)?this.gs(t,mo(e,null,"F")):this.Ds(t,d,e,l)}))))})))))}ps(t,e,n,s){return Zu(e)||s.isEqual(L.min())?v.resolve(null):this.fs.getDocuments(t,n).next((i=>{const a=this.bs(e,i);return this.Ss(e,a,n,s)?v.resolve(null):(ln()<=W.DEBUG&&V("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),hn(e)),this.Ds(t,a,e,Zm(s,Tr)).next((u=>u)))}))}bs(t,e){let n=new tt(sh(t));return e.forEach(((s,i)=>{Br(t,i)&&(n=n.add(i))})),n}Ss(t,e,n,s){if(t.limit===null)return!1;if(n.size!==e.size)return!0;const i=t.limitType==="F"?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}ys(t,e,n){return ln()<=W.DEBUG&&V("QueryEngine","Using full collection scan to execute query:",hn(e)),this.fs.getDocumentsMatchingQuery(t,e,kt.min(),n)}Ds(t,e,n,s){return this.fs.getDocumentsMatchingQuery(t,n,s).next((i=>(e.forEach((a=>{i=i.insert(a.key,a)})),i)))}}const Zo="LocalStore",n_=3e8;class r_{constructor(t,e,n,s){this.persistence=t,this.Cs=e,this.serializer=s,this.vs=new it(q),this.Fs=new Zt((i=>Ke(i)),Fr),this.Ms=new Map,this.xs=t.getRemoteDocumentCache(),this.li=t.getTargetCache(),this.Pi=t.getBundleCache(),this.Os(n)}Os(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new $h(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.vs)))}}function Kh(r,t,e,n){return new r_(r,t,e,n)}async function Hh(r,t){const e=j(r);return await e.persistence.runTransaction("Handle user change","readonly",(n=>{let s;return e.mutationQueue.getAllMutationBatches(n).next((i=>(s=i,e.Os(t),e.mutationQueue.getAllMutationBatches(n)))).next((i=>{const a=[],u=[];let l=$();for(const d of s){a.push(d.batchId);for(const m of d.mutations)l=l.add(m.key)}for(const d of i){u.push(d.batchId);for(const m of d.mutations)l=l.add(m.key)}return e.localDocuments.getDocuments(n,l).next((d=>({Ns:d,removedBatchIds:a,addedBatchIds:u})))}))}))}function s_(r,t){const e=j(r);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",(n=>{const s=t.batch.keys(),i=e.xs.newChangeBuffer({trackRemovals:!0});return(function(u,l,d,m){const p=d.batch,I=p.keys();let S=v.resolve();return I.forEach((C=>{S=S.next((()=>m.getEntry(l,C))).next((k=>{const M=d.docVersions.get(C);F(M!==null,48541),k.version.compareTo(M)<0&&(p.applyToRemoteDocument(k,d),k.isValidDocument()&&(k.setReadTime(d.commitVersion),m.addEntry(k)))}))})),S.next((()=>u.mutationQueue.removeMutationBatch(l,p)))})(e,n,t,i).next((()=>i.apply(n))).next((()=>e.mutationQueue.performConsistencyCheck(n))).next((()=>e.documentOverlayCache.removeOverlaysForBatchId(n,s,t.batch.batchId))).next((()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,(function(u){let l=$();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(l=l.add(u.batch.mutations[d].key));return l})(t)))).next((()=>e.localDocuments.getDocuments(n,s)))}))}function Wh(r){const t=j(r);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.li.getLastRemoteSnapshotVersion(e)))}function i_(r,t){const e=j(r),n=t.snapshotVersion;let s=e.vs;return e.persistence.runTransaction("Apply remote event","readwrite-primary",(i=>{const a=e.xs.newChangeBuffer({trackRemovals:!0});s=e.vs;const u=[];t.targetChanges.forEach(((m,p)=>{const I=s.get(p);if(!I)return;u.push(e.li.removeMatchingKeys(i,m.removedDocuments,p).next((()=>e.li.addMatchingKeys(i,m.addedDocuments,p))));let S=I.withSequenceNumber(i.currentSequenceNumber);t.targetMismatches.get(p)!==null?S=S.withResumeToken(dt.EMPTY_BYTE_STRING,L.min()).withLastLimboFreeSnapshotVersion(L.min()):m.resumeToken.approximateByteSize()>0&&(S=S.withResumeToken(m.resumeToken,n)),s=s.insert(p,S),(function(k,M,G){return k.resumeToken.approximateByteSize()===0||M.snapshotVersion.toMicroseconds()-k.snapshotVersion.toMicroseconds()>=n_?!0:G.addedDocuments.size+G.modifiedDocuments.size+G.removedDocuments.size>0})(I,S,m)&&u.push(e.li.updateTargetData(i,S))}));let l=Nt(),d=$();if(t.documentUpdates.forEach((m=>{t.resolvedLimboDocuments.has(m)&&u.push(e.persistence.referenceDelegate.updateLimboDocument(i,m))})),u.push(o_(i,a,t.documentUpdates).next((m=>{l=m.Bs,d=m.Ls}))),!n.isEqual(L.min())){const m=e.li.getLastRemoteSnapshotVersion(i).next((p=>e.li.setTargetsMetadata(i,i.currentSequenceNumber,n)));u.push(m)}return v.waitFor(u).next((()=>a.apply(i))).next((()=>e.localDocuments.getLocalViewOfDocuments(i,l,d))).next((()=>l))})).then((i=>(e.vs=s,i)))}function o_(r,t,e){let n=$(),s=$();return e.forEach((i=>n=n.add(i))),t.getEntries(r,n).next((i=>{let a=Nt();return e.forEach(((u,l)=>{const d=i.get(u);l.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(u)),l.isNoDocument()&&l.version.isEqual(L.min())?(t.removeEntry(u,l.readTime),a=a.insert(u,l)):!d.isValidDocument()||l.version.compareTo(d.version)>0||l.version.compareTo(d.version)===0&&d.hasPendingWrites?(t.addEntry(l),a=a.insert(u,l)):V(Zo,"Ignoring outdated watch update for ",u,". Current version:",d.version," Watch version:",l.version)})),{Bs:a,Ls:s}}))}function a_(r,t){const e=j(r);return e.persistence.runTransaction("Get next mutation batch","readonly",(n=>(t===void 0&&(t=Ue),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t))))}function u_(r,t){const e=j(r);return e.persistence.runTransaction("Allocate target","readwrite",(n=>{let s;return e.li.getTargetData(n,t).next((i=>i?(s=i,v.resolve(s)):e.li.allocateTargetId(n).next((a=>(s=new Wt(t,a,"TargetPurposeListen",n.currentSequenceNumber),e.li.addTargetData(n,s).next((()=>s)))))))})).then((n=>{const s=e.vs.get(n.targetId);return(s===null||n.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(e.vs=e.vs.insert(n.targetId,n),e.Fs.set(t,n.targetId)),n}))}async function wo(r,t,e){const n=j(r),s=n.vs.get(t),i=e?"readwrite":"readwrite-primary";try{e||await n.persistence.runTransaction("Release target",i,(a=>n.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!ve(a))throw a;V(Zo,`Failed to update sequence numbers for target ${t}: ${a}`)}n.vs=n.vs.remove(t),n.Fs.delete(s.target)}function Cc(r,t,e){const n=j(r);let s=L.min(),i=$();return n.persistence.runTransaction("Execute query","readwrite",(a=>(function(l,d,m){const p=j(l),I=p.Fs.get(m);return I!==void 0?v.resolve(p.vs.get(I)):p.li.getTargetData(d,m)})(n,a,Ft(t)).next((u=>{if(u)return s=u.lastLimboFreeSnapshotVersion,n.li.getMatchingKeysForTargetId(a,u.targetId).next((l=>{i=l}))})).next((()=>n.Cs.getDocumentsMatchingQuery(a,t,e?s:L.min(),e?i:$()))).next((u=>(c_(n,Hp(t),u),{documents:u,ks:i})))))}function c_(r,t,e){let n=r.Ms.get(t)||L.min();e.forEach(((s,i)=>{i.readTime.compareTo(n)>0&&(n=i.readTime)})),r.Ms.set(t,n)}class Dc{constructor(){this.activeTargetIds=Zp()}Qs(t){this.activeTargetIds=this.activeTargetIds.add(t)}Gs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Ws(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Qh{constructor(){this.vo=new Dc,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t,e=!0){return e&&this.vo.Qs(t),this.Fo[t]||"not-current"}updateQueryState(t,e,n){this.Fo[t]=e}removeLocalQueryTarget(t){this.vo.Gs(t)}isLocalQueryTarget(t){return this.vo.activeTargetIds.has(t)}clearQueryState(t){delete this.Fo[t]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(t){return this.vo.activeTargetIds.has(t)}start(){return this.vo=new Dc,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class l_{Mo(t){}shutdown(){}}const xc="ConnectivityMonitor";class Nc{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(t){this.Lo.push(t)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){V(xc,"Network connectivity changed: AVAILABLE");for(const t of this.Lo)t(0)}Bo(){V(xc,"Network connectivity changed: UNAVAILABLE");for(const t of this.Lo)t(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let ds=null;function vo(){return ds===null?ds=(function(){return 268435456+Math.round(2147483648*Math.random())})():ds++,"0x"+ds.toString(16)}const Hi="RestConnection",h_={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class d_{get Ko(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.qo=e+"://"+t.host,this.Uo=`projects/${n}/databases/${s}`,this.$o=this.databaseId.database===ks?`project_id=${n}`:`project_id=${n}&database_id=${s}`}Wo(t,e,n,s,i){const a=vo(),u=this.Qo(t,e.toUriEncodedString());V(Hi,`Sending RPC '${t}' ${a}:`,u,n);const l={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(l,s,i);const{host:d}=new URL(u),m=So(d);return this.zo(t,u,l,n,m).then((p=>(V(Hi,`Received RPC '${t}' ${a}: `,p),p)),(p=>{throw ye(Hi,`RPC '${t}' ${a} failed with error: `,p,"url: ",u,"request:",n),p}))}jo(t,e,n,s,i,a){return this.Wo(t,e,n,s,i)}Go(t,e,n){t["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Nn})(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((s,i)=>t[i]=s)),n&&n.headers.forEach(((s,i)=>t[i]=s))}Qo(t,e){const n=h_[t];let s=`${this.qo}/v1/${e}:${n}`;return this.databaseInfo.apiKey&&(s=`${s}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),s}terminate(){}}class f_{constructor(t){this.Ho=t.Ho,this.Jo=t.Jo}Zo(t){this.Xo=t}Yo(t){this.e_=t}t_(t){this.n_=t}onMessage(t){this.r_=t}close(){this.Jo()}send(t){this.Ho(t)}i_(){this.Xo()}s_(){this.e_()}o_(t){this.n_(t)}__(t){this.r_(t)}}const Et="WebChannelConnection",sr=(r,t,e)=>{r.listen(t,(n=>{try{e(n)}catch(s){setTimeout((()=>{throw s}),0)}}))};class gn extends d_{constructor(t){super(t),this.a_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}static u_(){if(!gn.c_){const t=yl();sr(t,_l.STAT_EVENT,(e=>{e.stat===to.PROXY?V(Et,"STAT_EVENT: detected buffering proxy"):e.stat===to.NOPROXY&&V(Et,"STAT_EVENT: detected no buffering proxy")})),gn.c_=!0}}zo(t,e,n,s,i){const a=vo();return new Promise(((u,l)=>{const d=new pl;d.setWithCredentials(!0),d.listenOnce(gl.COMPLETE,(()=>{try{switch(d.getLastErrorCode()){case fs.NO_ERROR:const p=d.getResponseJson();V(Et,`XHR for RPC '${t}' ${a} received:`,JSON.stringify(p)),u(p);break;case fs.TIMEOUT:V(Et,`RPC '${t}' ${a} timed out`),l(new x(P.DEADLINE_EXCEEDED,"Request time out"));break;case fs.HTTP_ERROR:const I=d.getStatus();if(V(Et,`RPC '${t}' ${a} failed with status:`,I,"response text:",d.getResponseText()),I>0){let S=d.getResponseJson();Array.isArray(S)&&(S=S[0]);const C=S?.error;if(C&&C.status&&C.message){const k=(function(G){const U=G.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(U)>=0?U:P.UNKNOWN})(C.status);l(new x(k,C.message))}else l(new x(P.UNKNOWN,"Server responded with status "+d.getStatus()))}else l(new x(P.UNAVAILABLE,"Connection failed."));break;default:O(9055,{l_:t,streamId:a,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{V(Et,`RPC '${t}' ${a} completed.`)}}));const m=JSON.stringify(s);V(Et,`RPC '${t}' ${a} sending request:`,s),d.send(e,"POST",m,n,15)}))}T_(t,e,n){const s=vo(),i=[this.qo,"/","google.firestore.v1.Firestore","/",t,"/channel"],a=this.createWebChannelTransport(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;l!==void 0&&(u.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Go(u.initMessageHeaders,e,n),u.encodeInitMessageHeaders=!0;const d=i.join("");V(Et,`Creating RPC '${t}' stream ${s}: ${d}`,u);const m=a.createWebChannel(d,u);this.I_(m);let p=!1,I=!1;const S=new f_({Ho:C=>{I?V(Et,`Not sending because RPC '${t}' stream ${s} is closed:`,C):(p||(V(Et,`Opening RPC '${t}' stream ${s} transport.`),m.open(),p=!0),V(Et,`RPC '${t}' stream ${s} sending:`,C),m.send(C))},Jo:()=>m.close()});return sr(m,ir.EventType.OPEN,(()=>{I||(V(Et,`RPC '${t}' stream ${s} transport opened.`),S.i_())})),sr(m,ir.EventType.CLOSE,(()=>{I||(I=!0,V(Et,`RPC '${t}' stream ${s} transport closed`),S.o_(),this.E_(m))})),sr(m,ir.EventType.ERROR,(C=>{I||(I=!0,ye(Et,`RPC '${t}' stream ${s} transport errored. Name:`,C.name,"Message:",C.message),S.o_(new x(P.UNAVAILABLE,"The operation could not be completed")))})),sr(m,ir.EventType.MESSAGE,(C=>{if(!I){const k=C.data[0];F(!!k,16349);const M=k,G=M?.error||M[0]?.error;if(G){V(Et,`RPC '${t}' stream ${s} received error:`,G);const U=G.status;let B=(function(Q){const E=ct[Q];if(E!==void 0)return gh(E)})(U),J=G.message;U==="NOT_FOUND"&&J.includes("database")&&J.includes("does not exist")&&J.includes(this.databaseId.database)&&ye(`Database '${this.databaseId.database}' not found. Please check your project configuration.`),B===void 0&&(B=P.INTERNAL,J="Unknown error status: "+U+" with message "+G.message),I=!0,S.o_(new x(B,J)),m.close()}else V(Et,`RPC '${t}' stream ${s} received:`,k),S.__(k)}})),gn.u_(),setTimeout((()=>{S.s_()}),0),S}terminate(){this.a_.forEach((t=>t.close())),this.a_=[]}I_(t){this.a_.push(t)}E_(t){this.a_=this.a_.filter((e=>e===t))}Go(t,e,n){super.Go(t,e,n),this.databaseInfo.apiKey&&(t["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return Il()}}function m_(r){return new gn(r)}function p_(){return typeof window<"u"?window:null}function vs(){return typeof document<"u"?document:null}function li(r){return new gg(r,!0)}gn.c_=!1;class Yh{constructor(t,e,n=1e3,s=1.5,i=6e4){this.Ci=t,this.timerId=e,this.R_=n,this.A_=s,this.V_=i,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(t){this.cancel();const e=Math.floor(this.d_+this.y_()),n=Math.max(0,Date.now()-this.f_),s=Math.max(0,e-n);s>0&&V("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.d_} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),t()))),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}const kc="PersistentStream";class Jh{constructor(t,e,n,s,i,a,u,l){this.Ci=t,this.b_=n,this.S_=s,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Yh(t,e)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,(()=>this.k_())))}K_(t){this.q_(),this.stream.send(t)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(t,e){this.q_(),this.U_(),this.M_.cancel(),this.D_++,t!==4?this.M_.reset():e&&e.code===P.RESOURCE_EXHAUSTED?(Rt(e.toString()),Rt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):e&&e.code===P.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.t_(e)}W_(){}auth(){this.state=1;const t=this.Q_(this.D_),e=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([n,s])=>{this.D_===e&&this.G_(n,s)}),(n=>{t((()=>{const s=new x(P.UNKNOWN,"Fetching auth token failed: "+n.message);return this.z_(s)}))}))}G_(t,e){const n=this.Q_(this.D_);this.stream=this.j_(t,e),this.stream.Zo((()=>{n((()=>this.listener.Zo()))})),this.stream.Yo((()=>{n((()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.Yo())))})),this.stream.t_((s=>{n((()=>this.z_(s)))})),this.stream.onMessage((s=>{n((()=>++this.F_==1?this.H_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(t){return V(kc,`close with error: ${t}`),this.stream=null,this.close(4,t)}Q_(t){return e=>{this.Ci.enqueueAndForget((()=>this.D_===t?e():(V(kc,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class g_ extends Jh{constructor(t,e,n,s,i,a){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,s,a),this.serializer=i}j_(t,e){return this.connection.T_("Listen",t,e)}H_(t){return this.onNext(t)}onNext(t){this.M_.reset();const e=Ig(this.serializer,t),n=(function(i){if(!("targetChange"in i))return L.min();const a=i.targetChange;return a.targetIds&&a.targetIds.length?L.min():a.readTime?Pt(a.readTime):L.min()})(t);return this.listener.J_(e,n)}Z_(t){const e={};e.database=_o(this.serializer),e.addTarget=(function(i,a){let u;const l=a.target;if(u=Os(l)?{documents:Ah(i,l)}:{query:bh(i,l).ft},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=Ih(i,a.resumeToken);const d=po(i,a.expectedCount);d!==null&&(u.expectedCount=d)}else if(a.snapshotVersion.compareTo(L.min())>0){u.readTime=Cn(i,a.snapshotVersion.toTimestamp());const d=po(i,a.expectedCount);d!==null&&(u.expectedCount=d)}return u})(this.serializer,t);const n=Tg(this.serializer,t);n&&(e.labels=n),this.K_(e)}X_(t){const e={};e.database=_o(this.serializer),e.removeTarget=t,this.K_(e)}}class __ extends Jh{constructor(t,e,n,s,i,a){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,s,a),this.serializer=i}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(t,e){return this.connection.T_("Write",t,e)}H_(t){return F(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,F(!t.writeResults||t.writeResults.length===0,55816),this.listener.ta()}onNext(t){F(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.M_.reset();const e=Eg(t.writeResults,t.commitTime),n=Pt(t.commitTime);return this.listener.na(n,e)}ra(){const t={};t.database=_o(this.serializer),this.K_(t)}ea(t){const e={streamToken:this.lastStreamToken,writes:t.map((n=>Bs(this.serializer,n)))};this.K_(e)}}class y_{}class I_ extends y_{constructor(t,e,n,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new x(P.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(t,e,n,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,a])=>this.connection.Wo(t,go(e,n),s,i,a))).catch((i=>{throw i.name==="FirebaseError"?(i.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new x(P.UNKNOWN,i.toString())}))}jo(t,e,n,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,u])=>this.connection.jo(t,go(e,n),s,a,u,i))).catch((a=>{throw a.name==="FirebaseError"?(a.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new x(P.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}function E_(r,t,e,n){return new I_(r,t,e,n)}class T_{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(t){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ca("Offline")))}set(t){this.Pa(),this.oa=0,t==="Online"&&(this.aa=!1),this.ca(t)}ca(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}la(t){const e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Rt(e),this.aa=!1):V("OnlineStateTracker",e)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const Ye="RemoteStore";class w_{constructor(t,e,n,s,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=i,this.Aa.Mo((a=>{n.enqueueAndForget((async()=>{Ze(this)&&(V(Ye,"Restarting streams for network reachability change."),await(async function(l){const d=j(l);d.Ea.add(4),await qr(d),d.Va.set("Unknown"),d.Ea.delete(4),await hi(d)})(this))}))})),this.Va=new T_(n,s)}}async function hi(r){if(Ze(r))for(const t of r.Ra)await t(!0)}async function qr(r){for(const t of r.Ra)await t(!1)}function Xh(r,t){const e=j(r);e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),ra(e)?na(e):Mn(e).O_()&&ea(e,t))}function ta(r,t){const e=j(r),n=Mn(e);e.Ia.delete(t),n.O_()&&Zh(e,t),e.Ia.size===0&&(n.O_()?n.L_():Ze(e)&&e.Va.set("Unknown"))}function ea(r,t){if(r.da.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(L.min())>0){const e=r.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}Mn(r).Z_(t)}function Zh(r,t){r.da.$e(t),Mn(r).X_(t)}function na(r){r.da=new dg({getRemoteKeysForTarget:t=>r.remoteSyncer.getRemoteKeysForTarget(t),At:t=>r.Ia.get(t)||null,ht:()=>r.datastore.serializer.databaseId}),Mn(r).start(),r.Va.ua()}function ra(r){return Ze(r)&&!Mn(r).x_()&&r.Ia.size>0}function Ze(r){return j(r).Ea.size===0}function td(r){r.da=void 0}async function v_(r){r.Va.set("Online")}async function A_(r){r.Ia.forEach(((t,e)=>{ea(r,t)}))}async function b_(r,t){td(r),ra(r)?(r.Va.ha(t),na(r)):r.Va.set("Unknown")}async function R_(r,t,e){if(r.Va.set("Online"),t instanceof yh&&t.state===2&&t.cause)try{await(async function(s,i){const a=i.cause;for(const u of i.targetIds)s.Ia.has(u)&&(await s.remoteSyncer.rejectListen(u,a),s.Ia.delete(u),s.da.removeTarget(u))})(r,t)}catch(n){V(Ye,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await $s(r,n)}else if(t instanceof Ts?r.da.Xe(t):t instanceof _h?r.da.st(t):r.da.tt(t),!e.isEqual(L.min()))try{const n=await Wh(r.localStore);e.compareTo(n)>=0&&await(function(i,a){const u=i.da.Tt(a);return u.targetChanges.forEach(((l,d)=>{if(l.resumeToken.approximateByteSize()>0){const m=i.Ia.get(d);m&&i.Ia.set(d,m.withResumeToken(l.resumeToken,a))}})),u.targetMismatches.forEach(((l,d)=>{const m=i.Ia.get(l);if(!m)return;i.Ia.set(l,m.withResumeToken(dt.EMPTY_BYTE_STRING,m.snapshotVersion)),Zh(i,l);const p=new Wt(m.target,l,d,m.sequenceNumber);ea(i,p)})),i.remoteSyncer.applyRemoteEvent(u)})(r,e)}catch(n){V(Ye,"Failed to raise snapshot:",n),await $s(r,n)}}async function $s(r,t,e){if(!ve(t))throw t;r.Ea.add(1),await qr(r),r.Va.set("Offline"),e||(e=()=>Wh(r.localStore)),r.asyncQueue.enqueueRetryable((async()=>{V(Ye,"Retrying IndexedDB access"),await e(),r.Ea.delete(1),await hi(r)}))}function ed(r,t){return t().catch((e=>$s(r,e,t)))}async function jr(r){const t=j(r),e=Te(t);let n=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:Ue;for(;S_(t);)try{const s=await a_(t.localStore,n);if(s===null){t.Ta.length===0&&e.L_();break}n=s.batchId,P_(t,s)}catch(s){await $s(t,s)}nd(t)&&rd(t)}function S_(r){return Ze(r)&&r.Ta.length<10}function P_(r,t){r.Ta.push(t);const e=Te(r);e.O_()&&e.Y_&&e.ea(t.mutations)}function nd(r){return Ze(r)&&!Te(r).x_()&&r.Ta.length>0}function rd(r){Te(r).start()}async function V_(r){Te(r).ra()}async function C_(r){const t=Te(r);for(const e of r.Ta)t.ea(e.mutations)}async function D_(r,t,e){const n=r.Ta.shift(),s=zo.from(n,t,e);await ed(r,(()=>r.remoteSyncer.applySuccessfulWrite(s))),await jr(r)}async function x_(r,t){t&&Te(r).Y_&&await(async function(n,s){if((function(a){return cg(a)&&a!==P.ABORTED})(s.code)){const i=n.Ta.shift();Te(n).B_(),await ed(n,(()=>n.remoteSyncer.rejectFailedWrite(i.batchId,s))),await jr(n)}})(r,t),nd(r)&&rd(r)}async function Mc(r,t){const e=j(r);e.asyncQueue.verifyOperationInProgress(),V(Ye,"RemoteStore received new credentials");const n=Ze(e);e.Ea.add(3),await qr(e),n&&e.Va.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await hi(e)}async function N_(r,t){const e=j(r);t?(e.Ea.delete(2),await hi(e)):t||(e.Ea.add(2),await qr(e),e.Va.set("Unknown"))}function Mn(r){return r.ma||(r.ma=(function(e,n,s){const i=j(e);return i.sa(),new g_(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)})(r.datastore,r.asyncQueue,{Zo:v_.bind(null,r),Yo:A_.bind(null,r),t_:b_.bind(null,r),J_:R_.bind(null,r)}),r.Ra.push((async t=>{t?(r.ma.B_(),ra(r)?na(r):r.Va.set("Unknown")):(await r.ma.stop(),td(r))}))),r.ma}function Te(r){return r.fa||(r.fa=(function(e,n,s){const i=j(e);return i.sa(),new __(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)})(r.datastore,r.asyncQueue,{Zo:()=>Promise.resolve(),Yo:V_.bind(null,r),t_:x_.bind(null,r),ta:C_.bind(null,r),na:D_.bind(null,r)}),r.Ra.push((async t=>{t?(r.fa.B_(),await jr(r)):(await r.fa.stop(),r.Ta.length>0&&(V(Ye,`Stopping write stream with ${r.Ta.length} pending writes`),r.Ta=[]))}))),r.fa}class sa{constructor(t,e,n,s,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=s,this.removalCallback=i,this.deferred=new pe,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,s,i){const a=Date.now()+n,u=new sa(t,e,a,s,i);return u.start(n),u}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new x(P.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ia(r,t){if(Rt("AsyncQueue",`${t}: ${r}`),ve(r))return new x(P.UNAVAILABLE,`${t}: ${r}`);throw r}class _n{static emptySet(t){return new _n(t.comparator)}constructor(t){this.comparator=t?(e,n)=>t(e,n)||N.comparator(e.key,n.key):(e,n)=>N.comparator(e.key,n.key),this.keyedMap=or(),this.sortedSet=new it(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof _n)||this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const s=e.getNext().key,i=n.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){const n=new _n;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class Oc{constructor(){this.ga=new it(N.comparator)}track(t){const e=t.doc.key,n=this.ga.get(e);n?t.type!==0&&n.type===3?this.ga=this.ga.insert(e,t):t.type===3&&n.type!==1?this.ga=this.ga.insert(e,{type:n.type,doc:t.doc}):t.type===2&&n.type===2?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):t.type===2&&n.type===0?this.ga=this.ga.insert(e,{type:0,doc:t.doc}):t.type===1&&n.type===0?this.ga=this.ga.remove(e):t.type===1&&n.type===2?this.ga=this.ga.insert(e,{type:1,doc:n.doc}):t.type===0&&n.type===1?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):O(63341,{Vt:t,pa:n}):this.ga=this.ga.insert(e,t)}ya(){const t=[];return this.ga.inorderTraversal(((e,n)=>{t.push(n)})),t}}class Dn{constructor(t,e,n,s,i,a,u,l,d){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=l,this.hasCachedResults=d}static fromInitialDocuments(t,e,n,s,i){const a=[];return e.forEach((u=>{a.push({type:0,doc:u})})),new Dn(t,e,_n.emptySet(e),a,n,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&ni(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let s=0;s<e.length;s++)if(e[s].type!==n[s].type||!e[s].doc.isEqual(n[s].doc))return!1;return!0}}class k_{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some((t=>t.Da()))}}class M_{constructor(){this.queries=Fc(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(e,n){const s=j(e),i=s.queries;s.queries=Fc(),i.forEach(((a,u)=>{for(const l of u.ba)l.onError(n)}))})(this,new x(P.ABORTED,"Firestore shutting down"))}}function Fc(){return new Zt((r=>rh(r)),ni)}async function O_(r,t){const e=j(r);let n=3;const s=t.query;let i=e.queries.get(s);i?!i.Sa()&&t.Da()&&(n=2):(i=new k_,n=t.Da()?0:1);try{switch(n){case 0:i.wa=await e.onListen(s,!0);break;case 1:i.wa=await e.onListen(s,!1);break;case 2:await e.onFirstRemoteStoreListen(s)}}catch(a){const u=ia(a,`Initialization of query '${hn(t.query)}' failed`);return void t.onError(u)}e.queries.set(s,i),i.ba.push(t),t.va(e.onlineState),i.wa&&t.Fa(i.wa)&&oa(e)}async function F_(r,t){const e=j(r),n=t.query;let s=3;const i=e.queries.get(n);if(i){const a=i.ba.indexOf(t);a>=0&&(i.ba.splice(a,1),i.ba.length===0?s=t.Da()?0:1:!i.Sa()&&t.Da()&&(s=2))}switch(s){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}}function L_(r,t){const e=j(r);let n=!1;for(const s of t){const i=s.query,a=e.queries.get(i);if(a){for(const u of a.ba)u.Fa(s)&&(n=!0);a.wa=s}}n&&oa(e)}function B_(r,t,e){const n=j(r),s=n.queries.get(t);if(s)for(const i of s.ba)i.onError(e);n.queries.delete(t)}function oa(r){r.Ca.forEach((t=>{t.next()}))}var Ao,Lc;(Lc=Ao||(Ao={})).Ma="default",Lc.Cache="cache";class U_{constructor(t,e,n){this.query=t,this.xa=e,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(t){if(!this.options.includeMetadataChanges){const n=[];for(const s of t.docChanges)s.type!==3&&n.push(s);t=new Dn(t.query,t.docs,t.oldDocs,n,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Oa?this.Ba(t)&&(this.xa.next(t),e=!0):this.La(t,this.onlineState)&&(this.ka(t),e=!0),this.Na=t,e}onError(t){this.xa.error(t)}va(t){this.onlineState=t;let e=!1;return this.Na&&!this.Oa&&this.La(this.Na,t)&&(this.ka(this.Na),e=!0),e}La(t,e){if(!t.fromCache||!this.Da())return!0;const n=e!=="Offline";return(!this.options.Ka||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}Ba(t){if(t.docChanges.length>0)return!0;const e=this.Na&&this.Na.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}ka(t){t=Dn.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Oa=!0,this.xa.next(t)}Da(){return this.options.source!==Ao.Cache}}class sd{constructor(t){this.key=t}}class id{constructor(t){this.key=t}}class q_{constructor(t,e){this.query=t,this.Za=e,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=$(),this.mutatedKeys=$(),this.eu=sh(t),this.tu=new _n(this.eu)}get nu(){return this.Za}ru(t,e){const n=e?e.iu:new Oc,s=e?e.tu:this.tu;let i=e?e.mutatedKeys:this.mutatedKeys,a=s,u=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal(((m,p)=>{const I=s.get(m),S=Br(this.query,p)?p:null,C=!!I&&this.mutatedKeys.has(I.key),k=!!S&&(S.hasLocalMutations||this.mutatedKeys.has(S.key)&&S.hasCommittedMutations);let M=!1;I&&S?I.data.isEqual(S.data)?C!==k&&(n.track({type:3,doc:S}),M=!0):this.su(I,S)||(n.track({type:2,doc:S}),M=!0,(l&&this.eu(S,l)>0||d&&this.eu(S,d)<0)&&(u=!0)):!I&&S?(n.track({type:0,doc:S}),M=!0):I&&!S&&(n.track({type:1,doc:I}),M=!0,(l||d)&&(u=!0)),M&&(S?(a=a.add(S),i=k?i.add(m):i.delete(m)):(a=a.delete(m),i=i.delete(m)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const m=this.query.limitType==="F"?a.last():a.first();a=a.delete(m.key),i=i.delete(m.key),n.track({type:1,doc:m})}return{tu:a,iu:n,Ss:u,mutatedKeys:i}}su(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,s){const i=this.tu;this.tu=t.tu,this.mutatedKeys=t.mutatedKeys;const a=t.iu.ya();a.sort(((m,p)=>(function(S,C){const k=M=>{switch(M){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return O(20277,{Vt:M})}};return k(S)-k(C)})(m.type,p.type)||this.eu(m.doc,p.doc))),this.ou(n),s=s??!1;const u=e&&!s?this._u():[],l=this.Ya.size===0&&this.current&&!s?1:0,d=l!==this.Xa;return this.Xa=l,a.length!==0||d?{snapshot:new Dn(this.query,t.tu,i,a,t.mutatedKeys,l===0,d,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Oc,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(t){return!this.Za.has(t)&&!!this.tu.has(t)&&!this.tu.get(t).hasLocalMutations}ou(t){t&&(t.addedDocuments.forEach((e=>this.Za=this.Za.add(e))),t.modifiedDocuments.forEach((e=>{})),t.removedDocuments.forEach((e=>this.Za=this.Za.delete(e))),this.current=t.current)}_u(){if(!this.current)return[];const t=this.Ya;this.Ya=$(),this.tu.forEach((n=>{this.uu(n.key)&&(this.Ya=this.Ya.add(n.key))}));const e=[];return t.forEach((n=>{this.Ya.has(n)||e.push(new id(n))})),this.Ya.forEach((n=>{t.has(n)||e.push(new sd(n))})),e}cu(t){this.Za=t.ks,this.Ya=$();const e=this.ru(t.documents);return this.applyChanges(e,!0)}lu(){return Dn.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Xa===0,this.hasCachedResults)}}const aa="SyncEngine";class j_{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class z_{constructor(t){this.key=t,this.hu=!1}}class $_{constructor(t,e,n,s,i,a){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new Zt((u=>rh(u)),ni),this.Iu=new Map,this.Eu=new Set,this.Ru=new it(N.comparator),this.Au=new Map,this.Vu=new Qo,this.du={},this.mu=new Map,this.fu=Qe.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function G_(r,t,e=!0){const n=hd(r);let s;const i=n.Tu.get(t);return i?(n.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await od(n,t,e,!0),s}async function K_(r,t){const e=hd(r);await od(e,t,!0,!1)}async function od(r,t,e,n){const s=await u_(r.localStore,Ft(t)),i=s.targetId,a=r.sharedClientState.addLocalQueryTarget(i,e);let u;return n&&(u=await H_(r,t,i,a==="current",s.resumeToken)),r.isPrimaryClient&&e&&Xh(r.remoteStore,s),u}async function H_(r,t,e,n,s){r.pu=(p,I,S)=>(async function(k,M,G,U){let B=M.view.ru(G);B.Ss&&(B=await Cc(k.localStore,M.query,!1).then((({documents:E})=>M.view.ru(E,B))));const J=U&&U.targetChanges.get(M.targetId),et=U&&U.targetMismatches.get(M.targetId)!=null,Q=M.view.applyChanges(B,k.isPrimaryClient,J,et);return Uc(k,M.targetId,Q.au),Q.snapshot})(r,p,I,S);const i=await Cc(r.localStore,t,!0),a=new q_(t,i.ks),u=a.ru(i.documents),l=Ur.createSynthesizedTargetChangeForCurrentChange(e,n&&r.onlineState!=="Offline",s),d=a.applyChanges(u,r.isPrimaryClient,l);Uc(r,e,d.au);const m=new j_(t,e,a);return r.Tu.set(t,m),r.Iu.has(e)?r.Iu.get(e).push(t):r.Iu.set(e,[t]),d.snapshot}async function W_(r,t,e){const n=j(r),s=n.Tu.get(t),i=n.Iu.get(s.targetId);if(i.length>1)return n.Iu.set(s.targetId,i.filter((a=>!ni(a,t)))),void n.Tu.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||await wo(n.localStore,s.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(s.targetId),e&&ta(n.remoteStore,s.targetId),bo(n,s.targetId)})).catch(Xe)):(bo(n,s.targetId),await wo(n.localStore,s.targetId,!0))}async function Q_(r,t){const e=j(r),n=e.Tu.get(t),s=e.Iu.get(n.targetId);e.isPrimaryClient&&s.length===1&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),ta(e.remoteStore,n.targetId))}async function Y_(r,t,e){const n=dd(r);try{const s=await(function(a,u){const l=j(a),d=X.now(),m=u.reduce(((S,C)=>S.add(C.key)),$());let p,I;return l.persistence.runTransaction("Locally write mutations","readwrite",(S=>{let C=Nt(),k=$();return l.xs.getEntries(S,m).next((M=>{C=M,C.forEach(((G,U)=>{U.isValidDocument()||(k=k.add(G))}))})).next((()=>l.localDocuments.getOverlayedDocuments(S,C))).next((M=>{p=M;const G=[];for(const U of u){const B=ag(U,p.get(U.key).overlayedDocument);B!=null&&G.push(new te(U.key,B,Wl(B.value.mapValue),St.exists(!0)))}return l.mutationQueue.addMutationBatch(S,d,G,u)})).next((M=>{I=M;const G=M.applyToLocalDocumentSet(p,k);return l.documentOverlayCache.saveOverlays(S,M.batchId,G)}))})).then((()=>({batchId:I.batchId,changes:oh(p)})))})(n.localStore,t);n.sharedClientState.addPendingMutation(s.batchId),(function(a,u,l){let d=a.du[a.currentUser.toKey()];d||(d=new it(q)),d=d.insert(u,l),a.du[a.currentUser.toKey()]=d})(n,s.batchId,e),await zr(n,s.changes),await jr(n.remoteStore)}catch(s){const i=ia(s,"Failed to persist write");e.reject(i)}}async function ad(r,t){const e=j(r);try{const n=await i_(e.localStore,t);t.targetChanges.forEach(((s,i)=>{const a=e.Au.get(i);a&&(F(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?F(a.hu,14607):s.removedDocuments.size>0&&(F(a.hu,42227),a.hu=!1))})),await zr(e,n,t)}catch(n){await Xe(n)}}function Bc(r,t,e){const n=j(r);if(n.isPrimaryClient&&e===0||!n.isPrimaryClient&&e===1){const s=[];n.Tu.forEach(((i,a)=>{const u=a.view.va(t);u.snapshot&&s.push(u.snapshot)})),(function(a,u){const l=j(a);l.onlineState=u;let d=!1;l.queries.forEach(((m,p)=>{for(const I of p.ba)I.va(u)&&(d=!0)})),d&&oa(l)})(n.eventManager,t),s.length&&n.Pu.J_(s),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}async function J_(r,t,e){const n=j(r);n.sharedClientState.updateQueryState(t,"rejected",e);const s=n.Au.get(t),i=s&&s.key;if(i){let a=new it(N.comparator);a=a.insert(i,ut.newNoDocument(i,L.min()));const u=$().add(i),l=new oi(L.min(),new Map,new it(q),a,u);await ad(n,l),n.Ru=n.Ru.remove(i),n.Au.delete(t),ua(n)}else await wo(n.localStore,t,!1).then((()=>bo(n,t,e))).catch(Xe)}async function X_(r,t){const e=j(r),n=t.batch.batchId;try{const s=await s_(e.localStore,t);cd(e,n,null),ud(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),await zr(e,s)}catch(s){await Xe(s)}}async function Z_(r,t,e){const n=j(r);try{const s=await(function(a,u){const l=j(a);return l.persistence.runTransaction("Reject batch","readwrite-primary",(d=>{let m;return l.mutationQueue.lookupMutationBatch(d,u).next((p=>(F(p!==null,37113),m=p.keys(),l.mutationQueue.removeMutationBatch(d,p)))).next((()=>l.mutationQueue.performConsistencyCheck(d))).next((()=>l.documentOverlayCache.removeOverlaysForBatchId(d,m,u))).next((()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,m))).next((()=>l.localDocuments.getDocuments(d,m)))}))})(n.localStore,t);cd(n,t,e),ud(n,t),n.sharedClientState.updateMutationState(t,"rejected",e),await zr(n,s)}catch(s){await Xe(s)}}function ud(r,t){(r.mu.get(t)||[]).forEach((e=>{e.resolve()})),r.mu.delete(t)}function cd(r,t,e){const n=j(r);let s=n.du[n.currentUser.toKey()];if(s){const i=s.get(t);i&&(e?i.reject(e):i.resolve(),s=s.remove(t)),n.du[n.currentUser.toKey()]=s}}function bo(r,t,e=null){r.sharedClientState.removeLocalQueryTarget(t);for(const n of r.Iu.get(t))r.Tu.delete(n),e&&r.Pu.yu(n,e);r.Iu.delete(t),r.isPrimaryClient&&r.Vu.Gr(t).forEach((n=>{r.Vu.containsKey(n)||ld(r,n)}))}function ld(r,t){r.Eu.delete(t.path.canonicalString());const e=r.Ru.get(t);e!==null&&(ta(r.remoteStore,e),r.Ru=r.Ru.remove(t),r.Au.delete(e),ua(r))}function Uc(r,t,e){for(const n of e)n instanceof sd?(r.Vu.addReference(n.key,t),ty(r,n)):n instanceof id?(V(aa,"Document no longer in limbo: "+n.key),r.Vu.removeReference(n.key,t),r.Vu.containsKey(n.key)||ld(r,n.key)):O(19791,{wu:n})}function ty(r,t){const e=t.key,n=e.path.canonicalString();r.Ru.get(e)||r.Eu.has(n)||(V(aa,"New document in limbo: "+e),r.Eu.add(n),ua(r))}function ua(r){for(;r.Eu.size>0&&r.Ru.size<r.maxConcurrentLimboResolutions;){const t=r.Eu.values().next().value;r.Eu.delete(t);const e=new N(Y.fromString(t)),n=r.fu.next();r.Au.set(n,new z_(e)),r.Ru=r.Ru.insert(e,n),Xh(r.remoteStore,new Wt(Ft(ei(e.path)),n,"TargetPurposeLimboResolution",Ot.ce))}}async function zr(r,t,e){const n=j(r),s=[],i=[],a=[];n.Tu.isEmpty()||(n.Tu.forEach(((u,l)=>{a.push(n.pu(l,t,e).then((d=>{if((d||e)&&n.isPrimaryClient){const m=d?!d.fromCache:e?.targetChanges.get(l.targetId)?.current;n.sharedClientState.updateQueryState(l.targetId,m?"current":"not-current")}if(d){s.push(d);const m=Xo.Es(l.targetId,d);i.push(m)}})))})),await Promise.all(a),n.Pu.J_(s),await(async function(l,d){const m=j(l);try{await m.persistence.runTransaction("notifyLocalViewChanges","readwrite",(p=>v.forEach(d,(I=>v.forEach(I.Ts,(S=>m.persistence.referenceDelegate.addReference(p,I.targetId,S))).next((()=>v.forEach(I.Is,(S=>m.persistence.referenceDelegate.removeReference(p,I.targetId,S)))))))))}catch(p){if(!ve(p))throw p;V(Zo,"Failed to update sequence numbers: "+p)}for(const p of d){const I=p.targetId;if(!p.fromCache){const S=m.vs.get(I),C=S.snapshotVersion,k=S.withLastLimboFreeSnapshotVersion(C);m.vs=m.vs.insert(I,k)}}})(n.localStore,i))}async function ey(r,t){const e=j(r);if(!e.currentUser.isEqual(t)){V(aa,"User change. New user:",t.toKey());const n=await Hh(e.localStore,t);e.currentUser=t,(function(i,a){i.mu.forEach((u=>{u.forEach((l=>{l.reject(new x(P.CANCELLED,a))}))})),i.mu.clear()})(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),await zr(e,n.Ns)}}function ny(r,t){const e=j(r),n=e.Au.get(t);if(n&&n.hu)return $().add(n.key);{let s=$();const i=e.Iu.get(t);if(!i)return s;for(const a of i){const u=e.Tu.get(a);s=s.unionWith(u.view.nu)}return s}}function hd(r){const t=j(r);return t.remoteStore.remoteSyncer.applyRemoteEvent=ad.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=ny.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=J_.bind(null,t),t.Pu.J_=L_.bind(null,t.eventManager),t.Pu.yu=B_.bind(null,t.eventManager),t}function dd(r){const t=j(r);return t.remoteStore.remoteSyncer.applySuccessfulWrite=X_.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Z_.bind(null,t),t}class Nr{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=li(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),await this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)}Fu(t,e){return null}Mu(t,e){return null}vu(t){return Kh(this.persistence,new Gh,t.initialUser,this.serializer)}Cu(t){return new Yo(ci.Vi,this.serializer)}Du(t){return new Qh}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Nr.provider={build:()=>new Nr};class ry extends Nr{constructor(t){super(),this.cacheSizeBytes=t}Fu(t,e){F(this.persistence.referenceDelegate instanceof zs,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new Uh(n,t.asyncQueue,e)}Cu(t){const e=this.cacheSizeBytes!==void 0?Tt.withCacheSize(this.cacheSizeBytes):Tt.DEFAULT;return new Yo((n=>zs.Vi(n,e)),this.serializer)}}class sy extends Nr{constructor(t,e,n){super(),this.xu=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}async initialize(t){await super.initialize(t),await this.xu.initialize(this,t),await dd(this.xu.syncEngine),await jr(this.xu.remoteStore),await this.persistence.zi((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}vu(t){return Kh(this.persistence,new Gh,t.initialUser,this.serializer)}Fu(t,e){const n=this.persistence.referenceDelegate.garbageCollector;return new Uh(n,t.asyncQueue,e)}Mu(t,e){const n=new rp(e,this.persistence);return new np(t.asyncQueue,n)}Cu(t){const e=t_(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?Tt.withCacheSize(this.cacheSizeBytes):Tt.DEFAULT;return new Jo(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,p_(),vs(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(t){return new Qh}}class Gs{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>Bc(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=ey.bind(null,this.syncEngine),await N_(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return(function(){return new M_})()}createDatastore(t){const e=li(t.databaseInfo.databaseId),n=m_(t.databaseInfo);return E_(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return(function(n,s,i,a,u){return new w_(n,s,i,a,u)})(this.localStore,this.datastore,t.asyncQueue,(e=>Bc(this.syncEngine,e,0)),(function(){return Nc.v()?new Nc:new l_})())}createSyncEngine(t,e){return(function(s,i,a,u,l,d,m){const p=new $_(s,i,a,u,l,d);return m&&(p.gu=!0),p})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){await(async function(e){const n=j(e);V(Ye,"RemoteStore shutting down."),n.Ea.add(5),await qr(n),n.Aa.shutdown(),n.Va.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Gs.provider={build:()=>new Gs};class iy{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ou(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ou(this.observer.error,t):Rt("Uncaught Error in snapshot listener:",t.toString()))}Nu(){this.muted=!0}Ou(t,e){setTimeout((()=>{this.muted||t(e)}),0)}}const we="FirestoreClient";class oy{constructor(t,e,n,s,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this._databaseInfo=s,this.user=_t.UNAUTHENTICATED,this.clientId=Co.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,(async a=>{V(we,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(n,(a=>(V(we,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new pe;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=ia(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function Wi(r,t){r.asyncQueue.verifyOperationInProgress(),V(we,"Initializing OfflineComponentProvider");const e=r.configuration;await t.initialize(e);let n=e.initialUser;r.setCredentialChangeListener((async s=>{n.isEqual(s)||(await Hh(t.localStore,s),n=s)})),t.persistence.setDatabaseDeletedListener((()=>r.terminate())),r._offlineComponents=t}async function qc(r,t){r.asyncQueue.verifyOperationInProgress();const e=await ay(r);V(we,"Initializing OnlineComponentProvider"),await t.initialize(e,r.configuration),r.setCredentialChangeListener((n=>Mc(t.remoteStore,n))),r.setAppCheckTokenChangeListener(((n,s)=>Mc(t.remoteStore,s))),r._onlineComponents=t}async function ay(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){V(we,"Using user provided OfflineComponentProvider");try{await Wi(r,r._uninitializedComponentsProvider._offline)}catch(t){const e=t;if(!(function(s){return s.name==="FirebaseError"?s.code===P.FAILED_PRECONDITION||s.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(e))throw e;ye("Error using user provided cache. Falling back to memory cache: "+e),await Wi(r,new Nr)}}else V(we,"Using default OfflineComponentProvider"),await Wi(r,new ry(void 0));return r._offlineComponents}async function fd(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(V(we,"Using user provided OnlineComponentProvider"),await qc(r,r._uninitializedComponentsProvider._online)):(V(we,"Using default OnlineComponentProvider"),await qc(r,new Gs))),r._onlineComponents}function uy(r){return fd(r).then((t=>t.syncEngine))}async function jc(r){const t=await fd(r),e=t.eventManager;return e.onListen=G_.bind(null,t.syncEngine),e.onUnlisten=W_.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=K_.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=Q_.bind(null,t.syncEngine),e}function cy(r,t,e,n){const s=new iy(n),i=new U_(t,s,e);return r.asyncQueue.enqueueAndForget((async()=>O_(await jc(r),i))),()=>{s.Nu(),r.asyncQueue.enqueueAndForget((async()=>F_(await jc(r),i)))}}function ly(r,t){const e=new pe;return r.asyncQueue.enqueueAndForget((async()=>Y_(await uy(r),t,e))),e.promise}function md(r){const t={};return r.timeoutSeconds!==void 0&&(t.timeoutSeconds=r.timeoutSeconds),t}const hy="ComponentProvider",zc=new Map;function dy(r,t,e,n,s){return new xp(r,t,e,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,md(s.experimentalLongPollingOptions),s.useFetchStreams,s.isUsingEmulator,n)}const pd="firestore.googleapis.com",$c=!0;class Gc{constructor(t){if(t.host===void 0){if(t.ssl!==void 0)throw new x(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=pd,this.ssl=$c}else this.host=t.host,this.ssl=t.ssl??$c;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=Oh;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<Fg)throw new x(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}Xm("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=md(t.experimentalLongPollingOptions??{}),(function(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new x(P.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<5)throw new x(P.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is 5)`);if(n.timeoutSeconds>30)throw new x(P.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&(function(n,s){return n.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class di{constructor(t,e,n,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Gc({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new x(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new x(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Gc(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=(function(n){if(!n)return new jm;switch(n.type){case"firstParty":return new Km(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new x(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(e){const n=zc.get(e);n&&(V(hy,"Removing Datastore"),zc.delete(e),n.terminate())})(this),Promise.resolve()}}function fy(r,t,e,n={}){r=Qt(r,di);const s=So(t),i=r._getSettings(),a={...i,emulatorOptions:r._getEmulatorOptions()},u=`${t}:${e}`;s&&(_f(`https://${u}`),Tf("Firestore",!0)),i.host!==pd&&i.host!==u&&ye("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...i,host:u,ssl:s,emulatorOptions:n};if(!Ss(l,a)&&(r._setSettings(l),n.mockUserToken)){let d,m;if(typeof n.mockUserToken=="string")d=n.mockUserToken,m=_t.MOCK_USER;else{d=yf(n.mockUserToken,r._app?.options.projectId);const p=n.mockUserToken.sub||n.mockUserToken.user_id;if(!p)throw new x(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");m=new _t(p)}r._authCredentials=new zm(new Tl(d,m))}}class On{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new On(this.firestore,t,this._query)}}class ht{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new _e(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new ht(this.firestore,t,this._key)}toJSON(){return{type:ht._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,n){if(Mr(e,ht._jsonSchema))return new ht(t,n||null,new N(Y.fromString(e.referencePath)))}}ht._jsonSchemaVersion="firestore/documentReference/1.0",ht._jsonSchema={type:lt("string",ht._jsonSchemaVersion),referencePath:lt("string")};class _e extends On{constructor(t,e,n){super(t,e,ei(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new ht(this.firestore,null,new N(t))}withConverter(t){return new _e(this.firestore,t,this._path)}}function xy(r,t,...e){if(r=Kt(r),vl("collection","path",t),r instanceof di){const n=Y.fromString(t,...e);return ku(n),new _e(r,null,n)}{if(!(r instanceof ht||r instanceof _e))throw new x(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(Y.fromString(t,...e));return ku(n),new _e(r.firestore,null,n)}}function my(r,t,...e){if(r=Kt(r),arguments.length===1&&(t=Co.newId()),vl("doc","path",t),r instanceof di){const n=Y.fromString(t,...e);return Nu(n),new ht(r,null,new N(n))}{if(!(r instanceof ht||r instanceof _e))throw new x(P.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(Y.fromString(t,...e));return Nu(n),new ht(r.firestore,r instanceof _e?r.converter:null,new N(n))}}const Kc="AsyncQueue";class Hc{constructor(t=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Yh(this,"async_queue_retry"),this._c=()=>{const n=vs();n&&V(Kc,"Visibility state changed to "+n.visibilityState),this.M_.w_()},this.ac=t;const e=vs();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.uc(),this.cc(t)}enterRestrictedMode(t){if(!this.ec){this.ec=!0,this.sc=t||!1;const e=vs();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this._c)}}enqueue(t){if(this.uc(),this.ec)return new Promise((()=>{}));const e=new pe;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Yu.push(t),this.lc())))}async lc(){if(this.Yu.length!==0){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(t){if(!ve(t))throw t;V(Kc,"Operation failed with retryable error: "+t)}this.Yu.length>0&&this.M_.p_((()=>this.lc()))}}cc(t){const e=this.ac.then((()=>(this.rc=!0,t().catch((n=>{throw this.nc=n,this.rc=!1,Rt("INTERNAL UNHANDLED ERROR: ",Wc(n)),n})).then((n=>(this.rc=!1,n))))));return this.ac=e,e}enqueueAfterDelay(t,e,n){this.uc(),this.oc.indexOf(t)>-1&&(e=0);const s=sa.createAndSchedule(this,t,e,n,(i=>this.hc(i)));return this.tc.push(s),s}uc(){this.nc&&O(47125,{Pc:Wc(this.nc)})}verifyOperationInProgress(){}async Tc(){let t;do t=this.ac,await t;while(t!==this.ac)}Ic(t){for(const e of this.tc)if(e.timerId===t)return!0;return!1}Ec(t){return this.Tc().then((()=>{this.tc.sort(((e,n)=>e.targetTimeMs-n.targetTimeMs));for(const e of this.tc)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.Tc()}))}Rc(t){this.oc.push(t)}hc(t){const e=this.tc.indexOf(t);this.tc.splice(e,1)}}function Wc(r){let t=r.message||"";return r.stack&&(t=r.stack.includes(r.message)?r.stack:r.message+`
`+r.stack),t}class Je extends di{constructor(t,e,n,s){super(t,e,n,s),this.type="firestore",this._queue=new Hc,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new Hc(t),this._firestoreClient=void 0,await t}}}function Ny(r,t){const e=typeof r=="object"?r:Pm(),n=typeof r=="string"?r:ks,s=wm(e,"firestore").getImmediate({identifier:n});if(!s._initialized){const i=pf("firestore");i&&fy(s,...i)}return s}function gd(r){if(r._terminated)throw new x(P.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||_d(r),r._firestoreClient}function _d(r){const t=r._freezeSettings(),e=dy(r._databaseId,r._app?.options.appId||"",r._persistenceKey,r._app?.options.apiKey,t);r._componentsProvider||t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(r._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),r._firestoreClient=new oy(r._authCredentials,r._appCheckCredentials,r._queue,e,r._componentsProvider&&(function(s){const i=s?._online.build();return{_offline:s?._offline.build(i),_online:i}})(r._componentsProvider))}function ky(r,t){ye("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=r._freezeSettings();return py(r,Gs.provider,{build:n=>new sy(n,e.cacheSizeBytes,t?.forceOwnership)}),Promise.resolve()}function py(r,t,e){if((r=Qt(r,Je))._firestoreClient||r._terminated)throw new x(P.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(r._componentsProvider||r._getSettings().localCache)throw new x(P.FAILED_PRECONDITION,"SDK cache is already specified.");r._componentsProvider={_online:t,_offline:e},_d(r)}class Mt{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Mt(dt.fromBase64String(t))}catch(e){throw new x(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new Mt(dt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:Mt._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(Mr(t,Mt._jsonSchema))return Mt.fromBase64String(t.bytes)}}Mt._jsonSchemaVersion="firestore/bytes/1.0",Mt._jsonSchema={type:lt("string",Mt._jsonSchemaVersion),bytes:lt("string")};class ca{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new x(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ot(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class la{constructor(t){this._methodName=t}}class Gt{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new x(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new x(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return q(this._lat,t._lat)||q(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Gt._jsonSchemaVersion}}static fromJSON(t){if(Mr(t,Gt._jsonSchema))return new Gt(t.latitude,t.longitude)}}Gt._jsonSchemaVersion="firestore/geoPoint/1.0",Gt._jsonSchema={type:lt("string",Gt._jsonSchemaVersion),latitude:lt("number"),longitude:lt("number")};class Bt{constructor(t){this._values=(t||[]).map((e=>e))}toArray(){return this._values.map((t=>t))}isEqual(t){return(function(n,s){if(n.length!==s.length)return!1;for(let i=0;i<n.length;++i)if(n[i]!==s[i])return!1;return!0})(this._values,t._values)}toJSON(){return{type:Bt._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(Mr(t,Bt._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every((e=>typeof e=="number")))return new Bt(t.vectorValues);throw new x(P.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Bt._jsonSchemaVersion="firestore/vectorValue/1.0",Bt._jsonSchema={type:lt("string",Bt._jsonSchemaVersion),vectorValues:lt("object")};const gy=/^__.*__$/;class _y{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return this.fieldMask!==null?new te(t,this.data,this.fieldMask,e,this.fieldTransforms):new kn(t,this.data,e,this.fieldTransforms)}}class yd{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new te(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function Id(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw O(40011,{dataSource:r})}}class ha{constructor(t,e,n,s,i,a){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=s,i===void 0&&this.validatePath(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(t){return new ha({...this.settings,...t},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(t){const e=this.path?.child(t),n=this.contextWith({path:e,arrayElement:!1});return n.validatePathSegment(t),n}childContextForFieldPath(t){const e=this.path?.child(t),n=this.contextWith({path:e,arrayElement:!1});return n.validatePath(),n}childContextForArray(t){return this.contextWith({path:void 0,arrayElement:!0})}createError(t){return Ks(t,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(t){return this.fieldMask.find((e=>t.isPrefixOf(e)))!==void 0||this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))!==void 0}validatePath(){if(this.path)for(let t=0;t<this.path.length;t++)this.validatePathSegment(this.path.get(t))}validatePathSegment(t){if(t.length===0)throw this.createError("Document fields must not be empty");if(Id(this.dataSource)&&gy.test(t))throw this.createError('Document fields cannot begin and end with "__"')}}class yy{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||li(t)}createContext(t,e,n,s=!1){return new ha({dataSource:t,methodName:e,targetDoc:n,path:ot.emptyPath(),arrayElement:!1,hasConverter:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function da(r){const t=r._freezeSettings(),e=li(r._databaseId);return new yy(r._databaseId,!!t.ignoreUndefinedProperties,e)}function Iy(r,t,e,n,s,i={}){const a=r.createContext(i.merge||i.mergeFields?2:0,t,e,s);fa("Data must be an object, but it was:",a,n);const u=Ed(n,a);let l,d;if(i.merge)l=new Ct(a.fieldMask),d=a.fieldTransforms;else if(i.mergeFields){const m=[];for(const p of i.mergeFields){const I=kr(t,p,e);if(!a.contains(I))throw new x(P.INVALID_ARGUMENT,`Field '${I}' is specified in your field mask but missing from your input data.`);vd(m,I)||m.push(I)}l=new Ct(m),d=a.fieldTransforms.filter((p=>l.covers(p.field)))}else l=null,d=a.fieldTransforms;return new _y(new wt(u),l,d)}class fi extends la{_toFieldTransform(t){if(t.dataSource!==2)throw t.dataSource===1?t.createError(`${this._methodName}() can only appear at the top level of your update data`):t.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof fi}}function Ey(r,t,e,n){const s=r.createContext(1,t,e);fa("Data must be an object, but it was:",s,n);const i=[],a=wt.empty();Ae(n,((l,d)=>{const m=wd(t,l,e);d=Kt(d);const p=s.childContextForFieldPath(m);if(d instanceof fi)i.push(m);else{const I=$r(d,p);I!=null&&(i.push(m),a.set(m,I))}}));const u=new Ct(i);return new yd(a,u,s.fieldTransforms)}function Ty(r,t,e,n,s,i){const a=r.createContext(1,t,e),u=[kr(t,n,e)],l=[s];if(i.length%2!=0)throw new x(P.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let I=0;I<i.length;I+=2)u.push(kr(t,i[I])),l.push(i[I+1]);const d=[],m=wt.empty();for(let I=u.length-1;I>=0;--I)if(!vd(d,u[I])){const S=u[I];let C=l[I];C=Kt(C);const k=a.childContextForFieldPath(S);if(C instanceof fi)d.push(S);else{const M=$r(C,k);M!=null&&(d.push(S),m.set(S,M))}}const p=new Ct(d);return new yd(m,p,a.fieldTransforms)}function wy(r,t,e,n=!1){return $r(e,r.createContext(n?4:3,t))}function $r(r,t){if(Td(r=Kt(r)))return fa("Unsupported field value:",t,r),Ed(r,t);if(r instanceof la)return(function(n,s){if(!Id(s.dataSource))throw s.createError(`${n._methodName}() can only be used with update() and set()`);if(!s.path)throw s.createError(`${n._methodName}() is not currently supported inside arrays`);const i=n._toFieldTransform(s);i&&s.fieldTransforms.push(i)})(r,t),null;if(r===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),r instanceof Array){if(t.settings.arrayElement&&t.dataSource!==4)throw t.createError("Nested arrays are not supported");return(function(n,s){const i=[];let a=0;for(const u of n){let l=$r(u,s.childContextForArray(a));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),a++}return{arrayValue:{values:i}}})(r,t)}return(function(n,s){if((n=Kt(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return tg(s.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const i=X.fromDate(n);return{timestampValue:Cn(s.serializer,i)}}if(n instanceof X){const i=new X(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Cn(s.serializer,i)}}if(n instanceof Gt)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Mt)return{bytesValue:Ih(s.serializer,n._byteString)};if(n instanceof ht){const i=s.databaseId,a=n.firestore._databaseId;if(!a.isEqual(i))throw s.createError(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Ko(n.firestore._databaseId||s.databaseId,n._key.path)}}if(n instanceof Bt)return(function(a,u){const l=a instanceof Bt?a.toArray():a;return{mapValue:{fields:{[Lo]:{stringValue:Bo},[An]:{arrayValue:{values:l.map((m=>{if(typeof m!="number")throw u.createError("VectorValues must only contain numeric values.");return qo(u.serializer,m)}))}}}}}})(n,s);if(Ch(n))return n._toProto(s.serializer);throw s.createError(`Unsupported field value: ${Hs(n)}`)})(r,t)}function Ed(r,t){const e={};return Bl(r)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Ae(r,((n,s)=>{const i=$r(s,t.childContextForField(n));i!=null&&(e[n]=i)})),{mapValue:{fields:e}}}function Td(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof X||r instanceof Gt||r instanceof Mt||r instanceof ht||r instanceof la||r instanceof Bt||Ch(r))}function fa(r,t,e){if(!Td(e)||!Al(e)){const n=Hs(e);throw n==="an object"?t.createError(r+" a custom object"):t.createError(r+" "+n)}}function kr(r,t,e){if((t=Kt(t))instanceof ca)return t._internalPath;if(typeof t=="string")return wd(r,t);throw Ks("Field path arguments must be of type string or ",r,!1,void 0,e)}const vy=new RegExp("[~\\*/\\[\\]]");function wd(r,t,e){if(t.search(vy)>=0)throw Ks(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,e);try{return new ca(...t.split("."))._internalPath}catch{throw Ks(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,e)}}function Ks(r,t,e,n,s){const i=n&&!n.isEmpty(),a=s!==void 0;let u=`Function ${t}() called with invalid data`;e&&(u+=" (via `toFirestore()`)"),u+=". ";let l="";return(i||a)&&(l+=" (found",i&&(l+=` in field ${n}`),a&&(l+=` in document ${s}`),l+=")"),new x(P.INVALID_ARGUMENT,u+r+l)}function vd(r,t){return r.some((e=>e.isEqual(t)))}class Ay{convertValue(t,e="none"){switch(Ie(t)){case 0:return null;case 1:return t.booleanValue;case 2:return st(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Xt(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw O(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return Ae(t,((s,i)=>{n[s]=this.convertValue(i,e)})),n}convertVectorValue(t){const e=t.fields?.[An].arrayValue?.values?.map((n=>st(n.doubleValue)));return new Bt(e)}convertGeoPoint(t){return new Gt(st(t.latitude),st(t.longitude))}convertArray(t,e){return(t.values||[]).map((n=>this.convertValue(n,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=Zs(t);return n==null?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Sr(t));default:return null}}convertTimestamp(t){const e=Jt(t);return new X(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=Y.fromString(t);F(Vh(n),9688,{name:t});const s=new Ge(n.get(1),n.get(3)),i=new N(n.popFirst(5));return s.isEqual(e)||Rt(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}}class Ad extends Ay{constructor(t){super(),this.firestore=t}convertBytes(t){return new Mt(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new ht(this.firestore,null,e)}}const Qc="@firebase/firestore",Yc="4.11.0";function Jc(r){return(function(e,n){if(typeof e!="object"||e===null)return!1;const s=e;for(const i of n)if(i in s&&typeof s[i]=="function")return!0;return!1})(r,["next","error","complete"])}class bd{constructor(t,e,n,s,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new ht(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new by(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(t){if(this._document){const e=this._document.data.field(kr("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}}class by extends bd{data(){return super.data()}}function Ry(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new x(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class ma{}class Sy extends ma{}function My(r,t,...e){let n=[];t instanceof ma&&n.push(t),n=n.concat(e),(function(i){const a=i.filter((l=>l instanceof ga)).length,u=i.filter((l=>l instanceof pa)).length;if(a>1||a>0&&u>0)throw new x(P.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(n);for(const s of n)r=s._apply(r);return r}class pa extends Sy{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new pa(t,e,n)}_apply(t){const e=this._parse(t);return Rd(t._query,e),new On(t.firestore,t.converter,fo(t._query,e))}_parse(t){const e=da(t.firestore);return(function(i,a,u,l,d,m,p){let I;if(d.isKeyField()){if(m==="array-contains"||m==="array-contains-any")throw new x(P.INVALID_ARGUMENT,`Invalid Query. You can't perform '${m}' queries on documentId().`);if(m==="in"||m==="not-in"){Zc(p,m);const C=[];for(const k of p)C.push(Xc(l,i,k));I={arrayValue:{values:C}}}else I=Xc(l,i,p)}else m!=="in"&&m!=="not-in"&&m!=="array-contains-any"||Zc(p,m),I=wy(u,a,p,m==="in"||m==="not-in");return K.create(d,m,I)})(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}}class ga extends ma{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new ga(t,e)}_parse(t){const e=this._queryConstraints.map((n=>n._parse(t))).filter((n=>n.getFilters().length>0));return e.length===1?e[0]:Z.create(e,this._getOperator())}_apply(t){const e=this._parse(t);return e.getFilters().length===0?t:((function(s,i){let a=s;const u=i.getFlattenedFilters();for(const l of u)Rd(a,l),a=fo(a,l)})(t._query,e),new On(t.firestore,t.converter,fo(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function Xc(r,t,e){if(typeof(e=Kt(e))=="string"){if(e==="")throw new x(P.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!nh(t)&&e.indexOf("/")!==-1)throw new x(P.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);const n=t.path.child(Y.fromString(e));if(!N.isDocumentKey(n))throw new x(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return Vr(r,new N(n))}if(e instanceof ht)return Vr(r,e._key);throw new x(P.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Hs(e)}.`)}function Zc(r,t){if(!Array.isArray(r)||r.length===0)throw new x(P.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Rd(r,t){const e=(function(s,i){for(const a of s)for(const u of a.getFlattenedFilters())if(i.indexOf(u.op)>=0)return u.op;return null})(r.filters,(function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(t.op));if(e!==null)throw e===t.op?new x(P.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new x(P.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}function Py(r,t,e){let n;return n=r?r.toFirestore(t):t,n}class cr{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class ze extends bd{constructor(t,e,n,s,i,a){super(t,e,n,s,a),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new As(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(kr("DocumentSnapshot.get",t));if(n!==null)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new x(P.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t=this._document,e={};return e.type=ze._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?e:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e)}}ze._jsonSchemaVersion="firestore/documentSnapshot/1.0",ze._jsonSchema={type:lt("string",ze._jsonSchemaVersion),bundleSource:lt("string","DocumentSnapshot"),bundleName:lt("string"),bundle:lt("string")};class As extends ze{data(t={}){return super.data(t)}}class yn{constructor(t,e,n,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new cr(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new As(this._firestore,this._userDataWriter,n.key,n,new cr(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new x(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=(function(s,i){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map((u=>{const l=new As(s._firestore,s._userDataWriter,u.doc.key,u.doc,new cr(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);return u.doc,{type:"added",doc:l,oldIndex:-1,newIndex:a++}}))}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((u=>i||u.type!==3)).map((u=>{const l=new As(s._firestore,s._userDataWriter,u.doc.key,u.doc,new cr(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,m=-1;return u.type!==0&&(d=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),m=a.indexOf(u.doc.key)),{type:Vy(u.type),doc:l,oldIndex:d,newIndex:m}}))}})(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new x(P.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t={};t.type=yn._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=Co.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const e=[],n=[],s=[];return this.docs.forEach((i=>{i._document!==null&&(e.push(i._document),n.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))})),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}}function Vy(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return O(61501,{type:r})}}yn._jsonSchemaVersion="firestore/querySnapshot/1.0",yn._jsonSchema={type:lt("string",yn._jsonSchemaVersion),bundleSource:lt("string","QuerySnapshot"),bundleName:lt("string"),bundle:lt("string")};function Oy(r,t,e,...n){r=Qt(r,ht);const s=Qt(r.firestore,Je),i=da(s);let a;return a=typeof(t=Kt(t))=="string"||t instanceof ca?Ty(i,"updateDoc",r._key,t,e,n):Ey(i,"updateDoc",r._key,t),_a(s,[a.toMutation(r._key,St.exists(!0))])}function Fy(r){return _a(Qt(r.firestore,Je),[new ii(r._key,St.none())])}function Ly(r,t){const e=Qt(r.firestore,Je),n=my(r),s=Py(r.converter,t),i=da(r.firestore);return _a(e,[Iy(i,"addDoc",n._key,s,r.converter!==null,{}).toMutation(n._key,St.exists(!1))]).then((()=>n))}function By(r,...t){r=Kt(r);let e={includeMetadataChanges:!1,source:"default"},n=0;typeof t[n]!="object"||Jc(t[n])||(e=t[n++]);const s={includeMetadataChanges:e.includeMetadataChanges,source:e.source};if(Jc(t[n])){const d=t[n];t[n]=d.next?.bind(d),t[n+1]=d.error?.bind(d),t[n+2]=d.complete?.bind(d)}let i,a,u;if(r instanceof ht)a=Qt(r.firestore,Je),u=ei(r._key.path),i={next:d=>{t[n]&&t[n](Cy(a,r,d))},error:t[n+1],complete:t[n+2]};else{const d=Qt(r,On);a=Qt(d.firestore,Je),u=d._query;const m=new Ad(a);i={next:p=>{t[n]&&t[n](new yn(a,m,d,p))},error:t[n+1],complete:t[n+2]},Ry(r._query)}const l=gd(a);return cy(l,u,s,i)}function _a(r,t){const e=gd(r);return ly(e,t)}function Cy(r,t,e){const n=e.docs.get(t._key),s=new Ad(r);return new ze(r,s,t._key,n,new cr(e.hasPendingWrites,e.fromCache),t.converter)}(function(t,e=!0){qm(Rm),Vs(new Ir("firestore",((n,{instanceIdentifier:s,options:i})=>{const a=n.getProvider("app").getImmediate(),u=new Je(new $m(n.getProvider("auth-internal")),new Hm(a,n.getProvider("app-check-internal")),Np(a,s),a);return i={useFetchStreams:e,...i},u._setSettings(i),u}),"PUBLIC").setMultipleInstances(!0)),pn(Qc,Yc,t),pn(Qc,Yc,"esm2020")})();export{Fy as a,Ly as b,xy as c,my as d,ky as e,Ny as g,Sm as i,By as o,My as q,Oy as u};
