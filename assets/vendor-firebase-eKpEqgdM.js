const gf=()=>{};var wu={};const nl=function(r){const t=[];let e=0;for(let n=0;n<r.length;n++){let s=r.charCodeAt(n);s<128?t[e++]=s:s<2048?(t[e++]=s>>6|192,t[e++]=s&63|128):(s&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(s=65536+((s&1023)<<10)+(r.charCodeAt(++n)&1023),t[e++]=s>>18|240,t[e++]=s>>12&63|128,t[e++]=s>>6&63|128,t[e++]=s&63|128):(t[e++]=s>>12|224,t[e++]=s>>6&63|128,t[e++]=s&63|128)}return t},_f=function(r){const t=[];let e=0,n=0;for(;e<r.length;){const s=r[e++];if(s<128)t[n++]=String.fromCharCode(s);else if(s>191&&s<224){const i=r[e++];t[n++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=r[e++],a=r[e++],u=r[e++],l=((s&7)<<18|(i&63)<<12|(a&63)<<6|u&63)-65536;t[n++]=String.fromCharCode(55296+(l>>10)),t[n++]=String.fromCharCode(56320+(l&1023))}else{const i=r[e++],a=r[e++];t[n++]=String.fromCharCode((s&15)<<12|(i&63)<<6|a&63)}}return t.join("")},rl={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,t){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let s=0;s<r.length;s+=3){const i=r[s],a=s+1<r.length,u=a?r[s+1]:0,l=s+2<r.length,d=l?r[s+2]:0,f=i>>2,p=(i&3)<<4|u>>4;let I=(u&15)<<2|d>>6,S=d&63;l||(S=64,a||(I=64)),n.push(e[f],e[p],e[I],e[S])}return n.join("")},encodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(r):this.encodeByteArray(nl(r),t)},decodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(r):_f(this.decodeStringToByteArray(r,t))},decodeStringToByteArray(r,t){this.init_();const e=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let s=0;s<r.length;){const i=e[r.charAt(s++)],u=s<r.length?e[r.charAt(s)]:0;++s;const d=s<r.length?e[r.charAt(s)]:64;++s;const p=s<r.length?e[r.charAt(s)]:64;if(++s,i==null||u==null||d==null||p==null)throw new yf;const I=i<<2|u>>4;if(n.push(I),d!==64){const S=u<<4&240|d>>2;if(n.push(S),p!==64){const C=d<<6&192|p;n.push(C)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}};class yf extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const If=function(r){const t=nl(r);return rl.encodeByteArray(t,!0)},Rs=function(r){return If(r).replace(/\./g,"")},Ef=function(r){try{return rl.decodeString(r,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function sl(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const Tf=()=>sl().__FIREBASE_DEFAULTS__,wf=()=>{if(typeof process>"u"||typeof wu>"u")return;const r=wu.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},vf=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=r&&Ef(r[1]);return t&&JSON.parse(t)},Po=()=>{try{return gf()||Tf()||wf()||vf()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},Af=r=>Po()?.emulatorHosts?.[r],bf=r=>{const t=Af(r);if(!t)return;const e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const n=parseInt(t.substring(e+1),10);return t[0]==="["?[t.substring(1,e-1),n]:[t.substring(0,e),n]},il=()=>Po()?.config;class Rf{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,n))}}}function Vo(r){try{return(r.startsWith("http://")||r.startsWith("https://")?new URL(r).hostname:r).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Sf(r){return(await fetch(r,{credentials:"include"})).ok}function Pf(r,t){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const e={alg:"none",type:"JWT"},n=t||"demo-project",s=r.iat||0,i=r.sub||r.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${n}`,aud:n,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...r};return[Rs(JSON.stringify(e)),Rs(JSON.stringify(a)),""].join(".")}const hr={};function Vf(){const r={prod:[],emulator:[]};for(const t of Object.keys(hr))hr[t]?r.emulator.push(t):r.prod.push(t);return r}function Cf(r){let t=document.getElementById(r),e=!1;return t||(t=document.createElement("div"),t.setAttribute("id",r),e=!0),{created:e,element:t}}let vu=!1;function Df(r,t){if(typeof window>"u"||typeof document>"u"||!Vo(window.location.host)||hr[r]===t||hr[r]||vu)return;hr[r]=t;function e(I){return`__firebase__banner__${I}`}const n="__firebase__banner",i=Vf().prod.length>0;function a(){const I=document.getElementById(n);I&&I.remove()}function u(I){I.style.display="flex",I.style.background="#7faaf0",I.style.position="fixed",I.style.bottom="5px",I.style.left="5px",I.style.padding=".5em",I.style.borderRadius="5px",I.style.alignItems="center"}function l(I,S){I.setAttribute("width","24"),I.setAttribute("id",S),I.setAttribute("height","24"),I.setAttribute("viewBox","0 0 24 24"),I.setAttribute("fill","none"),I.style.marginLeft="-6px"}function d(){const I=document.createElement("span");return I.style.cursor="pointer",I.style.marginLeft="16px",I.style.fontSize="24px",I.innerHTML=" &times;",I.onclick=()=>{vu=!0,a()},I}function f(I,S){I.setAttribute("id",S),I.innerText="Learn more",I.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",I.setAttribute("target","__blank"),I.style.paddingLeft="5px",I.style.textDecoration="underline"}function p(){const I=Cf(n),S=e("text"),C=document.getElementById(S)||document.createElement("span"),k=e("learnmore"),M=document.getElementById(k)||document.createElement("a"),$=e("preprendIcon"),U=document.getElementById($)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(I.created){const B=I.element;u(B),f(M,k);const J=d();l(U,$),B.append(U,C,M,J),document.body.appendChild(B)}i?(C.innerText="Preview backend disconnected.",U.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(U.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,C.innerText="Preview backend running in this workspace."),C.setAttribute("id",S)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",p):p()}function Ss(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function ol(){const r=Po()?.forceEnvironment;if(r==="node")return!0;if(r==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function al(){return!ol()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function ul(){return!ol()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function cl(){try{return typeof indexedDB=="object"}catch{return!1}}function xf(){return new Promise((r,t)=>{try{let e=!0;const n="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(n);s.onsuccess=()=>{s.result.close(),e||self.indexedDB.deleteDatabase(n),r(!0)},s.onupgradeneeded=()=>{e=!1},s.onerror=()=>{t(s.error?.message||"")}}catch(e){t(e)}})}const Nf="FirebaseError";class Nn extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name=Nf,Object.setPrototypeOf(this,Nn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ll.prototype.create)}}class ll{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},s=`${this.service}/${t}`,i=this.errors[t],a=i?kf(i,n):"Error",u=`${this.serviceName}: ${a} (${s}).`;return new Nn(s,u,n)}}function kf(r,t){return r.replace(Mf,(e,n)=>{const s=t[n];return s!=null?String(s):`<${n}?>`})}const Mf=/\{\$([^}]+)}/g;function Ps(r,t){if(r===t)return!0;const e=Object.keys(r),n=Object.keys(t);for(const s of e){if(!n.includes(s))return!1;const i=r[s],a=t[s];if(Au(i)&&Au(a)){if(!Ps(i,a))return!1}else if(i!==a)return!1}for(const s of n)if(!e.includes(s))return!1;return!0}function Au(r){return r!==null&&typeof r=="object"}function Ht(r){return r&&r._delegate?r._delegate:r}class Er{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const Ne="[DEFAULT]";class Of{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const n=new Rf;if(this.instancesDeferred.set(e,n),this.isInitialized(e)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:e});s&&n.resolve(s)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){const e=this.normalizeInstanceIdentifier(t?.identifier),n=t?.optional??!1;if(this.isInitialized(e)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:e})}catch(s){if(n)return null;throw s}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(Lf(t))try{this.getOrInitializeService({instanceIdentifier:Ne})}catch{}for(const[e,n]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(e);try{const i=this.getOrInitializeService({instanceIdentifier:s});n.resolve(i)}catch{}}}}clearInstance(t=Ne){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=Ne){return this.instances.has(t)}getOptions(t=Ne){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[i,a]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(i);n===u&&a.resolve(s)}return s}onInit(t,e){const n=this.normalizeInstanceIdentifier(e),s=this.onInitCallbacks.get(n)??new Set;s.add(t),this.onInitCallbacks.set(n,s);const i=this.instances.get(n);return i&&t(i,n),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const s of n)try{s(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:Ff(t),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch{}return n||null}normalizeInstanceIdentifier(t=Ne){return this.component?this.component.multipleInstances?t:Ne:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Ff(r){return r===Ne?void 0:r}function Lf(r){return r.instantiationMode==="EAGER"}class Bf{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new Of(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}var W;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(W||(W={}));const Uf={debug:W.DEBUG,verbose:W.VERBOSE,info:W.INFO,warn:W.WARN,error:W.ERROR,silent:W.SILENT},qf=W.INFO,jf={[W.DEBUG]:"log",[W.VERBOSE]:"log",[W.INFO]:"info",[W.WARN]:"warn",[W.ERROR]:"error"},zf=(r,t,...e)=>{if(t<r.logLevel)return;const n=new Date().toISOString(),s=jf[t];if(s)console[s](`[${n}]  ${r.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class hl{constructor(t){this.name=t,this._logLevel=qf,this._logHandler=zf,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in W))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?Uf[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,W.DEBUG,...t),this._logHandler(this,W.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,W.VERBOSE,...t),this._logHandler(this,W.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,W.INFO,...t),this._logHandler(this,W.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,W.WARN,...t),this._logHandler(this,W.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,W.ERROR,...t),this._logHandler(this,W.ERROR,...t)}}const Gf=(r,t)=>t.some(e=>r instanceof e);let bu,Ru;function $f(){return bu||(bu=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Kf(){return Ru||(Ru=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const dl=new WeakMap,Yi=new WeakMap,fl=new WeakMap,Bi=new WeakMap,Co=new WeakMap;function Hf(r){const t=new Promise((e,n)=>{const s=()=>{r.removeEventListener("success",i),r.removeEventListener("error",a)},i=()=>{e(fe(r.result)),s()},a=()=>{n(r.error),s()};r.addEventListener("success",i),r.addEventListener("error",a)});return t.then(e=>{e instanceof IDBCursor&&dl.set(e,r)}).catch(()=>{}),Co.set(t,r),t}function Wf(r){if(Yi.has(r))return;const t=new Promise((e,n)=>{const s=()=>{r.removeEventListener("complete",i),r.removeEventListener("error",a),r.removeEventListener("abort",a)},i=()=>{e(),s()},a=()=>{n(r.error||new DOMException("AbortError","AbortError")),s()};r.addEventListener("complete",i),r.addEventListener("error",a),r.addEventListener("abort",a)});Yi.set(r,t)}let Ji={get(r,t,e){if(r instanceof IDBTransaction){if(t==="done")return Yi.get(r);if(t==="objectStoreNames")return r.objectStoreNames||fl.get(r);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return fe(r[t])},set(r,t,e){return r[t]=e,!0},has(r,t){return r instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in r}};function Qf(r){Ji=r(Ji)}function Yf(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){const n=r.call(Ui(this),t,...e);return fl.set(n,t.sort?t.sort():[t]),fe(n)}:Kf().includes(r)?function(...t){return r.apply(Ui(this),t),fe(dl.get(this))}:function(...t){return fe(r.apply(Ui(this),t))}}function Jf(r){return typeof r=="function"?Yf(r):(r instanceof IDBTransaction&&Wf(r),Gf(r,$f())?new Proxy(r,Ji):r)}function fe(r){if(r instanceof IDBRequest)return Hf(r);if(Bi.has(r))return Bi.get(r);const t=Jf(r);return t!==r&&(Bi.set(r,t),Co.set(t,r)),t}const Ui=r=>Co.get(r);function Xf(r,t,{blocked:e,upgrade:n,blocking:s,terminated:i}={}){const a=indexedDB.open(r,t),u=fe(a);return n&&a.addEventListener("upgradeneeded",l=>{n(fe(a.result),l.oldVersion,l.newVersion,fe(a.transaction),l)}),e&&a.addEventListener("blocked",l=>e(l.oldVersion,l.newVersion,l)),u.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),u}const Zf=["get","getKey","getAll","getAllKeys","count"],tm=["put","add","delete","clear"],qi=new Map;function Su(r,t){if(!(r instanceof IDBDatabase&&!(t in r)&&typeof t=="string"))return;if(qi.get(t))return qi.get(t);const e=t.replace(/FromIndex$/,""),n=t!==e,s=tm.includes(e);if(!(e in(n?IDBIndex:IDBObjectStore).prototype)||!(s||Zf.includes(e)))return;const i=async function(a,...u){const l=this.transaction(a,s?"readwrite":"readonly");let d=l.store;return n&&(d=d.index(u.shift())),(await Promise.all([d[e](...u),s&&l.done]))[0]};return qi.set(t,i),i}Qf(r=>({...r,get:(t,e,n)=>Su(t,e)||r.get(t,e,n),has:(t,e)=>!!Su(t,e)||r.has(t,e)}));class em{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(nm(e)){const n=e.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(e=>e).join(" ")}}function nm(r){return r.getComponent()?.type==="VERSION"}const Xi="@firebase/app",Pu="0.14.8";const Jt=new hl("@firebase/app"),rm="@firebase/app-compat",sm="@firebase/analytics-compat",im="@firebase/analytics",om="@firebase/app-check-compat",am="@firebase/app-check",um="@firebase/auth",cm="@firebase/auth-compat",lm="@firebase/database",hm="@firebase/data-connect",dm="@firebase/database-compat",fm="@firebase/functions",mm="@firebase/functions-compat",pm="@firebase/installations",gm="@firebase/installations-compat",_m="@firebase/messaging",ym="@firebase/messaging-compat",Im="@firebase/performance",Em="@firebase/performance-compat",Tm="@firebase/remote-config",wm="@firebase/remote-config-compat",vm="@firebase/storage",Am="@firebase/storage-compat",bm="@firebase/firestore",Rm="@firebase/ai",Sm="@firebase/firestore-compat",Pm="firebase",Vm="12.9.0";const Zi="[DEFAULT]",Cm={[Xi]:"fire-core",[rm]:"fire-core-compat",[im]:"fire-analytics",[sm]:"fire-analytics-compat",[am]:"fire-app-check",[om]:"fire-app-check-compat",[um]:"fire-auth",[cm]:"fire-auth-compat",[lm]:"fire-rtdb",[hm]:"fire-data-connect",[dm]:"fire-rtdb-compat",[fm]:"fire-fn",[mm]:"fire-fn-compat",[pm]:"fire-iid",[gm]:"fire-iid-compat",[_m]:"fire-fcm",[ym]:"fire-fcm-compat",[Im]:"fire-perf",[Em]:"fire-perf-compat",[Tm]:"fire-rc",[wm]:"fire-rc-compat",[vm]:"fire-gcs",[Am]:"fire-gcs-compat",[bm]:"fire-fst",[Sm]:"fire-fst-compat",[Rm]:"fire-vertex","fire-js":"fire-js",[Pm]:"fire-js-all"};const Vs=new Map,Dm=new Map,to=new Map;function Vu(r,t){try{r.container.addComponent(t)}catch(e){Jt.debug(`Component ${t.name} failed to register with FirebaseApp ${r.name}`,e)}}function Cs(r){const t=r.name;if(to.has(t))return Jt.debug(`There were multiple attempts to register component ${t}.`),!1;to.set(t,r);for(const e of Vs.values())Vu(e,r);for(const e of Dm.values())Vu(e,r);return!0}function xm(r,t){const e=r.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),r.container.getProvider(t)}function Nm(r){return r==null?!1:r.settings!==void 0}const km={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},me=new ll("app","Firebase",km);class Mm{constructor(t,e,n){this._isDeleted=!1,this._options={...t},this._config={...e},this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Er("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw me.create("app-deleted",{appName:this._name})}}const Om=Vm;function Fm(r,t={}){let e=r;typeof t!="object"&&(t={name:t});const n={name:Zi,automaticDataCollectionEnabled:!0,...t},s=n.name;if(typeof s!="string"||!s)throw me.create("bad-app-name",{appName:String(s)});if(e||(e=il()),!e)throw me.create("no-options");const i=Vs.get(s);if(i){if(Ps(e,i.options)&&Ps(n,i.config))return i;throw me.create("duplicate-app",{appName:s})}const a=new Bf(s);for(const l of to.values())a.addComponent(l);const u=new Mm(e,n,a);return Vs.set(s,u),u}function Lm(r=Zi){const t=Vs.get(r);if(!t&&r===Zi&&il())return Fm();if(!t)throw me.create("no-app",{appName:r});return t}function pn(r,t,e){let n=Cm[r]??r;e&&(n+=`-${e}`);const s=n.match(/\s|\//),i=t.match(/\s|\//);if(s||i){const a=[`Unable to register library "${n}" with version "${t}":`];s&&a.push(`library name "${n}" contains illegal characters (whitespace or "/")`),s&&i&&a.push("and"),i&&a.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Jt.warn(a.join(" "));return}Cs(new Er(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}const Bm="firebase-heartbeat-database",Um=1,Tr="firebase-heartbeat-store";let ji=null;function ml(){return ji||(ji=Xf(Bm,Um,{upgrade:(r,t)=>{switch(t){case 0:try{r.createObjectStore(Tr)}catch(e){console.warn(e)}}}}).catch(r=>{throw me.create("idb-open",{originalErrorMessage:r.message})})),ji}async function qm(r){try{const e=(await ml()).transaction(Tr),n=await e.objectStore(Tr).get(pl(r));return await e.done,n}catch(t){if(t instanceof Nn)Jt.warn(t.message);else{const e=me.create("idb-get",{originalErrorMessage:t?.message});Jt.warn(e.message)}}}async function Cu(r,t){try{const n=(await ml()).transaction(Tr,"readwrite");await n.objectStore(Tr).put(t,pl(r)),await n.done}catch(e){if(e instanceof Nn)Jt.warn(e.message);else{const n=me.create("idb-set",{originalErrorMessage:e?.message});Jt.warn(n.message)}}}function pl(r){return`${r.name}!${r.options.appId}`}const jm=1024,zm=30;class Gm{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new Km(e),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){try{const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=Du();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(s=>s.date===n))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:e}),this._heartbeatsCache.heartbeats.length>zm){const s=Hm(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(t){Jt.warn(t)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Du(),{heartbeatsToSend:e,unsentEntries:n}=$m(this._heartbeatsCache.heartbeats),s=Rs(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return Jt.warn(t),""}}}function Du(){return new Date().toISOString().substring(0,10)}function $m(r,t=jm){const e=[];let n=r.slice();for(const s of r){const i=e.find(a=>a.agent===s.agent);if(i){if(i.dates.push(s.date),xu(e)>t){i.dates.pop();break}}else if(e.push({agent:s.agent,dates:[s.date]}),xu(e)>t){e.pop();break}n=n.slice(1)}return{heartbeatsToSend:e,unsentEntries:n}}class Km{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return cl()?xf().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const e=await qm(this.app);return e?.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){if(await this._canUseIndexedDBPromise){const n=await this.read();return Cu(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){if(await this._canUseIndexedDBPromise){const n=await this.read();return Cu(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}else return}}function xu(r){return Rs(JSON.stringify({version:2,heartbeats:r})).length}function Hm(r){if(r.length===0)return-1;let t=0,e=r[0].date;for(let n=1;n<r.length;n++)r[n].date<e&&(e=r[n].date,t=n);return t}function Wm(r){Cs(new Er("platform-logger",t=>new em(t),"PRIVATE")),Cs(new Er("heartbeat",t=>new Gm(t),"PRIVATE")),pn(Xi,Pu,r),pn(Xi,Pu,"esm2020"),pn("fire-js","")}Wm("");var Qm="firebase",Ym="12.9.0";pn(Qm,Ym,"app");var Nu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var pe,gl;(function(){var r;function t(E,g){function y(){}y.prototype=g.prototype,E.F=g.prototype,E.prototype=new y,E.prototype.constructor=E,E.D=function(w,T,b){for(var _=Array(arguments.length-2),Vt=2;Vt<arguments.length;Vt++)_[Vt-2]=arguments[Vt];return g.prototype[T].apply(w,_)}}function e(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}t(n,e),n.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(E,g,y){y||(y=0);const w=Array(16);if(typeof g=="string")for(var T=0;T<16;++T)w[T]=g.charCodeAt(y++)|g.charCodeAt(y++)<<8|g.charCodeAt(y++)<<16|g.charCodeAt(y++)<<24;else for(T=0;T<16;++T)w[T]=g[y++]|g[y++]<<8|g[y++]<<16|g[y++]<<24;g=E.g[0],y=E.g[1],T=E.g[2];let b=E.g[3],_;_=g+(b^y&(T^b))+w[0]+3614090360&4294967295,g=y+(_<<7&4294967295|_>>>25),_=b+(T^g&(y^T))+w[1]+3905402710&4294967295,b=g+(_<<12&4294967295|_>>>20),_=T+(y^b&(g^y))+w[2]+606105819&4294967295,T=b+(_<<17&4294967295|_>>>15),_=y+(g^T&(b^g))+w[3]+3250441966&4294967295,y=T+(_<<22&4294967295|_>>>10),_=g+(b^y&(T^b))+w[4]+4118548399&4294967295,g=y+(_<<7&4294967295|_>>>25),_=b+(T^g&(y^T))+w[5]+1200080426&4294967295,b=g+(_<<12&4294967295|_>>>20),_=T+(y^b&(g^y))+w[6]+2821735955&4294967295,T=b+(_<<17&4294967295|_>>>15),_=y+(g^T&(b^g))+w[7]+4249261313&4294967295,y=T+(_<<22&4294967295|_>>>10),_=g+(b^y&(T^b))+w[8]+1770035416&4294967295,g=y+(_<<7&4294967295|_>>>25),_=b+(T^g&(y^T))+w[9]+2336552879&4294967295,b=g+(_<<12&4294967295|_>>>20),_=T+(y^b&(g^y))+w[10]+4294925233&4294967295,T=b+(_<<17&4294967295|_>>>15),_=y+(g^T&(b^g))+w[11]+2304563134&4294967295,y=T+(_<<22&4294967295|_>>>10),_=g+(b^y&(T^b))+w[12]+1804603682&4294967295,g=y+(_<<7&4294967295|_>>>25),_=b+(T^g&(y^T))+w[13]+4254626195&4294967295,b=g+(_<<12&4294967295|_>>>20),_=T+(y^b&(g^y))+w[14]+2792965006&4294967295,T=b+(_<<17&4294967295|_>>>15),_=y+(g^T&(b^g))+w[15]+1236535329&4294967295,y=T+(_<<22&4294967295|_>>>10),_=g+(T^b&(y^T))+w[1]+4129170786&4294967295,g=y+(_<<5&4294967295|_>>>27),_=b+(y^T&(g^y))+w[6]+3225465664&4294967295,b=g+(_<<9&4294967295|_>>>23),_=T+(g^y&(b^g))+w[11]+643717713&4294967295,T=b+(_<<14&4294967295|_>>>18),_=y+(b^g&(T^b))+w[0]+3921069994&4294967295,y=T+(_<<20&4294967295|_>>>12),_=g+(T^b&(y^T))+w[5]+3593408605&4294967295,g=y+(_<<5&4294967295|_>>>27),_=b+(y^T&(g^y))+w[10]+38016083&4294967295,b=g+(_<<9&4294967295|_>>>23),_=T+(g^y&(b^g))+w[15]+3634488961&4294967295,T=b+(_<<14&4294967295|_>>>18),_=y+(b^g&(T^b))+w[4]+3889429448&4294967295,y=T+(_<<20&4294967295|_>>>12),_=g+(T^b&(y^T))+w[9]+568446438&4294967295,g=y+(_<<5&4294967295|_>>>27),_=b+(y^T&(g^y))+w[14]+3275163606&4294967295,b=g+(_<<9&4294967295|_>>>23),_=T+(g^y&(b^g))+w[3]+4107603335&4294967295,T=b+(_<<14&4294967295|_>>>18),_=y+(b^g&(T^b))+w[8]+1163531501&4294967295,y=T+(_<<20&4294967295|_>>>12),_=g+(T^b&(y^T))+w[13]+2850285829&4294967295,g=y+(_<<5&4294967295|_>>>27),_=b+(y^T&(g^y))+w[2]+4243563512&4294967295,b=g+(_<<9&4294967295|_>>>23),_=T+(g^y&(b^g))+w[7]+1735328473&4294967295,T=b+(_<<14&4294967295|_>>>18),_=y+(b^g&(T^b))+w[12]+2368359562&4294967295,y=T+(_<<20&4294967295|_>>>12),_=g+(y^T^b)+w[5]+4294588738&4294967295,g=y+(_<<4&4294967295|_>>>28),_=b+(g^y^T)+w[8]+2272392833&4294967295,b=g+(_<<11&4294967295|_>>>21),_=T+(b^g^y)+w[11]+1839030562&4294967295,T=b+(_<<16&4294967295|_>>>16),_=y+(T^b^g)+w[14]+4259657740&4294967295,y=T+(_<<23&4294967295|_>>>9),_=g+(y^T^b)+w[1]+2763975236&4294967295,g=y+(_<<4&4294967295|_>>>28),_=b+(g^y^T)+w[4]+1272893353&4294967295,b=g+(_<<11&4294967295|_>>>21),_=T+(b^g^y)+w[7]+4139469664&4294967295,T=b+(_<<16&4294967295|_>>>16),_=y+(T^b^g)+w[10]+3200236656&4294967295,y=T+(_<<23&4294967295|_>>>9),_=g+(y^T^b)+w[13]+681279174&4294967295,g=y+(_<<4&4294967295|_>>>28),_=b+(g^y^T)+w[0]+3936430074&4294967295,b=g+(_<<11&4294967295|_>>>21),_=T+(b^g^y)+w[3]+3572445317&4294967295,T=b+(_<<16&4294967295|_>>>16),_=y+(T^b^g)+w[6]+76029189&4294967295,y=T+(_<<23&4294967295|_>>>9),_=g+(y^T^b)+w[9]+3654602809&4294967295,g=y+(_<<4&4294967295|_>>>28),_=b+(g^y^T)+w[12]+3873151461&4294967295,b=g+(_<<11&4294967295|_>>>21),_=T+(b^g^y)+w[15]+530742520&4294967295,T=b+(_<<16&4294967295|_>>>16),_=y+(T^b^g)+w[2]+3299628645&4294967295,y=T+(_<<23&4294967295|_>>>9),_=g+(T^(y|~b))+w[0]+4096336452&4294967295,g=y+(_<<6&4294967295|_>>>26),_=b+(y^(g|~T))+w[7]+1126891415&4294967295,b=g+(_<<10&4294967295|_>>>22),_=T+(g^(b|~y))+w[14]+2878612391&4294967295,T=b+(_<<15&4294967295|_>>>17),_=y+(b^(T|~g))+w[5]+4237533241&4294967295,y=T+(_<<21&4294967295|_>>>11),_=g+(T^(y|~b))+w[12]+1700485571&4294967295,g=y+(_<<6&4294967295|_>>>26),_=b+(y^(g|~T))+w[3]+2399980690&4294967295,b=g+(_<<10&4294967295|_>>>22),_=T+(g^(b|~y))+w[10]+4293915773&4294967295,T=b+(_<<15&4294967295|_>>>17),_=y+(b^(T|~g))+w[1]+2240044497&4294967295,y=T+(_<<21&4294967295|_>>>11),_=g+(T^(y|~b))+w[8]+1873313359&4294967295,g=y+(_<<6&4294967295|_>>>26),_=b+(y^(g|~T))+w[15]+4264355552&4294967295,b=g+(_<<10&4294967295|_>>>22),_=T+(g^(b|~y))+w[6]+2734768916&4294967295,T=b+(_<<15&4294967295|_>>>17),_=y+(b^(T|~g))+w[13]+1309151649&4294967295,y=T+(_<<21&4294967295|_>>>11),_=g+(T^(y|~b))+w[4]+4149444226&4294967295,g=y+(_<<6&4294967295|_>>>26),_=b+(y^(g|~T))+w[11]+3174756917&4294967295,b=g+(_<<10&4294967295|_>>>22),_=T+(g^(b|~y))+w[2]+718787259&4294967295,T=b+(_<<15&4294967295|_>>>17),_=y+(b^(T|~g))+w[9]+3951481745&4294967295,E.g[0]=E.g[0]+g&4294967295,E.g[1]=E.g[1]+(T+(_<<21&4294967295|_>>>11))&4294967295,E.g[2]=E.g[2]+T&4294967295,E.g[3]=E.g[3]+b&4294967295}n.prototype.v=function(E,g){g===void 0&&(g=E.length);const y=g-this.blockSize,w=this.C;let T=this.h,b=0;for(;b<g;){if(T==0)for(;b<=y;)s(this,E,b),b+=this.blockSize;if(typeof E=="string"){for(;b<g;)if(w[T++]=E.charCodeAt(b++),T==this.blockSize){s(this,w),T=0;break}}else for(;b<g;)if(w[T++]=E[b++],T==this.blockSize){s(this,w),T=0;break}}this.h=T,this.o+=g},n.prototype.A=function(){var E=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);E[0]=128;for(var g=1;g<E.length-8;++g)E[g]=0;g=this.o*8;for(var y=E.length-8;y<E.length;++y)E[y]=g&255,g/=256;for(this.v(E),E=Array(16),g=0,y=0;y<4;++y)for(let w=0;w<32;w+=8)E[g++]=this.g[y]>>>w&255;return E};function i(E,g){var y=u;return Object.prototype.hasOwnProperty.call(y,E)?y[E]:y[E]=g(E)}function a(E,g){this.h=g;const y=[];let w=!0;for(let T=E.length-1;T>=0;T--){const b=E[T]|0;w&&b==g||(y[T]=b,w=!1)}this.g=y}var u={};function l(E){return-128<=E&&E<128?i(E,function(g){return new a([g|0],g<0?-1:0)}):new a([E|0],E<0?-1:0)}function d(E){if(isNaN(E)||!isFinite(E))return p;if(E<0)return M(d(-E));const g=[];let y=1;for(let w=0;E>=y;w++)g[w]=E/y|0,y*=4294967296;return new a(g,0)}function f(E,g){if(E.length==0)throw Error("number format error: empty string");if(g=g||10,g<2||36<g)throw Error("radix out of range: "+g);if(E.charAt(0)=="-")return M(f(E.substring(1),g));if(E.indexOf("-")>=0)throw Error('number format error: interior "-" character');const y=d(Math.pow(g,8));let w=p;for(let b=0;b<E.length;b+=8){var T=Math.min(8,E.length-b);const _=parseInt(E.substring(b,b+T),g);T<8?(T=d(Math.pow(g,T)),w=w.j(T).add(d(_))):(w=w.j(y),w=w.add(d(_)))}return w}var p=l(0),I=l(1),S=l(16777216);r=a.prototype,r.m=function(){if(k(this))return-M(this).m();let E=0,g=1;for(let y=0;y<this.g.length;y++){const w=this.i(y);E+=(w>=0?w:4294967296+w)*g,g*=4294967296}return E},r.toString=function(E){if(E=E||10,E<2||36<E)throw Error("radix out of range: "+E);if(C(this))return"0";if(k(this))return"-"+M(this).toString(E);const g=d(Math.pow(E,6));var y=this;let w="";for(;;){const T=J(y,g).g;y=$(y,T.j(g));let b=((y.g.length>0?y.g[0]:y.h)>>>0).toString(E);if(y=T,C(y))return b+w;for(;b.length<6;)b="0"+b;w=b+w}},r.i=function(E){return E<0?0:E<this.g.length?this.g[E]:this.h};function C(E){if(E.h!=0)return!1;for(let g=0;g<E.g.length;g++)if(E.g[g]!=0)return!1;return!0}function k(E){return E.h==-1}r.l=function(E){return E=$(this,E),k(E)?-1:C(E)?0:1};function M(E){const g=E.g.length,y=[];for(let w=0;w<g;w++)y[w]=~E.g[w];return new a(y,~E.h).add(I)}r.abs=function(){return k(this)?M(this):this},r.add=function(E){const g=Math.max(this.g.length,E.g.length),y=[];let w=0;for(let T=0;T<=g;T++){let b=w+(this.i(T)&65535)+(E.i(T)&65535),_=(b>>>16)+(this.i(T)>>>16)+(E.i(T)>>>16);w=_>>>16,b&=65535,_&=65535,y[T]=_<<16|b}return new a(y,y[y.length-1]&-2147483648?-1:0)};function $(E,g){return E.add(M(g))}r.j=function(E){if(C(this)||C(E))return p;if(k(this))return k(E)?M(this).j(M(E)):M(M(this).j(E));if(k(E))return M(this.j(M(E)));if(this.l(S)<0&&E.l(S)<0)return d(this.m()*E.m());const g=this.g.length+E.g.length,y=[];for(var w=0;w<2*g;w++)y[w]=0;for(w=0;w<this.g.length;w++)for(let T=0;T<E.g.length;T++){const b=this.i(w)>>>16,_=this.i(w)&65535,Vt=E.i(T)>>>16,Re=E.i(T)&65535;y[2*w+2*T]+=_*Re,U(y,2*w+2*T),y[2*w+2*T+1]+=b*Re,U(y,2*w+2*T+1),y[2*w+2*T+1]+=_*Vt,U(y,2*w+2*T+1),y[2*w+2*T+2]+=b*Vt,U(y,2*w+2*T+2)}for(E=0;E<g;E++)y[E]=y[2*E+1]<<16|y[2*E];for(E=g;E<2*g;E++)y[E]=0;return new a(y,0)};function U(E,g){for(;(E[g]&65535)!=E[g];)E[g+1]+=E[g]>>>16,E[g]&=65535,g++}function B(E,g){this.g=E,this.h=g}function J(E,g){if(C(g))throw Error("division by zero");if(C(E))return new B(p,p);if(k(E))return g=J(M(E),g),new B(M(g.g),M(g.h));if(k(g))return g=J(E,M(g)),new B(M(g.g),g.h);if(E.g.length>30){if(k(E)||k(g))throw Error("slowDivide_ only works with positive integers.");for(var y=I,w=g;w.l(E)<=0;)y=et(y),w=et(w);var T=Q(y,1),b=Q(w,1);for(w=Q(w,2),y=Q(y,2);!C(w);){var _=b.add(w);_.l(E)<=0&&(T=T.add(y),b=_),w=Q(w,1),y=Q(y,1)}return g=$(E,T.j(g)),new B(T,g)}for(T=p;E.l(g)>=0;){for(y=Math.max(1,Math.floor(E.m()/g.m())),w=Math.ceil(Math.log(y)/Math.LN2),w=w<=48?1:Math.pow(2,w-48),b=d(y),_=b.j(g);k(_)||_.l(E)>0;)y-=w,b=d(y),_=b.j(g);C(b)&&(b=I),T=T.add(b),E=$(E,_)}return new B(T,E)}r.B=function(E){return J(this,E).h},r.and=function(E){const g=Math.max(this.g.length,E.g.length),y=[];for(let w=0;w<g;w++)y[w]=this.i(w)&E.i(w);return new a(y,this.h&E.h)},r.or=function(E){const g=Math.max(this.g.length,E.g.length),y=[];for(let w=0;w<g;w++)y[w]=this.i(w)|E.i(w);return new a(y,this.h|E.h)},r.xor=function(E){const g=Math.max(this.g.length,E.g.length),y=[];for(let w=0;w<g;w++)y[w]=this.i(w)^E.i(w);return new a(y,this.h^E.h)};function et(E){const g=E.g.length+1,y=[];for(let w=0;w<g;w++)y[w]=E.i(w)<<1|E.i(w-1)>>>31;return new a(y,E.h)}function Q(E,g){const y=g>>5;g%=32;const w=E.g.length-y,T=[];for(let b=0;b<w;b++)T[b]=g>0?E.i(b+y)>>>g|E.i(b+y+1)<<32-g:E.i(b+y);return new a(T,E.h)}n.prototype.digest=n.prototype.A,n.prototype.reset=n.prototype.u,n.prototype.update=n.prototype.v,gl=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=f,pe=a}).apply(typeof Nu<"u"?Nu:typeof self<"u"?self:typeof window<"u"?window:{});var as=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var _l,or,yl,ms,eo,Il,El,Tl;(function(){var r,t=Object.defineProperty;function e(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof as=="object"&&as];for(var c=0;c<o.length;++c){var h=o[c];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var n=e(this);function s(o,c){if(c)t:{var h=n;o=o.split(".");for(var m=0;m<o.length-1;m++){var A=o[m];if(!(A in h))break t;h=h[A]}o=o[o.length-1],m=h[o],c=c(m),c!=m&&c!=null&&t(h,o,{configurable:!0,writable:!0,value:c})}}s("Symbol.dispose",function(o){return o||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(o){return o||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(o){return o||function(c){var h=[],m;for(m in c)Object.prototype.hasOwnProperty.call(c,m)&&h.push([m,c[m]]);return h}});var i=i||{},a=this||self;function u(o){var c=typeof o;return c=="object"&&o!=null||c=="function"}function l(o,c,h){return o.call.apply(o.bind,arguments)}function d(o,c,h){return d=l,d.apply(null,arguments)}function f(o,c){var h=Array.prototype.slice.call(arguments,1);return function(){var m=h.slice();return m.push.apply(m,arguments),o.apply(this,m)}}function p(o,c){function h(){}h.prototype=c.prototype,o.Z=c.prototype,o.prototype=new h,o.prototype.constructor=o,o.Ob=function(m,A,R){for(var D=Array(arguments.length-2),z=2;z<arguments.length;z++)D[z-2]=arguments[z];return c.prototype[A].apply(m,D)}}var I=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?o=>o&&AsyncContext.Snapshot.wrap(o):o=>o;function S(o){const c=o.length;if(c>0){const h=Array(c);for(let m=0;m<c;m++)h[m]=o[m];return h}return[]}function C(o,c){for(let m=1;m<arguments.length;m++){const A=arguments[m];var h=typeof A;if(h=h!="object"?h:A?Array.isArray(A)?"array":h:"null",h=="array"||h=="object"&&typeof A.length=="number"){h=o.length||0;const R=A.length||0;o.length=h+R;for(let D=0;D<R;D++)o[h+D]=A[D]}else o.push(A)}}class k{constructor(c,h){this.i=c,this.j=h,this.h=0,this.g=null}get(){let c;return this.h>0?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function M(o){a.setTimeout(()=>{throw o},0)}function $(){var o=E;let c=null;return o.g&&(c=o.g,o.g=o.g.next,o.g||(o.h=null),c.next=null),c}class U{constructor(){this.h=this.g=null}add(c,h){const m=B.get();m.set(c,h),this.h?this.h.next=m:this.g=m,this.h=m}}var B=new k(()=>new J,o=>o.reset());class J{constructor(){this.next=this.g=this.h=null}set(c,h){this.h=c,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let et,Q=!1,E=new U,g=()=>{const o=Promise.resolve(void 0);et=()=>{o.then(y)}};function y(){for(var o;o=$();){try{o.h.call(o.g)}catch(h){M(h)}var c=B;c.j(o),c.h<100&&(c.h++,o.next=c.g,c.g=o)}Q=!1}function w(){this.u=this.u,this.C=this.C}w.prototype.u=!1,w.prototype.dispose=function(){this.u||(this.u=!0,this.N())},w.prototype[Symbol.dispose]=function(){this.dispose()},w.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function T(o,c){this.type=o,this.g=this.target=c,this.defaultPrevented=!1}T.prototype.h=function(){this.defaultPrevented=!0};var b=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var o=!1,c=Object.defineProperty({},"passive",{get:function(){o=!0}});try{const h=()=>{};a.addEventListener("test",h,c),a.removeEventListener("test",h,c)}catch{}return o})();function _(o){return/^[\s\xa0]*$/.test(o)}function Vt(o,c){T.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o&&this.init(o,c)}p(Vt,T),Vt.prototype.init=function(o,c){const h=this.type=o.type,m=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;this.target=o.target||o.srcElement,this.g=c,c=o.relatedTarget,c||(h=="mouseover"?c=o.fromElement:h=="mouseout"&&(c=o.toElement)),this.relatedTarget=c,m?(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=o.pointerType,this.state=o.state,this.i=o,o.defaultPrevented&&Vt.Z.h.call(this)},Vt.prototype.h=function(){Vt.Z.h.call(this);const o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var Re="closure_listenable_"+(Math.random()*1e6|0),Fd=0;function Ld(o,c,h,m,A){this.listener=o,this.proxy=null,this.src=c,this.type=h,this.capture=!!m,this.ha=A,this.key=++Fd,this.da=this.fa=!1}function Kr(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function Hr(o,c,h){for(const m in o)c.call(h,o[m],m,o)}function Bd(o,c){for(const h in o)c.call(void 0,o[h],h,o)}function Ta(o){const c={};for(const h in o)c[h]=o[h];return c}const wa="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function va(o,c){let h,m;for(let A=1;A<arguments.length;A++){m=arguments[A];for(h in m)o[h]=m[h];for(let R=0;R<wa.length;R++)h=wa[R],Object.prototype.hasOwnProperty.call(m,h)&&(o[h]=m[h])}}function Wr(o){this.src=o,this.g={},this.h=0}Wr.prototype.add=function(o,c,h,m,A){const R=o.toString();o=this.g[R],o||(o=this.g[R]=[],this.h++);const D=gi(o,c,m,A);return D>-1?(c=o[D],h||(c.fa=!1)):(c=new Ld(c,this.src,R,!!m,A),c.fa=h,o.push(c)),c};function pi(o,c){const h=c.type;if(h in o.g){var m=o.g[h],A=Array.prototype.indexOf.call(m,c,void 0),R;(R=A>=0)&&Array.prototype.splice.call(m,A,1),R&&(Kr(c),o.g[h].length==0&&(delete o.g[h],o.h--))}}function gi(o,c,h,m){for(let A=0;A<o.length;++A){const R=o[A];if(!R.da&&R.listener==c&&R.capture==!!h&&R.ha==m)return A}return-1}var _i="closure_lm_"+(Math.random()*1e6|0),yi={};function Aa(o,c,h,m,A){if(Array.isArray(c)){for(let R=0;R<c.length;R++)Aa(o,c[R],h,m,A);return null}return h=Sa(h),o&&o[Re]?o.J(c,h,u(m)?!!m.capture:!1,A):Ud(o,c,h,!1,m,A)}function Ud(o,c,h,m,A,R){if(!c)throw Error("Invalid event type");const D=u(A)?!!A.capture:!!A;let z=Ei(o);if(z||(o[_i]=z=new Wr(o)),h=z.add(c,h,m,D,R),h.proxy)return h;if(m=qd(),h.proxy=m,m.src=o,m.listener=h,o.addEventListener)b||(A=D),A===void 0&&(A=!1),o.addEventListener(c.toString(),m,A);else if(o.attachEvent)o.attachEvent(Ra(c.toString()),m);else if(o.addListener&&o.removeListener)o.addListener(m);else throw Error("addEventListener and attachEvent are unavailable.");return h}function qd(){function o(h){return c.call(o.src,o.listener,h)}const c=jd;return o}function ba(o,c,h,m,A){if(Array.isArray(c))for(var R=0;R<c.length;R++)ba(o,c[R],h,m,A);else m=u(m)?!!m.capture:!!m,h=Sa(h),o&&o[Re]?(o=o.i,R=String(c).toString(),R in o.g&&(c=o.g[R],h=gi(c,h,m,A),h>-1&&(Kr(c[h]),Array.prototype.splice.call(c,h,1),c.length==0&&(delete o.g[R],o.h--)))):o&&(o=Ei(o))&&(c=o.g[c.toString()],o=-1,c&&(o=gi(c,h,m,A)),(h=o>-1?c[o]:null)&&Ii(h))}function Ii(o){if(typeof o!="number"&&o&&!o.da){var c=o.src;if(c&&c[Re])pi(c.i,o);else{var h=o.type,m=o.proxy;c.removeEventListener?c.removeEventListener(h,m,o.capture):c.detachEvent?c.detachEvent(Ra(h),m):c.addListener&&c.removeListener&&c.removeListener(m),(h=Ei(c))?(pi(h,o),h.h==0&&(h.src=null,c[_i]=null)):Kr(o)}}}function Ra(o){return o in yi?yi[o]:yi[o]="on"+o}function jd(o,c){if(o.da)o=!0;else{c=new Vt(c,this);const h=o.listener,m=o.ha||o.src;o.fa&&Ii(o),o=h.call(m,c)}return o}function Ei(o){return o=o[_i],o instanceof Wr?o:null}var Ti="__closure_events_fn_"+(Math.random()*1e9>>>0);function Sa(o){return typeof o=="function"?o:(o[Ti]||(o[Ti]=function(c){return o.handleEvent(c)}),o[Ti])}function It(){w.call(this),this.i=new Wr(this),this.M=this,this.G=null}p(It,w),It.prototype[Re]=!0,It.prototype.removeEventListener=function(o,c,h,m){ba(this,o,c,h,m)};function At(o,c){var h,m=o.G;if(m)for(h=[];m;m=m.G)h.push(m);if(o=o.M,m=c.type||c,typeof c=="string")c=new T(c,o);else if(c instanceof T)c.target=c.target||o;else{var A=c;c=new T(m,o),va(c,A)}A=!0;let R,D;if(h)for(D=h.length-1;D>=0;D--)R=c.g=h[D],A=Qr(R,m,!0,c)&&A;if(R=c.g=o,A=Qr(R,m,!0,c)&&A,A=Qr(R,m,!1,c)&&A,h)for(D=0;D<h.length;D++)R=c.g=h[D],A=Qr(R,m,!1,c)&&A}It.prototype.N=function(){if(It.Z.N.call(this),this.i){var o=this.i;for(const c in o.g){const h=o.g[c];for(let m=0;m<h.length;m++)Kr(h[m]);delete o.g[c],o.h--}}this.G=null},It.prototype.J=function(o,c,h,m){return this.i.add(String(o),c,!1,h,m)},It.prototype.K=function(o,c,h,m){return this.i.add(String(o),c,!0,h,m)};function Qr(o,c,h,m){if(c=o.i.g[String(c)],!c)return!0;c=c.concat();let A=!0;for(let R=0;R<c.length;++R){const D=c[R];if(D&&!D.da&&D.capture==h){const z=D.listener,ft=D.ha||D.src;D.fa&&pi(o.i,D),A=z.call(ft,m)!==!1&&A}}return A&&!m.defaultPrevented}function zd(o,c){if(typeof o!="function")if(o&&typeof o.handleEvent=="function")o=d(o.handleEvent,o);else throw Error("Invalid listener argument");return Number(c)>2147483647?-1:a.setTimeout(o,c||0)}function Pa(o){o.g=zd(()=>{o.g=null,o.i&&(o.i=!1,Pa(o))},o.l);const c=o.h;o.h=null,o.m.apply(null,c)}class Gd extends w{constructor(c,h){super(),this.m=c,this.l=h,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:Pa(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ln(o){w.call(this),this.h=o,this.g={}}p(Ln,w);var Va=[];function Ca(o){Hr(o.g,function(c,h){this.g.hasOwnProperty(h)&&Ii(c)},o),o.g={}}Ln.prototype.N=function(){Ln.Z.N.call(this),Ca(this)},Ln.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var wi=a.JSON.stringify,$d=a.JSON.parse,Kd=class{stringify(o){return a.JSON.stringify(o,void 0)}parse(o){return a.JSON.parse(o,void 0)}};function Da(){}function xa(){}var Bn={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function vi(){T.call(this,"d")}p(vi,T);function Ai(){T.call(this,"c")}p(Ai,T);var Se={},Na=null;function Yr(){return Na=Na||new It}Se.Ia="serverreachability";function ka(o){T.call(this,Se.Ia,o)}p(ka,T);function Un(o){const c=Yr();At(c,new ka(c))}Se.STAT_EVENT="statevent";function Ma(o,c){T.call(this,Se.STAT_EVENT,o),this.stat=c}p(Ma,T);function bt(o){const c=Yr();At(c,new Ma(c,o))}Se.Ja="timingevent";function Oa(o,c){T.call(this,Se.Ja,o),this.size=c}p(Oa,T);function qn(o,c){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){o()},c)}function jn(){this.g=!0}jn.prototype.ua=function(){this.g=!1};function Hd(o,c,h,m,A,R){o.info(function(){if(o.g)if(R){var D="",z=R.split("&");for(let nt=0;nt<z.length;nt++){var ft=z[nt].split("=");if(ft.length>1){const pt=ft[0];ft=ft[1];const jt=pt.split("_");D=jt.length>=2&&jt[1]=="type"?D+(pt+"="+ft+"&"):D+(pt+"=redacted&")}}}else D=null;else D=R;return"XMLHTTP REQ ("+m+") [attempt "+A+"]: "+c+`
`+h+`
`+D})}function Wd(o,c,h,m,A,R,D){o.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+A+"]: "+c+`
`+h+`
`+R+" "+D})}function tn(o,c,h,m){o.info(function(){return"XMLHTTP TEXT ("+c+"): "+Yd(o,h)+(m?" "+m:"")})}function Qd(o,c){o.info(function(){return"TIMEOUT: "+c})}jn.prototype.info=function(){};function Yd(o,c){if(!o.g)return c;if(!c)return null;try{const R=JSON.parse(c);if(R){for(o=0;o<R.length;o++)if(Array.isArray(R[o])){var h=R[o];if(!(h.length<2)){var m=h[1];if(Array.isArray(m)&&!(m.length<1)){var A=m[0];if(A!="noop"&&A!="stop"&&A!="close")for(let D=1;D<m.length;D++)m[D]=""}}}}return wi(R)}catch{return c}}var Jr={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Fa={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},La;function bi(){}p(bi,Da),bi.prototype.g=function(){return new XMLHttpRequest},La=new bi;function zn(o){return encodeURIComponent(String(o))}function Jd(o){var c=1;o=o.split(":");const h=[];for(;c>0&&o.length;)h.push(o.shift()),c--;return o.length&&h.push(o.join(":")),h}function ne(o,c,h,m){this.j=o,this.i=c,this.l=h,this.S=m||1,this.V=new Ln(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Ba}function Ba(){this.i=null,this.g="",this.h=!1}var Ua={},Ri={};function Si(o,c,h){o.M=1,o.A=Zr(qt(c)),o.u=h,o.R=!0,qa(o,null)}function qa(o,c){o.F=Date.now(),Xr(o),o.B=qt(o.A);var h=o.B,m=o.S;Array.isArray(m)||(m=[String(m)]),tu(h.i,"t",m),o.C=0,h=o.j.L,o.h=new Ba,o.g=yu(o.j,h?c:null,!o.u),o.P>0&&(o.O=new Gd(d(o.Y,o,o.g),o.P)),c=o.V,h=o.g,m=o.ba;var A="readystatechange";Array.isArray(A)||(A&&(Va[0]=A.toString()),A=Va);for(let R=0;R<A.length;R++){const D=Aa(h,A[R],m||c.handleEvent,!1,c.h||c);if(!D)break;c.g[D.key]=D}c=o.J?Ta(o.J):{},o.u?(o.v||(o.v="POST"),c["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.B,o.v,o.u,c)):(o.v="GET",o.g.ea(o.B,o.v,null,c)),Un(),Hd(o.i,o.v,o.B,o.l,o.S,o.u)}ne.prototype.ba=function(o){o=o.target;const c=this.O;c&&ie(o)==3?c.j():this.Y(o)},ne.prototype.Y=function(o){try{if(o==this.g)t:{const z=ie(this.g),ft=this.g.ya(),nt=this.g.ca();if(!(z<3)&&(z!=3||this.g&&(this.h.h||this.g.la()||au(this.g)))){this.K||z!=4||ft==7||(ft==8||nt<=0?Un(3):Un(2)),Pi(this);var c=this.g.ca();this.X=c;var h=Xd(this);if(this.o=c==200,Wd(this.i,this.v,this.B,this.l,this.S,z,c),this.o){if(this.U&&!this.L){e:{if(this.g){var m,A=this.g;if((m=A.g?A.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!_(m)){var R=m;break e}}R=null}if(o=R)tn(this.i,this.l,o,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Vi(this,o);else{this.o=!1,this.m=3,bt(12),Pe(this),Gn(this);break t}}if(this.R){o=!0;let pt;for(;!this.K&&this.C<h.length;)if(pt=Zd(this,h),pt==Ri){z==4&&(this.m=4,bt(14),o=!1),tn(this.i,this.l,null,"[Incomplete Response]");break}else if(pt==Ua){this.m=4,bt(15),tn(this.i,this.l,h,"[Invalid Chunk]"),o=!1;break}else tn(this.i,this.l,pt,null),Vi(this,pt);if(ja(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),z!=4||h.length!=0||this.h.h||(this.m=1,bt(16),o=!1),this.o=this.o&&o,!o)tn(this.i,this.l,h,"[Invalid Chunked Response]"),Pe(this),Gn(this);else if(h.length>0&&!this.W){this.W=!0;var D=this.j;D.g==this&&D.aa&&!D.P&&(D.j.info("Great, no buffering proxy detected. Bytes received: "+h.length),Fi(D),D.P=!0,bt(11))}}else tn(this.i,this.l,h,null),Vi(this,h);z==4&&Pe(this),this.o&&!this.K&&(z==4?mu(this.j,this):(this.o=!1,Xr(this)))}else mf(this.g),c==400&&h.indexOf("Unknown SID")>0?(this.m=3,bt(12)):(this.m=0,bt(13)),Pe(this),Gn(this)}}}catch{}};function Xd(o){if(!ja(o))return o.g.la();const c=au(o.g);if(c==="")return"";let h="";const m=c.length,A=ie(o.g)==4;if(!o.h.i){if(typeof TextDecoder>"u")return Pe(o),Gn(o),"";o.h.i=new a.TextDecoder}for(let R=0;R<m;R++)o.h.h=!0,h+=o.h.i.decode(c[R],{stream:!(A&&R==m-1)});return c.length=0,o.h.g+=h,o.C=0,o.h.g}function ja(o){return o.g?o.v=="GET"&&o.M!=2&&o.j.Aa:!1}function Zd(o,c){var h=o.C,m=c.indexOf(`
`,h);return m==-1?Ri:(h=Number(c.substring(h,m)),isNaN(h)?Ua:(m+=1,m+h>c.length?Ri:(c=c.slice(m,m+h),o.C=m+h,c)))}ne.prototype.cancel=function(){this.K=!0,Pe(this)};function Xr(o){o.T=Date.now()+o.H,za(o,o.H)}function za(o,c){if(o.D!=null)throw Error("WatchDog timer not null");o.D=qn(d(o.aa,o),c)}function Pi(o){o.D&&(a.clearTimeout(o.D),o.D=null)}ne.prototype.aa=function(){this.D=null;const o=Date.now();o-this.T>=0?(Qd(this.i,this.B),this.M!=2&&(Un(),bt(17)),Pe(this),this.m=2,Gn(this)):za(this,this.T-o)};function Gn(o){o.j.I==0||o.K||mu(o.j,o)}function Pe(o){Pi(o);var c=o.O;c&&typeof c.dispose=="function"&&c.dispose(),o.O=null,Ca(o.V),o.g&&(c=o.g,o.g=null,c.abort(),c.dispose())}function Vi(o,c){try{var h=o.j;if(h.I!=0&&(h.g==o||Ci(h.h,o))){if(!o.L&&Ci(h.h,o)&&h.I==3){try{var m=h.Ba.g.parse(c)}catch{m=null}if(Array.isArray(m)&&m.length==3){var A=m;if(A[0]==0){t:if(!h.v){if(h.g)if(h.g.F+3e3<o.F)ss(h),ns(h);else break t;Oi(h),bt(18)}}else h.xa=A[1],0<h.xa-h.K&&A[2]<37500&&h.F&&h.A==0&&!h.C&&(h.C=qn(d(h.Va,h),6e3));Ka(h.h)<=1&&h.ta&&(h.ta=void 0)}else Ce(h,11)}else if((o.L||h.g==o)&&ss(h),!_(c))for(A=h.Ba.g.parse(c),c=0;c<A.length;c++){let nt=A[c];const pt=nt[0];if(!(pt<=h.K))if(h.K=pt,nt=nt[1],h.I==2)if(nt[0]=="c"){h.M=nt[1],h.ba=nt[2];const jt=nt[3];jt!=null&&(h.ka=jt,h.j.info("VER="+h.ka));const De=nt[4];De!=null&&(h.za=De,h.j.info("SVER="+h.za));const oe=nt[5];oe!=null&&typeof oe=="number"&&oe>0&&(m=1.5*oe,h.O=m,h.j.info("backChannelRequestTimeoutMs_="+m)),m=h;const ae=o.g;if(ae){const os=ae.g?ae.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(os){var R=m.h;R.g||os.indexOf("spdy")==-1&&os.indexOf("quic")==-1&&os.indexOf("h2")==-1||(R.j=R.l,R.g=new Set,R.h&&(Di(R,R.h),R.h=null))}if(m.G){const Li=ae.g?ae.g.getResponseHeader("X-HTTP-Session-Id"):null;Li&&(m.wa=Li,rt(m.J,m.G,Li))}}h.I=3,h.l&&h.l.ra(),h.aa&&(h.T=Date.now()-o.F,h.j.info("Handshake RTT: "+h.T+"ms")),m=h;var D=o;if(m.na=_u(m,m.L?m.ba:null,m.W),D.L){Ha(m.h,D);var z=D,ft=m.O;ft&&(z.H=ft),z.D&&(Pi(z),Xr(z)),m.g=D}else du(m);h.i.length>0&&rs(h)}else nt[0]!="stop"&&nt[0]!="close"||Ce(h,7);else h.I==3&&(nt[0]=="stop"||nt[0]=="close"?nt[0]=="stop"?Ce(h,7):Mi(h):nt[0]!="noop"&&h.l&&h.l.qa(nt),h.A=0)}}Un(4)}catch{}}var tf=class{constructor(o,c){this.g=o,this.map=c}};function Ga(o){this.l=o||10,a.PerformanceNavigationTiming?(o=a.performance.getEntriesByType("navigation"),o=o.length>0&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function $a(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function Ka(o){return o.h?1:o.g?o.g.size:0}function Ci(o,c){return o.h?o.h==c:o.g?o.g.has(c):!1}function Di(o,c){o.g?o.g.add(c):o.h=c}function Ha(o,c){o.h&&o.h==c?o.h=null:o.g&&o.g.has(c)&&o.g.delete(c)}Ga.prototype.cancel=function(){if(this.i=Wa(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const o of this.g.values())o.cancel();this.g.clear()}};function Wa(o){if(o.h!=null)return o.i.concat(o.h.G);if(o.g!=null&&o.g.size!==0){let c=o.i;for(const h of o.g.values())c=c.concat(h.G);return c}return S(o.i)}var Qa=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ef(o,c){if(o){o=o.split("&");for(let h=0;h<o.length;h++){const m=o[h].indexOf("=");let A,R=null;m>=0?(A=o[h].substring(0,m),R=o[h].substring(m+1)):A=o[h],c(A,R?decodeURIComponent(R.replace(/\+/g," ")):"")}}}function re(o){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let c;o instanceof re?(this.l=o.l,$n(this,o.j),this.o=o.o,this.g=o.g,Kn(this,o.u),this.h=o.h,xi(this,eu(o.i)),this.m=o.m):o&&(c=String(o).match(Qa))?(this.l=!1,$n(this,c[1]||"",!0),this.o=Hn(c[2]||""),this.g=Hn(c[3]||"",!0),Kn(this,c[4]),this.h=Hn(c[5]||"",!0),xi(this,c[6]||"",!0),this.m=Hn(c[7]||"")):(this.l=!1,this.i=new Qn(null,this.l))}re.prototype.toString=function(){const o=[];var c=this.j;c&&o.push(Wn(c,Ya,!0),":");var h=this.g;return(h||c=="file")&&(o.push("//"),(c=this.o)&&o.push(Wn(c,Ya,!0),"@"),o.push(zn(h).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.u,h!=null&&o.push(":",String(h))),(h=this.h)&&(this.g&&h.charAt(0)!="/"&&o.push("/"),o.push(Wn(h,h.charAt(0)=="/"?sf:rf,!0))),(h=this.i.toString())&&o.push("?",h),(h=this.m)&&o.push("#",Wn(h,af)),o.join("")},re.prototype.resolve=function(o){const c=qt(this);let h=!!o.j;h?$n(c,o.j):h=!!o.o,h?c.o=o.o:h=!!o.g,h?c.g=o.g:h=o.u!=null;var m=o.h;if(h)Kn(c,o.u);else if(h=!!o.h){if(m.charAt(0)!="/")if(this.g&&!this.h)m="/"+m;else{var A=c.h.lastIndexOf("/");A!=-1&&(m=c.h.slice(0,A+1)+m)}if(A=m,A==".."||A==".")m="";else if(A.indexOf("./")!=-1||A.indexOf("/.")!=-1){m=A.lastIndexOf("/",0)==0,A=A.split("/");const R=[];for(let D=0;D<A.length;){const z=A[D++];z=="."?m&&D==A.length&&R.push(""):z==".."?((R.length>1||R.length==1&&R[0]!="")&&R.pop(),m&&D==A.length&&R.push("")):(R.push(z),m=!0)}m=R.join("/")}else m=A}return h?c.h=m:h=o.i.toString()!=="",h?xi(c,eu(o.i)):h=!!o.m,h&&(c.m=o.m),c};function qt(o){return new re(o)}function $n(o,c,h){o.j=h?Hn(c,!0):c,o.j&&(o.j=o.j.replace(/:$/,""))}function Kn(o,c){if(c){if(c=Number(c),isNaN(c)||c<0)throw Error("Bad port number "+c);o.u=c}else o.u=null}function xi(o,c,h){c instanceof Qn?(o.i=c,uf(o.i,o.l)):(h||(c=Wn(c,of)),o.i=new Qn(c,o.l))}function rt(o,c,h){o.i.set(c,h)}function Zr(o){return rt(o,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),o}function Hn(o,c){return o?c?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function Wn(o,c,h){return typeof o=="string"?(o=encodeURI(o).replace(c,nf),h&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function nf(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var Ya=/[#\/\?@]/g,rf=/[#\?:]/g,sf=/[#\?]/g,of=/[#\?@]/g,af=/#/g;function Qn(o,c){this.h=this.g=null,this.i=o||null,this.j=!!c}function Ve(o){o.g||(o.g=new Map,o.h=0,o.i&&ef(o.i,function(c,h){o.add(decodeURIComponent(c.replace(/\+/g," ")),h)}))}r=Qn.prototype,r.add=function(o,c){Ve(this),this.i=null,o=en(this,o);let h=this.g.get(o);return h||this.g.set(o,h=[]),h.push(c),this.h+=1,this};function Ja(o,c){Ve(o),c=en(o,c),o.g.has(c)&&(o.i=null,o.h-=o.g.get(c).length,o.g.delete(c))}function Xa(o,c){return Ve(o),c=en(o,c),o.g.has(c)}r.forEach=function(o,c){Ve(this),this.g.forEach(function(h,m){h.forEach(function(A){o.call(c,A,m,this)},this)},this)};function Za(o,c){Ve(o);let h=[];if(typeof c=="string")Xa(o,c)&&(h=h.concat(o.g.get(en(o,c))));else for(o=Array.from(o.g.values()),c=0;c<o.length;c++)h=h.concat(o[c]);return h}r.set=function(o,c){return Ve(this),this.i=null,o=en(this,o),Xa(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[c]),this.h+=1,this},r.get=function(o,c){return o?(o=Za(this,o),o.length>0?String(o[0]):c):c};function tu(o,c,h){Ja(o,c),h.length>0&&(o.i=null,o.g.set(en(o,c),S(h)),o.h+=h.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const o=[],c=Array.from(this.g.keys());for(let m=0;m<c.length;m++){var h=c[m];const A=zn(h);h=Za(this,h);for(let R=0;R<h.length;R++){let D=A;h[R]!==""&&(D+="="+zn(h[R])),o.push(D)}}return this.i=o.join("&")};function eu(o){const c=new Qn;return c.i=o.i,o.g&&(c.g=new Map(o.g),c.h=o.h),c}function en(o,c){return c=String(c),o.j&&(c=c.toLowerCase()),c}function uf(o,c){c&&!o.j&&(Ve(o),o.i=null,o.g.forEach(function(h,m){const A=m.toLowerCase();m!=A&&(Ja(this,m),tu(this,A,h))},o)),o.j=c}function cf(o,c){const h=new jn;if(a.Image){const m=new Image;m.onload=f(se,h,"TestLoadImage: loaded",!0,c,m),m.onerror=f(se,h,"TestLoadImage: error",!1,c,m),m.onabort=f(se,h,"TestLoadImage: abort",!1,c,m),m.ontimeout=f(se,h,"TestLoadImage: timeout",!1,c,m),a.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=o}else c(!1)}function lf(o,c){const h=new jn,m=new AbortController,A=setTimeout(()=>{m.abort(),se(h,"TestPingServer: timeout",!1,c)},1e4);fetch(o,{signal:m.signal}).then(R=>{clearTimeout(A),R.ok?se(h,"TestPingServer: ok",!0,c):se(h,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(A),se(h,"TestPingServer: error",!1,c)})}function se(o,c,h,m,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),m(h)}catch{}}function hf(){this.g=new Kd}function Ni(o){this.i=o.Sb||null,this.h=o.ab||!1}p(Ni,Da),Ni.prototype.g=function(){return new ts(this.i,this.h)};function ts(o,c){It.call(this),this.H=o,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}p(ts,It),r=ts.prototype,r.open=function(o,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=o,this.D=c,this.readyState=1,Jn(this)},r.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const c={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};o&&(c.body=o),(this.H||a).fetch(new Request(this.D,c)).then(this.Pa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Yn(this)),this.readyState=0},r.Pa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,Jn(this)),this.g&&(this.readyState=3,Jn(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;nu(this)}else o.text().then(this.Oa.bind(this),this.ga.bind(this))};function nu(o){o.j.read().then(o.Ma.bind(o)).catch(o.ga.bind(o))}r.Ma=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var c=o.value?o.value:new Uint8Array(0);(c=this.B.decode(c,{stream:!o.done}))&&(this.response=this.responseText+=c)}o.done?Yn(this):Jn(this),this.readyState==3&&nu(this)}},r.Oa=function(o){this.g&&(this.response=this.responseText=o,Yn(this))},r.Na=function(o){this.g&&(this.response=o,Yn(this))},r.ga=function(){this.g&&Yn(this)};function Yn(o){o.readyState=4,o.l=null,o.j=null,o.B=null,Jn(o)}r.setRequestHeader=function(o,c){this.A.append(o,c)},r.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const o=[],c=this.h.entries();for(var h=c.next();!h.done;)h=h.value,o.push(h[0]+": "+h[1]),h=c.next();return o.join(`\r
`)};function Jn(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(ts.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function ru(o){let c="";return Hr(o,function(h,m){c+=m,c+=":",c+=h,c+=`\r
`}),c}function ki(o,c,h){t:{for(m in h){var m=!1;break t}m=!0}m||(h=ru(h),typeof o=="string"?h!=null&&zn(h):rt(o,c,h))}function at(o){It.call(this),this.headers=new Map,this.L=o||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}p(at,It);var df=/^https?$/i,ff=["POST","PUT"];r=at.prototype,r.Fa=function(o){this.H=o},r.ea=function(o,c,h,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);c=c?c.toUpperCase():"GET",this.D=o,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():La.g(),this.g.onreadystatechange=I(d(this.Ca,this));try{this.B=!0,this.g.open(c,String(o),!0),this.B=!1}catch(R){su(this,R);return}if(o=h||"",h=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var A in m)h.set(A,m[A]);else if(typeof m.keys=="function"&&typeof m.get=="function")for(const R of m.keys())h.set(R,m.get(R));else throw Error("Unknown input type for opt_headers: "+String(m));m=Array.from(h.keys()).find(R=>R.toLowerCase()=="content-type"),A=a.FormData&&o instanceof a.FormData,!(Array.prototype.indexOf.call(ff,c,void 0)>=0)||m||A||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[R,D]of h)this.g.setRequestHeader(R,D);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(o),this.v=!1}catch(R){su(this,R)}};function su(o,c){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=c,o.o=5,iu(o),es(o)}function iu(o){o.A||(o.A=!0,At(o,"complete"),At(o,"error"))}r.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=o||7,At(this,"complete"),At(this,"abort"),es(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),es(this,!0)),at.Z.N.call(this)},r.Ca=function(){this.u||(this.B||this.v||this.j?ou(this):this.Xa())},r.Xa=function(){ou(this)};function ou(o){if(o.h&&typeof i<"u"){if(o.v&&ie(o)==4)setTimeout(o.Ca.bind(o),0);else if(At(o,"readystatechange"),ie(o)==4){o.h=!1;try{const R=o.ca();t:switch(R){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break t;default:c=!1}var h;if(!(h=c)){var m;if(m=R===0){let D=String(o.D).match(Qa)[1]||null;!D&&a.self&&a.self.location&&(D=a.self.location.protocol.slice(0,-1)),m=!df.test(D?D.toLowerCase():"")}h=m}if(h)At(o,"complete"),At(o,"success");else{o.o=6;try{var A=ie(o)>2?o.g.statusText:""}catch{A=""}o.l=A+" ["+o.ca()+"]",iu(o)}}finally{es(o)}}}}function es(o,c){if(o.g){o.m&&(clearTimeout(o.m),o.m=null);const h=o.g;o.g=null,c||At(o,"ready");try{h.onreadystatechange=null}catch{}}}r.isActive=function(){return!!this.g};function ie(o){return o.g?o.g.readyState:0}r.ca=function(){try{return ie(this)>2?this.g.status:-1}catch{return-1}},r.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.La=function(o){if(this.g){var c=this.g.responseText;return o&&c.indexOf(o)==0&&(c=c.substring(o.length)),$d(c)}};function au(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.F){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function mf(o){const c={};o=(o.g&&ie(o)>=2&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let m=0;m<o.length;m++){if(_(o[m]))continue;var h=Jd(o[m]);const A=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();const R=c[A]||[];c[A]=R,R.push(h)}Bd(c,function(m){return m.join(", ")})}r.ya=function(){return this.o},r.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Xn(o,c,h){return h&&h.internalChannelParams&&h.internalChannelParams[o]||c}function uu(o){this.za=0,this.i=[],this.j=new jn,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Xn("failFast",!1,o),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Xn("baseRetryDelayMs",5e3,o),this.Za=Xn("retryDelaySeedMs",1e4,o),this.Ta=Xn("forwardChannelMaxRetries",2,o),this.va=Xn("forwardChannelRequestTimeoutMs",2e4,o),this.ma=o&&o.xmlHttpFactory||void 0,this.Ua=o&&o.Rb||void 0,this.Aa=o&&o.useFetchStreams||!1,this.O=void 0,this.L=o&&o.supportsCrossDomainXhr||!1,this.M="",this.h=new Ga(o&&o.concurrentRequestLimit),this.Ba=new hf,this.S=o&&o.fastHandshake||!1,this.R=o&&o.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=o&&o.Pb||!1,o&&o.ua&&this.j.ua(),o&&o.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&o&&o.detectBufferingProxy||!1,this.ia=void 0,o&&o.longPollingTimeout&&o.longPollingTimeout>0&&(this.ia=o.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}r=uu.prototype,r.ka=8,r.I=1,r.connect=function(o,c,h,m){bt(0),this.W=o,this.H=c||{},h&&m!==void 0&&(this.H.OSID=h,this.H.OAID=m),this.F=this.X,this.J=_u(this,null,this.W),rs(this)};function Mi(o){if(cu(o),o.I==3){var c=o.V++,h=qt(o.J);if(rt(h,"SID",o.M),rt(h,"RID",c),rt(h,"TYPE","terminate"),Zn(o,h),c=new ne(o,o.j,c),c.M=2,c.A=Zr(qt(h)),h=!1,a.navigator&&a.navigator.sendBeacon)try{h=a.navigator.sendBeacon(c.A.toString(),"")}catch{}!h&&a.Image&&(new Image().src=c.A,h=!0),h||(c.g=yu(c.j,null),c.g.ea(c.A)),c.F=Date.now(),Xr(c)}gu(o)}function ns(o){o.g&&(Fi(o),o.g.cancel(),o.g=null)}function cu(o){ns(o),o.v&&(a.clearTimeout(o.v),o.v=null),ss(o),o.h.cancel(),o.m&&(typeof o.m=="number"&&a.clearTimeout(o.m),o.m=null)}function rs(o){if(!$a(o.h)&&!o.m){o.m=!0;var c=o.Ea;et||g(),Q||(et(),Q=!0),E.add(c,o),o.D=0}}function pf(o,c){return Ka(o.h)>=o.h.j-(o.m?1:0)?!1:o.m?(o.i=c.G.concat(o.i),!0):o.I==1||o.I==2||o.D>=(o.Sa?0:o.Ta)?!1:(o.m=qn(d(o.Ea,o,c),pu(o,o.D)),o.D++,!0)}r.Ea=function(o){if(this.m)if(this.m=null,this.I==1){if(!o){this.V=Math.floor(Math.random()*1e5),o=this.V++;const A=new ne(this,this.j,o);let R=this.o;if(this.U&&(R?(R=Ta(R),va(R,this.U)):R=this.U),this.u!==null||this.R||(A.J=R,R=null),this.S)t:{for(var c=0,h=0;h<this.i.length;h++){e:{var m=this.i[h];if("__data__"in m.map&&(m=m.map.__data__,typeof m=="string")){m=m.length;break e}m=void 0}if(m===void 0)break;if(c+=m,c>4096){c=h;break t}if(c===4096||h===this.i.length-1){c=h+1;break t}}c=1e3}else c=1e3;c=hu(this,A,c),h=qt(this.J),rt(h,"RID",o),rt(h,"CVER",22),this.G&&rt(h,"X-HTTP-Session-Id",this.G),Zn(this,h),R&&(this.R?c="headers="+zn(ru(R))+"&"+c:this.u&&ki(h,this.u,R)),Di(this.h,A),this.Ra&&rt(h,"TYPE","init"),this.S?(rt(h,"$req",c),rt(h,"SID","null"),A.U=!0,Si(A,h,null)):Si(A,h,c),this.I=2}}else this.I==3&&(o?lu(this,o):this.i.length==0||$a(this.h)||lu(this))};function lu(o,c){var h;c?h=c.l:h=o.V++;const m=qt(o.J);rt(m,"SID",o.M),rt(m,"RID",h),rt(m,"AID",o.K),Zn(o,m),o.u&&o.o&&ki(m,o.u,o.o),h=new ne(o,o.j,h,o.D+1),o.u===null&&(h.J=o.o),c&&(o.i=c.G.concat(o.i)),c=hu(o,h,1e3),h.H=Math.round(o.va*.5)+Math.round(o.va*.5*Math.random()),Di(o.h,h),Si(h,m,c)}function Zn(o,c){o.H&&Hr(o.H,function(h,m){rt(c,m,h)}),o.l&&Hr({},function(h,m){rt(c,m,h)})}function hu(o,c,h){h=Math.min(o.i.length,h);const m=o.l?d(o.l.Ka,o.l,o):null;t:{var A=o.i;let z=-1;for(;;){const ft=["count="+h];z==-1?h>0?(z=A[0].g,ft.push("ofs="+z)):z=0:ft.push("ofs="+z);let nt=!0;for(let pt=0;pt<h;pt++){var R=A[pt].g;const jt=A[pt].map;if(R-=z,R<0)z=Math.max(0,A[pt].g-100),nt=!1;else try{R="req"+R+"_"||"";try{var D=jt instanceof Map?jt:Object.entries(jt);for(const[De,oe]of D){let ae=oe;u(oe)&&(ae=wi(oe)),ft.push(R+De+"="+encodeURIComponent(ae))}}catch(De){throw ft.push(R+"type="+encodeURIComponent("_badmap")),De}}catch{m&&m(jt)}}if(nt){D=ft.join("&");break t}}D=void 0}return o=o.i.splice(0,h),c.G=o,D}function du(o){if(!o.g&&!o.v){o.Y=1;var c=o.Da;et||g(),Q||(et(),Q=!0),E.add(c,o),o.A=0}}function Oi(o){return o.g||o.v||o.A>=3?!1:(o.Y++,o.v=qn(d(o.Da,o),pu(o,o.A)),o.A++,!0)}r.Da=function(){if(this.v=null,fu(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var o=4*this.T;this.j.info("BP detection timer enabled: "+o),this.B=qn(d(this.Wa,this),o)}},r.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,bt(10),ns(this),fu(this))};function Fi(o){o.B!=null&&(a.clearTimeout(o.B),o.B=null)}function fu(o){o.g=new ne(o,o.j,"rpc",o.Y),o.u===null&&(o.g.J=o.o),o.g.P=0;var c=qt(o.na);rt(c,"RID","rpc"),rt(c,"SID",o.M),rt(c,"AID",o.K),rt(c,"CI",o.F?"0":"1"),!o.F&&o.ia&&rt(c,"TO",o.ia),rt(c,"TYPE","xmlhttp"),Zn(o,c),o.u&&o.o&&ki(c,o.u,o.o),o.O&&(o.g.H=o.O);var h=o.g;o=o.ba,h.M=1,h.A=Zr(qt(c)),h.u=null,h.R=!0,qa(h,o)}r.Va=function(){this.C!=null&&(this.C=null,ns(this),Oi(this),bt(19))};function ss(o){o.C!=null&&(a.clearTimeout(o.C),o.C=null)}function mu(o,c){var h=null;if(o.g==c){ss(o),Fi(o),o.g=null;var m=2}else if(Ci(o.h,c))h=c.G,Ha(o.h,c),m=1;else return;if(o.I!=0){if(c.o)if(m==1){h=c.u?c.u.length:0,c=Date.now()-c.F;var A=o.D;m=Yr(),At(m,new Oa(m,h)),rs(o)}else du(o);else if(A=c.m,A==3||A==0&&c.X>0||!(m==1&&pf(o,c)||m==2&&Oi(o)))switch(h&&h.length>0&&(c=o.h,c.i=c.i.concat(h)),A){case 1:Ce(o,5);break;case 4:Ce(o,10);break;case 3:Ce(o,6);break;default:Ce(o,2)}}}function pu(o,c){let h=o.Qa+Math.floor(Math.random()*o.Za);return o.isActive()||(h*=2),h*c}function Ce(o,c){if(o.j.info("Error code "+c),c==2){var h=d(o.bb,o),m=o.Ua;const A=!m;m=new re(m||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||$n(m,"https"),Zr(m),A?cf(m.toString(),h):lf(m.toString(),h)}else bt(2);o.I=0,o.l&&o.l.pa(c),gu(o),cu(o)}r.bb=function(o){o?(this.j.info("Successfully pinged google.com"),bt(2)):(this.j.info("Failed to ping google.com"),bt(1))};function gu(o){if(o.I=0,o.ja=[],o.l){const c=Wa(o.h);(c.length!=0||o.i.length!=0)&&(C(o.ja,c),C(o.ja,o.i),o.h.i.length=0,S(o.i),o.i.length=0),o.l.oa()}}function _u(o,c,h){var m=h instanceof re?qt(h):new re(h);if(m.g!="")c&&(m.g=c+"."+m.g),Kn(m,m.u);else{var A=a.location;m=A.protocol,c=c?c+"."+A.hostname:A.hostname,A=+A.port;const R=new re(null);m&&$n(R,m),c&&(R.g=c),A&&Kn(R,A),h&&(R.h=h),m=R}return h=o.G,c=o.wa,h&&c&&rt(m,h,c),rt(m,"VER",o.ka),Zn(o,m),m}function yu(o,c,h){if(c&&!o.L)throw Error("Can't create secondary domain capable XhrIo object.");return c=o.Aa&&!o.ma?new at(new Ni({ab:h})):new at(o.ma),c.Fa(o.L),c}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function Iu(){}r=Iu.prototype,r.ra=function(){},r.qa=function(){},r.pa=function(){},r.oa=function(){},r.isActive=function(){return!0},r.Ka=function(){};function is(){}is.prototype.g=function(o,c){return new Dt(o,c)};function Dt(o,c){It.call(this),this.g=new uu(c),this.l=o,this.h=c&&c.messageUrlParams||null,o=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(o?o["X-WebChannel-Content-Type"]=c.messageContentType:o={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.sa&&(o?o["X-WebChannel-Client-Profile"]=c.sa:o={"X-WebChannel-Client-Profile":c.sa}),this.g.U=o,(o=c&&c.Qb)&&!_(o)&&(this.g.u=o),this.A=c&&c.supportsCrossDomainXhr||!1,this.v=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!_(c)&&(this.g.G=c,o=this.h,o!==null&&c in o&&(o=this.h,c in o&&delete o[c])),this.j=new nn(this)}p(Dt,It),Dt.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Dt.prototype.close=function(){Mi(this.g)},Dt.prototype.o=function(o){var c=this.g;if(typeof o=="string"){var h={};h.__data__=o,o=h}else this.v&&(h={},h.__data__=wi(o),o=h);c.i.push(new tf(c.Ya++,o)),c.I==3&&rs(c)},Dt.prototype.N=function(){this.g.l=null,delete this.j,Mi(this.g),delete this.g,Dt.Z.N.call(this)};function Eu(o){vi.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var c=o.__sm__;if(c){t:{for(const h in c){o=h;break t}o=void 0}(this.i=o)&&(o=this.i,c=c!==null&&o in c?c[o]:void 0),this.data=c}else this.data=o}p(Eu,vi);function Tu(){Ai.call(this),this.status=1}p(Tu,Ai);function nn(o){this.g=o}p(nn,Iu),nn.prototype.ra=function(){At(this.g,"a")},nn.prototype.qa=function(o){At(this.g,new Eu(o))},nn.prototype.pa=function(o){At(this.g,new Tu)},nn.prototype.oa=function(){At(this.g,"b")},is.prototype.createWebChannel=is.prototype.g,Dt.prototype.send=Dt.prototype.o,Dt.prototype.open=Dt.prototype.m,Dt.prototype.close=Dt.prototype.close,Tl=function(){return new is},El=function(){return Yr()},Il=Se,eo={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Jr.NO_ERROR=0,Jr.TIMEOUT=8,Jr.HTTP_ERROR=6,ms=Jr,Fa.COMPLETE="complete",yl=Fa,xa.EventType=Bn,Bn.OPEN="a",Bn.CLOSE="b",Bn.ERROR="c",Bn.MESSAGE="d",It.prototype.listen=It.prototype.J,or=xa,at.prototype.listenOnce=at.prototype.K,at.prototype.getLastError=at.prototype.Ha,at.prototype.getLastErrorCode=at.prototype.ya,at.prototype.getStatus=at.prototype.ca,at.prototype.getResponseJson=at.prototype.La,at.prototype.getResponseText=at.prototype.la,at.prototype.send=at.prototype.ea,at.prototype.setWithCredentials=at.prototype.Fa,_l=at}).apply(typeof as<"u"?as:typeof self<"u"?self:typeof window<"u"?window:{});class _t{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}_t.UNAUTHENTICATED=new _t(null),_t.GOOGLE_CREDENTIALS=new _t("google-credentials-uid"),_t.FIRST_PARTY=new _t("first-party-uid"),_t.MOCK_USER=new _t("mock-user");let kn="12.9.0";function Jm(r){kn=r}const $e=new hl("@firebase/firestore");function ln(){return $e.logLevel}function V(r,...t){if($e.logLevel<=W.DEBUG){const e=t.map(Do);$e.debug(`Firestore (${kn}): ${r}`,...e)}}function Rt(r,...t){if($e.logLevel<=W.ERROR){const e=t.map(Do);$e.error(`Firestore (${kn}): ${r}`,...e)}}function ye(r,...t){if($e.logLevel<=W.WARN){const e=t.map(Do);$e.warn(`Firestore (${kn}): ${r}`,...e)}}function Do(r){if(typeof r=="string")return r;try{return(function(e){return JSON.stringify(e)})(r)}catch{return r}}function O(r,t,e){let n="Unexpected state";typeof t=="string"?n=t:e=t,wl(r,n,e)}function wl(r,t,e){let n=`FIRESTORE (${kn}) INTERNAL ASSERTION FAILED: ${t} (ID: ${r.toString(16)})`;if(e!==void 0)try{n+=" CONTEXT: "+JSON.stringify(e)}catch{n+=" CONTEXT: "+e}throw Rt(n),new Error(n)}function F(r,t,e,n){let s="Unexpected state";typeof e=="string"?s=e:n=e,r||wl(t,s,n)}function j(r,t){return r}const P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class x extends Nn{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Yt{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class vl{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class Xm{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(_t.UNAUTHENTICATED)))}shutdown(){}}class Zm{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class tp{constructor(t){this.t=t,this.currentUser=_t.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){F(this.o===void 0,42304);let n=this.i;const s=l=>this.i!==n?(n=this.i,e(l)):Promise.resolve();let i=new Yt;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Yt,t.enqueueRetryable((()=>s(this.currentUser)))};const a=()=>{const l=i;t.enqueueRetryable((async()=>{await l.promise,await s(this.currentUser)}))},u=l=>{V("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((l=>u(l))),setTimeout((()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?u(l):(V("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Yt)}}),0),a()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((n=>this.i!==t?(V("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(F(typeof n.accessToken=="string",31837,{l:n}),new vl(n.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return F(t===null||typeof t=="string",2055,{h:t}),new _t(t)}}class ep{constructor(t,e,n){this.P=t,this.T=e,this.I=n,this.type="FirstParty",this.user=_t.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);const t=this.A();return t&&this.R.set("Authorization",t),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class np{constructor(t,e,n){this.P=t,this.T=e,this.I=n}getToken(){return Promise.resolve(new ep(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable((()=>e(_t.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class ku{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class rp{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Nm(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){F(this.o===void 0,3512);const n=i=>{i.error!=null&&V("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const a=i.token!==this.m;return this.m=i.token,V("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?e(i.token):Promise.resolve()};this.o=i=>{t.enqueueRetryable((()=>n(i)))};const s=i=>{V("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((i=>s(i))),setTimeout((()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):V("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new ku(this.p));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((e=>e?(F(typeof e.token=="string",44558,{tokenResult:e}),this.m=e.token,new ku(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function sp(r){const t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(r);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let n=0;n<r;n++)e[n]=Math.floor(256*Math.random());return e}class xo{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(4.129032258064516);let n="";for(;n.length<20;){const s=sp(40);for(let i=0;i<s.length;++i)n.length<20&&s[i]<e&&(n+=t.charAt(s[i]%62))}return n}}function q(r,t){return r<t?-1:r>t?1:0}function no(r,t){const e=Math.min(r.length,t.length);for(let n=0;n<e;n++){const s=r.charAt(n),i=t.charAt(n);if(s!==i)return zi(s)===zi(i)?q(s,i):zi(s)?1:-1}return q(r.length,t.length)}const ip=55296,op=57343;function zi(r){const t=r.charCodeAt(0);return t>=ip&&t<=op}function In(r,t,e){return r.length===t.length&&r.every(((n,s)=>e(n,t[s])))}function Al(r){return r+"\0"}const Mu="__name__";class zt{constructor(t,e,n){e===void 0?e=0:e>t.length&&O(637,{offset:e,range:t.length}),n===void 0?n=t.length-e:n>t.length-e&&O(1746,{length:n,range:t.length-e}),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return zt.comparator(this,t)===0}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof zt?t.forEach((n=>{e.push(n)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let s=0;s<n;s++){const i=zt.compareSegments(t.get(s),e.get(s));if(i!==0)return i}return q(t.length,e.length)}static compareSegments(t,e){const n=zt.isNumericId(t),s=zt.isNumericId(e);return n&&!s?-1:!n&&s?1:n&&s?zt.extractNumericId(t).compare(zt.extractNumericId(e)):no(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return pe.fromString(t.substring(4,t.length-2))}}class Y extends zt{construct(t,e,n){return new Y(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new x(P.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((s=>s.length>0)))}return new Y(e)}static emptyPath(){return new Y([])}}const ap=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ot extends zt{construct(t,e,n){return new ot(t,e,n)}static isValidIdentifier(t){return ap.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ot.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Mu}static keyField(){return new ot([Mu])}static fromServerFormat(t){const e=[];let n="",s=0;const i=()=>{if(n.length===0)throw new x(P.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let a=!1;for(;s<t.length;){const u=t[s];if(u==="\\"){if(s+1===t.length)throw new x(P.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const l=t[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new x(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=l,s+=2}else u==="`"?(a=!a,s++):u!=="."||a?(n+=u,s++):(i(),s++)}if(i(),a)throw new x(P.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new ot(e)}static emptyPath(){return new ot([])}}class N{constructor(t){this.path=t}static fromPath(t){return new N(Y.fromString(t))}static fromName(t){return new N(Y.fromString(t).popFirst(5))}static empty(){return new N(Y.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&Y.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return Y.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new N(new Y(t.slice()))}}function bl(r,t,e){if(!e)throw new x(P.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${t}.`)}function up(r,t,e,n){if(t===!0&&n===!0)throw new x(P.INVALID_ARGUMENT,`${r} and ${e} cannot be used together.`)}function Ou(r){if(!N.isDocumentKey(r))throw new x(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function Fu(r){if(N.isDocumentKey(r))throw new x(P.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function Rl(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}function Ws(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{const t=(function(n){return n.constructor?n.constructor.name:null})(r);return t?`a custom ${t} object`:"an object"}}return typeof r=="function"?"a function":O(12329,{type:typeof r})}function Ft(r,t){if("_delegate"in r&&(r=r._delegate),!(r instanceof t)){if(t.name===r.constructor.name)throw new x(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const e=Ws(r);throw new x(P.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return r}function ht(r,t){const e={typeString:r};return t&&(e.value=t),e}function Mr(r,t){if(!Rl(r))throw new x(P.INVALID_ARGUMENT,"JSON must be an object");let e;for(const n in t)if(t[n]){const s=t[n].typeString,i="value"in t[n]?{value:t[n].value}:void 0;if(!(n in r)){e=`JSON missing required field: '${n}'`;break}const a=r[n];if(s&&typeof a!==s){e=`JSON field '${n}' must be a ${s}.`;break}if(i!==void 0&&a!==i.value){e=`Expected '${n}' field to equal '${i.value}'`;break}}if(e)throw new x(P.INVALID_ARGUMENT,e);return!0}const Lu=-62135596800,Bu=1e6;class X{static now(){return X.fromMillis(Date.now())}static fromDate(t){return X.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor((t-1e3*e)*Bu);return new X(e,n)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new x(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new x(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<Lu)throw new x(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new x(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Bu}_compareTo(t){return this.seconds===t.seconds?q(this.nanoseconds,t.nanoseconds):q(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:X._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(Mr(t,X._jsonSchema))return new X(t.seconds,t.nanoseconds)}valueOf(){const t=this.seconds-Lu;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}X._jsonSchemaVersion="firestore/timestamp/1.0",X._jsonSchema={type:ht("string",X._jsonSchemaVersion),seconds:ht("number"),nanoseconds:ht("number")};class L{static fromTimestamp(t){return new L(t)}static min(){return new L(new X(0,0))}static max(){return new L(new X(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const wr=-1;class Ds{constructor(t,e,n,s){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=s}}function ro(r){return r.fields.find((t=>t.kind===2))}function ke(r){return r.fields.filter((t=>t.kind!==2))}Ds.UNKNOWN_ID=-1;class ps{constructor(t,e){this.fieldPath=t,this.kind=e}}class vr{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new vr(0,kt.min())}}function cp(r,t){const e=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,s=L.fromTimestamp(n===1e9?new X(e+1,0):new X(e,n));return new kt(s,N.empty(),t)}function Sl(r){return new kt(r.readTime,r.key,wr)}class kt{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new kt(L.min(),N.empty(),wr)}static max(){return new kt(L.max(),N.empty(),wr)}}function No(r,t){let e=r.readTime.compareTo(t.readTime);return e!==0?e:(e=N.comparator(r.documentKey,t.documentKey),e!==0?e:q(r.largestBatchId,t.largestBatchId))}const Pl="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Vl{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function Xe(r){if(r.code!==P.FAILED_PRECONDITION||r.message!==Pl)throw r;V("LocalStore","Unexpectedly lost primary lease")}class v{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&O(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new v(((n,s)=>{this.nextCallback=i=>{this.wrapSuccess(t,i).next(n,s)},this.catchCallback=i=>{this.wrapFailure(e,i).next(n,s)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof v?e:v.resolve(e)}catch(e){return v.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):v.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):v.reject(e)}static resolve(t){return new v(((e,n)=>{e(t)}))}static reject(t){return new v(((e,n)=>{n(t)}))}static waitFor(t){return new v(((e,n)=>{let s=0,i=0,a=!1;t.forEach((u=>{++s,u.next((()=>{++i,a&&i===s&&e()}),(l=>n(l)))})),a=!0,i===s&&e()}))}static or(t){let e=v.resolve(!1);for(const n of t)e=e.next((s=>s?v.resolve(s):n()));return e}static forEach(t,e){const n=[];return t.forEach(((s,i)=>{n.push(e.call(this,s,i))})),this.waitFor(n)}static mapArray(t,e){return new v(((n,s)=>{const i=t.length,a=new Array(i);let u=0;for(let l=0;l<i;l++){const d=l;e(t[d]).next((f=>{a[d]=f,++u,u===i&&n(a)}),(f=>s(f)))}}))}static doWhile(t,e){return new v(((n,s)=>{const i=()=>{t()===!0?e().next((()=>{i()}),s):n()};i()}))}}const xt="SimpleDb";class Qs{static open(t,e,n,s){try{return new Qs(e,t.transaction(s,n))}catch(i){throw new dr(e,i)}}constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.S=new Yt,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{e.error?this.S.reject(new dr(t,e.error)):this.S.resolve()},this.transaction.onerror=n=>{const s=ko(n.target.error);this.S.reject(new dr(t,s))}}get D(){return this.S.promise}abort(t){t&&this.S.reject(t),this.aborted||(V(xt,"Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const t=this.transaction;this.aborted||typeof t.commit!="function"||t.commit()}store(t){const e=this.transaction.objectStore(t);return new hp(e)}}class ge{static delete(t){return V(xt,"Removing database:",t),Oe(sl().indexedDB.deleteDatabase(t)).toPromise()}static v(){if(!cl())return!1;if(ge.F())return!0;const t=Ss(),e=ge.M(t),n=0<e&&e<10,s=Cl(t),i=0<s&&s<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||i)}static F(){return typeof process<"u"&&process.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE==="YES"}static O(t,e){return t.store(e)}static M(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}constructor(t,e,n){this.name=t,this.version=e,this.N=n,this.B=null,ge.M(Ss())===12.2&&Rt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(t){return this.db||(V(xt,"Opening database:",this.name),this.db=await new Promise(((e,n)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const a=i.target.result;e(a)},s.onblocked=()=>{n(new dr(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const a=i.target.error;a.name==="VersionError"?n(new x(P.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?n(new x(P.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):n(new dr(t,a))},s.onupgradeneeded=i=>{V(xt,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const a=i.target.result;this.N.k(a,s.transaction,i.oldVersion,this.version).next((()=>{V(xt,"Database upgrade to version "+this.version+" complete")}))}}))),this.K&&(this.db.onversionchange=e=>this.K(e)),this.db}q(t){this.K=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(t,e,n,s){const i=e==="readonly";let a=0;for(;;){++a;try{this.db=await this.L(t);const u=Qs.open(this.db,t,i?"readonly":"readwrite",n),l=s(u).next((d=>(u.C(),d))).catch((d=>(u.abort(d),v.reject(d)))).toPromise();return l.catch((()=>{})),await u.D,l}catch(u){const l=u,d=l.name!=="FirebaseError"&&a<3;if(V(xt,"Transaction failed with error:",l.message,"Retrying:",d),this.close(),!d)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function Cl(r){const t=r.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}class lp{constructor(t){this.U=t,this.$=!1,this.W=null}get isDone(){return this.$}get G(){return this.W}set cursor(t){this.U=t}done(){this.$=!0}j(t){this.W=t}delete(){return Oe(this.U.delete())}}class dr extends x{constructor(t,e){super(P.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function Ae(r){return r.name==="IndexedDbTransactionError"}class hp{constructor(t){this.store=t}put(t,e){let n;return e!==void 0?(V(xt,"PUT",this.store.name,t,e),n=this.store.put(e,t)):(V(xt,"PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Oe(n)}add(t){return V(xt,"ADD",this.store.name,t,t),Oe(this.store.add(t))}get(t){return Oe(this.store.get(t)).next((e=>(e===void 0&&(e=null),V(xt,"GET",this.store.name,t,e),e)))}delete(t){return V(xt,"DELETE",this.store.name,t),Oe(this.store.delete(t))}count(){return V(xt,"COUNT",this.store.name),Oe(this.store.count())}H(t,e){const n=this.options(t,e),s=n.index?this.store.index(n.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(n.range);return new v(((a,u)=>{i.onerror=l=>{u(l.target.error)},i.onsuccess=l=>{a(l.target.result)}}))}{const i=this.cursor(n),a=[];return this.J(i,((u,l)=>{a.push(l)})).next((()=>a))}}Z(t,e){const n=this.store.getAll(t,e===null?void 0:e);return new v(((s,i)=>{n.onerror=a=>{i(a.target.error)},n.onsuccess=a=>{s(a.target.result)}}))}X(t,e){V(xt,"DELETE ALL",this.store.name);const n=this.options(t,e);n.Y=!1;const s=this.cursor(n);return this.J(s,((i,a,u)=>u.delete()))}ee(t,e){let n;e?n=t:(n={},e=t);const s=this.cursor(n);return this.J(s,e)}te(t){const e=this.cursor({});return new v(((n,s)=>{e.onerror=i=>{const a=ko(i.target.error);s(a)},e.onsuccess=i=>{const a=i.target.result;a?t(a.primaryKey,a.value).next((u=>{u?a.continue():n()})):n()}}))}J(t,e){const n=[];return new v(((s,i)=>{t.onerror=a=>{i(a.target.error)},t.onsuccess=a=>{const u=a.target.result;if(!u)return void s();const l=new lp(u),d=e(u.primaryKey,u.value,l);if(d instanceof v){const f=d.catch((p=>(l.done(),v.reject(p))));n.push(f)}l.isDone?s():l.G===null?u.continue():u.continue(l.G)}})).next((()=>v.waitFor(n)))}options(t,e){let n;return t!==void 0&&(typeof t=="string"?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.Y?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function Oe(r){return new v(((t,e)=>{r.onsuccess=n=>{const s=n.target.result;t(s)},r.onerror=n=>{const s=ko(n.target.error);e(s)}}))}let Uu=!1;function ko(r){const t=ge.M(Ss());if(t>=12.2&&t<13){const e="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(e)>=0){const n=new x("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Uu||(Uu=!0,setTimeout((()=>{throw n}),0)),n}}return r}const fr="IndexBackfiller";class dp{constructor(t,e){this.asyncQueue=t,this.ne=e,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(t){V(fr,`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,(async()=>{this.task=null;try{const e=await this.ne.ie();V(fr,`Documents written: ${e}`)}catch(e){Ae(e)?V(fr,"Ignoring IndexedDB error during index backfill: ",e):await Xe(e)}await this.re(6e4)}))}}class fp{constructor(t,e){this.localStore=t,this.persistence=e}async ie(t=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(e=>this.se(e,t)))}se(t,e){const n=new Set;let s=e,i=!0;return v.doWhile((()=>i===!0&&s>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next((a=>{if(a!==null&&!n.has(a))return V(fr,`Processing collection: ${a}`),this.oe(t,a,s).next((u=>{s-=u,n.add(a)}));i=!1})))).next((()=>e-s))}oe(t,e,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next((s=>this.localStore.localDocuments.getNextDocuments(t,e,s,n).next((i=>{const a=i.changes;return this.localStore.indexManager.updateIndexEntries(t,a).next((()=>this._e(s,i))).next((u=>(V(fr,`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(t,e,u)))).next((()=>a.size))}))))}_e(t,e){let n=t;return e.changes.forEach(((s,i)=>{const a=Sl(i);No(a,n)>0&&(n=a)})),new kt(n.readTime,n.documentKey,Math.max(e.batchId,t.largestBatchId))}}class Ot{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=n=>this.ae(n),this.ue=n=>e.writeSequenceNumber(n))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ue&&this.ue(t),t}}Ot.ce=-1;const qe=-1;function Ys(r){return r==null}function Ar(r){return r===0&&1/r==-1/0}function mp(r){return typeof r=="number"&&Number.isInteger(r)&&!Ar(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}const xs="";function vt(r){let t="";for(let e=0;e<r.length;e++)t.length>0&&(t=qu(t)),t=pp(r.get(e),t);return qu(t)}function pp(r,t){let e=t;const n=r.length;for(let s=0;s<n;s++){const i=r.charAt(s);switch(i){case"\0":e+="";break;case xs:e+="";break;default:e+=i}}return e}function qu(r){return r+xs+""}function Gt(r){const t=r.length;if(F(t>=2,64408,{path:r}),t===2)return F(r.charAt(0)===xs&&r.charAt(1)==="",56145,{path:r}),Y.emptyPath();const e=t-2,n=[];let s="";for(let i=0;i<t;){const a=r.indexOf(xs,i);switch((a<0||a>e)&&O(50515,{path:r}),r.charAt(a+1)){case"":const u=r.substring(i,a);let l;s.length===0?l=u:(s+=u,l=s,s=""),n.push(l);break;case"":s+=r.substring(i,a),s+="\0";break;case"":s+=r.substring(i,a+1);break;default:O(61167,{path:r})}i=a+2}return new Y(n)}const Me="remoteDocuments",Or="owner",rn="owner",br="mutationQueues",gp="userId",Bt="mutations",ju="batchId",Ue="userMutationsIndex",zu=["userId","batchId"];function gs(r,t){return[r,vt(t)]}function Dl(r,t,e){return[r,vt(t),e]}const _p={},En="documentMutations",Ns="remoteDocumentsV14",yp=["prefixPath","collectionGroup","readTime","documentId"],_s="documentKeyIndex",Ip=["prefixPath","collectionGroup","documentId"],xl="collectionGroupIndex",Ep=["collectionGroup","readTime","prefixPath","documentId"],Rr="remoteDocumentGlobal",so="remoteDocumentGlobalKey",Tn="targets",Nl="queryTargetsIndex",Tp=["canonicalId","targetId"],wn="targetDocuments",wp=["targetId","path"],Mo="documentTargetsIndex",vp=["path","targetId"],ks="targetGlobalKey",je="targetGlobal",Sr="collectionParents",Ap=["collectionId","parent"],vn="clientMetadata",bp="clientId",Js="bundles",Rp="bundleId",Xs="namedQueries",Sp="name",Oo="indexConfiguration",Pp="indexId",io="collectionGroupIndex",Vp="collectionGroup",mr="indexState",Cp=["indexId","uid"],kl="sequenceNumberIndex",Dp=["uid","sequenceNumber"],pr="indexEntries",xp=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Ml="documentKeyIndex",Np=["indexId","uid","orderedDocumentKey"],Zs="documentOverlays",kp=["userId","collectionPath","documentId"],oo="collectionPathOverlayIndex",Mp=["userId","collectionPath","largestBatchId"],Ol="collectionGroupOverlayIndex",Op=["userId","collectionGroup","largestBatchId"],Fo="globals",Fp="name",Fl=[br,Bt,En,Me,Tn,Or,je,wn,vn,Rr,Sr,Js,Xs],Lp=[...Fl,Zs],Ll=[br,Bt,En,Ns,Tn,Or,je,wn,vn,Rr,Sr,Js,Xs,Zs],Bl=Ll,Lo=[...Bl,Oo,mr,pr],Bp=Lo,Ul=[...Lo,Fo],Up=Ul;class ao extends Vl{constructor(t,e){super(),this.le=t,this.currentSequenceNumber=e}}function mt(r,t){const e=j(r);return ge.O(e.le,t)}function Gu(r){let t=0;for(const e in r)Object.prototype.hasOwnProperty.call(r,e)&&t++;return t}function be(r,t){for(const e in r)Object.prototype.hasOwnProperty.call(r,e)&&t(e,r[e])}function ql(r){for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}class it{constructor(t,e){this.comparator=t,this.root=e||yt.EMPTY}insert(t,e){return new it(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,yt.BLACK,null,null))}remove(t){return new it(this.comparator,this.root.remove(t,this.comparator).copy(null,null,yt.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(n===0)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(t,n.key);if(s===0)return e+n.left.size;s<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new us(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new us(this.root,t,this.comparator,!1)}getReverseIterator(){return new us(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new us(this.root,t,this.comparator,!0)}}class us{constructor(t,e,n,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,e&&s&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(i===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class yt{constructor(t,e,n,s,i){this.key=t,this.value=e,this.color=n??yt.RED,this.left=s??yt.EMPTY,this.right=i??yt.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,s,i){return new yt(t??this.key,e??this.value,n??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let s=this;const i=n(t,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(t,e,n),null):i===0?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return yt.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),e(t,s.key)===0){if(s.right.isEmpty())return yt.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,yt.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,yt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw O(43730,{key:this.key,value:this.value});if(this.right.isRed())throw O(14113,{key:this.key,value:this.value});const t=this.left.check();if(t!==this.right.check())throw O(27949);return t+(this.isRed()?0:1)}}yt.EMPTY=null,yt.RED=!0,yt.BLACK=!1;yt.EMPTY=new class{constructor(){this.size=0}get key(){throw O(57766)}get value(){throw O(16141)}get color(){throw O(16727)}get left(){throw O(29726)}get right(){throw O(36894)}copy(t,e,n,s,i){return this}insert(t,e,n){return new yt(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class tt{constructor(t){this.comparator=t,this.data=new it(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let n;for(n=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new $u(this.data.getIterator())}getIteratorFrom(t){return new $u(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((n=>{e=e.add(n)})),e}isEqual(t){if(!(t instanceof tt)||this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const s=e.getNext().key,i=n.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new tt(this.comparator);return e.data=t,e}}class $u{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function sn(r){return r.hasNext()?r.getNext():void 0}class Ct{constructor(t){this.fields=t,t.sort(ot.comparator)}static empty(){return new Ct([])}unionWith(t){let e=new tt(ot.comparator);for(const n of this.fields)e=e.add(n);for(const n of t)e=e.add(n);return new Ct(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return In(this.fields,t.fields,((e,n)=>e.isEqual(n)))}}class jl extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class dt{constructor(t){this.binaryString=t}static fromBase64String(t){const e=(function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new jl("Invalid base64 string: "+i):i}})(t);return new dt(e)}static fromUint8Array(t){const e=(function(s){let i="";for(let a=0;a<s.length;++a)i+=String.fromCharCode(s[a]);return i})(t);return new dt(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(e){return btoa(e)})(this.binaryString)}toUint8Array(){return(function(e){const n=new Uint8Array(e.length);for(let s=0;s<e.length;s++)n[s]=e.charCodeAt(s);return n})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return q(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}dt.EMPTY_BYTE_STRING=new dt("");const qp=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Xt(r){if(F(!!r,39018),typeof r=="string"){let t=0;const e=qp.exec(r);if(F(!!e,46558,{timestamp:r}),e[1]){let s=e[1];s=(s+"000000000").substr(0,9),t=Number(s)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:t}}return{seconds:st(r.seconds),nanos:st(r.nanos)}}function st(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function Zt(r){return typeof r=="string"?dt.fromBase64String(r):dt.fromUint8Array(r)}const zl="server_timestamp",Gl="__type__",$l="__previous_value__",Kl="__local_write_time__";function Bo(r){return(r?.mapValue?.fields||{})[Gl]?.stringValue===zl}function ti(r){const t=r.mapValue.fields[$l];return Bo(t)?ti(t):t}function Pr(r){const t=Xt(r.mapValue.fields[Kl].timestampValue);return new X(t.seconds,t.nanos)}class jp{constructor(t,e,n,s,i,a,u,l,d,f,p){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=s,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=l,this.useFetchStreams=d,this.isUsingEmulator=f,this.apiKey=p}}const Ms="(default)";class Ke{constructor(t,e){this.projectId=t,this.database=e||Ms}static empty(){return new Ke("","")}get isDefaultDatabase(){return this.database===Ms}isEqual(t){return t instanceof Ke&&t.projectId===this.projectId&&t.database===this.database}}function zp(r,t){if(!Object.prototype.hasOwnProperty.apply(r.options,["projectId"]))throw new x(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ke(r.options.projectId,t)}const Uo="__type__",Hl="__max__",de={mapValue:{fields:{__type__:{stringValue:Hl}}}},qo="__vector__",An="value",ys={nullValue:"NULL_VALUE"};function Ie(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?Bo(r)?4:Wl(r)?9007199254740991:ei(r)?10:11:O(28295,{value:r})}function Wt(r,t){if(r===t)return!0;const e=Ie(r);if(e!==Ie(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===t.booleanValue;case 4:return Pr(r).isEqual(Pr(t));case 3:return(function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const a=Xt(s.timestampValue),u=Xt(i.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos})(r,t);case 5:return r.stringValue===t.stringValue;case 6:return(function(s,i){return Zt(s.bytesValue).isEqual(Zt(i.bytesValue))})(r,t);case 7:return r.referenceValue===t.referenceValue;case 8:return(function(s,i){return st(s.geoPointValue.latitude)===st(i.geoPointValue.latitude)&&st(s.geoPointValue.longitude)===st(i.geoPointValue.longitude)})(r,t);case 2:return(function(s,i){if("integerValue"in s&&"integerValue"in i)return st(s.integerValue)===st(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const a=st(s.doubleValue),u=st(i.doubleValue);return a===u?Ar(a)===Ar(u):isNaN(a)&&isNaN(u)}return!1})(r,t);case 9:return In(r.arrayValue.values||[],t.arrayValue.values||[],Wt);case 10:case 11:return(function(s,i){const a=s.mapValue.fields||{},u=i.mapValue.fields||{};if(Gu(a)!==Gu(u))return!1;for(const l in a)if(a.hasOwnProperty(l)&&(u[l]===void 0||!Wt(a[l],u[l])))return!1;return!0})(r,t);default:return O(52216,{left:r})}}function Vr(r,t){return(r.values||[]).find((e=>Wt(e,t)))!==void 0}function Ee(r,t){if(r===t)return 0;const e=Ie(r),n=Ie(t);if(e!==n)return q(e,n);switch(e){case 0:case 9007199254740991:return 0;case 1:return q(r.booleanValue,t.booleanValue);case 2:return(function(i,a){const u=st(i.integerValue||i.doubleValue),l=st(a.integerValue||a.doubleValue);return u<l?-1:u>l?1:u===l?0:isNaN(u)?isNaN(l)?0:-1:1})(r,t);case 3:return Ku(r.timestampValue,t.timestampValue);case 4:return Ku(Pr(r),Pr(t));case 5:return no(r.stringValue,t.stringValue);case 6:return(function(i,a){const u=Zt(i),l=Zt(a);return u.compareTo(l)})(r.bytesValue,t.bytesValue);case 7:return(function(i,a){const u=i.split("/"),l=a.split("/");for(let d=0;d<u.length&&d<l.length;d++){const f=q(u[d],l[d]);if(f!==0)return f}return q(u.length,l.length)})(r.referenceValue,t.referenceValue);case 8:return(function(i,a){const u=q(st(i.latitude),st(a.latitude));return u!==0?u:q(st(i.longitude),st(a.longitude))})(r.geoPointValue,t.geoPointValue);case 9:return Hu(r.arrayValue,t.arrayValue);case 10:return(function(i,a){const u=i.fields||{},l=a.fields||{},d=u[An]?.arrayValue,f=l[An]?.arrayValue,p=q(d?.values?.length||0,f?.values?.length||0);return p!==0?p:Hu(d,f)})(r.mapValue,t.mapValue);case 11:return(function(i,a){if(i===de.mapValue&&a===de.mapValue)return 0;if(i===de.mapValue)return 1;if(a===de.mapValue)return-1;const u=i.fields||{},l=Object.keys(u),d=a.fields||{},f=Object.keys(d);l.sort(),f.sort();for(let p=0;p<l.length&&p<f.length;++p){const I=no(l[p],f[p]);if(I!==0)return I;const S=Ee(u[l[p]],d[f[p]]);if(S!==0)return S}return q(l.length,f.length)})(r.mapValue,t.mapValue);default:throw O(23264,{he:e})}}function Ku(r,t){if(typeof r=="string"&&typeof t=="string"&&r.length===t.length)return q(r,t);const e=Xt(r),n=Xt(t),s=q(e.seconds,n.seconds);return s!==0?s:q(e.nanos,n.nanos)}function Hu(r,t){const e=r.values||[],n=t.values||[];for(let s=0;s<e.length&&s<n.length;++s){const i=Ee(e[s],n[s]);if(i)return i}return q(e.length,n.length)}function bn(r){return uo(r)}function uo(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?(function(e){const n=Xt(e);return`time(${n.seconds},${n.nanos})`})(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?(function(e){return Zt(e).toBase64()})(r.bytesValue):"referenceValue"in r?(function(e){return N.fromName(e).toString()})(r.referenceValue):"geoPointValue"in r?(function(e){return`geo(${e.latitude},${e.longitude})`})(r.geoPointValue):"arrayValue"in r?(function(e){let n="[",s=!0;for(const i of e.values||[])s?s=!1:n+=",",n+=uo(i);return n+"]"})(r.arrayValue):"mapValue"in r?(function(e){const n=Object.keys(e.fields||{}).sort();let s="{",i=!0;for(const a of n)i?i=!1:s+=",",s+=`${a}:${uo(e.fields[a])}`;return s+"}"})(r.mapValue):O(61005,{value:r})}function Is(r){switch(Ie(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=ti(r);return t?16+Is(t):16;case 5:return 2*r.stringValue.length;case 6:return Zt(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return(function(n){return(n.values||[]).reduce(((s,i)=>s+Is(i)),0)})(r.arrayValue);case 10:case 11:return(function(n){let s=0;return be(n.fields,((i,a)=>{s+=i.length+Is(a)})),s})(r.mapValue);default:throw O(13486,{value:r})}}function Cr(r,t){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${t.path.canonicalString()}`}}function co(r){return!!r&&"integerValue"in r}function Dr(r){return!!r&&"arrayValue"in r}function Wu(r){return!!r&&"nullValue"in r}function Qu(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function Es(r){return!!r&&"mapValue"in r}function ei(r){return(r?.mapValue?.fields||{})[Uo]?.stringValue===qo}function gr(r){if(r.geoPointValue)return{geoPointValue:{...r.geoPointValue}};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:{...r.timestampValue}};if(r.mapValue){const t={mapValue:{fields:{}}};return be(r.mapValue.fields,((e,n)=>t.mapValue.fields[e]=gr(n))),t}if(r.arrayValue){const t={arrayValue:{values:[]}};for(let e=0;e<(r.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=gr(r.arrayValue.values[e]);return t}return{...r}}function Wl(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue===Hl}const Ql={mapValue:{fields:{[Uo]:{stringValue:qo},[An]:{arrayValue:{}}}}};function Gp(r){return"nullValue"in r?ys:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?Cr(Ke.empty(),N.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?ei(r)?Ql:{mapValue:{}}:O(35942,{value:r})}function $p(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?Cr(Ke.empty(),N.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?Ql:"mapValue"in r?ei(r)?{mapValue:{}}:de:O(61959,{value:r})}function Yu(r,t){const e=Ee(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?-1:!r.inclusive&&t.inclusive?1:0}function Ju(r,t){const e=Ee(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?1:!r.inclusive&&t.inclusive?-1:0}class wt{constructor(t){this.value=t}static empty(){return new wt({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Es(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=gr(e)}setAll(t){let e=ot.emptyPath(),n={},s=[];t.forEach(((a,u)=>{if(!e.isImmediateParentOf(u)){const l=this.getFieldsMap(e);this.applyChanges(l,n,s),n={},s=[],e=u.popLast()}a?n[u.lastSegment()]=gr(a):s.push(u.lastSegment())}));const i=this.getFieldsMap(e);this.applyChanges(i,n,s)}delete(t){const e=this.field(t.popLast());Es(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Wt(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let s=e.mapValue.fields[t.get(n)];Es(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,n){be(e,((s,i)=>t[s]=i));for(const s of n)delete t[s]}clone(){return new wt(gr(this.value))}}function Yl(r){const t=[];return be(r.fields,((e,n)=>{const s=new ot([e]);if(Es(n)){const i=Yl(n.mapValue).fields;if(i.length===0)t.push(s);else for(const a of i)t.push(s.child(a))}else t.push(s)})),new Ct(t)}class ut{constructor(t,e,n,s,i,a,u){this.key=t,this.documentType=e,this.version=n,this.readTime=s,this.createTime=i,this.data=a,this.documentState=u}static newInvalidDocument(t){return new ut(t,0,L.min(),L.min(),L.min(),wt.empty(),0)}static newFoundDocument(t,e,n,s){return new ut(t,1,e,L.min(),n,s,0)}static newNoDocument(t,e){return new ut(t,2,e,L.min(),L.min(),wt.empty(),0)}static newUnknownDocument(t,e){return new ut(t,3,e,L.min(),L.min(),wt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(L.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=wt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=wt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=L.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof ut&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new ut(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Rn{constructor(t,e){this.position=t,this.inclusive=e}}function Xu(r,t,e){let n=0;for(let s=0;s<r.position.length;s++){const i=t[s],a=r.position[s];if(i.field.isKeyField()?n=N.comparator(N.fromName(a.referenceValue),e.key):n=Ee(a,e.data.field(i.field)),i.dir==="desc"&&(n*=-1),n!==0)break}return n}function Zu(r,t){if(r===null)return t===null;if(t===null||r.inclusive!==t.inclusive||r.position.length!==t.position.length)return!1;for(let e=0;e<r.position.length;e++)if(!Wt(r.position[e],t.position[e]))return!1;return!0}class Os{constructor(t,e="asc"){this.field=t,this.dir=e}}function Kp(r,t){return r.dir===t.dir&&r.field.isEqual(t.field)}class Jl{}class K extends Jl{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,n):new Hp(t,e,n):e==="array-contains"?new Yp(t,n):e==="in"?new rh(t,n):e==="not-in"?new Jp(t,n):e==="array-contains-any"?new Xp(t,n):new K(t,e,n)}static createKeyFieldInFilter(t,e,n){return e==="in"?new Wp(t,n):new Qp(t,n)}matches(t){const e=t.data.field(this.field);return this.op==="!="?e!==null&&e.nullValue===void 0&&this.matchesComparison(Ee(e,this.value)):e!==null&&Ie(this.value)===Ie(e)&&this.matchesComparison(Ee(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return O(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Z extends Jl{constructor(t,e){super(),this.filters=t,this.op=e,this.Pe=null}static create(t,e){return new Z(t,e)}matches(t){return Sn(this)?this.filters.find((e=>!e.matches(t)))===void 0:this.filters.find((e=>e.matches(t)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Sn(r){return r.op==="and"}function lo(r){return r.op==="or"}function jo(r){return Xl(r)&&Sn(r)}function Xl(r){for(const t of r.filters)if(t instanceof Z)return!1;return!0}function ho(r){if(r instanceof K)return r.field.canonicalString()+r.op.toString()+bn(r.value);if(jo(r))return r.filters.map((t=>ho(t))).join(",");{const t=r.filters.map((e=>ho(e))).join(",");return`${r.op}(${t})`}}function Zl(r,t){return r instanceof K?(function(n,s){return s instanceof K&&n.op===s.op&&n.field.isEqual(s.field)&&Wt(n.value,s.value)})(r,t):r instanceof Z?(function(n,s){return s instanceof Z&&n.op===s.op&&n.filters.length===s.filters.length?n.filters.reduce(((i,a,u)=>i&&Zl(a,s.filters[u])),!0):!1})(r,t):void O(19439)}function th(r,t){const e=r.filters.concat(t);return Z.create(e,r.op)}function eh(r){return r instanceof K?(function(e){return`${e.field.canonicalString()} ${e.op} ${bn(e.value)}`})(r):r instanceof Z?(function(e){return e.op.toString()+" {"+e.getFilters().map(eh).join(" ,")+"}"})(r):"Filter"}class Hp extends K{constructor(t,e,n){super(t,e,n),this.key=N.fromName(n.referenceValue)}matches(t){const e=N.comparator(t.key,this.key);return this.matchesComparison(e)}}class Wp extends K{constructor(t,e){super(t,"in",e),this.keys=nh("in",e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class Qp extends K{constructor(t,e){super(t,"not-in",e),this.keys=nh("not-in",e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function nh(r,t){return(t.arrayValue?.values||[]).map((e=>N.fromName(e.referenceValue)))}class Yp extends K{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Dr(e)&&Vr(e.arrayValue,this.value)}}class rh extends K{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return e!==null&&Vr(this.value.arrayValue,e)}}class Jp extends K{constructor(t,e){super(t,"not-in",e)}matches(t){if(Vr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return e!==null&&e.nullValue===void 0&&!Vr(this.value.arrayValue,e)}}class Xp extends K{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Dr(e)||!e.arrayValue.values)&&e.arrayValue.values.some((n=>Vr(this.value.arrayValue,n)))}}class Zp{constructor(t,e=null,n=[],s=[],i=null,a=null,u=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=a,this.endAt=u,this.Te=null}}function fo(r,t=null,e=[],n=[],s=null,i=null,a=null){return new Zp(r,t,e,n,s,i,a)}function He(r){const t=j(r);if(t.Te===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((n=>ho(n))).join(","),e+="|ob:",e+=t.orderBy.map((n=>(function(i){return i.field.canonicalString()+i.dir})(n))).join(","),Ys(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((n=>bn(n))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((n=>bn(n))).join(",")),t.Te=e}return t.Te}function Fr(r,t){if(r.limit!==t.limit||r.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<r.orderBy.length;e++)if(!Kp(r.orderBy[e],t.orderBy[e]))return!1;if(r.filters.length!==t.filters.length)return!1;for(let e=0;e<r.filters.length;e++)if(!Zl(r.filters[e],t.filters[e]))return!1;return r.collectionGroup===t.collectionGroup&&!!r.path.isEqual(t.path)&&!!Zu(r.startAt,t.startAt)&&Zu(r.endAt,t.endAt)}function Fs(r){return N.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function Ls(r,t){return r.filters.filter((e=>e instanceof K&&e.field.isEqual(t)))}function tc(r,t,e){let n=ys,s=!0;for(const i of Ls(r,t)){let a=ys,u=!0;switch(i.op){case"<":case"<=":a=Gp(i.value);break;case"==":case"in":case">=":a=i.value;break;case">":a=i.value,u=!1;break;case"!=":case"not-in":a=ys}Yu({value:n,inclusive:s},{value:a,inclusive:u})<0&&(n=a,s=u)}if(e!==null){for(let i=0;i<r.orderBy.length;++i)if(r.orderBy[i].field.isEqual(t)){const a=e.position[i];Yu({value:n,inclusive:s},{value:a,inclusive:e.inclusive})<0&&(n=a,s=e.inclusive);break}}return{value:n,inclusive:s}}function ec(r,t,e){let n=de,s=!0;for(const i of Ls(r,t)){let a=de,u=!0;switch(i.op){case">=":case">":a=$p(i.value),u=!1;break;case"==":case"in":case"<=":a=i.value;break;case"<":a=i.value,u=!1;break;case"!=":case"not-in":a=de}Ju({value:n,inclusive:s},{value:a,inclusive:u})>0&&(n=a,s=u)}if(e!==null){for(let i=0;i<r.orderBy.length;++i)if(r.orderBy[i].field.isEqual(t)){const a=e.position[i];Ju({value:n,inclusive:s},{value:a,inclusive:e.inclusive})>0&&(n=a,s=e.inclusive);break}}return{value:n,inclusive:s}}class Lr{constructor(t,e=null,n=[],s=[],i=null,a="F",u=null,l=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=s,this.limit=i,this.limitType=a,this.startAt=u,this.endAt=l,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function tg(r,t,e,n,s,i,a,u){return new Lr(r,t,e,n,s,i,a,u)}function Br(r){return new Lr(r)}function nc(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function eg(r){return N.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function sh(r){return r.collectionGroup!==null}function _r(r){const t=j(r);if(t.Ie===null){t.Ie=[];const e=new Set;for(const i of t.explicitOrderBy)t.Ie.push(i),e.add(i.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new tt(ot.comparator);return a.filters.forEach((l=>{l.getFlattenedFilters().forEach((d=>{d.isInequality()&&(u=u.add(d.field))}))})),u})(t).forEach((i=>{e.has(i.canonicalString())||i.isKeyField()||t.Ie.push(new Os(i,n))})),e.has(ot.keyField().canonicalString())||t.Ie.push(new Os(ot.keyField(),n))}return t.Ie}function Lt(r){const t=j(r);return t.Ee||(t.Ee=ng(t,_r(r))),t.Ee}function ng(r,t){if(r.limitType==="F")return fo(r.path,r.collectionGroup,t,r.filters,r.limit,r.startAt,r.endAt);{t=t.map((s=>{const i=s.dir==="desc"?"asc":"desc";return new Os(s.field,i)}));const e=r.endAt?new Rn(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new Rn(r.startAt.position,r.startAt.inclusive):null;return fo(r.path,r.collectionGroup,t,r.filters,r.limit,e,n)}}function mo(r,t){const e=r.filters.concat([t]);return new Lr(r.path,r.collectionGroup,r.explicitOrderBy.slice(),e,r.limit,r.limitType,r.startAt,r.endAt)}function po(r,t,e){return new Lr(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),t,e,r.startAt,r.endAt)}function ni(r,t){return Fr(Lt(r),Lt(t))&&r.limitType===t.limitType}function ih(r){return`${He(Lt(r))}|lt:${r.limitType}`}function hn(r){return`Query(target=${(function(e){let n=e.path.canonicalString();return e.collectionGroup!==null&&(n+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(n+=`, filters: [${e.filters.map((s=>eh(s))).join(", ")}]`),Ys(e.limit)||(n+=", limit: "+e.limit),e.orderBy.length>0&&(n+=`, orderBy: [${e.orderBy.map((s=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(s))).join(", ")}]`),e.startAt&&(n+=", startAt: ",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map((s=>bn(s))).join(",")),e.endAt&&(n+=", endAt: ",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map((s=>bn(s))).join(",")),`Target(${n})`})(Lt(r))}; limitType=${r.limitType})`}function Ur(r,t){return t.isFoundDocument()&&(function(n,s){const i=s.key.path;return n.collectionGroup!==null?s.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):N.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i)})(r,t)&&(function(n,s){for(const i of _r(n))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0})(r,t)&&(function(n,s){for(const i of n.filters)if(!i.matches(s))return!1;return!0})(r,t)&&(function(n,s){return!(n.startAt&&!(function(a,u,l){const d=Xu(a,u,l);return a.inclusive?d<=0:d<0})(n.startAt,_r(n),s)||n.endAt&&!(function(a,u,l){const d=Xu(a,u,l);return a.inclusive?d>=0:d>0})(n.endAt,_r(n),s))})(r,t)}function rg(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function oh(r){return(t,e)=>{let n=!1;for(const s of _r(r)){const i=sg(s,t,e);if(i!==0)return i;n=n||s.field.isKeyField()}return 0}}function sg(r,t,e){const n=r.field.isKeyField()?N.comparator(t.key,e.key):(function(i,a,u){const l=a.data.field(i),d=u.data.field(i);return l!==null&&d!==null?Ee(l,d):O(42886)})(r.field,t,e);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return O(19790,{direction:r.dir})}}class te{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(n!==void 0){for(const[s,i]of n)if(this.equalsFn(s,t))return i}}has(t){return this.get(t)!==void 0}set(t,e){const n=this.mapKeyFn(t),s=this.inner[n];if(s===void 0)return this.inner[n]=[[t,e]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],t))return void(s[i]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(n===void 0)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],t))return n.length===1?delete this.inner[e]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(t){be(this.inner,((e,n)=>{for(const[s,i]of n)t(s,i)}))}isEmpty(){return ql(this.inner)}size(){return this.innerSize}}const ig=new it(N.comparator);function Nt(){return ig}const ah=new it(N.comparator);function ar(...r){let t=ah;for(const e of r)t=t.insert(e.key,e);return t}function uh(r){let t=ah;return r.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function $t(){return yr()}function ch(){return yr()}function yr(){return new te((r=>r.toString()),((r,t)=>r.isEqual(t)))}const og=new it(N.comparator),ag=new tt(N.comparator);function G(...r){let t=ag;for(const e of r)t=t.add(e);return t}const ug=new tt(q);function cg(){return ug}function zo(r,t){if(r.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ar(t)?"-0":t}}function lh(r){return{integerValue:""+r}}function hh(r,t){return mp(t)?lh(t):zo(r,t)}class ri{constructor(){this._=void 0}}function lg(r,t,e){return r instanceof xr?(function(s,i){const a={fields:{[Gl]:{stringValue:zl},[Kl]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&Bo(i)&&(i=ti(i)),i&&(a.fields[$l]=i),{mapValue:a}})(e,t):r instanceof Pn?fh(r,t):r instanceof Vn?mh(r,t):(function(s,i){const a=dh(s,i),u=rc(a)+rc(s.Ae);return co(a)&&co(s.Ae)?lh(u):zo(s.serializer,u)})(r,t)}function hg(r,t,e){return r instanceof Pn?fh(r,t):r instanceof Vn?mh(r,t):e}function dh(r,t){return r instanceof Cn?(function(n){return co(n)||(function(i){return!!i&&"doubleValue"in i})(n)})(t)?t:{integerValue:0}:null}class xr extends ri{}class Pn extends ri{constructor(t){super(),this.elements=t}}function fh(r,t){const e=ph(t);for(const n of r.elements)e.some((s=>Wt(s,n)))||e.push(n);return{arrayValue:{values:e}}}class Vn extends ri{constructor(t){super(),this.elements=t}}function mh(r,t){let e=ph(t);for(const n of r.elements)e=e.filter((s=>!Wt(s,n)));return{arrayValue:{values:e}}}class Cn extends ri{constructor(t,e){super(),this.serializer=t,this.Ae=e}}function rc(r){return st(r.integerValue||r.doubleValue)}function ph(r){return Dr(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}class gh{constructor(t,e){this.field=t,this.transform=e}}function dg(r,t){return r.field.isEqual(t.field)&&(function(n,s){return n instanceof Pn&&s instanceof Pn||n instanceof Vn&&s instanceof Vn?In(n.elements,s.elements,Wt):n instanceof Cn&&s instanceof Cn?Wt(n.Ae,s.Ae):n instanceof xr&&s instanceof xr})(r.transform,t.transform)}class fg{constructor(t,e){this.version=t,this.transformResults=e}}class St{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new St}static exists(t){return new St(void 0,t)}static updateTime(t){return new St(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Ts(r,t){return r.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(r.updateTime):r.exists===void 0||r.exists===t.isFoundDocument()}class si{}function _h(r,t){if(!r.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return r.isNoDocument()?new Go(r.key,St.none()):new Mn(r.key,r.data,St.none());{const e=r.data,n=wt.empty();let s=new tt(ot.comparator);for(let i of t.fields)if(!s.has(i)){let a=e.field(i);a===null&&i.length>1&&(i=i.popLast(),a=e.field(i)),a===null?n.delete(i):n.set(i,a),s=s.add(i)}return new ee(r.key,n,new Ct(s.toArray()),St.none())}}function mg(r,t,e){r instanceof Mn?(function(s,i,a){const u=s.value.clone(),l=ic(s.fieldTransforms,i,a.transformResults);u.setAll(l),i.convertToFoundDocument(a.version,u).setHasCommittedMutations()})(r,t,e):r instanceof ee?(function(s,i,a){if(!Ts(s.precondition,i))return void i.convertToUnknownDocument(a.version);const u=ic(s.fieldTransforms,i,a.transformResults),l=i.data;l.setAll(yh(s)),l.setAll(u),i.convertToFoundDocument(a.version,l).setHasCommittedMutations()})(r,t,e):(function(s,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()})(0,t,e)}function Ir(r,t,e,n){return r instanceof Mn?(function(i,a,u,l){if(!Ts(i.precondition,a))return u;const d=i.value.clone(),f=oc(i.fieldTransforms,l,a);return d.setAll(f),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null})(r,t,e,n):r instanceof ee?(function(i,a,u,l){if(!Ts(i.precondition,a))return u;const d=oc(i.fieldTransforms,l,a),f=a.data;return f.setAll(yh(i)),f.setAll(d),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),u===null?null:u.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map((p=>p.field)))})(r,t,e,n):(function(i,a,u){return Ts(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u})(r,t,e)}function pg(r,t){let e=null;for(const n of r.fieldTransforms){const s=t.data.field(n.field),i=dh(n.transform,s||null);i!=null&&(e===null&&(e=wt.empty()),e.set(n.field,i))}return e||null}function sc(r,t){return r.type===t.type&&!!r.key.isEqual(t.key)&&!!r.precondition.isEqual(t.precondition)&&!!(function(n,s){return n===void 0&&s===void 0||!(!n||!s)&&In(n,s,((i,a)=>dg(i,a)))})(r.fieldTransforms,t.fieldTransforms)&&(r.type===0?r.value.isEqual(t.value):r.type!==1||r.data.isEqual(t.data)&&r.fieldMask.isEqual(t.fieldMask))}class Mn extends si{constructor(t,e,n,s=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class ee extends si{constructor(t,e,n,s,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function yh(r){const t=new Map;return r.fieldMask.fields.forEach((e=>{if(!e.isEmpty()){const n=r.data.field(e);t.set(e,n)}})),t}function ic(r,t,e){const n=new Map;F(r.length===e.length,32656,{Ve:e.length,de:r.length});for(let s=0;s<e.length;s++){const i=r[s],a=i.transform,u=t.data.field(i.field);n.set(i.field,hg(a,u,e[s]))}return n}function oc(r,t,e){const n=new Map;for(const s of r){const i=s.transform,a=e.data.field(s.field);n.set(s.field,lg(i,a,t))}return n}class Go extends si{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ih extends si{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class $o{constructor(t,e,n,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(t.key)&&mg(i,t,n[s])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=Ir(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=Ir(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=ch();return this.mutations.forEach((s=>{const i=t.get(s.key),a=i.overlayedDocument;let u=this.applyToLocalView(a,i.mutatedFields);u=e.has(s.key)?null:u;const l=_h(a,u);l!==null&&n.set(s.key,l),a.isValidDocument()||a.convertToNoDocument(L.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),G())}isEqual(t){return this.batchId===t.batchId&&In(this.mutations,t.mutations,((e,n)=>sc(e,n)))&&In(this.baseMutations,t.baseMutations,((e,n)=>sc(e,n)))}}class Ko{constructor(t,e,n,s){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=s}static from(t,e,n){F(t.mutations.length===n.length,58842,{me:t.mutations.length,fe:n.length});let s=(function(){return og})();const i=t.mutations;for(let a=0;a<i.length;a++)s=s.insert(i[a].key,n[a].version);return new Ko(t,e,n,s)}}class Ho{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class gg{constructor(t,e){this.count=t,this.unchangedNames=e}}var lt,H;function _g(r){switch(r){case P.OK:return O(64938);case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0;default:return O(15467,{code:r})}}function Eh(r){if(r===void 0)return Rt("GRPC error has no .code"),P.UNKNOWN;switch(r){case lt.OK:return P.OK;case lt.CANCELLED:return P.CANCELLED;case lt.UNKNOWN:return P.UNKNOWN;case lt.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case lt.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case lt.INTERNAL:return P.INTERNAL;case lt.UNAVAILABLE:return P.UNAVAILABLE;case lt.UNAUTHENTICATED:return P.UNAUTHENTICATED;case lt.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case lt.NOT_FOUND:return P.NOT_FOUND;case lt.ALREADY_EXISTS:return P.ALREADY_EXISTS;case lt.PERMISSION_DENIED:return P.PERMISSION_DENIED;case lt.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case lt.ABORTED:return P.ABORTED;case lt.OUT_OF_RANGE:return P.OUT_OF_RANGE;case lt.UNIMPLEMENTED:return P.UNIMPLEMENTED;case lt.DATA_LOSS:return P.DATA_LOSS;default:return O(39323,{code:r})}}(H=lt||(lt={}))[H.OK=0]="OK",H[H.CANCELLED=1]="CANCELLED",H[H.UNKNOWN=2]="UNKNOWN",H[H.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",H[H.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",H[H.NOT_FOUND=5]="NOT_FOUND",H[H.ALREADY_EXISTS=6]="ALREADY_EXISTS",H[H.PERMISSION_DENIED=7]="PERMISSION_DENIED",H[H.UNAUTHENTICATED=16]="UNAUTHENTICATED",H[H.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",H[H.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",H[H.ABORTED=10]="ABORTED",H[H.OUT_OF_RANGE=11]="OUT_OF_RANGE",H[H.UNIMPLEMENTED=12]="UNIMPLEMENTED",H[H.INTERNAL=13]="INTERNAL",H[H.UNAVAILABLE=14]="UNAVAILABLE",H[H.DATA_LOSS=15]="DATA_LOSS";function yg(){return new TextEncoder}const Ig=new pe([4294967295,4294967295],0);function ac(r){const t=yg().encode(r),e=new gl;return e.update(t),new Uint8Array(e.digest())}function uc(r){const t=new DataView(r.buffer),e=t.getUint32(0,!0),n=t.getUint32(4,!0),s=t.getUint32(8,!0),i=t.getUint32(12,!0);return[new pe([e,n],0),new pe([s,i],0)]}class Wo{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new ur(`Invalid padding: ${e}`);if(n<0)throw new ur(`Invalid hash count: ${n}`);if(t.length>0&&this.hashCount===0)throw new ur(`Invalid hash count: ${n}`);if(t.length===0&&e!==0)throw new ur(`Invalid padding when bitmap length is 0: ${e}`);this.ge=8*t.length-e,this.pe=pe.fromNumber(this.ge)}ye(t,e,n){let s=t.add(e.multiply(pe.fromNumber(n)));return s.compare(Ig)===1&&(s=new pe([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.ge===0)return!1;const e=ac(t),[n,s]=uc(e);for(let i=0;i<this.hashCount;i++){const a=this.ye(n,s,i);if(!this.we(a))return!1}return!0}static create(t,e,n){const s=t%8==0?0:8-t%8,i=new Uint8Array(Math.ceil(t/8)),a=new Wo(i,s,e);return n.forEach((u=>a.insert(u))),a}insert(t){if(this.ge===0)return;const e=ac(t),[n,s]=uc(e);for(let i=0;i<this.hashCount;i++){const a=this.ye(n,s,i);this.be(a)}}be(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class ur extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class ii{constructor(t,e,n,s,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const s=new Map;return s.set(t,qr.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new ii(L.min(),s,new it(q),Nt(),G())}}class qr{constructor(t,e,n,s,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new qr(n,e,G(),G(),G())}}class ws{constructor(t,e,n,s){this.Se=t,this.removedTargetIds=e,this.key=n,this.De=s}}class Th{constructor(t,e){this.targetId=t,this.Ce=e}}class wh{constructor(t,e,n=dt.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=s}}class cc{constructor(){this.ve=0,this.Fe=lc(),this.Me=dt.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(t){t.approximateByteSize()>0&&(this.Oe=!0,this.Me=t)}ke(){let t=G(),e=G(),n=G();return this.Fe.forEach(((s,i)=>{switch(i){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:O(38017,{changeType:i})}})),new qr(this.Me,this.xe,t,e,n)}Ke(){this.Oe=!1,this.Fe=lc()}qe(t,e){this.Oe=!0,this.Fe=this.Fe.insert(t,e)}Ue(t){this.Oe=!0,this.Fe=this.Fe.remove(t)}$e(){this.ve+=1}We(){this.ve-=1,F(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class Eg{constructor(t){this.Ge=t,this.ze=new Map,this.je=Nt(),this.He=cs(),this.Je=cs(),this.Ze=new it(q)}Xe(t){for(const e of t.Se)t.De&&t.De.isFoundDocument()?this.Ye(e,t.De):this.et(e,t.key,t.De);for(const e of t.removedTargetIds)this.et(e,t.key,t.De)}tt(t){this.forEachTarget(t,(e=>{const n=this.nt(e);switch(t.state){case 0:this.rt(e)&&n.Le(t.resumeToken);break;case 1:n.We(),n.Ne||n.Ke(),n.Le(t.resumeToken);break;case 2:n.We(),n.Ne||this.removeTarget(e);break;case 3:this.rt(e)&&(n.Qe(),n.Le(t.resumeToken));break;case 4:this.rt(e)&&(this.it(e),n.Le(t.resumeToken));break;default:O(56790,{state:t.state})}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ze.forEach(((n,s)=>{this.rt(s)&&e(s)}))}st(t){const e=t.targetId,n=t.Ce.count,s=this.ot(e);if(s){const i=s.target;if(Fs(i))if(n===0){const a=new N(i.path);this.et(e,a,ut.newNoDocument(a,L.min()))}else F(n===1,20013,{expectedCount:n});else{const a=this._t(e);if(a!==n){const u=this.ut(t),l=u?this.ct(u,t,a):1;if(l!==0){this.it(e);const d=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(e,d)}}}}}ut(t){const e=t.Ce.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:s=0},hashCount:i=0}=e;let a,u;try{a=Zt(n).toUint8Array()}catch(l){if(l instanceof jl)return ye("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{u=new Wo(a,s,i)}catch(l){return ye(l instanceof ur?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return u.ge===0?null:u}ct(t,e,n){return e.Ce.count===n-this.Pt(t,e.targetId)?0:2}Pt(t,e){const n=this.Ge.getRemoteKeysForTarget(e);let s=0;return n.forEach((i=>{const a=this.Ge.ht(),u=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;t.mightContain(u)||(this.et(e,i,null),s++)})),s}Tt(t){const e=new Map;this.ze.forEach(((i,a)=>{const u=this.ot(a);if(u){if(i.current&&Fs(u.target)){const l=new N(u.target.path);this.It(l).has(a)||this.Et(a,l)||this.et(a,l,ut.newNoDocument(l,t))}i.Be&&(e.set(a,i.ke()),i.Ke())}}));let n=G();this.Je.forEach(((i,a)=>{let u=!0;a.forEachWhile((l=>{const d=this.ot(l);return!d||d.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)})),u&&(n=n.add(i))})),this.je.forEach(((i,a)=>a.setReadTime(t)));const s=new ii(t,e,this.Ze,this.je,n);return this.je=Nt(),this.He=cs(),this.Je=cs(),this.Ze=new it(q),s}Ye(t,e){if(!this.rt(t))return;const n=this.Et(t,e.key)?2:0;this.nt(t).qe(e.key,n),this.je=this.je.insert(e.key,e),this.He=this.He.insert(e.key,this.It(e.key).add(t)),this.Je=this.Je.insert(e.key,this.Rt(e.key).add(t))}et(t,e,n){if(!this.rt(t))return;const s=this.nt(t);this.Et(t,e)?s.qe(e,1):s.Ue(e),this.Je=this.Je.insert(e,this.Rt(e).delete(t)),this.Je=this.Je.insert(e,this.Rt(e).add(t)),n&&(this.je=this.je.insert(e,n))}removeTarget(t){this.ze.delete(t)}_t(t){const e=this.nt(t).ke();return this.Ge.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}$e(t){this.nt(t).$e()}nt(t){let e=this.ze.get(t);return e||(e=new cc,this.ze.set(t,e)),e}Rt(t){let e=this.Je.get(t);return e||(e=new tt(q),this.Je=this.Je.insert(t,e)),e}It(t){let e=this.He.get(t);return e||(e=new tt(q),this.He=this.He.insert(t,e)),e}rt(t){const e=this.ot(t)!==null;return e||V("WatchChangeAggregator","Detected inactive target",t),e}ot(t){const e=this.ze.get(t);return e&&e.Ne?null:this.Ge.At(t)}it(t){this.ze.set(t,new cc),this.Ge.getRemoteKeysForTarget(t).forEach((e=>{this.et(t,e,null)}))}Et(t,e){return this.Ge.getRemoteKeysForTarget(t).has(e)}}function cs(){return new it(N.comparator)}function lc(){return new it(N.comparator)}const Tg={asc:"ASCENDING",desc:"DESCENDING"},wg={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},vg={and:"AND",or:"OR"};class Ag{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function go(r,t){return r.useProto3Json||Ys(t)?t:{value:t}}function Dn(r,t){return r.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function vh(r,t){return r.useProto3Json?t.toBase64():t.toUint8Array()}function bg(r,t){return Dn(r,t.toTimestamp())}function Pt(r){return F(!!r,49232),L.fromTimestamp((function(e){const n=Xt(e);return new X(n.seconds,n.nanos)})(r))}function Qo(r,t){return _o(r,t).canonicalString()}function _o(r,t){const e=(function(s){return new Y(["projects",s.projectId,"databases",s.database])})(r).child("documents");return t===void 0?e:e.child(t)}function Ah(r){const t=Y.fromString(r);return F(Nh(t),10190,{key:t.toString()}),t}function Bs(r,t){return Qo(r.databaseId,t.path)}function ze(r,t){const e=Ah(t);if(e.get(1)!==r.databaseId.projectId)throw new x(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+r.databaseId.projectId);if(e.get(3)!==r.databaseId.database)throw new x(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+r.databaseId.database);return new N(Sh(e))}function bh(r,t){return Qo(r.databaseId,t)}function Rh(r){const t=Ah(r);return t.length===4?Y.emptyPath():Sh(t)}function yo(r){return new Y(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function Sh(r){return F(r.length>4&&r.get(4)==="documents",29091,{key:r.toString()}),r.popFirst(5)}function hc(r,t,e){return{name:Bs(r,t),fields:e.value.mapValue.fields}}function Rg(r,t,e){const n=ze(r,t.name),s=Pt(t.updateTime),i=t.createTime?Pt(t.createTime):L.min(),a=new wt({mapValue:{fields:t.fields}}),u=ut.newFoundDocument(n,s,i,a);return e&&u.setHasCommittedMutations(),e?u.setHasCommittedMutations():u}function Sg(r,t){let e;if("targetChange"in t){t.targetChange;const n=(function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:O(39313,{state:d})})(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],i=(function(d,f){return d.useProto3Json?(F(f===void 0||typeof f=="string",58123),dt.fromBase64String(f||"")):(F(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),dt.fromUint8Array(f||new Uint8Array))})(r,t.targetChange.resumeToken),a=t.targetChange.cause,u=a&&(function(d){const f=d.code===void 0?P.UNKNOWN:Eh(d.code);return new x(f,d.message||"")})(a);e=new wh(n,s,i,u||null)}else if("documentChange"in t){t.documentChange;const n=t.documentChange;n.document,n.document.name,n.document.updateTime;const s=ze(r,n.document.name),i=Pt(n.document.updateTime),a=n.document.createTime?Pt(n.document.createTime):L.min(),u=new wt({mapValue:{fields:n.document.fields}}),l=ut.newFoundDocument(s,i,a,u),d=n.targetIds||[],f=n.removedTargetIds||[];e=new ws(d,f,l.key,l)}else if("documentDelete"in t){t.documentDelete;const n=t.documentDelete;n.document;const s=ze(r,n.document),i=n.readTime?Pt(n.readTime):L.min(),a=ut.newNoDocument(s,i),u=n.removedTargetIds||[];e=new ws([],u,a.key,a)}else if("documentRemove"in t){t.documentRemove;const n=t.documentRemove;n.document;const s=ze(r,n.document),i=n.removedTargetIds||[];e=new ws([],i,s,null)}else{if(!("filter"in t))return O(11601,{Vt:t});{t.filter;const n=t.filter;n.targetId;const{count:s=0,unchangedNames:i}=n,a=new gg(s,i),u=n.targetId;e=new Th(u,a)}}return e}function Us(r,t){let e;if(t instanceof Mn)e={update:hc(r,t.key,t.value)};else if(t instanceof Go)e={delete:Bs(r,t.key)};else if(t instanceof ee)e={update:hc(r,t.key,t.data),updateMask:Ng(t.fieldMask)};else{if(!(t instanceof Ih))return O(16599,{dt:t.type});e={verify:Bs(r,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map((n=>(function(i,a){const u=a.transform;if(u instanceof xr)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Pn)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Vn)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Cn)return{fieldPath:a.field.canonicalString(),increment:u.Ae};throw O(20930,{transform:a.transform})})(0,n)))),t.precondition.isNone||(e.currentDocument=(function(s,i){return i.updateTime!==void 0?{updateTime:bg(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:O(27497)})(r,t.precondition)),e}function Io(r,t){const e=t.currentDocument?(function(i){return i.updateTime!==void 0?St.updateTime(Pt(i.updateTime)):i.exists!==void 0?St.exists(i.exists):St.none()})(t.currentDocument):St.none(),n=t.updateTransforms?t.updateTransforms.map((s=>(function(a,u){let l=null;if("setToServerValue"in u)F(u.setToServerValue==="REQUEST_TIME",16630,{proto:u}),l=new xr;else if("appendMissingElements"in u){const f=u.appendMissingElements.values||[];l=new Pn(f)}else if("removeAllFromArray"in u){const f=u.removeAllFromArray.values||[];l=new Vn(f)}else"increment"in u?l=new Cn(a,u.increment):O(16584,{proto:u});const d=ot.fromServerFormat(u.fieldPath);return new gh(d,l)})(r,s))):[];if(t.update){t.update.name;const s=ze(r,t.update.name),i=new wt({mapValue:{fields:t.update.fields}});if(t.updateMask){const a=(function(l){const d=l.fieldPaths||[];return new Ct(d.map((f=>ot.fromServerFormat(f))))})(t.updateMask);return new ee(s,i,a,e,n)}return new Mn(s,i,e,n)}if(t.delete){const s=ze(r,t.delete);return new Go(s,e)}if(t.verify){const s=ze(r,t.verify);return new Ih(s,e)}return O(1463,{proto:t})}function Pg(r,t){return r&&r.length>0?(F(t!==void 0,14353),r.map((e=>(function(s,i){let a=s.updateTime?Pt(s.updateTime):Pt(i);return a.isEqual(L.min())&&(a=Pt(i)),new fg(a,s.transformResults||[])})(e,t)))):[]}function Ph(r,t){return{documents:[bh(r,t.path)]}}function Vh(r,t){const e={structuredQuery:{}},n=t.path;let s;t.collectionGroup!==null?(s=n,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=n.popLast(),e.structuredQuery.from=[{collectionId:n.lastSegment()}]),e.parent=bh(r,s);const i=(function(d){if(d.length!==0)return xh(Z.create(d,"and"))})(t.filters);i&&(e.structuredQuery.where=i);const a=(function(d){if(d.length!==0)return d.map((f=>(function(I){return{field:dn(I.field),direction:Cg(I.dir)}})(f)))})(t.orderBy);a&&(e.structuredQuery.orderBy=a);const u=go(r,t.limit);return u!==null&&(e.structuredQuery.limit=u),t.startAt&&(e.structuredQuery.startAt=(function(d){return{before:d.inclusive,values:d.position}})(t.startAt)),t.endAt&&(e.structuredQuery.endAt=(function(d){return{before:!d.inclusive,values:d.position}})(t.endAt)),{ft:e,parent:s}}function Ch(r){let t=Rh(r.parent);const e=r.structuredQuery,n=e.from?e.from.length:0;let s=null;if(n>0){F(n===1,65062);const f=e.from[0];f.allDescendants?s=f.collectionId:t=t.child(f.collectionId)}let i=[];e.where&&(i=(function(p){const I=Dh(p);return I instanceof Z&&jo(I)?I.getFilters():[I]})(e.where));let a=[];e.orderBy&&(a=(function(p){return p.map((I=>(function(C){return new Os(fn(C.field),(function(M){switch(M){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(C.direction))})(I)))})(e.orderBy));let u=null;e.limit&&(u=(function(p){let I;return I=typeof p=="object"?p.value:p,Ys(I)?null:I})(e.limit));let l=null;e.startAt&&(l=(function(p){const I=!!p.before,S=p.values||[];return new Rn(S,I)})(e.startAt));let d=null;return e.endAt&&(d=(function(p){const I=!p.before,S=p.values||[];return new Rn(S,I)})(e.endAt)),tg(t,s,a,i,u,"F",l,d)}function Vg(r,t){const e=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return O(28987,{purpose:s})}})(t.purpose);return e==null?null:{"goog-listen-tags":e}}function Dh(r){return r.unaryFilter!==void 0?(function(e){switch(e.unaryFilter.op){case"IS_NAN":const n=fn(e.unaryFilter.field);return K.create(n,"==",{doubleValue:NaN});case"IS_NULL":const s=fn(e.unaryFilter.field);return K.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=fn(e.unaryFilter.field);return K.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=fn(e.unaryFilter.field);return K.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return O(61313);default:return O(60726)}})(r):r.fieldFilter!==void 0?(function(e){return K.create(fn(e.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return O(58110);default:return O(50506)}})(e.fieldFilter.op),e.fieldFilter.value)})(r):r.compositeFilter!==void 0?(function(e){return Z.create(e.compositeFilter.filters.map((n=>Dh(n))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return O(1026)}})(e.compositeFilter.op))})(r):O(30097,{filter:r})}function Cg(r){return Tg[r]}function Dg(r){return wg[r]}function xg(r){return vg[r]}function dn(r){return{fieldPath:r.canonicalString()}}function fn(r){return ot.fromServerFormat(r.fieldPath)}function xh(r){return r instanceof K?(function(e){if(e.op==="=="){if(Qu(e.value))return{unaryFilter:{field:dn(e.field),op:"IS_NAN"}};if(Wu(e.value))return{unaryFilter:{field:dn(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(Qu(e.value))return{unaryFilter:{field:dn(e.field),op:"IS_NOT_NAN"}};if(Wu(e.value))return{unaryFilter:{field:dn(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:dn(e.field),op:Dg(e.op),value:e.value}}})(r):r instanceof Z?(function(e){const n=e.getFilters().map((s=>xh(s)));return n.length===1?n[0]:{compositeFilter:{op:xg(e.op),filters:n}}})(r):O(54877,{filter:r})}function Ng(r){const t=[];return r.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function Nh(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}function kh(r){return!!r&&typeof r._toProto=="function"&&r._protoValueType==="ProtoValue"}class Qt{constructor(t,e,n,s,i=L.min(),a=L.min(),u=dt.EMPTY_BYTE_STRING,l=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=l}withSequenceNumber(t){return new Qt(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new Qt(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Qt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Qt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class Mh{constructor(t){this.yt=t}}function kg(r,t){let e;if(t.document)e=Rg(r.yt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const n=N.fromSegments(t.noDocument.path),s=Qe(t.noDocument.readTime);e=ut.newNoDocument(n,s),t.hasCommittedMutations&&e.setHasCommittedMutations()}else{if(!t.unknownDocument)return O(56709);{const n=N.fromSegments(t.unknownDocument.path),s=Qe(t.unknownDocument.version);e=ut.newUnknownDocument(n,s)}}return t.readTime&&e.setReadTime((function(s){const i=new X(s[0],s[1]);return L.fromTimestamp(i)})(t.readTime)),e}function dc(r,t){const e=t.key,n={prefixPath:e.getCollectionPath().popLast().toArray(),collectionGroup:e.collectionGroup,documentId:e.path.lastSegment(),readTime:qs(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())n.document=(function(i,a){return{name:Bs(i,a.key),fields:a.data.value.mapValue.fields,updateTime:Dn(i,a.version.toTimestamp()),createTime:Dn(i,a.createTime.toTimestamp())}})(r.yt,t);else if(t.isNoDocument())n.noDocument={path:e.path.toArray(),readTime:We(t.version)};else{if(!t.isUnknownDocument())return O(57904,{document:t});n.unknownDocument={path:e.path.toArray(),version:We(t.version)}}return n}function qs(r){const t=r.toTimestamp();return[t.seconds,t.nanoseconds]}function We(r){const t=r.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function Qe(r){const t=new X(r.seconds,r.nanoseconds);return L.fromTimestamp(t)}function Fe(r,t){const e=(t.baseMutations||[]).map((i=>Io(r.yt,i)));for(let i=0;i<t.mutations.length-1;++i){const a=t.mutations[i];if(i+1<t.mutations.length&&t.mutations[i+1].transform!==void 0){const u=t.mutations[i+1];a.updateTransforms=u.transform.fieldTransforms,t.mutations.splice(i+1,1),++i}}const n=t.mutations.map((i=>Io(r.yt,i))),s=X.fromMillis(t.localWriteTimeMs);return new $o(t.batchId,s,e,n)}function cr(r){const t=Qe(r.readTime),e=r.lastLimboFreeSnapshotVersion!==void 0?Qe(r.lastLimboFreeSnapshotVersion):L.min();let n;return n=(function(i){return i.documents!==void 0})(r.query)?(function(i){const a=i.documents.length;return F(a===1,1966,{count:a}),Lt(Br(Rh(i.documents[0])))})(r.query):(function(i){return Lt(Ch(i))})(r.query),new Qt(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,t,e,dt.fromBase64String(r.resumeToken))}function Oh(r,t){const e=We(t.snapshotVersion),n=We(t.lastLimboFreeSnapshotVersion);let s;s=Fs(t.target)?Ph(r.yt,t.target):Vh(r.yt,t.target).ft;const i=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:He(t.target),readTime:e,resumeToken:i,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:s}}function Fh(r){const t=Ch({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?po(t,t.limit,"L"):t}function Gi(r,t){return new Ho(t.largestBatchId,Io(r.yt,t.overlayMutation))}function fc(r,t){const e=t.path.lastSegment();return[r,vt(t.path.popLast()),e]}function mc(r,t,e,n){return{indexId:r,uid:t,sequenceNumber:e,readTime:We(n.readTime),documentKey:vt(n.documentKey.path),largestBatchId:n.largestBatchId}}class Mg{getBundleMetadata(t,e){return pc(t).get(e).next((n=>{if(n)return(function(i){return{id:i.bundleId,createTime:Qe(i.createTime),version:i.version}})(n)}))}saveBundleMetadata(t,e){return pc(t).put((function(s){return{bundleId:s.id,createTime:We(Pt(s.createTime)),version:s.version}})(e))}getNamedQuery(t,e){return gc(t).get(e).next((n=>{if(n)return(function(i){return{name:i.name,query:Fh(i.bundledQuery),readTime:Qe(i.readTime)}})(n)}))}saveNamedQuery(t,e){return gc(t).put((function(s){return{name:s.name,readTime:We(Pt(s.readTime)),bundledQuery:s.bundledQuery}})(e))}}function pc(r){return mt(r,Js)}function gc(r){return mt(r,Xs)}class oi{constructor(t,e){this.serializer=t,this.userId=e}static wt(t,e){const n=e.uid||"";return new oi(t,n)}getOverlay(t,e){return tr(t).get(fc(this.userId,e)).next((n=>n?Gi(this.serializer,n):null))}getOverlays(t,e){const n=$t();return v.forEach(e,(s=>this.getOverlay(t,s).next((i=>{i!==null&&n.set(s,i)})))).next((()=>n))}saveOverlays(t,e,n){const s=[];return n.forEach(((i,a)=>{const u=new Ho(e,a);s.push(this.bt(t,u))})),v.waitFor(s)}removeOverlaysForBatchId(t,e,n){const s=new Set;e.forEach((a=>s.add(vt(a.getCollectionPath()))));const i=[];return s.forEach((a=>{const u=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,n+1],!1,!0);i.push(tr(t).X(oo,u))})),v.waitFor(i)}getOverlaysForCollection(t,e,n){const s=$t(),i=vt(e),a=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return tr(t).H(oo,a).next((u=>{for(const l of u){const d=Gi(this.serializer,l);s.set(d.getKey(),d)}return s}))}getOverlaysForCollectionGroup(t,e,n,s){const i=$t();let a;const u=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,Number.POSITIVE_INFINITY],!0);return tr(t).ee({index:Ol,range:u},((l,d,f)=>{const p=Gi(this.serializer,d);i.size()<s||p.largestBatchId===a?(i.set(p.getKey(),p),a=p.largestBatchId):f.done()})).next((()=>i))}bt(t,e){return tr(t).put((function(s,i,a){const[u,l,d]=fc(i,a.mutation.key);return{userId:i,collectionPath:l,documentId:d,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:Us(s.yt,a.mutation)}})(this.serializer,this.userId,e))}}function tr(r){return mt(r,Zs)}class Og{St(t){return mt(t,Fo)}getSessionToken(t){return this.St(t).get("sessionToken").next((e=>{const n=e?.value;return n?dt.fromUint8Array(n):dt.EMPTY_BYTE_STRING}))}setSessionToken(t,e){return this.St(t).put({name:"sessionToken",value:e.toUint8Array()})}}class Le{constructor(){}Dt(t,e){this.Ct(t,e),e.vt()}Ct(t,e){if("nullValue"in t)this.Ft(e,5);else if("booleanValue"in t)this.Ft(e,10),e.Mt(t.booleanValue?1:0);else if("integerValue"in t)this.Ft(e,15),e.Mt(st(t.integerValue));else if("doubleValue"in t){const n=st(t.doubleValue);isNaN(n)?this.Ft(e,13):(this.Ft(e,15),Ar(n)?e.Mt(0):e.Mt(n))}else if("timestampValue"in t){let n=t.timestampValue;this.Ft(e,20),typeof n=="string"&&(n=Xt(n)),e.xt(`${n.seconds||""}`),e.Mt(n.nanos||0)}else if("stringValue"in t)this.Ot(t.stringValue,e),this.Nt(e);else if("bytesValue"in t)this.Ft(e,30),e.Bt(Zt(t.bytesValue)),this.Nt(e);else if("referenceValue"in t)this.Lt(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.Ft(e,45),e.Mt(n.latitude||0),e.Mt(n.longitude||0)}else"mapValue"in t?Wl(t)?this.Ft(e,Number.MAX_SAFE_INTEGER):ei(t)?this.kt(t.mapValue,e):(this.Kt(t.mapValue,e),this.Nt(e)):"arrayValue"in t?(this.qt(t.arrayValue,e),this.Nt(e)):O(19022,{Ut:t})}Ot(t,e){this.Ft(e,25),this.$t(t,e)}$t(t,e){e.xt(t)}Kt(t,e){const n=t.fields||{};this.Ft(e,55);for(const s of Object.keys(n))this.Ot(s,e),this.Ct(n[s],e)}kt(t,e){const n=t.fields||{};this.Ft(e,53);const s=An,i=n[s].arrayValue?.values?.length||0;this.Ft(e,15),e.Mt(st(i)),this.Ot(s,e),this.Ct(n[s],e)}qt(t,e){const n=t.values||[];this.Ft(e,50);for(const s of n)this.Ct(s,e)}Lt(t,e){this.Ft(e,37),N.fromName(t).path.forEach((n=>{this.Ft(e,60),this.$t(n,e)}))}Ft(t,e){t.Mt(e)}Nt(t){t.Mt(2)}}Le.Wt=new Le;const on=255;function Fg(r){if(r===0)return 8;let t=0;return r>>4||(t+=4,r<<=4),r>>6||(t+=2,r<<=2),r>>7||(t+=1),t}function _c(r){const t=64-(function(n){let s=0;for(let i=0;i<8;++i){const a=Fg(255&n[i]);if(s+=a,a!==8)break}return s})(r);return Math.ceil(t/8)}class Lg{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Qt(t){const e=t[Symbol.iterator]();let n=e.next();for(;!n.done;)this.Gt(n.value),n=e.next();this.zt()}jt(t){const e=t[Symbol.iterator]();let n=e.next();for(;!n.done;)this.Ht(n.value),n=e.next();this.Jt()}Zt(t){for(const e of t){const n=e.charCodeAt(0);if(n<128)this.Gt(n);else if(n<2048)this.Gt(960|n>>>6),this.Gt(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.Gt(480|n>>>12),this.Gt(128|63&n>>>6),this.Gt(128|63&n);else{const s=e.codePointAt(0);this.Gt(240|s>>>18),this.Gt(128|63&s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s)}}this.zt()}Xt(t){for(const e of t){const n=e.charCodeAt(0);if(n<128)this.Ht(n);else if(n<2048)this.Ht(960|n>>>6),this.Ht(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.Ht(480|n>>>12),this.Ht(128|63&n>>>6),this.Ht(128|63&n);else{const s=e.codePointAt(0);this.Ht(240|s>>>18),this.Ht(128|63&s>>>12),this.Ht(128|63&s>>>6),this.Ht(128|63&s)}}this.Jt()}Yt(t){const e=this.en(t),n=_c(e);this.tn(1+n),this.buffer[this.position++]=255&n;for(let s=e.length-n;s<e.length;++s)this.buffer[this.position++]=255&e[s]}nn(t){const e=this.en(t),n=_c(e);this.tn(1+n),this.buffer[this.position++]=~(255&n);for(let s=e.length-n;s<e.length;++s)this.buffer[this.position++]=~(255&e[s])}rn(){this.sn(on),this.sn(255)}_n(){this.an(on),this.an(255)}reset(){this.position=0}seed(t){this.tn(t.length),this.buffer.set(t,this.position),this.position+=t.length}un(){return this.buffer.slice(0,this.position)}en(t){const e=(function(i){const a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,i,!1),new Uint8Array(a.buffer)})(t),n=!!(128&e[0]);e[0]^=n?255:128;for(let s=1;s<e.length;++s)e[s]^=n?255:0;return e}Gt(t){const e=255&t;e===0?(this.sn(0),this.sn(255)):e===on?(this.sn(on),this.sn(0)):this.sn(e)}Ht(t){const e=255&t;e===0?(this.an(0),this.an(255)):e===on?(this.an(on),this.an(0)):this.an(t)}zt(){this.sn(0),this.sn(1)}Jt(){this.an(0),this.an(1)}sn(t){this.tn(1),this.buffer[this.position++]=t}an(t){this.tn(1),this.buffer[this.position++]=~t}tn(t){const e=t+this.position;if(e<=this.buffer.length)return;let n=2*this.buffer.length;n<e&&(n=e);const s=new Uint8Array(n);s.set(this.buffer),this.buffer=s}}class Bg{constructor(t){this.cn=t}Bt(t){this.cn.Qt(t)}xt(t){this.cn.Zt(t)}Mt(t){this.cn.Yt(t)}vt(){this.cn.rn()}}class Ug{constructor(t){this.cn=t}Bt(t){this.cn.jt(t)}xt(t){this.cn.Xt(t)}Mt(t){this.cn.nn(t)}vt(){this.cn._n()}}class er{constructor(){this.cn=new Lg,this.ascending=new Bg(this.cn),this.descending=new Ug(this.cn)}seed(t){this.cn.seed(t)}ln(t){return t===0?this.ascending:this.descending}un(){return this.cn.un()}reset(){this.cn.reset()}}class Be{constructor(t,e,n,s){this.hn=t,this.Pn=e,this.Tn=n,this.In=s}En(){const t=this.In.length,e=t===0||this.In[t-1]===255?t+1:t,n=new Uint8Array(e);return n.set(this.In,0),e!==t?n.set([0],this.In.length):++n[n.length-1],new Be(this.hn,this.Pn,this.Tn,n)}Rn(t,e,n){return{indexId:this.hn,uid:t,arrayValue:vs(this.Tn),directionalValue:vs(this.In),orderedDocumentKey:vs(e),documentKey:n.path.toArray()}}An(t,e,n){const s=this.Rn(t,e,n);return[s.indexId,s.uid,s.arrayValue,s.directionalValue,s.orderedDocumentKey,s.documentKey]}}function ue(r,t){let e=r.hn-t.hn;return e!==0?e:(e=yc(r.Tn,t.Tn),e!==0?e:(e=yc(r.In,t.In),e!==0?e:N.comparator(r.Pn,t.Pn)))}function yc(r,t){for(let e=0;e<r.length&&e<t.length;++e){const n=r[e]-t[e];if(n!==0)return n}return r.length-t.length}function vs(r){return ul()?(function(e){let n="";for(let s=0;s<e.length;s++)n+=String.fromCharCode(e[s]);return n})(r):r}function Ic(r){return typeof r!="string"?r:(function(e){const n=new Uint8Array(e.length);for(let s=0;s<e.length;s++)n[s]=e.charCodeAt(s);return n})(r)}class Ec{constructor(t){this.Vn=new tt(((e,n)=>ot.comparator(e.field,n.field))),this.collectionId=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment(),this.dn=t.orderBy,this.mn=[];for(const e of t.filters){const n=e;n.isInequality()?this.Vn=this.Vn.add(n):this.mn.push(n)}}get fn(){return this.Vn.size>1}gn(t){if(F(t.collectionGroup===this.collectionId,49279),this.fn)return!1;const e=ro(t);if(e!==void 0&&!this.pn(e))return!1;const n=ke(t);let s=new Set,i=0,a=0;for(;i<n.length&&this.pn(n[i]);++i)s=s.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.Vn.size>0){const u=this.Vn.getIterator().getNext();if(!s.has(u.field.canonicalString())){const l=n[i];if(!this.yn(u,l)||!this.wn(this.dn[a++],l))return!1}++i}for(;i<n.length;++i){const u=n[i];if(a>=this.dn.length||!this.wn(this.dn[a++],u))return!1}return!0}bn(){if(this.fn)return null;let t=new tt(ot.comparator);const e=[];for(const n of this.mn)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")e.push(new ps(n.field,2));else{if(t.has(n.field))continue;t=t.add(n.field),e.push(new ps(n.field,0))}for(const n of this.dn)n.field.isKeyField()||t.has(n.field)||(t=t.add(n.field),e.push(new ps(n.field,n.dir==="asc"?0:1)));return new Ds(Ds.UNKNOWN_ID,this.collectionId,e,vr.empty())}pn(t){for(const e of this.mn)if(this.yn(e,t))return!0;return!1}yn(t,e){if(t===void 0||!t.field.isEqual(e.fieldPath))return!1;const n=t.op==="array-contains"||t.op==="array-contains-any";return e.kind===2===n}wn(t,e){return!!t.field.isEqual(e.fieldPath)&&(e.kind===0&&t.dir==="asc"||e.kind===1&&t.dir==="desc")}}function Lh(r){if(F(r instanceof K||r instanceof Z,20012),r instanceof K){if(r instanceof rh){const e=r.value.arrayValue?.values?.map((n=>K.create(r.field,"==",n)))||[];return Z.create(e,"or")}return r}const t=r.filters.map((e=>Lh(e)));return Z.create(t,r.op)}function qg(r){if(r.getFilters().length===0)return[];const t=wo(Lh(r));return F(Bh(t),7391),Eo(t)||To(t)?[t]:t.getFilters()}function Eo(r){return r instanceof K}function To(r){return r instanceof Z&&jo(r)}function Bh(r){return Eo(r)||To(r)||(function(e){if(e instanceof Z&&lo(e)){for(const n of e.getFilters())if(!Eo(n)&&!To(n))return!1;return!0}return!1})(r)}function wo(r){if(F(r instanceof K||r instanceof Z,34018),r instanceof K)return r;if(r.filters.length===1)return wo(r.filters[0]);const t=r.filters.map((n=>wo(n)));let e=Z.create(t,r.op);return e=js(e),Bh(e)?e:(F(e instanceof Z,64498),F(Sn(e),40251),F(e.filters.length>1,57927),e.filters.reduce(((n,s)=>Yo(n,s))))}function Yo(r,t){let e;return F(r instanceof K||r instanceof Z,38388),F(t instanceof K||t instanceof Z,25473),e=r instanceof K?t instanceof K?(function(s,i){return Z.create([s,i],"and")})(r,t):Tc(r,t):t instanceof K?Tc(t,r):(function(s,i){if(F(s.filters.length>0&&i.filters.length>0,48005),Sn(s)&&Sn(i))return th(s,i.getFilters());const a=lo(s)?s:i,u=lo(s)?i:s,l=a.filters.map((d=>Yo(d,u)));return Z.create(l,"or")})(r,t),js(e)}function Tc(r,t){if(Sn(t))return th(t,r.getFilters());{const e=t.filters.map((n=>Yo(r,n)));return Z.create(e,"or")}}function js(r){if(F(r instanceof K||r instanceof Z,11850),r instanceof K)return r;const t=r.getFilters();if(t.length===1)return js(t[0]);if(Xl(r))return r;const e=t.map((s=>js(s))),n=[];return e.forEach((s=>{s instanceof K?n.push(s):s instanceof Z&&(s.op===r.op?n.push(...s.filters):n.push(s))})),n.length===1?n[0]:Z.create(n,r.op)}class jg{constructor(){this.Sn=new Jo}addToCollectionParentIndex(t,e){return this.Sn.add(e),v.resolve()}getCollectionParents(t,e){return v.resolve(this.Sn.getEntries(e))}addFieldIndex(t,e){return v.resolve()}deleteFieldIndex(t,e){return v.resolve()}deleteAllFieldIndexes(t){return v.resolve()}createTargetIndexes(t,e){return v.resolve()}getDocumentsMatchingTarget(t,e){return v.resolve(null)}getIndexType(t,e){return v.resolve(0)}getFieldIndexes(t,e){return v.resolve([])}getNextCollectionGroupToUpdate(t){return v.resolve(null)}getMinOffset(t,e){return v.resolve(kt.min())}getMinOffsetFromCollectionGroup(t,e){return v.resolve(kt.min())}updateCollectionGroup(t,e,n){return v.resolve()}updateIndexEntries(t,e){return v.resolve()}}class Jo{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e]||new tt(Y.comparator),i=!s.has(n);return this.index[e]=s.add(n),i}has(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e];return s&&s.has(n)}getEntries(t){return(this.index[t]||new tt(Y.comparator)).toArray()}}const wc="IndexedDbIndexManager",ls=new Uint8Array(0);class zg{constructor(t,e){this.databaseId=e,this.Dn=new Jo,this.Cn=new te((n=>He(n)),((n,s)=>Fr(n,s))),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this.Dn.has(e)){const n=e.lastSegment(),s=e.popLast();t.addOnCommittedListener((()=>{this.Dn.add(e)}));const i={collectionId:n,parent:vt(s)};return vc(t).put(i)}return v.resolve()}getCollectionParents(t,e){const n=[],s=IDBKeyRange.bound([e,""],[Al(e),""],!1,!0);return vc(t).H(s).next((i=>{for(const a of i){if(a.collectionId!==e)break;n.push(Gt(a.parent))}return n}))}addFieldIndex(t,e){const n=nr(t),s=(function(u){return{indexId:u.indexId,collectionGroup:u.collectionGroup,fields:u.fields.map((l=>[l.fieldPath.canonicalString(),l.kind]))}})(e);delete s.indexId;const i=n.add(s);if(e.indexState){const a=un(t);return i.next((u=>{a.put(mc(u,this.uid,e.indexState.sequenceNumber,e.indexState.offset))}))}return i.next()}deleteFieldIndex(t,e){const n=nr(t),s=un(t),i=an(t);return n.delete(e.indexId).next((()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))).next((()=>i.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))))}deleteAllFieldIndexes(t){const e=nr(t),n=an(t),s=un(t);return e.X().next((()=>n.X())).next((()=>s.X()))}createTargetIndexes(t,e){return v.forEach(this.vn(e),(n=>this.getIndexType(t,n).next((s=>{if(s===0||s===1){const i=new Ec(n).bn();if(i!=null)return this.addFieldIndex(t,i)}}))))}getDocumentsMatchingTarget(t,e){const n=an(t);let s=!0;const i=new Map;return v.forEach(this.vn(e),(a=>this.Fn(t,a).next((u=>{s&&(s=!!u),i.set(a,u)})))).next((()=>{if(s){let a=G();const u=[];return v.forEach(i,((l,d)=>{V(wc,`Using index ${(function(B){return`id=${B.indexId}|cg=${B.collectionGroup}|f=${B.fields.map((J=>`${J.fieldPath}:${J.kind}`)).join(",")}`})(l)} to execute ${He(e)}`);const f=(function(B,J){const et=ro(J);if(et===void 0)return null;for(const Q of Ls(B,et.fieldPath))switch(Q.op){case"array-contains-any":return Q.value.arrayValue.values||[];case"array-contains":return[Q.value]}return null})(d,l),p=(function(B,J){const et=new Map;for(const Q of ke(J))for(const E of Ls(B,Q.fieldPath))switch(E.op){case"==":case"in":et.set(Q.fieldPath.canonicalString(),E.value);break;case"not-in":case"!=":return et.set(Q.fieldPath.canonicalString(),E.value),Array.from(et.values())}return null})(d,l),I=(function(B,J){const et=[];let Q=!0;for(const E of ke(J)){const g=E.kind===0?tc(B,E.fieldPath,B.startAt):ec(B,E.fieldPath,B.startAt);et.push(g.value),Q&&(Q=g.inclusive)}return new Rn(et,Q)})(d,l),S=(function(B,J){const et=[];let Q=!0;for(const E of ke(J)){const g=E.kind===0?ec(B,E.fieldPath,B.endAt):tc(B,E.fieldPath,B.endAt);et.push(g.value),Q&&(Q=g.inclusive)}return new Rn(et,Q)})(d,l),C=this.Mn(l,d,I),k=this.Mn(l,d,S),M=this.xn(l,d,p),$=this.On(l.indexId,f,C,I.inclusive,k,S.inclusive,M);return v.forEach($,(U=>n.Z(U,e.limit).next((B=>{B.forEach((J=>{const et=N.fromSegments(J.documentKey);a.has(et)||(a=a.add(et),u.push(et))}))}))))})).next((()=>u))}return v.resolve(null)}))}vn(t){let e=this.Cn.get(t);return e||(t.filters.length===0?e=[t]:e=qg(Z.create(t.filters,"and")).map((n=>fo(t.path,t.collectionGroup,t.orderBy,n.getFilters(),t.limit,t.startAt,t.endAt))),this.Cn.set(t,e),e)}On(t,e,n,s,i,a,u){const l=(e!=null?e.length:1)*Math.max(n.length,i.length),d=l/(e!=null?e.length:1),f=[];for(let p=0;p<l;++p){const I=e?this.Nn(e[p/d]):ls,S=this.Bn(t,I,n[p%d],s),C=this.Ln(t,I,i[p%d],a),k=u.map((M=>this.Bn(t,I,M,!0)));f.push(...this.createRange(S,C,k))}return f}Bn(t,e,n,s){const i=new Be(t,N.empty(),e,n);return s?i:i.En()}Ln(t,e,n,s){const i=new Be(t,N.empty(),e,n);return s?i.En():i}Fn(t,e){const n=new Ec(e),s=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,s).next((i=>{let a=null;for(const u of i)n.gn(u)&&(!a||u.fields.length>a.fields.length)&&(a=u);return a}))}getIndexType(t,e){let n=2;const s=this.vn(e);return v.forEach(s,(i=>this.Fn(t,i).next((a=>{a?n!==0&&a.fields.length<(function(l){let d=new tt(ot.comparator),f=!1;for(const p of l.filters)for(const I of p.getFlattenedFilters())I.field.isKeyField()||(I.op==="array-contains"||I.op==="array-contains-any"?f=!0:d=d.add(I.field));for(const p of l.orderBy)p.field.isKeyField()||(d=d.add(p.field));return d.size+(f?1:0)})(i)&&(n=1):n=0})))).next((()=>(function(a){return a.limit!==null})(e)&&s.length>1&&n===2?1:n))}kn(t,e){const n=new er;for(const s of ke(t)){const i=e.data.field(s.fieldPath);if(i==null)return null;const a=n.ln(s.kind);Le.Wt.Dt(i,a)}return n.un()}Nn(t){const e=new er;return Le.Wt.Dt(t,e.ln(0)),e.un()}Kn(t,e){const n=new er;return Le.Wt.Dt(Cr(this.databaseId,e),n.ln((function(i){const a=ke(i);return a.length===0?0:a[a.length-1].kind})(t))),n.un()}xn(t,e,n){if(n===null)return[];let s=[];s.push(new er);let i=0;for(const a of ke(t)){const u=n[i++];for(const l of s)if(this.qn(e,a.fieldPath)&&Dr(u))s=this.Un(s,a,u);else{const d=l.ln(a.kind);Le.Wt.Dt(u,d)}}return this.$n(s)}Mn(t,e,n){return this.xn(t,e,n.position)}$n(t){const e=[];for(let n=0;n<t.length;++n)e[n]=t[n].un();return e}Un(t,e,n){const s=[...t],i=[];for(const a of n.arrayValue.values||[])for(const u of s){const l=new er;l.seed(u.un()),Le.Wt.Dt(a,l.ln(e.kind)),i.push(l)}return i}qn(t,e){return!!t.filters.find((n=>n instanceof K&&n.field.isEqual(e)&&(n.op==="in"||n.op==="not-in")))}getFieldIndexes(t,e){const n=nr(t),s=un(t);return(e?n.H(io,IDBKeyRange.bound(e,e)):n.H()).next((i=>{const a=[];return v.forEach(i,(u=>s.get([u.indexId,this.uid]).next((l=>{a.push((function(f,p){const I=p?new vr(p.sequenceNumber,new kt(Qe(p.readTime),new N(Gt(p.documentKey)),p.largestBatchId)):vr.empty(),S=f.fields.map((([C,k])=>new ps(ot.fromServerFormat(C),k)));return new Ds(f.indexId,f.collectionGroup,S,I)})(u,l))})))).next((()=>a))}))}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next((e=>e.length===0?null:(e.sort(((n,s)=>{const i=n.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:q(n.collectionGroup,s.collectionGroup)})),e[0].collectionGroup)))}updateCollectionGroup(t,e,n){const s=nr(t),i=un(t);return this.Wn(t).next((a=>s.H(io,IDBKeyRange.bound(e,e)).next((u=>v.forEach(u,(l=>i.put(mc(l.indexId,this.uid,a,n))))))))}updateIndexEntries(t,e){const n=new Map;return v.forEach(e,((s,i)=>{const a=n.get(s.collectionGroup);return(a?v.resolve(a):this.getFieldIndexes(t,s.collectionGroup)).next((u=>(n.set(s.collectionGroup,u),v.forEach(u,(l=>this.Qn(t,s,l).next((d=>{const f=this.Gn(i,l);return d.isEqual(f)?v.resolve():this.zn(t,i,l,d,f)})))))))}))}jn(t,e,n,s){return an(t).put(s.Rn(this.uid,this.Kn(n,e.key),e.key))}Hn(t,e,n,s){return an(t).delete(s.An(this.uid,this.Kn(n,e.key),e.key))}Qn(t,e,n){const s=an(t);let i=new tt(ue);return s.ee({index:Ml,range:IDBKeyRange.only([n.indexId,this.uid,vs(this.Kn(n,e))])},((a,u)=>{i=i.add(new Be(n.indexId,e,Ic(u.arrayValue),Ic(u.directionalValue)))})).next((()=>i))}Gn(t,e){let n=new tt(ue);const s=this.kn(e,t);if(s==null)return n;const i=ro(e);if(i!=null){const a=t.data.field(i.fieldPath);if(Dr(a))for(const u of a.arrayValue.values||[])n=n.add(new Be(e.indexId,t.key,this.Nn(u),s))}else n=n.add(new Be(e.indexId,t.key,ls,s));return n}zn(t,e,n,s,i){V(wc,"Updating index entries for document '%s'",e.key);const a=[];return(function(l,d,f,p,I){const S=l.getIterator(),C=d.getIterator();let k=sn(S),M=sn(C);for(;k||M;){let $=!1,U=!1;if(k&&M){const B=f(k,M);B<0?U=!0:B>0&&($=!0)}else k!=null?U=!0:$=!0;$?(p(M),M=sn(C)):U?(I(k),k=sn(S)):(k=sn(S),M=sn(C))}})(s,i,ue,(u=>{a.push(this.jn(t,e,n,u))}),(u=>{a.push(this.Hn(t,e,n,u))})),v.waitFor(a)}Wn(t){let e=1;return un(t).ee({index:kl,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((n,s,i)=>{i.done(),e=s.sequenceNumber+1})).next((()=>e))}createRange(t,e,n){n=n.sort(((a,u)=>ue(a,u))).filter(((a,u,l)=>!u||ue(a,l[u-1])!==0));const s=[];s.push(t);for(const a of n){const u=ue(a,t),l=ue(a,e);if(u===0)s[0]=t.En();else if(u>0&&l<0)s.push(a),s.push(a.En());else if(l>0)break}s.push(e);const i=[];for(let a=0;a<s.length;a+=2){if(this.Jn(s[a],s[a+1]))return[];const u=s[a].An(this.uid,ls,N.empty()),l=s[a+1].An(this.uid,ls,N.empty());i.push(IDBKeyRange.bound(u,l))}return i}Jn(t,e){return ue(t,e)>0}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next(Ac)}getMinOffset(t,e){return v.mapArray(this.vn(e),(n=>this.Fn(t,n).next((s=>s||O(44426))))).next(Ac)}}function vc(r){return mt(r,Sr)}function an(r){return mt(r,pr)}function nr(r){return mt(r,Oo)}function un(r){return mt(r,mr)}function Ac(r){F(r.length!==0,28825);let t=r[0].indexState.offset,e=t.largestBatchId;for(let n=1;n<r.length;n++){const s=r[n].indexState.offset;No(s,t)<0&&(t=s),e<s.largestBatchId&&(e=s.largestBatchId)}return new kt(t.readTime,t.documentKey,e)}const bc={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Uh=41943040;class Tt{static withCacheSize(t){return new Tt(t,Tt.DEFAULT_COLLECTION_PERCENTILE,Tt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}}function qh(r,t,e){const n=r.store(Bt),s=r.store(En),i=[],a=IDBKeyRange.only(e.batchId);let u=0;const l=n.ee({range:a},((f,p,I)=>(u++,I.delete())));i.push(l.next((()=>{F(u===1,47070,{batchId:e.batchId})})));const d=[];for(const f of e.mutations){const p=Dl(t,f.key.path,e.batchId);i.push(s.delete(p)),d.push(f.key)}return v.waitFor(i).next((()=>d))}function zs(r){if(!r)return 0;let t;if(r.document)t=r.document;else if(r.unknownDocument)t=r.unknownDocument;else{if(!r.noDocument)throw O(14731);t=r.noDocument}return JSON.stringify(t).length}Tt.DEFAULT_COLLECTION_PERCENTILE=10,Tt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Tt.DEFAULT=new Tt(Uh,Tt.DEFAULT_COLLECTION_PERCENTILE,Tt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Tt.DISABLED=new Tt(-1,0,0);class ai{constructor(t,e,n,s){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=s,this.Zn={}}static wt(t,e,n,s){F(t.uid!=="",64387);const i=t.isAuthenticated()?t.uid:"";return new ai(i,e,n,s)}checkEmpty(t){let e=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ce(t).ee({index:Ue,range:n},((s,i,a)=>{e=!1,a.done()})).next((()=>e))}addMutationBatch(t,e,n,s){const i=mn(t),a=ce(t);return a.add({}).next((u=>{F(typeof u=="number",49019);const l=new $o(u,e,n,s),d=(function(S,C,k){const M=k.baseMutations.map((U=>Us(S.yt,U))),$=k.mutations.map((U=>Us(S.yt,U)));return{userId:C,batchId:k.batchId,localWriteTimeMs:k.localWriteTime.toMillis(),baseMutations:M,mutations:$}})(this.serializer,this.userId,l),f=[];let p=new tt(((I,S)=>q(I.canonicalString(),S.canonicalString())));for(const I of s){const S=Dl(this.userId,I.key.path,u);p=p.add(I.key.path.popLast()),f.push(a.put(d)),f.push(i.put(S,_p))}return p.forEach((I=>{f.push(this.indexManager.addToCollectionParentIndex(t,I))})),t.addOnCommittedListener((()=>{this.Zn[u]=l.keys()})),v.waitFor(f).next((()=>l))}))}lookupMutationBatch(t,e){return ce(t).get(e).next((n=>n?(F(n.userId===this.userId,48,"Unexpected user for mutation batch",{userId:n.userId,batchId:e}),Fe(this.serializer,n)):null))}Xn(t,e){return this.Zn[e]?v.resolve(this.Zn[e]):this.lookupMutationBatch(t,e).next((n=>{if(n){const s=n.keys();return this.Zn[e]=s,s}return null}))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,s=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return ce(t).ee({index:Ue,range:s},((a,u,l)=>{u.userId===this.userId&&(F(u.batchId>=n,47524,{Yn:n}),i=Fe(this.serializer,u)),l.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(t){const e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=qe;return ce(t).ee({index:Ue,range:e,reverse:!0},((s,i,a)=>{n=i.batchId,a.done()})).next((()=>n))}getAllMutationBatches(t){const e=IDBKeyRange.bound([this.userId,qe],[this.userId,Number.POSITIVE_INFINITY]);return ce(t).H(Ue,e).next((n=>n.map((s=>Fe(this.serializer,s)))))}getAllMutationBatchesAffectingDocumentKey(t,e){const n=gs(this.userId,e.path),s=IDBKeyRange.lowerBound(n),i=[];return mn(t).ee({range:s},((a,u,l)=>{const[d,f,p]=a,I=Gt(f);if(d===this.userId&&e.path.isEqual(I))return ce(t).get(p).next((S=>{if(!S)throw O(61480,{er:a,batchId:p});F(S.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:S.userId,batchId:p}),i.push(Fe(this.serializer,S))}));l.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new tt(q);const s=[];return e.forEach((i=>{const a=gs(this.userId,i.path),u=IDBKeyRange.lowerBound(a),l=mn(t).ee({range:u},((d,f,p)=>{const[I,S,C]=d,k=Gt(S);I===this.userId&&i.path.isEqual(k)?n=n.add(C):p.done()}));s.push(l)})),v.waitFor(s).next((()=>this.tr(t,n)))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,s=n.length+1,i=gs(this.userId,n),a=IDBKeyRange.lowerBound(i);let u=new tt(q);return mn(t).ee({range:a},((l,d,f)=>{const[p,I,S]=l,C=Gt(I);p===this.userId&&n.isPrefixOf(C)?C.length===s&&(u=u.add(S)):f.done()})).next((()=>this.tr(t,u)))}tr(t,e){const n=[],s=[];return e.forEach((i=>{s.push(ce(t).get(i).next((a=>{if(a===null)throw O(35274,{batchId:i});F(a.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:a.userId,batchId:i}),n.push(Fe(this.serializer,a))})))})),v.waitFor(s).next((()=>n))}removeMutationBatch(t,e){return qh(t.le,this.userId,e).next((n=>(t.addOnCommittedListener((()=>{this.nr(e.batchId)})),v.forEach(n,(s=>this.referenceDelegate.markPotentiallyOrphaned(t,s))))))}nr(t){delete this.Zn[t]}performConsistencyCheck(t){return this.checkEmpty(t).next((e=>{if(!e)return v.resolve();const n=IDBKeyRange.lowerBound((function(a){return[a]})(this.userId)),s=[];return mn(t).ee({range:n},((i,a,u)=>{if(i[0]===this.userId){const l=Gt(i[1]);s.push(l)}else u.done()})).next((()=>{F(s.length===0,56720,{rr:s.map((i=>i.canonicalString()))})}))}))}containsKey(t,e){return jh(t,this.userId,e)}ir(t){return zh(t).get(this.userId).next((e=>e||{userId:this.userId,lastAcknowledgedBatchId:qe,lastStreamToken:""}))}}function jh(r,t,e){const n=gs(t,e.path),s=n[1],i=IDBKeyRange.lowerBound(n);let a=!1;return mn(r).ee({range:i,Y:!0},((u,l,d)=>{const[f,p,I]=u;f===t&&p===s&&(a=!0),d.done()})).next((()=>a))}function ce(r){return mt(r,Bt)}function mn(r){return mt(r,En)}function zh(r){return mt(r,br)}class Ye{constructor(t){this.sr=t}next(){return this.sr+=2,this.sr}static _r(){return new Ye(0)}static ar(){return new Ye(-1)}}class Gg{constructor(t,e){this.referenceDelegate=t,this.serializer=e}allocateTargetId(t){return this.ur(t).next((e=>{const n=new Ye(e.highestTargetId);return e.highestTargetId=n.next(),this.cr(t,e).next((()=>e.highestTargetId))}))}getLastRemoteSnapshotVersion(t){return this.ur(t).next((e=>L.fromTimestamp(new X(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(t){return this.ur(t).next((e=>e.highestListenSequenceNumber))}setTargetsMetadata(t,e,n){return this.ur(t).next((s=>(s.highestListenSequenceNumber=e,n&&(s.lastRemoteSnapshotVersion=n.toTimestamp()),e>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=e),this.cr(t,s))))}addTargetData(t,e){return this.lr(t,e).next((()=>this.ur(t).next((n=>(n.targetCount+=1,this.hr(e,n),this.cr(t,n))))))}updateTargetData(t,e){return this.lr(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next((()=>cn(t).delete(e.targetId))).next((()=>this.ur(t))).next((n=>(F(n.targetCount>0,8065),n.targetCount-=1,this.cr(t,n))))}removeTargets(t,e,n){let s=0;const i=[];return cn(t).ee(((a,u)=>{const l=cr(u);l.sequenceNumber<=e&&n.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(t,l)))})).next((()=>v.waitFor(i))).next((()=>s))}forEachTarget(t,e){return cn(t).ee(((n,s)=>{const i=cr(s);e(i)}))}ur(t){return Rc(t).get(ks).next((e=>(F(e!==null,2888),e)))}cr(t,e){return Rc(t).put(ks,e)}lr(t,e){return cn(t).put(Oh(this.serializer,e))}hr(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.ur(t).next((e=>e.targetCount))}getTargetData(t,e){const n=He(e),s=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return cn(t).ee({range:s,index:Nl},((a,u,l)=>{const d=cr(u);Fr(e,d.target)&&(i=d,l.done())})).next((()=>i))}addMatchingKeys(t,e,n){const s=[],i=he(t);return e.forEach((a=>{const u=vt(a.path);s.push(i.put({targetId:n,path:u})),s.push(this.referenceDelegate.addReference(t,n,a))})),v.waitFor(s)}removeMatchingKeys(t,e,n){const s=he(t);return v.forEach(e,(i=>{const a=vt(i.path);return v.waitFor([s.delete([n,a]),this.referenceDelegate.removeReference(t,n,i)])}))}removeMatchingKeysForTargetId(t,e){const n=he(t),s=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(s)}getMatchingKeysForTargetId(t,e){const n=IDBKeyRange.bound([e],[e+1],!1,!0),s=he(t);let i=G();return s.ee({range:n,Y:!0},((a,u,l)=>{const d=Gt(a[1]),f=new N(d);i=i.add(f)})).next((()=>i))}containsKey(t,e){const n=vt(e.path),s=IDBKeyRange.bound([n],[Al(n)],!1,!0);let i=0;return he(t).ee({index:Mo,Y:!0,range:s},(([a,u],l,d)=>{a!==0&&(i++,d.done())})).next((()=>i>0))}At(t,e){return cn(t).get(e).next((n=>n?cr(n):null))}}function cn(r){return mt(r,Tn)}function Rc(r){return mt(r,je)}function he(r){return mt(r,wn)}const Sc="LruGarbageCollector",$g=1048576;function Pc([r,t],[e,n]){const s=q(r,e);return s===0?q(t,n):s}class Kg{constructor(t){this.Pr=t,this.buffer=new tt(Pc),this.Tr=0}Ir(){return++this.Tr}Er(t){const e=[t,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(e);else{const n=this.buffer.last();Pc(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}}get maxValue(){return this.buffer.last()[0]}}class Gh{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Ar(t){V(Sc,`Garbage collection scheduled in ${t}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Ae(e)?V(Sc,"Ignoring IndexedDB error during garbage collection: ",e):await Xe(e)}await this.Ar(3e5)}))}}class Hg{constructor(t,e){this.Vr=t,this.params=e}calculateTargetCount(t,e){return this.Vr.dr(t).next((n=>Math.floor(e/100*n)))}nthSequenceNumber(t,e){if(e===0)return v.resolve(Ot.ce);const n=new Kg(e);return this.Vr.forEachTarget(t,(s=>n.Er(s.sequenceNumber))).next((()=>this.Vr.mr(t,(s=>n.Er(s))))).next((()=>n.maxValue))}removeTargets(t,e,n){return this.Vr.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.Vr.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(V("LruGarbageCollector","Garbage collection skipped; disabled"),v.resolve(bc)):this.getCacheSize(t).next((n=>n<this.params.cacheSizeCollectionThreshold?(V("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),bc):this.gr(t,e)))}getCacheSize(t){return this.Vr.getCacheSize(t)}gr(t,e){let n,s,i,a,u,l,d;const f=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((p=>(p>this.params.maximumSequenceNumbersToCollect?(V("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),s=this.params.maximumSequenceNumbersToCollect):s=p,a=Date.now(),this.nthSequenceNumber(t,s)))).next((p=>(n=p,u=Date.now(),this.removeTargets(t,n,e)))).next((p=>(i=p,l=Date.now(),this.removeOrphanedDocuments(t,n)))).next((p=>(d=Date.now(),ln()<=W.DEBUG&&V("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${s} in `+(u-a)+`ms
	Removed ${i} targets in `+(l-u)+`ms
	Removed ${p} documents in `+(d-l)+`ms
Total Duration: ${d-f}ms`),v.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:p}))))}}function $h(r,t){return new Hg(r,t)}class Wg{constructor(t,e){this.db=t,this.garbageCollector=$h(this,e)}dr(t){const e=this.pr(t);return this.db.getTargetCache().getTargetCount(t).next((n=>e.next((s=>n+s))))}pr(t){let e=0;return this.mr(t,(n=>{e++})).next((()=>e))}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}mr(t,e){return this.yr(t,((n,s)=>e(s)))}addReference(t,e,n){return hs(t,n)}removeReference(t,e,n){return hs(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return hs(t,e)}wr(t,e){return(function(s,i){let a=!1;return zh(s).te((u=>jh(s,u,i).next((l=>(l&&(a=!0),v.resolve(!l)))))).next((()=>a))})(t,e)}removeOrphanedDocuments(t,e){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.yr(t,((a,u)=>{if(u<=e){const l=this.wr(t,a).next((d=>{if(!d)return i++,n.getEntry(t,a).next((()=>(n.removeEntry(a,L.min()),he(t).delete((function(p){return[0,vt(p.path)]})(a)))))}));s.push(l)}})).next((()=>v.waitFor(s))).next((()=>n.apply(t))).next((()=>i))}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return hs(t,e)}yr(t,e){const n=he(t);let s,i=Ot.ce;return n.ee({index:Mo},(([a,u],{path:l,sequenceNumber:d})=>{a===0?(i!==Ot.ce&&e(new N(Gt(s)),i),i=d,s=l):i=Ot.ce})).next((()=>{i!==Ot.ce&&e(new N(Gt(s)),i)}))}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}}function hs(r,t){return he(r).put((function(n,s){return{targetId:0,path:vt(n.path),sequenceNumber:s}})(t,r.currentSequenceNumber))}class Kh{constructor(){this.changes=new te((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,ut.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return n!==void 0?v.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class Qg{constructor(t){this.serializer=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,n){return xe(t).put(n)}removeEntry(t,e,n){return xe(t).delete((function(i,a){const u=i.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],qs(a),u[u.length-1]]})(e,n))}updateMetadata(t,e){return this.getMetadata(t).next((n=>(n.byteSize+=e,this.br(t,n))))}getEntry(t,e){let n=ut.newInvalidDocument(e);return xe(t).ee({index:_s,range:IDBKeyRange.only(rr(e))},((s,i)=>{n=this.Sr(e,i)})).next((()=>n))}Dr(t,e){let n={size:0,document:ut.newInvalidDocument(e)};return xe(t).ee({index:_s,range:IDBKeyRange.only(rr(e))},((s,i)=>{n={document:this.Sr(e,i),size:zs(i)}})).next((()=>n))}getEntries(t,e){let n=Nt();return this.Cr(t,e,((s,i)=>{const a=this.Sr(s,i);n=n.insert(s,a)})).next((()=>n))}vr(t,e){let n=Nt(),s=new it(N.comparator);return this.Cr(t,e,((i,a)=>{const u=this.Sr(i,a);n=n.insert(i,u),s=s.insert(i,zs(a))})).next((()=>({documents:n,Fr:s})))}Cr(t,e,n){if(e.isEmpty())return v.resolve();let s=new tt(Dc);e.forEach((l=>s=s.add(l)));const i=IDBKeyRange.bound(rr(s.first()),rr(s.last())),a=s.getIterator();let u=a.getNext();return xe(t).ee({index:_s,range:i},((l,d,f)=>{const p=N.fromSegments([...d.prefixPath,d.collectionGroup,d.documentId]);for(;u&&Dc(u,p)<0;)n(u,null),u=a.getNext();u&&u.isEqual(p)&&(n(u,d),u=a.hasNext()?a.getNext():null),u?f.j(rr(u)):f.done()})).next((()=>{for(;u;)n(u,null),u=a.hasNext()?a.getNext():null}))}getDocumentsMatchingQuery(t,e,n,s,i){const a=e.path,u=[a.popLast().toArray(),a.lastSegment(),qs(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],l=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return xe(t).H(IDBKeyRange.bound(u,l,!0)).next((d=>{i?.incrementDocumentReadCount(d.length);let f=Nt();for(const p of d){const I=this.Sr(N.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);I.isFoundDocument()&&(Ur(e,I)||s.has(I.key))&&(f=f.insert(I.key,I))}return f}))}getAllFromCollectionGroup(t,e,n,s){let i=Nt();const a=Cc(e,n),u=Cc(e,kt.max());return xe(t).ee({index:xl,range:IDBKeyRange.bound(a,u,!0)},((l,d,f)=>{const p=this.Sr(N.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);i=i.insert(p.key,p),i.size===s&&f.done()})).next((()=>i))}newChangeBuffer(t){return new Yg(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next((e=>e.byteSize))}getMetadata(t){return Vc(t).get(so).next((e=>(F(!!e,20021),e)))}br(t,e){return Vc(t).put(so,e)}Sr(t,e){if(e){const n=kg(this.serializer,e);if(!(n.isNoDocument()&&n.version.isEqual(L.min())))return n}return ut.newInvalidDocument(t)}}function Hh(r){return new Qg(r)}class Yg extends Kh{constructor(t,e){super(),this.Mr=t,this.trackRemovals=e,this.Or=new te((n=>n.toString()),((n,s)=>n.isEqual(s)))}applyChanges(t){const e=[];let n=0,s=new tt(((i,a)=>q(i.canonicalString(),a.canonicalString())));return this.changes.forEach(((i,a)=>{const u=this.Or.get(i);if(e.push(this.Mr.removeEntry(t,i,u.readTime)),a.isValidDocument()){const l=dc(this.Mr.serializer,a);s=s.add(i.path.popLast());const d=zs(l);n+=d-u.size,e.push(this.Mr.addEntry(t,i,l))}else if(n-=u.size,this.trackRemovals){const l=dc(this.Mr.serializer,a.convertToNoDocument(L.min()));e.push(this.Mr.addEntry(t,i,l))}})),s.forEach((i=>{e.push(this.Mr.indexManager.addToCollectionParentIndex(t,i))})),e.push(this.Mr.updateMetadata(t,n)),v.waitFor(e)}getFromCache(t,e){return this.Mr.Dr(t,e).next((n=>(this.Or.set(e,{size:n.size,readTime:n.document.readTime}),n.document)))}getAllFromCache(t,e){return this.Mr.vr(t,e).next((({documents:n,Fr:s})=>(s.forEach(((i,a)=>{this.Or.set(i,{size:a,readTime:n.get(i).readTime})})),n)))}}function Vc(r){return mt(r,Rr)}function xe(r){return mt(r,Ns)}function rr(r){const t=r.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Cc(r,t){const e=t.documentKey.path.toArray();return[r,qs(t.readTime),e.slice(0,e.length-2),e.length>0?e[e.length-1]:""]}function Dc(r,t){const e=r.path.toArray(),n=t.path.toArray();let s=0;for(let i=0;i<e.length-2&&i<n.length-2;++i)if(s=q(e[i],n[i]),s)return s;return s=q(e.length,n.length),s||(s=q(e[e.length-2],n[n.length-2]),s||q(e[e.length-1],n[n.length-1]))}class Jg{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class Wh{constructor(t,e,n,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=s}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((s=>(n=s,this.remoteDocumentCache.getEntry(t,e)))).next((s=>(n!==null&&Ir(n.mutation,s,Ct.empty(),X.now()),s)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((n=>this.getLocalViewOfDocuments(t,n,G()).next((()=>n))))}getLocalViewOfDocuments(t,e,n=G()){const s=$t();return this.populateOverlays(t,s,e).next((()=>this.computeViews(t,e,s,n).next((i=>{let a=ar();return i.forEach(((u,l)=>{a=a.insert(u,l.overlayedDocument)})),a}))))}getOverlayedDocuments(t,e){const n=$t();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,G())))}populateOverlays(t,e,n){const s=[];return n.forEach((i=>{e.has(i)||s.push(i)})),this.documentOverlayCache.getOverlays(t,s).next((i=>{i.forEach(((a,u)=>{e.set(a,u)}))}))}computeViews(t,e,n,s){let i=Nt();const a=yr(),u=(function(){return yr()})();return e.forEach(((l,d)=>{const f=n.get(d.key);s.has(d.key)&&(f===void 0||f.mutation instanceof ee)?i=i.insert(d.key,d):f!==void 0?(a.set(d.key,f.mutation.getFieldMask()),Ir(f.mutation,d,f.mutation.getFieldMask(),X.now())):a.set(d.key,Ct.empty())})),this.recalculateAndSaveOverlays(t,i).next((l=>(l.forEach(((d,f)=>a.set(d,f))),e.forEach(((d,f)=>u.set(d,new Jg(f,a.get(d)??null)))),u)))}recalculateAndSaveOverlays(t,e){const n=yr();let s=new it(((a,u)=>a-u)),i=G();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((a=>{for(const u of a)u.keys().forEach((l=>{const d=e.get(l);if(d===null)return;let f=n.get(l)||Ct.empty();f=u.applyToLocalView(d,f),n.set(l,f);const p=(s.get(u.batchId)||G()).add(l);s=s.insert(u.batchId,p)}))})).next((()=>{const a=[],u=s.getReverseIterator();for(;u.hasNext();){const l=u.getNext(),d=l.key,f=l.value,p=ch();f.forEach((I=>{if(!i.has(I)){const S=_h(e.get(I),n.get(I));S!==null&&p.set(I,S),i=i.add(I)}})),a.push(this.documentOverlayCache.saveOverlays(t,d,p))}return v.waitFor(a)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((n=>this.recalculateAndSaveOverlays(t,n)))}getDocumentsMatchingQuery(t,e,n,s){return eg(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):sh(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,s):this.getDocumentsMatchingCollectionQuery(t,e,n,s)}getNextDocuments(t,e,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,s).next((i=>{const a=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,s-i.size):v.resolve($t());let u=wr,l=i;return a.next((d=>v.forEach(d,((f,p)=>(u<p.largestBatchId&&(u=p.largestBatchId),i.get(f)?v.resolve():this.remoteDocumentCache.getEntry(t,f).next((I=>{l=l.insert(f,I)}))))).next((()=>this.populateOverlays(t,d,i))).next((()=>this.computeViews(t,l,d,G()))).next((f=>({batchId:u,changes:uh(f)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new N(e)).next((n=>{let s=ar();return n.isFoundDocument()&&(s=s.insert(n.key,n)),s}))}getDocumentsMatchingCollectionGroupQuery(t,e,n,s){const i=e.collectionGroup;let a=ar();return this.indexManager.getCollectionParents(t,i).next((u=>v.forEach(u,(l=>{const d=(function(p,I){return new Lr(I,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)})(e,l.child(i));return this.getDocumentsMatchingCollectionQuery(t,d,n,s).next((f=>{f.forEach(((p,I)=>{a=a.insert(p,I)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(t,e,n,s){let i;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,i,s)))).next((a=>{i.forEach(((l,d)=>{const f=d.getKey();a.get(f)===null&&(a=a.insert(f,ut.newInvalidDocument(f)))}));let u=ar();return a.forEach(((l,d)=>{const f=i.get(l);f!==void 0&&Ir(f.mutation,d,Ct.empty(),X.now()),Ur(e,d)&&(u=u.insert(l,d))})),u}))}}class Xg{constructor(t){this.serializer=t,this.Nr=new Map,this.Br=new Map}getBundleMetadata(t,e){return v.resolve(this.Nr.get(e))}saveBundleMetadata(t,e){return this.Nr.set(e.id,(function(s){return{id:s.id,version:s.version,createTime:Pt(s.createTime)}})(e)),v.resolve()}getNamedQuery(t,e){return v.resolve(this.Br.get(e))}saveNamedQuery(t,e){return this.Br.set(e.name,(function(s){return{name:s.name,query:Fh(s.bundledQuery),readTime:Pt(s.readTime)}})(e)),v.resolve()}}class Zg{constructor(){this.overlays=new it(N.comparator),this.Lr=new Map}getOverlay(t,e){return v.resolve(this.overlays.get(e))}getOverlays(t,e){const n=$t();return v.forEach(e,(s=>this.getOverlay(t,s).next((i=>{i!==null&&n.set(s,i)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((s,i)=>{this.bt(t,e,i)})),v.resolve()}removeOverlaysForBatchId(t,e,n){const s=this.Lr.get(n);return s!==void 0&&(s.forEach((i=>this.overlays=this.overlays.remove(i))),this.Lr.delete(n)),v.resolve()}getOverlaysForCollection(t,e,n){const s=$t(),i=e.length+1,a=new N(e.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){const l=u.getNext().value,d=l.getKey();if(!e.isPrefixOf(d.path))break;d.path.length===i&&l.largestBatchId>n&&s.set(l.getKey(),l)}return v.resolve(s)}getOverlaysForCollectionGroup(t,e,n,s){let i=new it(((d,f)=>d-f));const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===e&&d.largestBatchId>n){let f=i.get(d.largestBatchId);f===null&&(f=$t(),i=i.insert(d.largestBatchId,f)),f.set(d.getKey(),d)}}const u=$t(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach(((d,f)=>u.set(d,f))),!(u.size()>=s)););return v.resolve(u)}bt(t,e,n){const s=this.overlays.get(n.key);if(s!==null){const a=this.Lr.get(s.largestBatchId).delete(n.key);this.Lr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new Ho(e,n));let i=this.Lr.get(e);i===void 0&&(i=G(),this.Lr.set(e,i)),this.Lr.set(e,i.add(n.key))}}class t_{constructor(){this.sessionToken=dt.EMPTY_BYTE_STRING}getSessionToken(t){return v.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,v.resolve()}}class Xo{constructor(){this.kr=new tt(gt.Kr),this.qr=new tt(gt.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(t,e){const n=new gt(t,e);this.kr=this.kr.add(n),this.qr=this.qr.add(n)}$r(t,e){t.forEach((n=>this.addReference(n,e)))}removeReference(t,e){this.Wr(new gt(t,e))}Qr(t,e){t.forEach((n=>this.removeReference(n,e)))}Gr(t){const e=new N(new Y([])),n=new gt(e,t),s=new gt(e,t+1),i=[];return this.qr.forEachInRange([n,s],(a=>{this.Wr(a),i.push(a.key)})),i}zr(){this.kr.forEach((t=>this.Wr(t)))}Wr(t){this.kr=this.kr.delete(t),this.qr=this.qr.delete(t)}jr(t){const e=new N(new Y([])),n=new gt(e,t),s=new gt(e,t+1);let i=G();return this.qr.forEachInRange([n,s],(a=>{i=i.add(a.key)})),i}containsKey(t){const e=new gt(t,0),n=this.kr.firstAfterOrEqual(e);return n!==null&&t.isEqual(n.key)}}class gt{constructor(t,e){this.key=t,this.Hr=e}static Kr(t,e){return N.comparator(t.key,e.key)||q(t.Hr,e.Hr)}static Ur(t,e){return q(t.Hr,e.Hr)||N.comparator(t.key,e.key)}}class e_{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.Yn=1,this.Jr=new tt(gt.Kr)}checkEmpty(t){return v.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,n,s){const i=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new $o(i,e,n,s);this.mutationQueue.push(a);for(const u of s)this.Jr=this.Jr.add(new gt(u.key,i)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast());return v.resolve(a)}lookupMutationBatch(t,e){return v.resolve(this.Zr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,s=this.Xr(n),i=s<0?0:s;return v.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return v.resolve(this.mutationQueue.length===0?qe:this.Yn-1)}getAllMutationBatches(t){return v.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new gt(e,0),s=new gt(e,Number.POSITIVE_INFINITY),i=[];return this.Jr.forEachInRange([n,s],(a=>{const u=this.Zr(a.Hr);i.push(u)})),v.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new tt(q);return e.forEach((s=>{const i=new gt(s,0),a=new gt(s,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([i,a],(u=>{n=n.add(u.Hr)}))})),v.resolve(this.Yr(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,s=n.length+1;let i=n;N.isDocumentKey(i)||(i=i.child(""));const a=new gt(new N(i),0);let u=new tt(q);return this.Jr.forEachWhile((l=>{const d=l.key.path;return!!n.isPrefixOf(d)&&(d.length===s&&(u=u.add(l.Hr)),!0)}),a),v.resolve(this.Yr(u))}Yr(t){const e=[];return t.forEach((n=>{const s=this.Zr(n);s!==null&&e.push(s)})),e}removeMutationBatch(t,e){F(this.ei(e.batchId,"removed")===0,55003),this.mutationQueue.shift();let n=this.Jr;return v.forEach(e.mutations,(s=>{const i=new gt(s.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)})).next((()=>{this.Jr=n}))}nr(t){}containsKey(t,e){const n=new gt(e,0),s=this.Jr.firstAfterOrEqual(n);return v.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,v.resolve()}ei(t,e){return this.Xr(t)}Xr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Zr(t){const e=this.Xr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class n_{constructor(t){this.ti=t,this.docs=(function(){return new it(N.comparator)})(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,s=this.docs.get(n),i=s?s.size:0,a=this.ti(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return v.resolve(n?n.document.mutableCopy():ut.newInvalidDocument(e))}getEntries(t,e){let n=Nt();return e.forEach((s=>{const i=this.docs.get(s);n=n.insert(s,i?i.document.mutableCopy():ut.newInvalidDocument(s))})),v.resolve(n)}getDocumentsMatchingQuery(t,e,n,s){let i=Nt();const a=e.path,u=new N(a.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(u);for(;l.hasNext();){const{key:d,value:{document:f}}=l.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||No(Sl(f),n)<=0||(s.has(f.key)||Ur(e,f))&&(i=i.insert(f.key,f.mutableCopy()))}return v.resolve(i)}getAllFromCollectionGroup(t,e,n,s){O(9500)}ni(t,e){return v.forEach(this.docs,(n=>e(n)))}newChangeBuffer(t){return new r_(this)}getSize(t){return v.resolve(this.size)}}class r_ extends Kh{constructor(t){super(),this.Mr=t}applyChanges(t){const e=[];return this.changes.forEach(((n,s)=>{s.isValidDocument()?e.push(this.Mr.addEntry(t,s)):this.Mr.removeEntry(n)})),v.waitFor(e)}getFromCache(t,e){return this.Mr.getEntry(t,e)}getAllFromCache(t,e){return this.Mr.getEntries(t,e)}}class s_{constructor(t){this.persistence=t,this.ri=new te((e=>He(e)),Fr),this.lastRemoteSnapshotVersion=L.min(),this.highestTargetId=0,this.ii=0,this.si=new Xo,this.targetCount=0,this.oi=Ye._r()}forEachTarget(t,e){return this.ri.forEach(((n,s)=>e(s))),v.resolve()}getLastRemoteSnapshotVersion(t){return v.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return v.resolve(this.ii)}allocateTargetId(t){return this.highestTargetId=this.oi.next(),v.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ii&&(this.ii=e),v.resolve()}lr(t){this.ri.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.oi=new Ye(e),this.highestTargetId=e),t.sequenceNumber>this.ii&&(this.ii=t.sequenceNumber)}addTargetData(t,e){return this.lr(e),this.targetCount+=1,v.resolve()}updateTargetData(t,e){return this.lr(e),v.resolve()}removeTargetData(t,e){return this.ri.delete(e.target),this.si.Gr(e.targetId),this.targetCount-=1,v.resolve()}removeTargets(t,e,n){let s=0;const i=[];return this.ri.forEach(((a,u)=>{u.sequenceNumber<=e&&n.get(u.targetId)===null&&(this.ri.delete(a),i.push(this.removeMatchingKeysForTargetId(t,u.targetId)),s++)})),v.waitFor(i).next((()=>s))}getTargetCount(t){return v.resolve(this.targetCount)}getTargetData(t,e){const n=this.ri.get(e)||null;return v.resolve(n)}addMatchingKeys(t,e,n){return this.si.$r(e,n),v.resolve()}removeMatchingKeys(t,e,n){this.si.Qr(e,n);const s=this.persistence.referenceDelegate,i=[];return s&&e.forEach((a=>{i.push(s.markPotentiallyOrphaned(t,a))})),v.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this.si.Gr(e),v.resolve()}getMatchingKeysForTargetId(t,e){const n=this.si.jr(e);return v.resolve(n)}containsKey(t,e){return v.resolve(this.si.containsKey(e))}}class Zo{constructor(t,e){this._i={},this.overlays={},this.ai=new Ot(0),this.ui=!1,this.ui=!0,this.ci=new t_,this.referenceDelegate=t(this),this.li=new s_(this),this.indexManager=new jg,this.remoteDocumentCache=(function(s){return new n_(s)})((n=>this.referenceDelegate.hi(n))),this.serializer=new Mh(e),this.Pi=new Xg(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Zg,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this._i[t.toKey()];return n||(n=new e_(e,this.referenceDelegate),this._i[t.toKey()]=n),n}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(t,e,n){V("MemoryPersistence","Starting transaction:",t);const s=new i_(this.ai.next());return this.referenceDelegate.Ti(),n(s).next((i=>this.referenceDelegate.Ii(s).next((()=>i)))).toPromise().then((i=>(s.raiseOnCommittedEvent(),i)))}Ei(t,e){return v.or(Object.values(this._i).map((n=>()=>n.containsKey(t,e))))}}class i_ extends Vl{constructor(t){super(),this.currentSequenceNumber=t}}class ui{constructor(t){this.persistence=t,this.Ri=new Xo,this.Ai=null}static Vi(t){return new ui(t)}get di(){if(this.Ai)return this.Ai;throw O(60996)}addReference(t,e,n){return this.Ri.addReference(n,e),this.di.delete(n.toString()),v.resolve()}removeReference(t,e,n){return this.Ri.removeReference(n,e),this.di.add(n.toString()),v.resolve()}markPotentiallyOrphaned(t,e){return this.di.add(e.toString()),v.resolve()}removeTarget(t,e){this.Ri.Gr(e.targetId).forEach((s=>this.di.add(s.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((s=>{s.forEach((i=>this.di.add(i.toString())))})).next((()=>n.removeTargetData(t,e)))}Ti(){this.Ai=new Set}Ii(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return v.forEach(this.di,(n=>{const s=N.fromPath(n);return this.mi(t,s).next((i=>{i||e.removeEntry(s,L.min())}))})).next((()=>(this.Ai=null,e.apply(t))))}updateLimboDocument(t,e){return this.mi(t,e).next((n=>{n?this.di.delete(e.toString()):this.di.add(e.toString())}))}hi(t){return 0}mi(t,e){return v.or([()=>v.resolve(this.Ri.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ei(t,e)])}}class Gs{constructor(t,e){this.persistence=t,this.fi=new te((n=>vt(n.path)),((n,s)=>n.isEqual(s))),this.garbageCollector=$h(this,e)}static Vi(t,e){return new Gs(t,e)}Ti(){}Ii(t){return v.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}dr(t){const e=this.pr(t);return this.persistence.getTargetCache().getTargetCount(t).next((n=>e.next((s=>n+s))))}pr(t){let e=0;return this.mr(t,(n=>{e++})).next((()=>e))}mr(t,e){return v.forEach(this.fi,((n,s)=>this.wr(t,n,s).next((i=>i?v.resolve():e(s)))))}removeTargets(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)}removeOrphanedDocuments(t,e){let n=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ni(t,(a=>this.wr(t,a,e).next((u=>{u||(n++,i.removeEntry(a,L.min()))})))).next((()=>i.apply(t))).next((()=>n))}markPotentiallyOrphaned(t,e){return this.fi.set(e,t.currentSequenceNumber),v.resolve()}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)}addReference(t,e,n){return this.fi.set(n,t.currentSequenceNumber),v.resolve()}removeReference(t,e,n){return this.fi.set(n,t.currentSequenceNumber),v.resolve()}updateLimboDocument(t,e){return this.fi.set(e,t.currentSequenceNumber),v.resolve()}hi(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=Is(t.data.value)),e}wr(t,e,n){return v.or([()=>this.persistence.Ei(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{const s=this.fi.get(e);return v.resolve(s!==void 0&&s>n)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}class o_{constructor(t){this.serializer=t}k(t,e,n,s){const i=new Qs("createOrUpgrade",e);n<1&&s>=1&&((function(l){l.createObjectStore(Or)})(t),(function(l){l.createObjectStore(br,{keyPath:gp}),l.createObjectStore(Bt,{keyPath:ju,autoIncrement:!0}).createIndex(Ue,zu,{unique:!0}),l.createObjectStore(En)})(t),xc(t),(function(l){l.createObjectStore(Me)})(t));let a=v.resolve();return n<3&&s>=3&&(n!==0&&((function(l){l.deleteObjectStore(wn),l.deleteObjectStore(Tn),l.deleteObjectStore(je)})(t),xc(t)),a=a.next((()=>(function(l){const d=l.store(je),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:L.min().toTimestamp(),targetCount:0};return d.put(ks,f)})(i)))),n<4&&s>=4&&(n!==0&&(a=a.next((()=>(function(l,d){return d.store(Bt).H().next((p=>{l.deleteObjectStore(Bt),l.createObjectStore(Bt,{keyPath:ju,autoIncrement:!0}).createIndex(Ue,zu,{unique:!0});const I=d.store(Bt),S=p.map((C=>I.put(C)));return v.waitFor(S)}))})(t,i)))),a=a.next((()=>{(function(l){l.createObjectStore(vn,{keyPath:bp})})(t)}))),n<5&&s>=5&&(a=a.next((()=>this.gi(i)))),n<6&&s>=6&&(a=a.next((()=>((function(l){l.createObjectStore(Rr)})(t),this.pi(i))))),n<7&&s>=7&&(a=a.next((()=>this.yi(i)))),n<8&&s>=8&&(a=a.next((()=>this.wi(t,i)))),n<9&&s>=9&&(a=a.next((()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(t)}))),n<10&&s>=10&&(a=a.next((()=>this.bi(i)))),n<11&&s>=11&&(a=a.next((()=>{(function(l){l.createObjectStore(Js,{keyPath:Rp})})(t),(function(l){l.createObjectStore(Xs,{keyPath:Sp})})(t)}))),n<12&&s>=12&&(a=a.next((()=>{(function(l){const d=l.createObjectStore(Zs,{keyPath:kp});d.createIndex(oo,Mp,{unique:!1}),d.createIndex(Ol,Op,{unique:!1})})(t)}))),n<13&&s>=13&&(a=a.next((()=>(function(l){const d=l.createObjectStore(Ns,{keyPath:yp});d.createIndex(_s,Ip),d.createIndex(xl,Ep)})(t))).next((()=>this.Si(t,i))).next((()=>t.deleteObjectStore(Me)))),n<14&&s>=14&&(a=a.next((()=>this.Di(t,i)))),n<15&&s>=15&&(a=a.next((()=>(function(l){l.createObjectStore(Oo,{keyPath:Pp,autoIncrement:!0}).createIndex(io,Vp,{unique:!1}),l.createObjectStore(mr,{keyPath:Cp}).createIndex(kl,Dp,{unique:!1}),l.createObjectStore(pr,{keyPath:xp}).createIndex(Ml,Np,{unique:!1})})(t)))),n<16&&s>=16&&(a=a.next((()=>{e.objectStore(mr).clear()})).next((()=>{e.objectStore(pr).clear()}))),n<17&&s>=17&&(a=a.next((()=>{(function(l){l.createObjectStore(Fo,{keyPath:Fp})})(t)}))),n<18&&s>=18&&ul()&&(a=a.next((()=>{e.objectStore(mr).clear()})).next((()=>{e.objectStore(pr).clear()}))),a}pi(t){let e=0;return t.store(Me).ee(((n,s)=>{e+=zs(s)})).next((()=>{const n={byteSize:e};return t.store(Rr).put(so,n)}))}gi(t){const e=t.store(br),n=t.store(Bt);return e.H().next((s=>v.forEach(s,(i=>{const a=IDBKeyRange.bound([i.userId,qe],[i.userId,i.lastAcknowledgedBatchId]);return n.H(Ue,a).next((u=>v.forEach(u,(l=>{F(l.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:l.batchId});const d=Fe(this.serializer,l);return qh(t,i.userId,d).next((()=>{}))}))))}))))}yi(t){const e=t.store(wn),n=t.store(Me);return t.store(je).get(ks).next((s=>{const i=[];return n.ee(((a,u)=>{const l=new Y(a),d=(function(p){return[0,vt(p)]})(l);i.push(e.get(d).next((f=>f?v.resolve():(p=>e.put({targetId:0,path:vt(p),sequenceNumber:s.highestListenSequenceNumber}))(l))))})).next((()=>v.waitFor(i)))}))}wi(t,e){t.createObjectStore(Sr,{keyPath:Ap});const n=e.store(Sr),s=new Jo,i=a=>{if(s.add(a)){const u=a.lastSegment(),l=a.popLast();return n.put({collectionId:u,parent:vt(l)})}};return e.store(Me).ee({Y:!0},((a,u)=>{const l=new Y(a);return i(l.popLast())})).next((()=>e.store(En).ee({Y:!0},(([a,u,l],d)=>{const f=Gt(u);return i(f.popLast())}))))}bi(t){const e=t.store(Tn);return e.ee(((n,s)=>{const i=cr(s),a=Oh(this.serializer,i);return e.put(a)}))}Si(t,e){const n=e.store(Me),s=[];return n.ee(((i,a)=>{const u=e.store(Ns),l=(function(p){return p.document?new N(Y.fromString(p.document.name).popFirst(5)):p.noDocument?N.fromSegments(p.noDocument.path):p.unknownDocument?N.fromSegments(p.unknownDocument.path):O(36783)})(a).path.toArray(),d={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};s.push(u.put(d))})).next((()=>v.waitFor(s)))}Di(t,e){const n=e.store(Bt),s=Hh(this.serializer),i=new Zo(ui.Vi,this.serializer.yt);return n.H().next((a=>{const u=new Map;return a.forEach((l=>{let d=u.get(l.userId)??G();Fe(this.serializer,l).keys().forEach((f=>d=d.add(f))),u.set(l.userId,d)})),v.forEach(u,((l,d)=>{const f=new _t(d),p=oi.wt(this.serializer,f),I=i.getIndexManager(f),S=ai.wt(f,this.serializer,I,i.referenceDelegate);return new Wh(s,S,p,I).recalculateAndSaveOverlaysForDocumentKeys(new ao(e,Ot.ce),l).next()}))}))}}function xc(r){r.createObjectStore(wn,{keyPath:wp}).createIndex(Mo,vp,{unique:!0}),r.createObjectStore(Tn,{keyPath:"targetId"}).createIndex(Nl,Tp,{unique:!0}),r.createObjectStore(je)}const le="IndexedDbPersistence",$i=18e5,Ki=5e3,Hi="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",a_="main";class ta{constructor(t,e,n,s,i,a,u,l,d,f,p=18){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Ci=i,this.window=a,this.document=u,this.Fi=d,this.Mi=f,this.xi=p,this.ai=null,this.ui=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Oi=null,this.inForeground=!1,this.Ni=null,this.Bi=null,this.Li=Number.NEGATIVE_INFINITY,this.ki=I=>Promise.resolve(),!ta.v())throw new x(P.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Wg(this,s),this.Ki=e+a_,this.serializer=new Mh(l),this.qi=new ge(this.Ki,this.xi,new o_(this.serializer)),this.ci=new Og,this.li=new Gg(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Hh(this.serializer),this.Pi=new Mg,this.window&&this.window.localStorage?this.Ui=this.window.localStorage:(this.Ui=null,f===!1&&Rt(le,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.$i().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new x(P.FAILED_PRECONDITION,Hi);return this.Wi(),this.Qi(),this.Gi(),this.runTransaction("getHighestListenSequenceNumber","readonly",(t=>this.li.getHighestSequenceNumber(t)))})).then((t=>{this.ai=new Ot(t,this.Fi)})).then((()=>{this.ui=!0})).catch((t=>(this.qi&&this.qi.close(),Promise.reject(t))))}zi(t){return this.ki=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.qi.q((async e=>{e.newVersion===null&&await t()}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.Ci.enqueueAndForget((async()=>{this.started&&await this.$i()})))}$i(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(t=>ds(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.ji(t).next((e=>{e||(this.isPrimary=!1,this.Ci.enqueueRetryable((()=>this.ki(!1))))}))})).next((()=>this.Hi(t))).next((e=>this.isPrimary&&!e?this.Ji(t).next((()=>!1)):!!e&&this.Zi(t).next((()=>!0)))))).catch((t=>{if(Ae(t))return V(le,"Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return V(le,"Releasing owner lease after error during lease refresh",t),!1})).then((t=>{this.isPrimary!==t&&this.Ci.enqueueRetryable((()=>this.ki(t))),this.isPrimary=t}))}ji(t){return sr(t).get(rn).next((e=>v.resolve(this.Xi(e))))}Yi(t){return ds(t).delete(this.clientId)}async es(){if(this.isPrimary&&!this.ts(this.Li,$i)){this.Li=Date.now();const t=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(e=>{const n=mt(e,vn);return n.H().next((s=>{const i=this.ns(s,$i),a=s.filter((u=>i.indexOf(u)===-1));return v.forEach(a,(u=>n.delete(u.clientId))).next((()=>a))}))})).catch((()=>[]));if(this.Ui)for(const e of t)this.Ui.removeItem(this.rs(e.clientId))}}Gi(){this.Bi=this.Ci.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.$i().then((()=>this.es())).then((()=>this.Gi()))))}Xi(t){return!!t&&t.ownerId===this.clientId}Hi(t){return this.Mi?v.resolve(!0):sr(t).get(rn).next((e=>{if(e!==null&&this.ts(e.leaseTimestampMs,Ki)&&!this.ss(e.ownerId)){if(this.Xi(e)&&this.networkEnabled)return!0;if(!this.Xi(e)){if(!e.allowTabSynchronization)throw new x(P.FAILED_PRECONDITION,Hi);return!1}}return!(!this.networkEnabled||!this.inForeground)||ds(t).H().next((n=>this.ns(n,Ki).find((s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,a=!this.inForeground&&s.inForeground,u=this.networkEnabled===s.networkEnabled;if(i||a&&u)return!0}return!1}))===void 0))})).next((e=>(this.isPrimary!==e&&V(le,`Client ${e?"is":"is not"} eligible for a primary lease.`),e)))}async shutdown(){this.ui=!1,this._s(),this.Bi&&(this.Bi.cancel(),this.Bi=null),this.us(),this.cs(),await this.qi.runTransaction("shutdown","readwrite",[Or,vn],(t=>{const e=new ao(t,Ot.ce);return this.Ji(e).next((()=>this.Yi(e)))})),this.qi.close(),this.ls()}ns(t,e){return t.filter((n=>this.ts(n.updateTimeMs,e)&&!this.ss(n.clientId)))}hs(){return this.runTransaction("getActiveClients","readonly",(t=>ds(t).H().next((e=>this.ns(e,$i).map((n=>n.clientId))))))}get started(){return this.ui}getGlobalsCache(){return this.ci}getMutationQueue(t,e){return ai.wt(t,this.serializer,e,this.referenceDelegate)}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new zg(t,this.serializer.yt.databaseId)}getDocumentOverlayCache(t){return oi.wt(this.serializer,t)}getBundleCache(){return this.Pi}runTransaction(t,e,n){V(le,"Starting transaction:",t);const s=e==="readonly"?"readonly":"readwrite",i=(function(l){return l===18?Up:l===17?Ul:l===16?Bp:l===15?Lo:l===14?Bl:l===13?Ll:l===12?Lp:l===11?Fl:void O(60245)})(this.xi);let a;return this.qi.runTransaction(t,s,i,(u=>(a=new ao(u,this.ai?this.ai.next():Ot.ce),e==="readwrite-primary"?this.ji(a).next((l=>!!l||this.Hi(a))).next((l=>{if(!l)throw Rt(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Ci.enqueueRetryable((()=>this.ki(!1))),new x(P.FAILED_PRECONDITION,Pl);return n(a)})).next((l=>this.Zi(a).next((()=>l)))):this.Ps(a).next((()=>n(a)))))).then((u=>(a.raiseOnCommittedEvent(),u)))}Ps(t){return sr(t).get(rn).next((e=>{if(e!==null&&this.ts(e.leaseTimestampMs,Ki)&&!this.ss(e.ownerId)&&!this.Xi(e)&&!(this.Mi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new x(P.FAILED_PRECONDITION,Hi)}))}Zi(t){const e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return sr(t).put(rn,e)}static v(){return ge.v()}Ji(t){const e=sr(t);return e.get(rn).next((n=>this.Xi(n)?(V(le,"Releasing primary lease."),e.delete(rn)):v.resolve()))}ts(t,e){const n=Date.now();return!(t<n-e)&&(!(t>n)||(Rt(`Detected an update time that is in the future: ${t} > ${n}`),!1))}Wi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ni=()=>{this.Ci.enqueueAndForget((()=>(this.inForeground=this.document.visibilityState==="visible",this.$i())))},this.document.addEventListener("visibilitychange",this.Ni),this.inForeground=this.document.visibilityState==="visible")}us(){this.Ni&&(this.document.removeEventListener("visibilitychange",this.Ni),this.Ni=null)}Qi(){typeof this.window?.addEventListener=="function"&&(this.Oi=()=>{this._s();const t=/(?:Version|Mobile)\/1[456]/;al()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.Ci.enterRestrictedMode(!0),this.Ci.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.Oi))}cs(){this.Oi&&(this.window.removeEventListener("pagehide",this.Oi),this.Oi=null)}ss(t){try{const e=this.Ui?.getItem(this.rs(t))!==null;return V(le,`Client '${t}' ${e?"is":"is not"} zombied in LocalStorage`),e}catch(e){return Rt(le,"Failed to get zombied client id.",e),!1}}_s(){if(this.Ui)try{this.Ui.setItem(this.rs(this.clientId),String(Date.now()))}catch(t){Rt("Failed to set zombie client id.",t)}}ls(){if(this.Ui)try{this.Ui.removeItem(this.rs(this.clientId))}catch{}}rs(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}function sr(r){return mt(r,Or)}function ds(r){return mt(r,vn)}function u_(r,t){let e=r.projectId;return r.isDefaultDatabase||(e+="."+r.database),"firestore/"+t+"/"+e+"/"}class ea{constructor(t,e,n,s){this.targetId=t,this.fromCache=e,this.Ts=n,this.Is=s}static Es(t,e){let n=G(),s=G();for(const i of e.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new ea(t,e.fromCache,n,s)}}class c_{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class Qh{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=(function(){return al()?8:Cl(Ss())>0?6:4})()}initialize(t,e){this.fs=t,this.indexManager=e,this.Rs=!0}getDocumentsMatchingQuery(t,e,n,s){const i={result:null};return this.gs(t,e).next((a=>{i.result=a})).next((()=>{if(!i.result)return this.ps(t,e,s,n).next((a=>{i.result=a}))})).next((()=>{if(i.result)return;const a=new c_;return this.ys(t,e,a).next((u=>{if(i.result=u,this.As)return this.ws(t,e,a,u.size)}))})).next((()=>i.result))}ws(t,e,n,s){return n.documentReadCount<this.Vs?(ln()<=W.DEBUG&&V("QueryEngine","SDK will not create cache indexes for query:",hn(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),v.resolve()):(ln()<=W.DEBUG&&V("QueryEngine","Query:",hn(e),"scans",n.documentReadCount,"local documents and returns",s,"documents as results."),n.documentReadCount>this.ds*s?(ln()<=W.DEBUG&&V("QueryEngine","The SDK decides to create cache indexes for query:",hn(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Lt(e))):v.resolve())}gs(t,e){if(nc(e))return v.resolve(null);let n=Lt(e);return this.indexManager.getIndexType(t,n).next((s=>s===0?null:(e.limit!==null&&s===1&&(e=po(e,null,"F"),n=Lt(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((i=>{const a=G(...i);return this.fs.getDocuments(t,a).next((u=>this.indexManager.getMinOffset(t,n).next((l=>{const d=this.bs(e,u);return this.Ss(e,d,a,l.readTime)?this.gs(t,po(e,null,"F")):this.Ds(t,d,e,l)}))))})))))}ps(t,e,n,s){return nc(e)||s.isEqual(L.min())?v.resolve(null):this.fs.getDocuments(t,n).next((i=>{const a=this.bs(e,i);return this.Ss(e,a,n,s)?v.resolve(null):(ln()<=W.DEBUG&&V("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),hn(e)),this.Ds(t,a,e,cp(s,wr)).next((u=>u)))}))}bs(t,e){let n=new tt(oh(t));return e.forEach(((s,i)=>{Ur(t,i)&&(n=n.add(i))})),n}Ss(t,e,n,s){if(t.limit===null)return!1;if(n.size!==e.size)return!0;const i=t.limitType==="F"?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}ys(t,e,n){return ln()<=W.DEBUG&&V("QueryEngine","Using full collection scan to execute query:",hn(e)),this.fs.getDocumentsMatchingQuery(t,e,kt.min(),n)}Ds(t,e,n,s){return this.fs.getDocumentsMatchingQuery(t,n,s).next((i=>(e.forEach((a=>{i=i.insert(a.key,a)})),i)))}}const na="LocalStore",l_=3e8;class h_{constructor(t,e,n,s){this.persistence=t,this.Cs=e,this.serializer=s,this.vs=new it(q),this.Fs=new te((i=>He(i)),Fr),this.Ms=new Map,this.xs=t.getRemoteDocumentCache(),this.li=t.getTargetCache(),this.Pi=t.getBundleCache(),this.Os(n)}Os(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Wh(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.vs)))}}function Yh(r,t,e,n){return new h_(r,t,e,n)}async function Jh(r,t){const e=j(r);return await e.persistence.runTransaction("Handle user change","readonly",(n=>{let s;return e.mutationQueue.getAllMutationBatches(n).next((i=>(s=i,e.Os(t),e.mutationQueue.getAllMutationBatches(n)))).next((i=>{const a=[],u=[];let l=G();for(const d of s){a.push(d.batchId);for(const f of d.mutations)l=l.add(f.key)}for(const d of i){u.push(d.batchId);for(const f of d.mutations)l=l.add(f.key)}return e.localDocuments.getDocuments(n,l).next((d=>({Ns:d,removedBatchIds:a,addedBatchIds:u})))}))}))}function d_(r,t){const e=j(r);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",(n=>{const s=t.batch.keys(),i=e.xs.newChangeBuffer({trackRemovals:!0});return(function(u,l,d,f){const p=d.batch,I=p.keys();let S=v.resolve();return I.forEach((C=>{S=S.next((()=>f.getEntry(l,C))).next((k=>{const M=d.docVersions.get(C);F(M!==null,48541),k.version.compareTo(M)<0&&(p.applyToRemoteDocument(k,d),k.isValidDocument()&&(k.setReadTime(d.commitVersion),f.addEntry(k)))}))})),S.next((()=>u.mutationQueue.removeMutationBatch(l,p)))})(e,n,t,i).next((()=>i.apply(n))).next((()=>e.mutationQueue.performConsistencyCheck(n))).next((()=>e.documentOverlayCache.removeOverlaysForBatchId(n,s,t.batch.batchId))).next((()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,(function(u){let l=G();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(l=l.add(u.batch.mutations[d].key));return l})(t)))).next((()=>e.localDocuments.getDocuments(n,s)))}))}function Xh(r){const t=j(r);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.li.getLastRemoteSnapshotVersion(e)))}function f_(r,t){const e=j(r),n=t.snapshotVersion;let s=e.vs;return e.persistence.runTransaction("Apply remote event","readwrite-primary",(i=>{const a=e.xs.newChangeBuffer({trackRemovals:!0});s=e.vs;const u=[];t.targetChanges.forEach(((f,p)=>{const I=s.get(p);if(!I)return;u.push(e.li.removeMatchingKeys(i,f.removedDocuments,p).next((()=>e.li.addMatchingKeys(i,f.addedDocuments,p))));let S=I.withSequenceNumber(i.currentSequenceNumber);t.targetMismatches.get(p)!==null?S=S.withResumeToken(dt.EMPTY_BYTE_STRING,L.min()).withLastLimboFreeSnapshotVersion(L.min()):f.resumeToken.approximateByteSize()>0&&(S=S.withResumeToken(f.resumeToken,n)),s=s.insert(p,S),(function(k,M,$){return k.resumeToken.approximateByteSize()===0||M.snapshotVersion.toMicroseconds()-k.snapshotVersion.toMicroseconds()>=l_?!0:$.addedDocuments.size+$.modifiedDocuments.size+$.removedDocuments.size>0})(I,S,f)&&u.push(e.li.updateTargetData(i,S))}));let l=Nt(),d=G();if(t.documentUpdates.forEach((f=>{t.resolvedLimboDocuments.has(f)&&u.push(e.persistence.referenceDelegate.updateLimboDocument(i,f))})),u.push(m_(i,a,t.documentUpdates).next((f=>{l=f.Bs,d=f.Ls}))),!n.isEqual(L.min())){const f=e.li.getLastRemoteSnapshotVersion(i).next((p=>e.li.setTargetsMetadata(i,i.currentSequenceNumber,n)));u.push(f)}return v.waitFor(u).next((()=>a.apply(i))).next((()=>e.localDocuments.getLocalViewOfDocuments(i,l,d))).next((()=>l))})).then((i=>(e.vs=s,i)))}function m_(r,t,e){let n=G(),s=G();return e.forEach((i=>n=n.add(i))),t.getEntries(r,n).next((i=>{let a=Nt();return e.forEach(((u,l)=>{const d=i.get(u);l.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(u)),l.isNoDocument()&&l.version.isEqual(L.min())?(t.removeEntry(u,l.readTime),a=a.insert(u,l)):!d.isValidDocument()||l.version.compareTo(d.version)>0||l.version.compareTo(d.version)===0&&d.hasPendingWrites?(t.addEntry(l),a=a.insert(u,l)):V(na,"Ignoring outdated watch update for ",u,". Current version:",d.version," Watch version:",l.version)})),{Bs:a,Ls:s}}))}function p_(r,t){const e=j(r);return e.persistence.runTransaction("Get next mutation batch","readonly",(n=>(t===void 0&&(t=qe),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t))))}function g_(r,t){const e=j(r);return e.persistence.runTransaction("Allocate target","readwrite",(n=>{let s;return e.li.getTargetData(n,t).next((i=>i?(s=i,v.resolve(s)):e.li.allocateTargetId(n).next((a=>(s=new Qt(t,a,"TargetPurposeListen",n.currentSequenceNumber),e.li.addTargetData(n,s).next((()=>s)))))))})).then((n=>{const s=e.vs.get(n.targetId);return(s===null||n.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(e.vs=e.vs.insert(n.targetId,n),e.Fs.set(t,n.targetId)),n}))}async function vo(r,t,e){const n=j(r),s=n.vs.get(t),i=e?"readwrite":"readwrite-primary";try{e||await n.persistence.runTransaction("Release target",i,(a=>n.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!Ae(a))throw a;V(na,`Failed to update sequence numbers for target ${t}: ${a}`)}n.vs=n.vs.remove(t),n.Fs.delete(s.target)}function Nc(r,t,e){const n=j(r);let s=L.min(),i=G();return n.persistence.runTransaction("Execute query","readwrite",(a=>(function(l,d,f){const p=j(l),I=p.Fs.get(f);return I!==void 0?v.resolve(p.vs.get(I)):p.li.getTargetData(d,f)})(n,a,Lt(t)).next((u=>{if(u)return s=u.lastLimboFreeSnapshotVersion,n.li.getMatchingKeysForTargetId(a,u.targetId).next((l=>{i=l}))})).next((()=>n.Cs.getDocumentsMatchingQuery(a,t,e?s:L.min(),e?i:G()))).next((u=>(__(n,rg(t),u),{documents:u,ks:i})))))}function __(r,t,e){let n=r.Ms.get(t)||L.min();e.forEach(((s,i)=>{i.readTime.compareTo(n)>0&&(n=i.readTime)})),r.Ms.set(t,n)}class kc{constructor(){this.activeTargetIds=cg()}Qs(t){this.activeTargetIds=this.activeTargetIds.add(t)}Gs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Ws(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Zh{constructor(){this.vo=new kc,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t,e=!0){return e&&this.vo.Qs(t),this.Fo[t]||"not-current"}updateQueryState(t,e,n){this.Fo[t]=e}removeLocalQueryTarget(t){this.vo.Gs(t)}isLocalQueryTarget(t){return this.vo.activeTargetIds.has(t)}clearQueryState(t){delete this.Fo[t]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(t){return this.vo.activeTargetIds.has(t)}start(){return this.vo=new kc,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class y_{Mo(t){}shutdown(){}}const Mc="ConnectivityMonitor";class Oc{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(t){this.Lo.push(t)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){V(Mc,"Network connectivity changed: AVAILABLE");for(const t of this.Lo)t(0)}Bo(){V(Mc,"Network connectivity changed: UNAVAILABLE");for(const t of this.Lo)t(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let fs=null;function Ao(){return fs===null?fs=(function(){return 268435456+Math.round(2147483648*Math.random())})():fs++,"0x"+fs.toString(16)}const Wi="RestConnection",I_={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class E_{get Ko(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.qo=e+"://"+t.host,this.Uo=`projects/${n}/databases/${s}`,this.$o=this.databaseId.database===Ms?`project_id=${n}`:`project_id=${n}&database_id=${s}`}Wo(t,e,n,s,i){const a=Ao(),u=this.Qo(t,e.toUriEncodedString());V(Wi,`Sending RPC '${t}' ${a}:`,u,n);const l={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(l,s,i);const{host:d}=new URL(u),f=Vo(d);return this.zo(t,u,l,n,f).then((p=>(V(Wi,`Received RPC '${t}' ${a}: `,p),p)),(p=>{throw ye(Wi,`RPC '${t}' ${a} failed with error: `,p,"url: ",u,"request:",n),p}))}jo(t,e,n,s,i,a){return this.Wo(t,e,n,s,i)}Go(t,e,n){t["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+kn})(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((s,i)=>t[i]=s)),n&&n.headers.forEach(((s,i)=>t[i]=s))}Qo(t,e){const n=I_[t];let s=`${this.qo}/v1/${e}:${n}`;return this.databaseInfo.apiKey&&(s=`${s}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),s}terminate(){}}class T_{constructor(t){this.Ho=t.Ho,this.Jo=t.Jo}Zo(t){this.Xo=t}Yo(t){this.e_=t}t_(t){this.n_=t}onMessage(t){this.r_=t}close(){this.Jo()}send(t){this.Ho(t)}i_(){this.Xo()}s_(){this.e_()}o_(t){this.n_(t)}__(t){this.r_(t)}}const Et="WebChannelConnection",ir=(r,t,e)=>{r.listen(t,(n=>{try{e(n)}catch(s){setTimeout((()=>{throw s}),0)}}))};class gn extends E_{constructor(t){super(t),this.a_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}static u_(){if(!gn.c_){const t=El();ir(t,Il.STAT_EVENT,(e=>{e.stat===eo.PROXY?V(Et,"STAT_EVENT: detected buffering proxy"):e.stat===eo.NOPROXY&&V(Et,"STAT_EVENT: detected no buffering proxy")})),gn.c_=!0}}zo(t,e,n,s,i){const a=Ao();return new Promise(((u,l)=>{const d=new _l;d.setWithCredentials(!0),d.listenOnce(yl.COMPLETE,(()=>{try{switch(d.getLastErrorCode()){case ms.NO_ERROR:const p=d.getResponseJson();V(Et,`XHR for RPC '${t}' ${a} received:`,JSON.stringify(p)),u(p);break;case ms.TIMEOUT:V(Et,`RPC '${t}' ${a} timed out`),l(new x(P.DEADLINE_EXCEEDED,"Request time out"));break;case ms.HTTP_ERROR:const I=d.getStatus();if(V(Et,`RPC '${t}' ${a} failed with status:`,I,"response text:",d.getResponseText()),I>0){let S=d.getResponseJson();Array.isArray(S)&&(S=S[0]);const C=S?.error;if(C&&C.status&&C.message){const k=(function($){const U=$.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(U)>=0?U:P.UNKNOWN})(C.status);l(new x(k,C.message))}else l(new x(P.UNKNOWN,"Server responded with status "+d.getStatus()))}else l(new x(P.UNAVAILABLE,"Connection failed."));break;default:O(9055,{l_:t,streamId:a,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{V(Et,`RPC '${t}' ${a} completed.`)}}));const f=JSON.stringify(s);V(Et,`RPC '${t}' ${a} sending request:`,s),d.send(e,"POST",f,n,15)}))}T_(t,e,n){const s=Ao(),i=[this.qo,"/","google.firestore.v1.Firestore","/",t,"/channel"],a=this.createWebChannelTransport(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;l!==void 0&&(u.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Go(u.initMessageHeaders,e,n),u.encodeInitMessageHeaders=!0;const d=i.join("");V(Et,`Creating RPC '${t}' stream ${s}: ${d}`,u);const f=a.createWebChannel(d,u);this.I_(f);let p=!1,I=!1;const S=new T_({Ho:C=>{I?V(Et,`Not sending because RPC '${t}' stream ${s} is closed:`,C):(p||(V(Et,`Opening RPC '${t}' stream ${s} transport.`),f.open(),p=!0),V(Et,`RPC '${t}' stream ${s} sending:`,C),f.send(C))},Jo:()=>f.close()});return ir(f,or.EventType.OPEN,(()=>{I||(V(Et,`RPC '${t}' stream ${s} transport opened.`),S.i_())})),ir(f,or.EventType.CLOSE,(()=>{I||(I=!0,V(Et,`RPC '${t}' stream ${s} transport closed`),S.o_(),this.E_(f))})),ir(f,or.EventType.ERROR,(C=>{I||(I=!0,ye(Et,`RPC '${t}' stream ${s} transport errored. Name:`,C.name,"Message:",C.message),S.o_(new x(P.UNAVAILABLE,"The operation could not be completed")))})),ir(f,or.EventType.MESSAGE,(C=>{if(!I){const k=C.data[0];F(!!k,16349);const M=k,$=M?.error||M[0]?.error;if($){V(Et,`RPC '${t}' stream ${s} received error:`,$);const U=$.status;let B=(function(Q){const E=lt[Q];if(E!==void 0)return Eh(E)})(U),J=$.message;U==="NOT_FOUND"&&J.includes("database")&&J.includes("does not exist")&&J.includes(this.databaseId.database)&&ye(`Database '${this.databaseId.database}' not found. Please check your project configuration.`),B===void 0&&(B=P.INTERNAL,J="Unknown error status: "+U+" with message "+$.message),I=!0,S.o_(new x(B,J)),f.close()}else V(Et,`RPC '${t}' stream ${s} received:`,k),S.__(k)}})),gn.u_(),setTimeout((()=>{S.s_()}),0),S}terminate(){this.a_.forEach((t=>t.close())),this.a_=[]}I_(t){this.a_.push(t)}E_(t){this.a_=this.a_.filter((e=>e===t))}Go(t,e,n){super.Go(t,e,n),this.databaseInfo.apiKey&&(t["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return Tl()}}function w_(r){return new gn(r)}function v_(){return typeof window<"u"?window:null}function As(){return typeof document<"u"?document:null}function ci(r){return new Ag(r,!0)}gn.c_=!1;class td{constructor(t,e,n=1e3,s=1.5,i=6e4){this.Ci=t,this.timerId=e,this.R_=n,this.A_=s,this.V_=i,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(t){this.cancel();const e=Math.floor(this.d_+this.y_()),n=Math.max(0,Date.now()-this.f_),s=Math.max(0,e-n);s>0&&V("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.d_} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),t()))),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}const Fc="PersistentStream";class ed{constructor(t,e,n,s,i,a,u,l){this.Ci=t,this.b_=n,this.S_=s,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new td(t,e)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,(()=>this.k_())))}K_(t){this.q_(),this.stream.send(t)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(t,e){this.q_(),this.U_(),this.M_.cancel(),this.D_++,t!==4?this.M_.reset():e&&e.code===P.RESOURCE_EXHAUSTED?(Rt(e.toString()),Rt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):e&&e.code===P.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.t_(e)}W_(){}auth(){this.state=1;const t=this.Q_(this.D_),e=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([n,s])=>{this.D_===e&&this.G_(n,s)}),(n=>{t((()=>{const s=new x(P.UNKNOWN,"Fetching auth token failed: "+n.message);return this.z_(s)}))}))}G_(t,e){const n=this.Q_(this.D_);this.stream=this.j_(t,e),this.stream.Zo((()=>{n((()=>this.listener.Zo()))})),this.stream.Yo((()=>{n((()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.Yo())))})),this.stream.t_((s=>{n((()=>this.z_(s)))})),this.stream.onMessage((s=>{n((()=>++this.F_==1?this.H_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(t){return V(Fc,`close with error: ${t}`),this.stream=null,this.close(4,t)}Q_(t){return e=>{this.Ci.enqueueAndForget((()=>this.D_===t?e():(V(Fc,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class A_ extends ed{constructor(t,e,n,s,i,a){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,s,a),this.serializer=i}j_(t,e){return this.connection.T_("Listen",t,e)}H_(t){return this.onNext(t)}onNext(t){this.M_.reset();const e=Sg(this.serializer,t),n=(function(i){if(!("targetChange"in i))return L.min();const a=i.targetChange;return a.targetIds&&a.targetIds.length?L.min():a.readTime?Pt(a.readTime):L.min()})(t);return this.listener.J_(e,n)}Z_(t){const e={};e.database=yo(this.serializer),e.addTarget=(function(i,a){let u;const l=a.target;if(u=Fs(l)?{documents:Ph(i,l)}:{query:Vh(i,l).ft},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=vh(i,a.resumeToken);const d=go(i,a.expectedCount);d!==null&&(u.expectedCount=d)}else if(a.snapshotVersion.compareTo(L.min())>0){u.readTime=Dn(i,a.snapshotVersion.toTimestamp());const d=go(i,a.expectedCount);d!==null&&(u.expectedCount=d)}return u})(this.serializer,t);const n=Vg(this.serializer,t);n&&(e.labels=n),this.K_(e)}X_(t){const e={};e.database=yo(this.serializer),e.removeTarget=t,this.K_(e)}}class b_ extends ed{constructor(t,e,n,s,i,a){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,s,a),this.serializer=i}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(t,e){return this.connection.T_("Write",t,e)}H_(t){return F(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,F(!t.writeResults||t.writeResults.length===0,55816),this.listener.ta()}onNext(t){F(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.M_.reset();const e=Pg(t.writeResults,t.commitTime),n=Pt(t.commitTime);return this.listener.na(n,e)}ra(){const t={};t.database=yo(this.serializer),this.K_(t)}ea(t){const e={streamToken:this.lastStreamToken,writes:t.map((n=>Us(this.serializer,n)))};this.K_(e)}}class R_{}class S_ extends R_{constructor(t,e,n,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new x(P.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(t,e,n,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,a])=>this.connection.Wo(t,_o(e,n),s,i,a))).catch((i=>{throw i.name==="FirebaseError"?(i.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new x(P.UNKNOWN,i.toString())}))}jo(t,e,n,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,u])=>this.connection.jo(t,_o(e,n),s,a,u,i))).catch((a=>{throw a.name==="FirebaseError"?(a.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new x(P.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}function P_(r,t,e,n){return new S_(r,t,e,n)}class V_{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(t){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ca("Offline")))}set(t){this.Pa(),this.oa=0,t==="Online"&&(this.aa=!1),this.ca(t)}ca(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}la(t){const e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Rt(e),this.aa=!1):V("OnlineStateTracker",e)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const Je="RemoteStore";class C_{constructor(t,e,n,s,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=i,this.Aa.Mo((a=>{n.enqueueAndForget((async()=>{Ze(this)&&(V(Je,"Restarting streams for network reachability change."),await(async function(l){const d=j(l);d.Ea.add(4),await jr(d),d.Va.set("Unknown"),d.Ea.delete(4),await li(d)})(this))}))})),this.Va=new V_(n,s)}}async function li(r){if(Ze(r))for(const t of r.Ra)await t(!0)}async function jr(r){for(const t of r.Ra)await t(!1)}function nd(r,t){const e=j(r);e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),oa(e)?ia(e):On(e).O_()&&sa(e,t))}function ra(r,t){const e=j(r),n=On(e);e.Ia.delete(t),n.O_()&&rd(e,t),e.Ia.size===0&&(n.O_()?n.L_():Ze(e)&&e.Va.set("Unknown"))}function sa(r,t){if(r.da.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(L.min())>0){const e=r.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}On(r).Z_(t)}function rd(r,t){r.da.$e(t),On(r).X_(t)}function ia(r){r.da=new Eg({getRemoteKeysForTarget:t=>r.remoteSyncer.getRemoteKeysForTarget(t),At:t=>r.Ia.get(t)||null,ht:()=>r.datastore.serializer.databaseId}),On(r).start(),r.Va.ua()}function oa(r){return Ze(r)&&!On(r).x_()&&r.Ia.size>0}function Ze(r){return j(r).Ea.size===0}function sd(r){r.da=void 0}async function D_(r){r.Va.set("Online")}async function x_(r){r.Ia.forEach(((t,e)=>{sa(r,t)}))}async function N_(r,t){sd(r),oa(r)?(r.Va.ha(t),ia(r)):r.Va.set("Unknown")}async function k_(r,t,e){if(r.Va.set("Online"),t instanceof wh&&t.state===2&&t.cause)try{await(async function(s,i){const a=i.cause;for(const u of i.targetIds)s.Ia.has(u)&&(await s.remoteSyncer.rejectListen(u,a),s.Ia.delete(u),s.da.removeTarget(u))})(r,t)}catch(n){V(Je,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await $s(r,n)}else if(t instanceof ws?r.da.Xe(t):t instanceof Th?r.da.st(t):r.da.tt(t),!e.isEqual(L.min()))try{const n=await Xh(r.localStore);e.compareTo(n)>=0&&await(function(i,a){const u=i.da.Tt(a);return u.targetChanges.forEach(((l,d)=>{if(l.resumeToken.approximateByteSize()>0){const f=i.Ia.get(d);f&&i.Ia.set(d,f.withResumeToken(l.resumeToken,a))}})),u.targetMismatches.forEach(((l,d)=>{const f=i.Ia.get(l);if(!f)return;i.Ia.set(l,f.withResumeToken(dt.EMPTY_BYTE_STRING,f.snapshotVersion)),rd(i,l);const p=new Qt(f.target,l,d,f.sequenceNumber);sa(i,p)})),i.remoteSyncer.applyRemoteEvent(u)})(r,e)}catch(n){V(Je,"Failed to raise snapshot:",n),await $s(r,n)}}async function $s(r,t,e){if(!Ae(t))throw t;r.Ea.add(1),await jr(r),r.Va.set("Offline"),e||(e=()=>Xh(r.localStore)),r.asyncQueue.enqueueRetryable((async()=>{V(Je,"Retrying IndexedDB access"),await e(),r.Ea.delete(1),await li(r)}))}function id(r,t){return t().catch((e=>$s(r,e,t)))}async function zr(r){const t=j(r),e=Te(t);let n=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:qe;for(;M_(t);)try{const s=await p_(t.localStore,n);if(s===null){t.Ta.length===0&&e.L_();break}n=s.batchId,O_(t,s)}catch(s){await $s(t,s)}od(t)&&ad(t)}function M_(r){return Ze(r)&&r.Ta.length<10}function O_(r,t){r.Ta.push(t);const e=Te(r);e.O_()&&e.Y_&&e.ea(t.mutations)}function od(r){return Ze(r)&&!Te(r).x_()&&r.Ta.length>0}function ad(r){Te(r).start()}async function F_(r){Te(r).ra()}async function L_(r){const t=Te(r);for(const e of r.Ta)t.ea(e.mutations)}async function B_(r,t,e){const n=r.Ta.shift(),s=Ko.from(n,t,e);await id(r,(()=>r.remoteSyncer.applySuccessfulWrite(s))),await zr(r)}async function U_(r,t){t&&Te(r).Y_&&await(async function(n,s){if((function(a){return _g(a)&&a!==P.ABORTED})(s.code)){const i=n.Ta.shift();Te(n).B_(),await id(n,(()=>n.remoteSyncer.rejectFailedWrite(i.batchId,s))),await zr(n)}})(r,t),od(r)&&ad(r)}async function Lc(r,t){const e=j(r);e.asyncQueue.verifyOperationInProgress(),V(Je,"RemoteStore received new credentials");const n=Ze(e);e.Ea.add(3),await jr(e),n&&e.Va.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await li(e)}async function q_(r,t){const e=j(r);t?(e.Ea.delete(2),await li(e)):t||(e.Ea.add(2),await jr(e),e.Va.set("Unknown"))}function On(r){return r.ma||(r.ma=(function(e,n,s){const i=j(e);return i.sa(),new A_(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)})(r.datastore,r.asyncQueue,{Zo:D_.bind(null,r),Yo:x_.bind(null,r),t_:N_.bind(null,r),J_:k_.bind(null,r)}),r.Ra.push((async t=>{t?(r.ma.B_(),oa(r)?ia(r):r.Va.set("Unknown")):(await r.ma.stop(),sd(r))}))),r.ma}function Te(r){return r.fa||(r.fa=(function(e,n,s){const i=j(e);return i.sa(),new b_(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)})(r.datastore,r.asyncQueue,{Zo:()=>Promise.resolve(),Yo:F_.bind(null,r),t_:U_.bind(null,r),ta:L_.bind(null,r),na:B_.bind(null,r)}),r.Ra.push((async t=>{t?(r.fa.B_(),await zr(r)):(await r.fa.stop(),r.Ta.length>0&&(V(Je,`Stopping write stream with ${r.Ta.length} pending writes`),r.Ta=[]))}))),r.fa}class aa{constructor(t,e,n,s,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=s,this.removalCallback=i,this.deferred=new Yt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,s,i){const a=Date.now()+n,u=new aa(t,e,a,s,i);return u.start(n),u}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new x(P.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ua(r,t){if(Rt("AsyncQueue",`${t}: ${r}`),Ae(r))return new x(P.UNAVAILABLE,`${t}: ${r}`);throw r}class _n{static emptySet(t){return new _n(t.comparator)}constructor(t){this.comparator=t?(e,n)=>t(e,n)||N.comparator(e.key,n.key):(e,n)=>N.comparator(e.key,n.key),this.keyedMap=ar(),this.sortedSet=new it(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof _n)||this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const s=e.getNext().key,i=n.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){const n=new _n;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class Bc{constructor(){this.ga=new it(N.comparator)}track(t){const e=t.doc.key,n=this.ga.get(e);n?t.type!==0&&n.type===3?this.ga=this.ga.insert(e,t):t.type===3&&n.type!==1?this.ga=this.ga.insert(e,{type:n.type,doc:t.doc}):t.type===2&&n.type===2?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):t.type===2&&n.type===0?this.ga=this.ga.insert(e,{type:0,doc:t.doc}):t.type===1&&n.type===0?this.ga=this.ga.remove(e):t.type===1&&n.type===2?this.ga=this.ga.insert(e,{type:1,doc:n.doc}):t.type===0&&n.type===1?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):O(63341,{Vt:t,pa:n}):this.ga=this.ga.insert(e,t)}ya(){const t=[];return this.ga.inorderTraversal(((e,n)=>{t.push(n)})),t}}class xn{constructor(t,e,n,s,i,a,u,l,d){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=l,this.hasCachedResults=d}static fromInitialDocuments(t,e,n,s,i){const a=[];return e.forEach((u=>{a.push({type:0,doc:u})})),new xn(t,e,_n.emptySet(e),a,n,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&ni(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let s=0;s<e.length;s++)if(e[s].type!==n[s].type||!e[s].doc.isEqual(n[s].doc))return!1;return!0}}class j_{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some((t=>t.Da()))}}class z_{constructor(){this.queries=Uc(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(e,n){const s=j(e),i=s.queries;s.queries=Uc(),i.forEach(((a,u)=>{for(const l of u.ba)l.onError(n)}))})(this,new x(P.ABORTED,"Firestore shutting down"))}}function Uc(){return new te((r=>ih(r)),ni)}async function ud(r,t){const e=j(r);let n=3;const s=t.query;let i=e.queries.get(s);i?!i.Sa()&&t.Da()&&(n=2):(i=new j_,n=t.Da()?0:1);try{switch(n){case 0:i.wa=await e.onListen(s,!0);break;case 1:i.wa=await e.onListen(s,!1);break;case 2:await e.onFirstRemoteStoreListen(s)}}catch(a){const u=ua(a,`Initialization of query '${hn(t.query)}' failed`);return void t.onError(u)}e.queries.set(s,i),i.ba.push(t),t.va(e.onlineState),i.wa&&t.Fa(i.wa)&&ca(e)}async function cd(r,t){const e=j(r),n=t.query;let s=3;const i=e.queries.get(n);if(i){const a=i.ba.indexOf(t);a>=0&&(i.ba.splice(a,1),i.ba.length===0?s=t.Da()?0:1:!i.Sa()&&t.Da()&&(s=2))}switch(s){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}}function G_(r,t){const e=j(r);let n=!1;for(const s of t){const i=s.query,a=e.queries.get(i);if(a){for(const u of a.ba)u.Fa(s)&&(n=!0);a.wa=s}}n&&ca(e)}function $_(r,t,e){const n=j(r),s=n.queries.get(t);if(s)for(const i of s.ba)i.onError(e);n.queries.delete(t)}function ca(r){r.Ca.forEach((t=>{t.next()}))}var bo,qc;(qc=bo||(bo={})).Ma="default",qc.Cache="cache";class ld{constructor(t,e,n){this.query=t,this.xa=e,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(t){if(!this.options.includeMetadataChanges){const n=[];for(const s of t.docChanges)s.type!==3&&n.push(s);t=new xn(t.query,t.docs,t.oldDocs,n,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Oa?this.Ba(t)&&(this.xa.next(t),e=!0):this.La(t,this.onlineState)&&(this.ka(t),e=!0),this.Na=t,e}onError(t){this.xa.error(t)}va(t){this.onlineState=t;let e=!1;return this.Na&&!this.Oa&&this.La(this.Na,t)&&(this.ka(this.Na),e=!0),e}La(t,e){if(!t.fromCache||!this.Da())return!0;const n=e!=="Offline";return(!this.options.Ka||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}Ba(t){if(t.docChanges.length>0)return!0;const e=this.Na&&this.Na.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}ka(t){t=xn.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Oa=!0,this.xa.next(t)}Da(){return this.options.source!==bo.Cache}}class hd{constructor(t){this.key=t}}class dd{constructor(t){this.key=t}}class K_{constructor(t,e){this.query=t,this.Za=e,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=G(),this.mutatedKeys=G(),this.eu=oh(t),this.tu=new _n(this.eu)}get nu(){return this.Za}ru(t,e){const n=e?e.iu:new Bc,s=e?e.tu:this.tu;let i=e?e.mutatedKeys:this.mutatedKeys,a=s,u=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal(((f,p)=>{const I=s.get(f),S=Ur(this.query,p)?p:null,C=!!I&&this.mutatedKeys.has(I.key),k=!!S&&(S.hasLocalMutations||this.mutatedKeys.has(S.key)&&S.hasCommittedMutations);let M=!1;I&&S?I.data.isEqual(S.data)?C!==k&&(n.track({type:3,doc:S}),M=!0):this.su(I,S)||(n.track({type:2,doc:S}),M=!0,(l&&this.eu(S,l)>0||d&&this.eu(S,d)<0)&&(u=!0)):!I&&S?(n.track({type:0,doc:S}),M=!0):I&&!S&&(n.track({type:1,doc:I}),M=!0,(l||d)&&(u=!0)),M&&(S?(a=a.add(S),i=k?i.add(f):i.delete(f)):(a=a.delete(f),i=i.delete(f)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),i=i.delete(f.key),n.track({type:1,doc:f})}return{tu:a,iu:n,Ss:u,mutatedKeys:i}}su(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,s){const i=this.tu;this.tu=t.tu,this.mutatedKeys=t.mutatedKeys;const a=t.iu.ya();a.sort(((f,p)=>(function(S,C){const k=M=>{switch(M){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return O(20277,{Vt:M})}};return k(S)-k(C)})(f.type,p.type)||this.eu(f.doc,p.doc))),this.ou(n),s=s??!1;const u=e&&!s?this._u():[],l=this.Ya.size===0&&this.current&&!s?1:0,d=l!==this.Xa;return this.Xa=l,a.length!==0||d?{snapshot:new xn(this.query,t.tu,i,a,t.mutatedKeys,l===0,d,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Bc,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(t){return!this.Za.has(t)&&!!this.tu.has(t)&&!this.tu.get(t).hasLocalMutations}ou(t){t&&(t.addedDocuments.forEach((e=>this.Za=this.Za.add(e))),t.modifiedDocuments.forEach((e=>{})),t.removedDocuments.forEach((e=>this.Za=this.Za.delete(e))),this.current=t.current)}_u(){if(!this.current)return[];const t=this.Ya;this.Ya=G(),this.tu.forEach((n=>{this.uu(n.key)&&(this.Ya=this.Ya.add(n.key))}));const e=[];return t.forEach((n=>{this.Ya.has(n)||e.push(new dd(n))})),this.Ya.forEach((n=>{t.has(n)||e.push(new hd(n))})),e}cu(t){this.Za=t.ks,this.Ya=G();const e=this.ru(t.documents);return this.applyChanges(e,!0)}lu(){return xn.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Xa===0,this.hasCachedResults)}}const la="SyncEngine";class H_{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class W_{constructor(t){this.key=t,this.hu=!1}}class Q_{constructor(t,e,n,s,i,a){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new te((u=>ih(u)),ni),this.Iu=new Map,this.Eu=new Set,this.Ru=new it(N.comparator),this.Au=new Map,this.Vu=new Xo,this.du={},this.mu=new Map,this.fu=Ye.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function Y_(r,t,e=!0){const n=yd(r);let s;const i=n.Tu.get(t);return i?(n.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await fd(n,t,e,!0),s}async function J_(r,t){const e=yd(r);await fd(e,t,!0,!1)}async function fd(r,t,e,n){const s=await g_(r.localStore,Lt(t)),i=s.targetId,a=r.sharedClientState.addLocalQueryTarget(i,e);let u;return n&&(u=await X_(r,t,i,a==="current",s.resumeToken)),r.isPrimaryClient&&e&&nd(r.remoteStore,s),u}async function X_(r,t,e,n,s){r.pu=(p,I,S)=>(async function(k,M,$,U){let B=M.view.ru($);B.Ss&&(B=await Nc(k.localStore,M.query,!1).then((({documents:E})=>M.view.ru(E,B))));const J=U&&U.targetChanges.get(M.targetId),et=U&&U.targetMismatches.get(M.targetId)!=null,Q=M.view.applyChanges(B,k.isPrimaryClient,J,et);return zc(k,M.targetId,Q.au),Q.snapshot})(r,p,I,S);const i=await Nc(r.localStore,t,!0),a=new K_(t,i.ks),u=a.ru(i.documents),l=qr.createSynthesizedTargetChangeForCurrentChange(e,n&&r.onlineState!=="Offline",s),d=a.applyChanges(u,r.isPrimaryClient,l);zc(r,e,d.au);const f=new H_(t,e,a);return r.Tu.set(t,f),r.Iu.has(e)?r.Iu.get(e).push(t):r.Iu.set(e,[t]),d.snapshot}async function Z_(r,t,e){const n=j(r),s=n.Tu.get(t),i=n.Iu.get(s.targetId);if(i.length>1)return n.Iu.set(s.targetId,i.filter((a=>!ni(a,t)))),void n.Tu.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||await vo(n.localStore,s.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(s.targetId),e&&ra(n.remoteStore,s.targetId),Ro(n,s.targetId)})).catch(Xe)):(Ro(n,s.targetId),await vo(n.localStore,s.targetId,!0))}async function ty(r,t){const e=j(r),n=e.Tu.get(t),s=e.Iu.get(n.targetId);e.isPrimaryClient&&s.length===1&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),ra(e.remoteStore,n.targetId))}async function ey(r,t,e){const n=Id(r);try{const s=await(function(a,u){const l=j(a),d=X.now(),f=u.reduce(((S,C)=>S.add(C.key)),G());let p,I;return l.persistence.runTransaction("Locally write mutations","readwrite",(S=>{let C=Nt(),k=G();return l.xs.getEntries(S,f).next((M=>{C=M,C.forEach((($,U)=>{U.isValidDocument()||(k=k.add($))}))})).next((()=>l.localDocuments.getOverlayedDocuments(S,C))).next((M=>{p=M;const $=[];for(const U of u){const B=pg(U,p.get(U.key).overlayedDocument);B!=null&&$.push(new ee(U.key,B,Yl(B.value.mapValue),St.exists(!0)))}return l.mutationQueue.addMutationBatch(S,d,$,u)})).next((M=>{I=M;const $=M.applyToLocalDocumentSet(p,k);return l.documentOverlayCache.saveOverlays(S,M.batchId,$)}))})).then((()=>({batchId:I.batchId,changes:uh(p)})))})(n.localStore,t);n.sharedClientState.addPendingMutation(s.batchId),(function(a,u,l){let d=a.du[a.currentUser.toKey()];d||(d=new it(q)),d=d.insert(u,l),a.du[a.currentUser.toKey()]=d})(n,s.batchId,e),await Gr(n,s.changes),await zr(n.remoteStore)}catch(s){const i=ua(s,"Failed to persist write");e.reject(i)}}async function md(r,t){const e=j(r);try{const n=await f_(e.localStore,t);t.targetChanges.forEach(((s,i)=>{const a=e.Au.get(i);a&&(F(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?F(a.hu,14607):s.removedDocuments.size>0&&(F(a.hu,42227),a.hu=!1))})),await Gr(e,n,t)}catch(n){await Xe(n)}}function jc(r,t,e){const n=j(r);if(n.isPrimaryClient&&e===0||!n.isPrimaryClient&&e===1){const s=[];n.Tu.forEach(((i,a)=>{const u=a.view.va(t);u.snapshot&&s.push(u.snapshot)})),(function(a,u){const l=j(a);l.onlineState=u;let d=!1;l.queries.forEach(((f,p)=>{for(const I of p.ba)I.va(u)&&(d=!0)})),d&&ca(l)})(n.eventManager,t),s.length&&n.Pu.J_(s),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}async function ny(r,t,e){const n=j(r);n.sharedClientState.updateQueryState(t,"rejected",e);const s=n.Au.get(t),i=s&&s.key;if(i){let a=new it(N.comparator);a=a.insert(i,ut.newNoDocument(i,L.min()));const u=G().add(i),l=new ii(L.min(),new Map,new it(q),a,u);await md(n,l),n.Ru=n.Ru.remove(i),n.Au.delete(t),ha(n)}else await vo(n.localStore,t,!1).then((()=>Ro(n,t,e))).catch(Xe)}async function ry(r,t){const e=j(r),n=t.batch.batchId;try{const s=await d_(e.localStore,t);gd(e,n,null),pd(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),await Gr(e,s)}catch(s){await Xe(s)}}async function sy(r,t,e){const n=j(r);try{const s=await(function(a,u){const l=j(a);return l.persistence.runTransaction("Reject batch","readwrite-primary",(d=>{let f;return l.mutationQueue.lookupMutationBatch(d,u).next((p=>(F(p!==null,37113),f=p.keys(),l.mutationQueue.removeMutationBatch(d,p)))).next((()=>l.mutationQueue.performConsistencyCheck(d))).next((()=>l.documentOverlayCache.removeOverlaysForBatchId(d,f,u))).next((()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,f))).next((()=>l.localDocuments.getDocuments(d,f)))}))})(n.localStore,t);gd(n,t,e),pd(n,t),n.sharedClientState.updateMutationState(t,"rejected",e),await Gr(n,s)}catch(s){await Xe(s)}}function pd(r,t){(r.mu.get(t)||[]).forEach((e=>{e.resolve()})),r.mu.delete(t)}function gd(r,t,e){const n=j(r);let s=n.du[n.currentUser.toKey()];if(s){const i=s.get(t);i&&(e?i.reject(e):i.resolve(),s=s.remove(t)),n.du[n.currentUser.toKey()]=s}}function Ro(r,t,e=null){r.sharedClientState.removeLocalQueryTarget(t);for(const n of r.Iu.get(t))r.Tu.delete(n),e&&r.Pu.yu(n,e);r.Iu.delete(t),r.isPrimaryClient&&r.Vu.Gr(t).forEach((n=>{r.Vu.containsKey(n)||_d(r,n)}))}function _d(r,t){r.Eu.delete(t.path.canonicalString());const e=r.Ru.get(t);e!==null&&(ra(r.remoteStore,e),r.Ru=r.Ru.remove(t),r.Au.delete(e),ha(r))}function zc(r,t,e){for(const n of e)n instanceof hd?(r.Vu.addReference(n.key,t),iy(r,n)):n instanceof dd?(V(la,"Document no longer in limbo: "+n.key),r.Vu.removeReference(n.key,t),r.Vu.containsKey(n.key)||_d(r,n.key)):O(19791,{wu:n})}function iy(r,t){const e=t.key,n=e.path.canonicalString();r.Ru.get(e)||r.Eu.has(n)||(V(la,"New document in limbo: "+e),r.Eu.add(n),ha(r))}function ha(r){for(;r.Eu.size>0&&r.Ru.size<r.maxConcurrentLimboResolutions;){const t=r.Eu.values().next().value;r.Eu.delete(t);const e=new N(Y.fromString(t)),n=r.fu.next();r.Au.set(n,new W_(e)),r.Ru=r.Ru.insert(e,n),nd(r.remoteStore,new Qt(Lt(Br(e.path)),n,"TargetPurposeLimboResolution",Ot.ce))}}async function Gr(r,t,e){const n=j(r),s=[],i=[],a=[];n.Tu.isEmpty()||(n.Tu.forEach(((u,l)=>{a.push(n.pu(l,t,e).then((d=>{if((d||e)&&n.isPrimaryClient){const f=d?!d.fromCache:e?.targetChanges.get(l.targetId)?.current;n.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(d){s.push(d);const f=ea.Es(l.targetId,d);i.push(f)}})))})),await Promise.all(a),n.Pu.J_(s),await(async function(l,d){const f=j(l);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",(p=>v.forEach(d,(I=>v.forEach(I.Ts,(S=>f.persistence.referenceDelegate.addReference(p,I.targetId,S))).next((()=>v.forEach(I.Is,(S=>f.persistence.referenceDelegate.removeReference(p,I.targetId,S)))))))))}catch(p){if(!Ae(p))throw p;V(na,"Failed to update sequence numbers: "+p)}for(const p of d){const I=p.targetId;if(!p.fromCache){const S=f.vs.get(I),C=S.snapshotVersion,k=S.withLastLimboFreeSnapshotVersion(C);f.vs=f.vs.insert(I,k)}}})(n.localStore,i))}async function oy(r,t){const e=j(r);if(!e.currentUser.isEqual(t)){V(la,"User change. New user:",t.toKey());const n=await Jh(e.localStore,t);e.currentUser=t,(function(i,a){i.mu.forEach((u=>{u.forEach((l=>{l.reject(new x(P.CANCELLED,a))}))})),i.mu.clear()})(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),await Gr(e,n.Ns)}}function ay(r,t){const e=j(r),n=e.Au.get(t);if(n&&n.hu)return G().add(n.key);{let s=G();const i=e.Iu.get(t);if(!i)return s;for(const a of i){const u=e.Tu.get(a);s=s.unionWith(u.view.nu)}return s}}function yd(r){const t=j(r);return t.remoteStore.remoteSyncer.applyRemoteEvent=md.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=ay.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=ny.bind(null,t),t.Pu.J_=G_.bind(null,t.eventManager),t.Pu.yu=$_.bind(null,t.eventManager),t}function Id(r){const t=j(r);return t.remoteStore.remoteSyncer.applySuccessfulWrite=ry.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=sy.bind(null,t),t}class Nr{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=ci(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),await this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)}Fu(t,e){return null}Mu(t,e){return null}vu(t){return Yh(this.persistence,new Qh,t.initialUser,this.serializer)}Cu(t){return new Zo(ui.Vi,this.serializer)}Du(t){return new Zh}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Nr.provider={build:()=>new Nr};class uy extends Nr{constructor(t){super(),this.cacheSizeBytes=t}Fu(t,e){F(this.persistence.referenceDelegate instanceof Gs,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new Gh(n,t.asyncQueue,e)}Cu(t){const e=this.cacheSizeBytes!==void 0?Tt.withCacheSize(this.cacheSizeBytes):Tt.DEFAULT;return new Zo((n=>Gs.Vi(n,e)),this.serializer)}}class cy extends Nr{constructor(t,e,n){super(),this.xu=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}async initialize(t){await super.initialize(t),await this.xu.initialize(this,t),await Id(this.xu.syncEngine),await zr(this.xu.remoteStore),await this.persistence.zi((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}vu(t){return Yh(this.persistence,new Qh,t.initialUser,this.serializer)}Fu(t,e){const n=this.persistence.referenceDelegate.garbageCollector;return new Gh(n,t.asyncQueue,e)}Mu(t,e){const n=new fp(e,this.persistence);return new dp(t.asyncQueue,n)}Cu(t){const e=u_(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?Tt.withCacheSize(this.cacheSizeBytes):Tt.DEFAULT;return new ta(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,v_(),As(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(t){return new Zh}}class Ks{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>jc(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=oy.bind(null,this.syncEngine),await q_(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return(function(){return new z_})()}createDatastore(t){const e=ci(t.databaseInfo.databaseId),n=w_(t.databaseInfo);return P_(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return(function(n,s,i,a,u){return new C_(n,s,i,a,u)})(this.localStore,this.datastore,t.asyncQueue,(e=>jc(this.syncEngine,e,0)),(function(){return Oc.v()?new Oc:new y_})())}createSyncEngine(t,e){return(function(s,i,a,u,l,d,f){const p=new Q_(s,i,a,u,l,d);return f&&(p.gu=!0),p})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){await(async function(e){const n=j(e);V(Je,"RemoteStore shutting down."),n.Ea.add(5),await jr(n),n.Aa.shutdown(),n.Va.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Ks.provider={build:()=>new Ks};class Ed{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ou(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ou(this.observer.error,t):Rt("Uncaught Error in snapshot listener:",t.toString()))}Nu(){this.muted=!0}Ou(t,e){setTimeout((()=>{this.muted||t(e)}),0)}}const we="FirestoreClient";class ly{constructor(t,e,n,s,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this._databaseInfo=s,this.user=_t.UNAUTHENTICATED,this.clientId=xo.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,(async a=>{V(we,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(n,(a=>(V(we,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Yt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=ua(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function Qi(r,t){r.asyncQueue.verifyOperationInProgress(),V(we,"Initializing OfflineComponentProvider");const e=r.configuration;await t.initialize(e);let n=e.initialUser;r.setCredentialChangeListener((async s=>{n.isEqual(s)||(await Jh(t.localStore,s),n=s)})),t.persistence.setDatabaseDeletedListener((()=>r.terminate())),r._offlineComponents=t}async function Gc(r,t){r.asyncQueue.verifyOperationInProgress();const e=await hy(r);V(we,"Initializing OnlineComponentProvider"),await t.initialize(e,r.configuration),r.setCredentialChangeListener((n=>Lc(t.remoteStore,n))),r.setAppCheckTokenChangeListener(((n,s)=>Lc(t.remoteStore,s))),r._onlineComponents=t}async function hy(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){V(we,"Using user provided OfflineComponentProvider");try{await Qi(r,r._uninitializedComponentsProvider._offline)}catch(t){const e=t;if(!(function(s){return s.name==="FirebaseError"?s.code===P.FAILED_PRECONDITION||s.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(e))throw e;ye("Error using user provided cache. Falling back to memory cache: "+e),await Qi(r,new Nr)}}else V(we,"Using default OfflineComponentProvider"),await Qi(r,new uy(void 0));return r._offlineComponents}async function Td(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(V(we,"Using user provided OnlineComponentProvider"),await Gc(r,r._uninitializedComponentsProvider._online)):(V(we,"Using default OnlineComponentProvider"),await Gc(r,new Ks))),r._onlineComponents}function dy(r){return Td(r).then((t=>t.syncEngine))}async function So(r){const t=await Td(r),e=t.eventManager;return e.onListen=Y_.bind(null,t.syncEngine),e.onUnlisten=Z_.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=J_.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=ty.bind(null,t.syncEngine),e}function fy(r,t,e,n){const s=new Ed(n),i=new ld(t,s,e);return r.asyncQueue.enqueueAndForget((async()=>ud(await So(r),i))),()=>{s.Nu(),r.asyncQueue.enqueueAndForget((async()=>cd(await So(r),i)))}}function my(r,t,e={}){const n=new Yt;return r.asyncQueue.enqueueAndForget((async()=>(function(i,a,u,l,d){const f=new Ed({next:I=>{f.Nu(),a.enqueueAndForget((()=>cd(i,p)));const S=I.docs.has(u);!S&&I.fromCache?d.reject(new x(P.UNAVAILABLE,"Failed to get document because the client is offline.")):S&&I.fromCache&&l&&l.source==="server"?d.reject(new x(P.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(I)},error:I=>d.reject(I)}),p=new ld(Br(u.path),f,{includeMetadataChanges:!0,Ka:!0});return ud(i,p)})(await So(r),r.asyncQueue,t,e,n))),n.promise}function py(r,t){const e=new Yt;return r.asyncQueue.enqueueAndForget((async()=>ey(await dy(r),t,e))),e.promise}function wd(r){const t={};return r.timeoutSeconds!==void 0&&(t.timeoutSeconds=r.timeoutSeconds),t}const gy="ComponentProvider",$c=new Map;function _y(r,t,e,n,s){return new jp(r,t,e,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,wd(s.experimentalLongPollingOptions),s.useFetchStreams,s.isUsingEmulator,n)}const vd="firestore.googleapis.com",Kc=!0;class Hc{constructor(t){if(t.host===void 0){if(t.ssl!==void 0)throw new x(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=vd,this.ssl=Kc}else this.host=t.host,this.ssl=t.ssl??Kc;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=Uh;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<$g)throw new x(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}up("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=wd(t.experimentalLongPollingOptions??{}),(function(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new x(P.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<5)throw new x(P.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is 5)`);if(n.timeoutSeconds>30)throw new x(P.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&(function(n,s){return n.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class hi{constructor(t,e,n,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Hc({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new x(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new x(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Hc(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=(function(n){if(!n)return new Xm;switch(n.type){case"firstParty":return new np(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new x(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(e){const n=$c.get(e);n&&(V(gy,"Removing Datastore"),$c.delete(e),n.terminate())})(this),Promise.resolve()}}function yy(r,t,e,n={}){r=Ft(r,hi);const s=Vo(t),i=r._getSettings(),a={...i,emulatorOptions:r._getEmulatorOptions()},u=`${t}:${e}`;s&&(Sf(`https://${u}`),Df("Firestore",!0)),i.host!==vd&&i.host!==u&&ye("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...i,host:u,ssl:s,emulatorOptions:n};if(!Ps(l,a)&&(r._setSettings(l),n.mockUserToken)){let d,f;if(typeof n.mockUserToken=="string")d=n.mockUserToken,f=_t.MOCK_USER;else{d=Pf(n.mockUserToken,r._app?.options.projectId);const p=n.mockUserToken.sub||n.mockUserToken.user_id;if(!p)throw new x(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new _t(p)}r._authCredentials=new Zm(new vl(d,f))}}class Fn{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new Fn(this.firestore,t,this._query)}}class ct{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new _e(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new ct(this.firestore,t,this._key)}toJSON(){return{type:ct._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,n){if(Mr(e,ct._jsonSchema))return new ct(t,n||null,new N(Y.fromString(e.referencePath)))}}ct._jsonSchemaVersion="firestore/documentReference/1.0",ct._jsonSchema={type:ht("string",ct._jsonSchemaVersion),referencePath:ht("string")};class _e extends Fn{constructor(t,e,n){super(t,e,Br(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new ct(this.firestore,null,new N(t))}withConverter(t){return new _e(this.firestore,t,this._path)}}function ky(r,t,...e){if(r=Ht(r),bl("collection","path",t),r instanceof hi){const n=Y.fromString(t,...e);return Fu(n),new _e(r,null,n)}{if(!(r instanceof ct||r instanceof _e))throw new x(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(Y.fromString(t,...e));return Fu(n),new _e(r.firestore,null,n)}}function Iy(r,t,...e){if(r=Ht(r),arguments.length===1&&(t=xo.newId()),bl("doc","path",t),r instanceof hi){const n=Y.fromString(t,...e);return Ou(n),new ct(r,null,new N(n))}{if(!(r instanceof ct||r instanceof _e))throw new x(P.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(Y.fromString(t,...e));return Ou(n),new ct(r.firestore,r instanceof _e?r.converter:null,new N(n))}}const Wc="AsyncQueue";class Qc{constructor(t=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new td(this,"async_queue_retry"),this._c=()=>{const n=As();n&&V(Wc,"Visibility state changed to "+n.visibilityState),this.M_.w_()},this.ac=t;const e=As();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.uc(),this.cc(t)}enterRestrictedMode(t){if(!this.ec){this.ec=!0,this.sc=t||!1;const e=As();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this._c)}}enqueue(t){if(this.uc(),this.ec)return new Promise((()=>{}));const e=new Yt;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Yu.push(t),this.lc())))}async lc(){if(this.Yu.length!==0){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(t){if(!Ae(t))throw t;V(Wc,"Operation failed with retryable error: "+t)}this.Yu.length>0&&this.M_.p_((()=>this.lc()))}}cc(t){const e=this.ac.then((()=>(this.rc=!0,t().catch((n=>{throw this.nc=n,this.rc=!1,Rt("INTERNAL UNHANDLED ERROR: ",Yc(n)),n})).then((n=>(this.rc=!1,n))))));return this.ac=e,e}enqueueAfterDelay(t,e,n){this.uc(),this.oc.indexOf(t)>-1&&(e=0);const s=aa.createAndSchedule(this,t,e,n,(i=>this.hc(i)));return this.tc.push(s),s}uc(){this.nc&&O(47125,{Pc:Yc(this.nc)})}verifyOperationInProgress(){}async Tc(){let t;do t=this.ac,await t;while(t!==this.ac)}Ic(t){for(const e of this.tc)if(e.timerId===t)return!0;return!1}Ec(t){return this.Tc().then((()=>{this.tc.sort(((e,n)=>e.targetTimeMs-n.targetTimeMs));for(const e of this.tc)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.Tc()}))}Rc(t){this.oc.push(t)}hc(t){const e=this.tc.indexOf(t);this.tc.splice(e,1)}}function Yc(r){let t=r.message||"";return r.stack&&(t=r.stack.includes(r.message)?r.stack:r.message+`
`+r.stack),t}class ve extends hi{constructor(t,e,n,s){super(t,e,n,s),this.type="firestore",this._queue=new Qc,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new Qc(t),this._firestoreClient=void 0,await t}}}function My(r,t){const e=typeof r=="object"?r:Lm(),n=typeof r=="string"?r:Ms,s=xm(e,"firestore").getImmediate({identifier:n});if(!s._initialized){const i=bf("firestore");i&&yy(s,...i)}return s}function da(r){if(r._terminated)throw new x(P.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||Ad(r),r._firestoreClient}function Ad(r){const t=r._freezeSettings(),e=_y(r._databaseId,r._app?.options.appId||"",r._persistenceKey,r._app?.options.apiKey,t);r._componentsProvider||t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(r._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),r._firestoreClient=new ly(r._authCredentials,r._appCheckCredentials,r._queue,e,r._componentsProvider&&(function(s){const i=s?._online.build();return{_offline:s?._offline.build(i),_online:i}})(r._componentsProvider))}function Oy(r,t){ye("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=r._freezeSettings();return Ey(r,Ks.provider,{build:n=>new cy(n,e.cacheSizeBytes,t?.forceOwnership)}),Promise.resolve()}function Ey(r,t,e){if((r=Ft(r,ve))._firestoreClient||r._terminated)throw new x(P.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(r._componentsProvider||r._getSettings().localCache)throw new x(P.FAILED_PRECONDITION,"SDK cache is already specified.");r._componentsProvider={_online:t,_offline:e},Ad(r)}class Mt{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Mt(dt.fromBase64String(t))}catch(e){throw new x(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new Mt(dt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:Mt._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(Mr(t,Mt._jsonSchema))return Mt.fromBase64String(t.bytes)}}Mt._jsonSchemaVersion="firestore/bytes/1.0",Mt._jsonSchema={type:ht("string",Mt._jsonSchemaVersion),bytes:ht("string")};class fa{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new x(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ot(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class di{constructor(t){this._methodName=t}}class Kt{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new x(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new x(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return q(this._lat,t._lat)||q(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Kt._jsonSchemaVersion}}static fromJSON(t){if(Mr(t,Kt._jsonSchema))return new Kt(t.latitude,t.longitude)}}Kt._jsonSchemaVersion="firestore/geoPoint/1.0",Kt._jsonSchema={type:ht("string",Kt._jsonSchemaVersion),latitude:ht("number"),longitude:ht("number")};class Ut{constructor(t){this._values=(t||[]).map((e=>e))}toArray(){return this._values.map((t=>t))}isEqual(t){return(function(n,s){if(n.length!==s.length)return!1;for(let i=0;i<n.length;++i)if(n[i]!==s[i])return!1;return!0})(this._values,t._values)}toJSON(){return{type:Ut._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(Mr(t,Ut._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every((e=>typeof e=="number")))return new Ut(t.vectorValues);throw new x(P.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Ut._jsonSchemaVersion="firestore/vectorValue/1.0",Ut._jsonSchema={type:ht("string",Ut._jsonSchemaVersion),vectorValues:ht("object")};const Ty=/^__.*__$/;class wy{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return this.fieldMask!==null?new ee(t,this.data,this.fieldMask,e,this.fieldTransforms):new Mn(t,this.data,e,this.fieldTransforms)}}class bd{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new ee(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function Rd(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw O(40011,{dataSource:r})}}class ma{constructor(t,e,n,s,i,a){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=s,i===void 0&&this.validatePath(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(t){return new ma({...this.settings,...t},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(t){const e=this.path?.child(t),n=this.contextWith({path:e,arrayElement:!1});return n.validatePathSegment(t),n}childContextForFieldPath(t){const e=this.path?.child(t),n=this.contextWith({path:e,arrayElement:!1});return n.validatePath(),n}childContextForArray(t){return this.contextWith({path:void 0,arrayElement:!0})}createError(t){return Hs(t,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(t){return this.fieldMask.find((e=>t.isPrefixOf(e)))!==void 0||this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))!==void 0}validatePath(){if(this.path)for(let t=0;t<this.path.length;t++)this.validatePathSegment(this.path.get(t))}validatePathSegment(t){if(t.length===0)throw this.createError("Document fields must not be empty");if(Rd(this.dataSource)&&Ty.test(t))throw this.createError('Document fields cannot begin and end with "__"')}}class vy{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||ci(t)}createContext(t,e,n,s=!1){return new ma({dataSource:t,methodName:e,targetDoc:n,path:ot.emptyPath(),arrayElement:!1,hasConverter:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function fi(r){const t=r._freezeSettings(),e=ci(r._databaseId);return new vy(r._databaseId,!!t.ignoreUndefinedProperties,e)}function Sd(r,t,e,n,s,i={}){const a=r.createContext(i.merge||i.mergeFields?2:0,t,e,s);ga("Data must be an object, but it was:",a,n);const u=Pd(n,a);let l,d;if(i.merge)l=new Ct(a.fieldMask),d=a.fieldTransforms;else if(i.mergeFields){const f=[];for(const p of i.mergeFields){const I=kr(t,p,e);if(!a.contains(I))throw new x(P.INVALID_ARGUMENT,`Field '${I}' is specified in your field mask but missing from your input data.`);Dd(f,I)||f.push(I)}l=new Ct(f),d=a.fieldTransforms.filter((p=>l.covers(p.field)))}else l=null,d=a.fieldTransforms;return new wy(new wt(u),l,d)}class mi extends di{_toFieldTransform(t){if(t.dataSource!==2)throw t.dataSource===1?t.createError(`${this._methodName}() can only appear at the top level of your update data`):t.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof mi}}class pa extends di{constructor(t,e){super(t),this.Vc=e}_toFieldTransform(t){const e=new Cn(t.serializer,hh(t.serializer,this.Vc));return new gh(t.path,e)}isEqual(t){return t instanceof pa&&this.Vc===t.Vc}}function Ay(r,t,e,n){const s=r.createContext(1,t,e);ga("Data must be an object, but it was:",s,n);const i=[],a=wt.empty();be(n,((l,d)=>{const f=Cd(t,l,e);d=Ht(d);const p=s.childContextForFieldPath(f);if(d instanceof mi)i.push(f);else{const I=$r(d,p);I!=null&&(i.push(f),a.set(f,I))}}));const u=new Ct(i);return new bd(a,u,s.fieldTransforms)}function by(r,t,e,n,s,i){const a=r.createContext(1,t,e),u=[kr(t,n,e)],l=[s];if(i.length%2!=0)throw new x(P.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let I=0;I<i.length;I+=2)u.push(kr(t,i[I])),l.push(i[I+1]);const d=[],f=wt.empty();for(let I=u.length-1;I>=0;--I)if(!Dd(d,u[I])){const S=u[I];let C=l[I];C=Ht(C);const k=a.childContextForFieldPath(S);if(C instanceof mi)d.push(S);else{const M=$r(C,k);M!=null&&(d.push(S),f.set(S,M))}}const p=new Ct(d);return new bd(f,p,a.fieldTransforms)}function Ry(r,t,e,n=!1){return $r(e,r.createContext(n?4:3,t))}function $r(r,t){if(Vd(r=Ht(r)))return ga("Unsupported field value:",t,r),Pd(r,t);if(r instanceof di)return(function(n,s){if(!Rd(s.dataSource))throw s.createError(`${n._methodName}() can only be used with update() and set()`);if(!s.path)throw s.createError(`${n._methodName}() is not currently supported inside arrays`);const i=n._toFieldTransform(s);i&&s.fieldTransforms.push(i)})(r,t),null;if(r===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),r instanceof Array){if(t.settings.arrayElement&&t.dataSource!==4)throw t.createError("Nested arrays are not supported");return(function(n,s){const i=[];let a=0;for(const u of n){let l=$r(u,s.childContextForArray(a));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),a++}return{arrayValue:{values:i}}})(r,t)}return(function(n,s){if((n=Ht(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return hh(s.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const i=X.fromDate(n);return{timestampValue:Dn(s.serializer,i)}}if(n instanceof X){const i=new X(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Dn(s.serializer,i)}}if(n instanceof Kt)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Mt)return{bytesValue:vh(s.serializer,n._byteString)};if(n instanceof ct){const i=s.databaseId,a=n.firestore._databaseId;if(!a.isEqual(i))throw s.createError(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Qo(n.firestore._databaseId||s.databaseId,n._key.path)}}if(n instanceof Ut)return(function(a,u){const l=a instanceof Ut?a.toArray():a;return{mapValue:{fields:{[Uo]:{stringValue:qo},[An]:{arrayValue:{values:l.map((f=>{if(typeof f!="number")throw u.createError("VectorValues must only contain numeric values.");return zo(u.serializer,f)}))}}}}}})(n,s);if(kh(n))return n._toProto(s.serializer);throw s.createError(`Unsupported field value: ${Ws(n)}`)})(r,t)}function Pd(r,t){const e={};return ql(r)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):be(r,((n,s)=>{const i=$r(s,t.childContextForField(n));i!=null&&(e[n]=i)})),{mapValue:{fields:e}}}function Vd(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof X||r instanceof Kt||r instanceof Mt||r instanceof ct||r instanceof di||r instanceof Ut||kh(r))}function ga(r,t,e){if(!Vd(e)||!Rl(e)){const n=Ws(e);throw n==="an object"?t.createError(r+" a custom object"):t.createError(r+" "+n)}}function kr(r,t,e){if((t=Ht(t))instanceof fa)return t._internalPath;if(typeof t=="string")return Cd(r,t);throw Hs("Field path arguments must be of type string or ",r,!1,void 0,e)}const Sy=new RegExp("[~\\*/\\[\\]]");function Cd(r,t,e){if(t.search(Sy)>=0)throw Hs(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,e);try{return new fa(...t.split("."))._internalPath}catch{throw Hs(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,e)}}function Hs(r,t,e,n,s){const i=n&&!n.isEmpty(),a=s!==void 0;let u=`Function ${t}() called with invalid data`;e&&(u+=" (via `toFirestore()`)"),u+=". ";let l="";return(i||a)&&(l+=" (found",i&&(l+=` in field ${n}`),a&&(l+=` in document ${s}`),l+=")"),new x(P.INVALID_ARGUMENT,u+r+l)}function Dd(r,t){return r.some((e=>e.isEqual(t)))}class Py{convertValue(t,e="none"){switch(Ie(t)){case 0:return null;case 1:return t.booleanValue;case 2:return st(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Zt(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw O(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return be(t,((s,i)=>{n[s]=this.convertValue(i,e)})),n}convertVectorValue(t){const e=t.fields?.[An].arrayValue?.values?.map((n=>st(n.doubleValue)));return new Ut(e)}convertGeoPoint(t){return new Kt(st(t.latitude),st(t.longitude))}convertArray(t,e){return(t.values||[]).map((n=>this.convertValue(n,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=ti(t);return n==null?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Pr(t));default:return null}}convertTimestamp(t){const e=Xt(t);return new X(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=Y.fromString(t);F(Nh(n),9688,{name:t});const s=new Ke(n.get(1),n.get(3)),i=new N(n.popFirst(5));return s.isEqual(e)||Rt(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}}class xd extends Py{constructor(t){super(),this.firestore=t}convertBytes(t){return new Mt(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new ct(this.firestore,null,e)}}function Fy(r){return new pa("increment",r)}const Jc="@firebase/firestore",Xc="4.11.0";function Zc(r){return(function(e,n){if(typeof e!="object"||e===null)return!1;const s=e;for(const i of n)if(i in s&&typeof s[i]=="function")return!0;return!1})(r,["next","error","complete"])}class Nd{constructor(t,e,n,s,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new ct(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new Vy(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(t){if(this._document){const e=this._document.data.field(kr("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}}class Vy extends Nd{data(){return super.data()}}function Cy(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new x(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class _a{}class Dy extends _a{}function Ly(r,t,...e){let n=[];t instanceof _a&&n.push(t),n=n.concat(e),(function(i){const a=i.filter((l=>l instanceof Ia)).length,u=i.filter((l=>l instanceof ya)).length;if(a>1||a>0&&u>0)throw new x(P.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(n);for(const s of n)r=s._apply(r);return r}class ya extends Dy{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new ya(t,e,n)}_apply(t){const e=this._parse(t);return kd(t._query,e),new Fn(t.firestore,t.converter,mo(t._query,e))}_parse(t){const e=fi(t.firestore);return(function(i,a,u,l,d,f,p){let I;if(d.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new x(P.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){el(p,f);const C=[];for(const k of p)C.push(tl(l,i,k));I={arrayValue:{values:C}}}else I=tl(l,i,p)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||el(p,f),I=Ry(u,a,p,f==="in"||f==="not-in");return K.create(d,f,I)})(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}}class Ia extends _a{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new Ia(t,e)}_parse(t){const e=this._queryConstraints.map((n=>n._parse(t))).filter((n=>n.getFilters().length>0));return e.length===1?e[0]:Z.create(e,this._getOperator())}_apply(t){const e=this._parse(t);return e.getFilters().length===0?t:((function(s,i){let a=s;const u=i.getFlattenedFilters();for(const l of u)kd(a,l),a=mo(a,l)})(t._query,e),new Fn(t.firestore,t.converter,mo(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function tl(r,t,e){if(typeof(e=Ht(e))=="string"){if(e==="")throw new x(P.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!sh(t)&&e.indexOf("/")!==-1)throw new x(P.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);const n=t.path.child(Y.fromString(e));if(!N.isDocumentKey(n))throw new x(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return Cr(r,new N(n))}if(e instanceof ct)return Cr(r,e._key);throw new x(P.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Ws(e)}.`)}function el(r,t){if(!Array.isArray(r)||r.length===0)throw new x(P.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function kd(r,t){const e=(function(s,i){for(const a of s)for(const u of a.getFlattenedFilters())if(i.indexOf(u.op)>=0)return u.op;return null})(r.filters,(function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(t.op));if(e!==null)throw e===t.op?new x(P.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new x(P.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}function Md(r,t,e){let n;return n=r?r.toFirestore(t):t,n}class lr{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Ge extends Nd{constructor(t,e,n,s,i,a){super(t,e,n,s,a),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new bs(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(kr("DocumentSnapshot.get",t));if(n!==null)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new x(P.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t=this._document,e={};return e.type=Ge._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?e:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e)}}Ge._jsonSchemaVersion="firestore/documentSnapshot/1.0",Ge._jsonSchema={type:ht("string",Ge._jsonSchemaVersion),bundleSource:ht("string","DocumentSnapshot"),bundleName:ht("string"),bundle:ht("string")};class bs extends Ge{data(t={}){return super.data(t)}}class yn{constructor(t,e,n,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new lr(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new bs(this._firestore,this._userDataWriter,n.key,n,new lr(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new x(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=(function(s,i){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map((u=>{const l=new bs(s._firestore,s._userDataWriter,u.doc.key,u.doc,new lr(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);return u.doc,{type:"added",doc:l,oldIndex:-1,newIndex:a++}}))}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((u=>i||u.type!==3)).map((u=>{const l=new bs(s._firestore,s._userDataWriter,u.doc.key,u.doc,new lr(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,f=-1;return u.type!==0&&(d=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),f=a.indexOf(u.doc.key)),{type:xy(u.type),doc:l,oldIndex:d,newIndex:f}}))}})(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new x(P.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t={};t.type=yn._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=xo.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const e=[],n=[],s=[];return this.docs.forEach((i=>{i._document!==null&&(e.push(i._document),n.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))})),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}}function xy(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return O(61501,{type:r})}}yn._jsonSchemaVersion="firestore/querySnapshot/1.0",yn._jsonSchema={type:ht("string",yn._jsonSchemaVersion),bundleSource:ht("string","QuerySnapshot"),bundleName:ht("string"),bundle:ht("string")};function By(r){r=Ft(r,ct);const t=Ft(r.firestore,ve),e=da(t);return my(e,r._key).then((n=>Od(t,r,n)))}function Uy(r,t,e){r=Ft(r,ct);const n=Ft(r.firestore,ve),s=Md(r.converter,t),i=fi(n);return Ea(n,[Sd(i,"setDoc",r._key,s,r.converter!==null,e).toMutation(r._key,St.none())])}function qy(r,t,e,...n){r=Ft(r,ct);const s=Ft(r.firestore,ve),i=fi(s);let a;return a=typeof(t=Ht(t))=="string"||t instanceof fa?by(i,"updateDoc",r._key,t,e,n):Ay(i,"updateDoc",r._key,t),Ea(s,[a.toMutation(r._key,St.exists(!0))])}function jy(r,t){const e=Ft(r.firestore,ve),n=Iy(r),s=Md(r.converter,t),i=fi(r.firestore);return Ea(e,[Sd(i,"addDoc",n._key,s,r.converter!==null,{}).toMutation(n._key,St.exists(!1))]).then((()=>n))}function zy(r,...t){r=Ht(r);let e={includeMetadataChanges:!1,source:"default"},n=0;typeof t[n]!="object"||Zc(t[n])||(e=t[n++]);const s={includeMetadataChanges:e.includeMetadataChanges,source:e.source};if(Zc(t[n])){const d=t[n];t[n]=d.next?.bind(d),t[n+1]=d.error?.bind(d),t[n+2]=d.complete?.bind(d)}let i,a,u;if(r instanceof ct)a=Ft(r.firestore,ve),u=Br(r._key.path),i={next:d=>{t[n]&&t[n](Od(a,r,d))},error:t[n+1],complete:t[n+2]};else{const d=Ft(r,Fn);a=Ft(d.firestore,ve),u=d._query;const f=new xd(a);i={next:p=>{t[n]&&t[n](new yn(a,f,d,p))},error:t[n+1],complete:t[n+2]},Cy(r._query)}const l=da(a);return fy(l,u,s,i)}function Ea(r,t){const e=da(r);return py(e,t)}function Od(r,t,e){const n=e.docs.get(t._key),s=new xd(r);return new Ge(r,s,t._key,n,new lr(e.hasPendingWrites,e.fromCache),t.converter)}(function(t,e=!0){Jm(Om),Cs(new Er("firestore",((n,{instanceIdentifier:s,options:i})=>{const a=n.getProvider("app").getImmediate(),u=new ve(new tp(n.getProvider("auth-internal")),new rp(a,n.getProvider("app-check-internal")),zp(a,s),a);return i={useFetchStreams:e,...i},u._setSettings(i),u}),"PUBLIC").setMultipleInstances(!0)),pn(Jc,Xc,t),pn(Jc,Xc,"esm2020")})();export{jy as a,By as b,ky as c,Iy as d,Oy as e,Fy as f,My as g,Fm as i,zy as o,Ly as q,Uy as s,qy as u};
